!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1419)}([function(t,e,n){"use strict";const r=n(5).MongoError,i=n(19),o=n(46);var s=e.formatSortValue=function(t){switch((""+t).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},a=e.formattedOrderClause=function(t){var e={};if(null==t)return null;if(Array.isArray(t)){if(0===t.length)return null;for(var n=0;n<t.length;n++)t[n].constructor===String?e[t[n]]=1:e[t[n][0]]=s(t[n][1])}else if(null!=t&&"object"==typeof t)e=t;else{if("string"!=typeof t)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");e[t]=1}return e},c=e.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},u=["w","j","wtimeout","fsync"];const l=process.emitWarning?t=>process.emitWarning(t,"DeprecationWarning"):t=>console.error(t);function h(t,e){return`${t} option [${e}] is deprecated and will be removed in a later version.`}const f={};try{n(156),f.ASYNC_ITERATOR=!0}catch(t){f.ASYNC_ITERATOR=!1}class p{constructor(t,e){this.db=t,this.collection=e}toString(){return this.collection?`${this.db}.${this.collection}`:this.db}withCollection(t){return new p(this.db,t)}static fromString(t){if(!t)throw new Error(`Cannot parse namespace from "${t}"`);const e=t.indexOf(".");return new p(t.substring(0,e),t.substring(e+1))}}function d(){const t=process.hrtime();return Math.floor(1e3*t[0]+t[1]/1e6)}t.exports={filterOptions:function(t,e){var n={};for(var r in t)-1!==e.indexOf(r)&&(n[r]=t[r]);return n},mergeOptions:function(t,e){for(var n in e)t[n]=e[n];return t},translateOptions:function(t,e){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var r in e)n[r]?t[n[r]]=e[r]:t[r]=e[r];return t},shallowClone:function(t){var e={};for(var n in t)e[n]=t[n];return e},getSingleProperty:function(t,e,n){Object.defineProperty(t,e,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(t){if("string"!=typeof t)throw new r("collection name must be a String");if(!t||-1!==t.indexOf(".."))throw new r("collection names cannot be empty");if(-1!==t.indexOf("$")&&null==t.match(/((^\$cmd)|(oplog\.\$main))/))throw new r("collection names must not contain '$'");if(null!=t.match(/^\.|\.$/))throw new r("collection names must not start or end with '.'");if(-1!==t.indexOf("\0"))throw new r("collection names cannot contain a null character")},toError:function(t){if(t instanceof Error)return t;for(var e=t.err||t.errmsg||t.errMessage||t,n=r.create({message:e,driver:!0}),i="object"==typeof t?Object.keys(t):[],o=0;o<i.length;o++)try{n[i[o]]=t[i[o]]}catch(t){}return n},formattedOrderClause:a,parseIndexOptions:function(t){var e,n={},r=[];return"string"==typeof t?(r.push(t+"_1"),n[t]=1):Array.isArray(t)?t.forEach((function(t){"string"==typeof t?(r.push(t+"_1"),n[t]=1):Array.isArray(t)?(r.push(t[0]+"_"+(t[1]||1)),n[t[0]]=t[1]||1):c(t)&&(e=Object.keys(t)).forEach((function(e){r.push(e+"_"+t[e]),n[e]=t[e]}))})):c(t)&&(e=Object.keys(t)).forEach((function(e){r.push(e+"_"+t[e]),n[e]=t[e]})),{name:r.join("_"),keys:e,fieldHash:n}},normalizeHintField:function(t){var e=null;if("string"==typeof t)e=t;else if(Array.isArray(t))e={},t.forEach((function(t){e[t]=1}));else if(null!=t&&"object"==typeof t)for(var n in e={},t)e[n]=t[n];return e},handleCallback:function(t,e,n,r){try{if(null==t)return;if(t)return r?t(e,n,r):t(e,n)}catch(e){return process.nextTick((function(){throw e})),!1}return!0},decorateCommand:function(t,e,n){for(var r in e)-1===n.indexOf(r)&&(t[r]=e[r]);return t},isObject:c,debugOptions:function(t,e){var n={};return t.forEach((function(t){n[t]=e[t]})),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(t,e,n,r){for(var i=0;i<n.length;i++)t[n[i]]||void 0===e[n[i]]||(t[n[i]]=e[n[i]]);if(!r)return t;var o=!1;for(i=0;i<u.length;i++)if(t[u[i]]){o=!0;break}if(!o)for(i=0;i<u.length;i++)e[u[i]]&&(t[u[i]]=e[u[i]]);return t},translateReadPreference:function(t){var e=null;if(!t.readPreference)return t;if("string"==typeof(e=t.readPreference))t.readPreference=new i(e);else if(!e||e instanceof i||"object"!=typeof e){if(!(e instanceof i))throw new TypeError("Invalid read preference: "+e)}else{const n=e.mode||e.preference;n&&"string"==typeof n&&(t.readPreference=new i(n,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}))}return t},executeLegacyOperation:(t,e,n,i)=>{if(null==t)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");i=i||{};const o=t.s.promiseLibrary;let s,a,c,u=n[n.length-1];if(!i.skipSessions&&t.hasSessionSupport())if(a=n[n.length-2],null==a||null==a.session){c=Symbol(),s=t.startSession({owner:c});const e=n.length-2;n[e]=Object.assign({},n[e],{session:s})}else if(a.session&&a.session.hasEnded)throw new r("Use of expired sessions is not permitted");const l=(t,e)=>function(n,r){if(s&&s.owner===c&&!i.returnsCursor)s.endSession(()=>{if(delete a.session,n)return e(n);t(r)});else{if(n)return e(n);t(r)}};if("function"==typeof u){u=n.pop();const t=l(t=>u(null,t),t=>u(t,null));n.push(t);try{return e.apply(null,n)}catch(e){throw t(e),e}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeLegacyOperation` must be a callback");return new o((function(t,r){const i=l(t,r);n[n.length-1]=i;try{return e.apply(null,n)}catch(t){i(t)}}))},applyRetryableWrites:function(t,e){return e&&e.s.options.retryWrites&&(t.retryWrites=!0),t},applyWriteConcern:function(t,e,n){n=n||{};const r=e.db,i=e.collection;if(n.session&&n.session.inTransaction())return t.writeConcern&&delete t.writeConcern,t;const s=o.fromOptions(n);return s?Object.assign(t,{writeConcern:s}):i&&i.writeConcern?Object.assign(t,{writeConcern:Object.assign({},i.writeConcern)}):r&&r.writeConcern?Object.assign(t,{writeConcern:Object.assign({},r.writeConcern)}):t},isPromiseLike:function(t){return t&&"function"==typeof t.then},decorateWithCollation:function(t,e,n){const i=e.s&&e.s.topology||e.topology;if(!i)throw new TypeError('parameter "target" is missing a topology');const o=i.capabilities();if(n.collation&&"object"==typeof n.collation){if(!o||!o.commandsTakeCollation)throw new r("Current topology does not support collation");t.collation=n.collation}},decorateWithReadConcern:function(t,e,n){if(n&&n.session&&n.session.inTransaction())return;let r=Object.assign({},t.readConcern||{});e.s.readConcern&&Object.assign(r,e.s.readConcern),Object.keys(r).length>0&&Object.assign(t,{readConcern:r})},deprecateOptions:function(t,e){if(!0===process.noDeprecation)return e;const n=t.msgHandler?t.msgHandler:h,r=new Set;function i(){const i=arguments[t.optionsIndex];return c(i)&&0!==Object.keys(i).length?(t.deprecatedOptions.forEach(e=>{if(i.hasOwnProperty(e)&&!r.has(e)){r.add(e);const i=n(t.name,e);if(l(i),this&&this.getLogger){const t=this.getLogger();t&&t.warn(i)}}}),e.apply(this,arguments)):e.apply(this,arguments)}return Object.setPrototypeOf(i,e),e.prototype&&(i.prototype=e.prototype),i},SUPPORTS:f,MongoDBNamespace:p,resolveReadPreference:function(t,e){const n=(e=e||{}).session,r=t.readPreference;let o;if(e.readPreference)o=i.fromOptions(e);else if(n&&n.inTransaction()&&n.transaction.options.readPreference)o=n.transaction.options.readPreference;else{if(null==r)throw new Error("No readPreference was provided or inherited.");o=r}return"string"==typeof o?new i(o):o},emitDeprecationWarning:l,makeCounter:function*(t){let e=t||0;for(;;){const t=e;e+=1,yield t}},maybePromise:function(t,e,n){const r=t&&t.s&&t.s.promiseLibrary||Promise;let i;return"function"!=typeof e&&(i=new r((t,n)=>{e=(e,r)=>{if(e)return n(e);t(r)}})),n((function(t,n){if(null==t)e(t,n);else try{e(t)}catch(t){return process.nextTick(()=>{throw t})}})),i},now:d,calculateDurationInMs:function(t){if("number"!=typeof t)throw TypeError("numeric value required to calculate duration");const e=d()-t;return e<0?0:e},makeInterruptableAsyncInterval:function(t,e){let n,r,i,o=!1;const s=(e=e||{}).interval||1e3,a=e.minInterval||500;function c(t){o||(clearTimeout(n),n=setTimeout(u,t||s))}function u(){i=0,r=d(),t(t=>{if(t)throw t;c(s)})}return"boolean"==typeof e.immediate&&e.immediate?u():(r=d(),c()),{wake:function(){const t=d(),e=t-i,n=t-r,o=Math.max(s-n,0);i=t,e<a||o>a&&c(a)},stop:function(){o=!0,n&&(clearTimeout(n),n=null),r=0,i=0}}}}},function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return a})),n.d(e,"h",(function(){return c})),n.d(e,"e",(function(){return u})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return h}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return p})),n.d(e,"c",(function(){return A})),n.d(e,"d",(function(){return I})),n.d(e,"e",(function(){return U})),n.d(e,"f",(function(){return C})),n.d(e,"g",(function(){return o})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"k",(function(){return D})),n.d(e,"l",(function(){return V})),n.d(e,"m",(function(){return h})),n.d(e,"n",(function(){return f})),n.d(e,"o",(function(){return H})),n.d(e,"p",(function(){return d})),n.d(e,"q",(function(){return M})),n.d(e,"r",(function(){return g})),n.d(e,"s",(function(){return v})),n.d(e,"t",(function(){return _})),n.d(e,"u",(function(){return L})),n.d(e,"v",(function(){return w})),n.d(e,"w",(function(){return E})),n.d(e,"x",(function(){return m})),n.d(e,"y",(function(){return y})),n.d(e,"z",(function(){return O})),n.d(e,"A",(function(){return b})),n.d(e,"B",(function(){return S})),n.d(e,"C",(function(){return R})),n.d(e,"D",(function(){return N})),n.d(e,"E",(function(){return F})),n.d(e,"F",(function(){return B})),n.d(e,"G",(function(){return $})),n.d(e,"H",(function(){return Y})),n.d(e,"I",(function(){return Q})),n.d(e,"J",(function(){return P})),n.d(e,"K",(function(){return z})),n.d(e,"L",(function(){return K})),n.d(e,"M",(function(){return G})),n.d(e,"N",(function(){return T}));var r=n(1),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw s(e)},s=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},a=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,l=o>>2,h=(3&o)<<4|a>>4,f=(15&a)<<2|u>>6,p=63&u;c||(p=64,s||(f=64)),r.push(n[l],n[h],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,c=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==c)throw Error();var u=o<<2|s>>4;if(r.push(u),64!==a){var l=s<<4&240|a>>2;if(r.push(l),64!==c){var h=a<<6&192|c;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},u=function(t){var e=a(t);return c.encodeByteArray(e,!0)},l=function(t){try{return c.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function h(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=f(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function y(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}function g(){return"object"==typeof self&&self.self===self}function v(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function b(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function _(){return d().indexOf("Electron/")>=0}function w(){var t=d();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function S(){return d().indexOf("MSAppHost/")>=0}function O(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}function E(){return"indexedDB"in window&&null!==indexedDB}function T(){return new Promise((function(t,e){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=window.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||window.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}function C(){return!(!navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var I=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,A.prototype.create),i}return Object(r.c)(e,t),e}(Error),A=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?k(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",c=new I(i,a),u=0,l=Object.keys(r);u<l.length;u++){var h=l[u];"_"!==h.slice(-1)&&(h in c&&console.warn('Overwriting FirebaseError base field "'+h+'" can cause unexpected behavior.'),c[h]=r[h])}return c},t}();function k(t,e){return t.replace(x,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var x=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N(t){return JSON.parse(t)}function P(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var j=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=N(l(o[0])||""),n=N(l(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},R=function(t){var e=j(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},M=function(t){var e=j(t).claims;return"object"==typeof e&&!0===e.admin};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function $(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function L(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function F(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var U=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=l^c&(u^l),s=1518500249):(o=c^u^l,s=1859775393):r<60?(o=c&u|l&(c|u),s=2400959708):(o=c^u^l,s=3395469782);i=(a<<5|a>>>27)+o+h+s+n[r]&4294967295;h=l,l=u,u=4294967295&(c<<30|c>>>2),c=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function V(t,e){var n=new q(t,e);return n.subscribe.bind(n)}var q=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=W),void 0===r.error&&(r.error=W),void 0===r.complete&&(r.complete=W);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function W(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var z=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function H(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function K(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(H(t,e,r)+"must be a valid function.")}function G(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(H(t,e,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Q=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var s=i-55296;r++,o(r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(s<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},Y=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e}},function(t,e,n){"use strict";let r=n(153);const i=n(119),o=n(9).retrieveEJSON();try{const t=i("bson-ext");t&&(r=t)}catch(t){}t.exports={MongoError:n(5).MongoError,MongoNetworkError:n(5).MongoNetworkError,MongoParseError:n(5).MongoParseError,MongoTimeoutError:n(5).MongoTimeoutError,MongoServerSelectionError:n(5).MongoServerSelectionError,MongoWriteConcernError:n(5).MongoWriteConcernError,Connection:n(154),Server:n(121),ReplSet:n(276),Mongos:n(278),Logger:n(34),Cursor:n(35).CoreCursor,ReadPreference:n(19),Sessions:n(47),BSON:r,EJSON:o,Topology:n(279).Topology,Query:n(37).Query,MongoCredentials:n(296).MongoCredentials,defaultAuthProviders:n(160).defaultAuthProviders,MongoCR:n(161),X509:n(162),Plain:n(163),GSSAPI:n(164),ScramSHA1:n(96).ScramSHA1,ScramSHA256:n(96).ScramSHA256,parseConnectionString:n(297)}},function(t,e,n){"use strict";const r={READ_OPERATION:Symbol("READ_OPERATION"),WRITE_OPERATION:Symbol("WRITE_OPERATION"),RETRYABLE:Symbol("RETRYABLE"),EXECUTE_WITH_SELECTION:Symbol("EXECUTE_WITH_SELECTION")};t.exports={Aspect:r,defineAspects:function(t,e){return Array.isArray(e)||e instanceof Set||(e=[e]),e=new Set(e),Object.defineProperty(t,"aspects",{value:e,writable:!1}),e},OperationBase:class{constructor(t){this.options=Object.assign({},t)}hasAspect(t){return null!=this.constructor.aspects&&this.constructor.aspects.has(t)}set session(t){Object.assign(this.options,{session:t})}get session(){return this.options.session}clearSession(){delete this.options.session}get canRetryRead(){return!0}execute(){throw new TypeError("`execute` must be implemented for OperationBase subclasses")}}}},function(t,e,n){"use strict";class r extends Error{constructor(t){if(t instanceof Error)super(t.message),this.stack=t.stack;else{if("string"==typeof t)super(t);else for(var e in super(t.message||t.errmsg||t.$err||"n/a"),t)"errmsg"!==e&&(this[e]=t[e]);Error.captureStackTrace(this,this.constructor)}this.name="MongoError"}get errmsg(){return this.message}static create(t){return new r(t)}hasErrorLabel(t){return this.errorLabels&&-1!==this.errorLabels.indexOf(t)}}class i extends r{constructor(t){super(t),this.name="MongoNetworkError"}}class o extends r{constructor(t){super(t),this.name="MongoParseError"}}class s extends r{constructor(t,e){e&&e.error?super(e.error.message||e.error):super(t),this.name="MongoTimeoutError",e&&(this.reason=e)}}const a=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);const c=new Set([91,189,11600,11602,13436]),u=new Set([10107,13435]),l=new Set([11600,91]);function h(t){return!(!t.code||!c.has(t.code))||(t.message.match(/not master or secondary/)||t.message.match(/node is recovering/))}t.exports={MongoError:r,MongoNetworkError:i,MongoParseError:o,MongoTimeoutError:s,MongoServerSelectionError:class extends s{constructor(t,e){super(t,e),this.name="MongoServerSelectionError"}},MongoWriteConcernError:class extends r{constructor(t,e){super(t),this.name="MongoWriteConcernError",null!=e&&(this.result=function(t){const e=Object.assign({},t);return 0===e.ok&&(e.ok=1,delete e.errmsg,delete e.code,delete e.codeName),e}(e))}},isRetryableError:function(t){return a.has(t.code)||t instanceof i||t.message.match(/not master/)||t.message.match(/node is recovering/)},isSDAMUnrecoverableError:function(t){return t instanceof o||null==t||!!(h(t)||(e=t,e.code&&u.has(e.code)||!h(e)&&e.message.match(/not master/)));var e},isNodeShuttingDownError:function(t){return t.code&&l.has(t.code)},isNetworkTimeoutError:function(t){return t instanceof i&&t.message.match(/timed out/)}}},function(t,e){t.exports=require("util")},,function(t,e,n){"use strict";e.arrayAtomicsSymbol=Symbol("mongoose#Array#_atomics"),e.arrayParentSymbol=Symbol("mongoose#Array#_parent"),e.arrayPathSymbol=Symbol("mongoose#Array#_path"),e.arraySchemaSymbol=Symbol("mongoose#Array#_schema"),e.documentArrayParent=Symbol("mongoose:documentArrayParent"),e.documentSchemaSymbol=Symbol("mongoose#Document#schema"),e.getSymbol=Symbol("mongoose#Document#get"),e.modelSymbol=Symbol("mongoose#Model"),e.objectIdSymbol=Symbol("mongoose#ObjectId"),e.populateModelSymbol=Symbol("mongoose.PopulateOptions#Model"),e.schemaTypeSymbol=Symbol("mongoose#schemaType"),e.scopeSymbol=Symbol("mongoose#Document#scope"),e.validatorErrorSymbol=Symbol("mongoose:validatorError")},function(t,e,n){"use strict";const r=n(150),i=n(53),o=n(119);const s=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};function a(t){if(t){if(t.ismaster)return t.ismaster.maxWireVersion;if("function"==typeof t.lastIsMaster){const e=t.lastIsMaster();if(e)return e.maxWireVersion}if(t.description)return t.description.maxWireVersion}return 0}t.exports={uuidV4:()=>{const t=i.randomBytes(16);return t[6]=15&t[6]|64,t[8]=63&t[8]|128,t},relayEvents:function(t,e,n){n.forEach(n=>t.on(n,t=>e.emit(n,t)))},collationNotSupported:function(t,e){return e&&e.collation&&a(t)<5},retrieveEJSON:function(){let t=null;try{t=o("mongodb-extjson")}catch(t){}return t||(t={parse:s,deserialize:s,serialize:s,stringify:s,setBSONModule:s,BSON:s}),t},retrieveKerberos:function(){let t;try{t=o("kerberos")}catch(t){if("MODULE_NOT_FOUND"===t.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw t}return t},maxWireVersion:a,isPromiseLike:function(t){return t&&"function"==typeof t.then},eachAsync:function(t,e,n){t=t||[];let r=0,i=0;for(r=0;r<t.length;++r)i++,e(t[r],o);function o(e){i--,e?n(e):r===t.length&&i<=0&&n()}0!==i||n()},isUnifiedTopology:function(t){return null!=t.description},arrayStrictEqual:function(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&(t.length===e.length&&t.every((t,n)=>t===e[n]))},tagsStrictEqual:function(t,e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&n.every(n=>e[n]===t[n])},errorStrictEqual:function(t,e){return t===e||!(null==t&&null!=e||null!=t&&null==e)&&(t.constructor.name===e.constructor.name&&t.message===e.message)},makeStateMachine:function(t){return function(e,n){const r=t[e.s.state];if(r&&r.indexOf(n)<0)throw new TypeError(`illegal state transition from [${e.s.state}] => [${n}], allowed: [${r}]`);e.emit("stateChanged",e.s.state,n),e.s.state=n}},makeClientMetadata:function(t){t=t||{};const e={driver:{name:"nodejs",version:n(262).version},os:{type:r.type(),name:process.platform,architecture:process.arch,version:r.release()},platform:`'Node.js ${process.version}, ${r.endianness} (${t.useUnifiedTopology?"unified":"legacy"})`};if(t.driverInfo&&(t.driverInfo.name&&(e.driver.name=`${e.driver.name}|${t.driverInfo.name}`),t.driverInfo.version&&(e.version=`${e.driver.version}|${t.driverInfo.version}`),t.driverInfo.platform&&(e.platform=`${e.platform}|${t.driverInfo.platform}`)),t.appname){const n=Buffer.from(t.appname);e.application={name:n.length>128?n.slice(0,128).toString("utf8"):t.appname}}return e},noop:()=>{}}},,function(t,e,n){"use strict";
/*!
 * Simplified lodash.get to work around the annoying null quirk. See:
 * https://github.com/lodash/lodash/issues/3659
 */function r(t,e){return null==t?t:t instanceof Map?t.get(e):t[e]}t.exports=function(t,e,n){const i=e.split(".");let o=e,s=t;for(const t of i){if(null==s)return n;if(null!=s[o])return s[o];s=r(s,t),o=o.substr(t.length+1)}return null==s?n:s}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(248),i=n(65),o=n(106),s=n(29).Buffer,a=n(63),c=n(42),u=n(346),l=n(49),h=n(64),f=n(194),p=n(193),d=n(107),m=n(24),y=n(133);let g;function v(t){if(Array.isArray(t.populate)){const n=[];t.populate.forEach((function(t){if(/[\s]/.test(t.path)){const r=Object.assign({},t);r.path.split(" ").forEach((function(t){r.path=t,n.push(e.populate(r)[0])}))}else n.push(e.populate(t)[0])})),t.populate=e.populate(n)}else null!=t.populate&&"object"==typeof t.populate&&(t.populate=e.populate(t.populate));const n=[],r=t.path.split(" ");null!=t.options&&(t.options=e.clone(t.options));for(const e of r)n.push(new u(Object.assign({},t,{path:e})));return n}
/*!
 * Return the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Object} obj
 */e.specialProperties=y,
/*!
 * Produces a collection name from model `name`. By default, just returns
 * the model name
 *
 * @param {String} name a model name
 * @param {Function} pluralize function that pluralizes the collection name
 * @return {String} a collection name
 * @api private
 */
e.toCollectionName=function(t,e){return"system.profile"===t||"system.indexes"===t?t:"function"==typeof e?e(t):t},
/*!
 * Determines if `a` and `b` are deep equal.
 *
 * Modified from node/lib/assert.js
 *
 * @param {any} a a value to compare to `b`
 * @param {any} b a value to compare to `a`
 * @return {Boolean}
 * @api private
 */
e.deepEqual=function t(n,r){if(n===r)return!0;if(n instanceof Date&&r instanceof Date)return n.getTime()===r.getTime();if(f(n,"ObjectID")&&f(r,"ObjectID")||f(n,"Decimal128")&&f(r,"Decimal128"))return n.toString()===r.toString();if(n instanceof RegExp&&r instanceof RegExp)return n.source===r.source&&n.ignoreCase===r.ignoreCase&&n.multiline===r.multiline&&n.global===r.global;if("object"!=typeof n&&"object"!=typeof r)return n===r;if(null===n||null===r||void 0===n||void 0===r)return!1;if(n.prototype!==r.prototype)return!1;if(n instanceof Number&&r instanceof Number)return n.valueOf()===r.valueOf();if(s.isBuffer(n))return e.buffer.areEqual(n,r);let i,o,a,c;d(n)&&(n=n.toObject()),d(r)&&(r=r.toObject());try{i=Object.keys(n),o=Object.keys(r)}catch(t){return!1}if(i.length!==o.length)return!1;for(i.sort(),o.sort(),c=i.length-1;c>=0;c--)if(i[c]!==o[c])return!1;for(c=i.length-1;c>=0;c--)if(a=i[c],!t(n[a],r[a]))return!1;return!0},
/*!
 * Get the last element of an array
 */
e.last=function(t){if(t.length>0)return t[t.length-1]},e.clone=l,
/*!
 * ignore
 */
e.promiseOrCallback=m,
/*!
 * ignore
 */
e.omit=function(t,e){if(null==e)return Object.assign({},t);Array.isArray(e)||(e=[e]);const n=Object.assign({},t);for(const t of e)delete n[t];return n},
/*!
 * Shallow copies defaults into options.
 *
 * @param {Object} defaults
 * @param {Object} options
 * @return {Object} the merged object
 * @api private
 */
e.options=function(t,e){const n=Object.keys(t);let r,i=n.length;for(e=e||{};i--;)r=n[i],r in e||(e[r]=t[r]);return e},
/*!
 * Generates a random string
 *
 * @api private
 */
e.random=function(){return Math.random().toString().substr(3)},
/*!
 * Merges `from` into `to` without overwriting existing properties.
 *
 * @param {Object} to
 * @param {Object} from
 * @api private
 */
e.merge=function t(n,r,i,o){i=i||{};const s=Object.keys(r);let a=0;const u=s.length;let l;o=o||"";const h=i.omitNested||{};for(;a<u;)if(l=s[a++],!(i.omit&&i.omit[l]||h[o]||y.has(l)))if(null==n[l])n[l]=r[l];else if(e.isObject(r[l])){if(e.isObject(n[l])||(n[l]={}),null!=r[l]){if(r[l].instanceOfSchema){n[l].instanceOfSchema?n[l].add(r[l].clone()):n[l]=r[l].clone();continue}if(r[l]instanceof c){n[l]=new c(r[l]);continue}}t(n[l],r[l],i,o?o+"."+l:l)}else i.overwrite&&(n[l]=r[l])},
/*!
 * Applies toObject recursively.
 *
 * @param {Document|Array|Object} obj
 * @return {Object}
 * @api private
 */
e.toObject=function t(r){let i;if(g||(g=n(22)),null==r)return r;if(r instanceof g)return r.toObject();if(Array.isArray(r)){i=[];for(const e of r)i.push(t(e));return i}if(e.isPOJO(r)){i={};for(const e in r)y.has(e)||(i[e]=t(r[e]));return i}return r},e.isObject=h,
/*!
 * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,
 * `arg` must be an object but not an instance of any special class, like String,
 * ObjectId, etc.
 *
 * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */
e.isPOJO=function(t){if(null==t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return!e||"Object"===e.constructor.name},
/*!
 * Determines if `obj` is a built-in object like an array, date, boolean,
 * etc.
 */
e.isNativeObject=function(t){return Array.isArray(t)||t instanceof Date||t instanceof Boolean||t instanceof Number||t instanceof String},
/*!
 * Determines if `val` is an object that has no own keys
 */
e.isEmptyObject=function(t){return null!=t&&"object"==typeof t&&0===Object.keys(t).length},
/*!
 * Search if `obj` or any POJOs nested underneath `obj` has a property named
 * `key`
 */
e.hasKey=function(t,n){const r=Object.keys(t);for(const i of r){if(i===n)return!0;if(e.isPOJO(t[i])&&e.hasKey(t[i],n))return!0}return!1},
/*!
 * A faster Array.prototype.slice.call(arguments) alternative
 * @api private
 */
e.args=o,
/*!
 * process.nextTick helper.
 *
 * Wraps `callback` in a try/catch + nextTick.
 *
 * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.
 *
 * @param {Function} callback
 * @api private
 */
e.tick=function(t){if("function"==typeof t)return function(){try{t.apply(this,arguments)}catch(t){process.nextTick((function(){throw t}))}}},
/*!
 * Returns true if `v` is an object that can be serialized as a primitive in
 * MongoDB
 */
e.isMongooseType=function(t){return t instanceof c||t instanceof a||t instanceof s},e.isMongooseObject=d,
/*!
 * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.
 *
 * @param {Object} object
 * @api private
 */
e.expires=function(t){if(!t||"Object"!==t.constructor.name)return;if(!("expires"in t))return;let e;e="string"!=typeof t.expires?t.expires:Math.round(r(t.expires)/1e3),t.expireAfterSeconds=e,delete t.expires},
/*!
 * populate helper
 */
e.populate=function(t,n,r,i,o,s,a,c){let l=null;if(1===arguments.length){if(t instanceof u)return[t];if(Array.isArray(t)){return h(t).map(t=>e.populate(t)[0])}l=e.isObject(t)?Object.assign({},t):{path:t}}else l="object"==typeof r?{path:t,select:n,match:r,options:i}:{path:t,select:n,model:r,match:i,options:o,populate:s,justOne:a,count:c};if("string"!=typeof l.path)throw new TypeError("utils.populate: invalid path. Expected string. Got typeof `"+typeof t+"`");return v(l);function h(t){const e=[];return t.forEach((function(t){if(/[\s]/.test(t.path)){t.path.split(" ").forEach((function(n){const r=Object.assign({},t);r.path=n,e.push(r)}))}else e.push(t)})),e}},e.getValue=function(t,e,n){return i.get(t,e,"_doc",n)},
/*!
 * Sets the value of `obj` at the given `path`.
 *
 * @param {String} path
 * @param {Anything} val
 * @param {Object} obj
 */
e.setValue=function(t,e,n,r,o){i.set(t,e,n,"_doc",r,o)},
/*!
 * Returns an array of values from object `o`.
 *
 * @param {Object} o
 * @return {Array}
 * @private
 */
e.object={},e.object.vals=function(t){const e=Object.keys(t);let n=e.length;const r=[];for(;n--;)r.push(t[e[n]]);return r},
/*!
 * @see exports.options
 */
e.object.shallowCopy=e.options;
/*!
 * Safer helper for hasOwnProperty checks
 *
 * @param {Object} obj
 * @param {String} prop
 */
const b=Object.prototype.hasOwnProperty;e.object.hasOwnProperty=function(t,e){return b.call(t,e)},
/*!
 * Determine if `val` is null or undefined
 *
 * @return {Boolean}
 */
e.isNullOrUndefined=function(t){return null==t},
/*!
 * ignore
 */
e.array={},
/*!
 * Flattens an array.
 *
 * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]
 *
 * @param {Array} arr
 * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.
 * @return {Array}
 * @private
 */
e.array.flatten=function t(e,n,r){return r||(r=[]),e.forEach((function(e){Array.isArray(e)?t(e,n,r):n&&!n(e)||r.push(e)})),r};
/*!
 * ignore
 */
const _=Object.prototype.hasOwnProperty;e.hasUserDefinedProperty=function(t,n){if(null==t)return!1;if(Array.isArray(n)){for(const r of n)if(e.hasUserDefinedProperty(t,r))return!0;return!1}if(_.call(t,n))return!0;if("object"==typeof t&&n in t){const e=t[n];return e!==Object.prototype[n]&&e!==Array.prototype[n]}return!1};
/*!
 * ignore
 */
const w=Math.pow(2,32)-1;e.isArrayIndex=function(t){return"number"==typeof t?t>=0&&t<=w:"string"==typeof t&&(!!/^\d+$/.test(t)&&((t=+t)>=0&&t<=w))},
/*!
 * Removes duplicate values from an array
 *
 * [1, 2, 3, 3, 5] => [1, 2, 3, 5]
 * [ ObjectId("550988ba0c19d57f697dc45e"), ObjectId("550988ba0c19d57f697dc45e") ]
 *    => [ObjectId("550988ba0c19d57f697dc45e")]
 *
 * @param {Array} arr
 * @return {Array}
 * @private
 */
e.array.unique=function(t){const e={},n={},r=[];for(const i of t)if("number"==typeof i||"string"==typeof i||null==i){if(e[i])continue;r.push(i),e[i]=!0}else if(i instanceof c){if(n[i.toString()])continue;r.push(i),n[i.toString()]=!0}else r.push(i);return r},
/*!
 * Determines if two buffers are equal.
 *
 * @param {Buffer} a
 * @param {Object} b
 */
e.buffer={},e.buffer.areEqual=function(t,e){if(!s.isBuffer(t))return!1;if(!s.isBuffer(e))return!1;if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;++n)if(t[n]!==e[n])return!1;return!0},e.getFunctionName=p,
/*!
 * Decorate buffers
 */
e.decorate=function(t,e){for(const n in e)y.has(n)||(t[n]=e[n])},e.mergeClone=function(t,n){d(n)&&(n=n.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1}));const r=Object.keys(n),i=r.length;let o,a=0;for(;a<i;)if(o=r[a++],!y.has(o))if(void 0===t[o])t[o]=e.clone(n[o],{transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1});else{let r=n[o];if(null==r||!r.valueOf||r instanceof Date||(r=r.valueOf()),e.isObject(r)){let n=r;d(r)&&!r.isMongooseBuffer&&(n=n.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1})),r.isMongooseBuffer&&(n=s.from(n)),e.mergeClone(t[o],n)}else t[o]=e.clone(r,{flattenDecimals:!1})}},e.each=function(t,e){for(const n of t)e(n)},
/*!
 * ignore
 */
e.getOption=function(t){const e=Array.prototype.slice.call(arguments,1);for(const n of e)if(null!=n[t])return n[t];return null},
/*!
 * ignore
 */
e.noop=function(){}},function(t,e){t.exports=require("events")},function(t,e,n){"use strict";const r=n(19),i=n(5).MongoError,o=n(27).ServerType,s=n(155).TopologyDescription;t.exports={getReadPreference:function(t,e){var n=t.readPreference||new r("primary");if(e.readPreference&&(n=e.readPreference),"string"==typeof n&&(n=new r(n)),!(n instanceof r))throw new i("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,COMPRESSION_DETAILS_SIZE:9,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012,OP_MSG:2013},parseHeader:function(t){return{length:t.readInt32LE(0),requestId:t.readInt32LE(4),responseTo:t.readInt32LE(8),opCode:t.readInt32LE(12)}},applyCommonQueryOptions:function(t,e){return Object.assign(t,{raw:"boolean"==typeof e.raw&&e.raw,promoteLongs:"boolean"!=typeof e.promoteLongs||e.promoteLongs,promoteValues:"boolean"!=typeof e.promoteValues||e.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers&&e.promoteBuffers,monitoring:"boolean"==typeof e.monitoring&&e.monitoring,fullResult:"boolean"==typeof e.fullResult&&e.fullResult}),"number"==typeof e.socketTimeout&&(t.socketTimeout=e.socketTimeout),e.session&&(t.session=e.session),"string"==typeof e.documentsReturnedIn&&(t.documentsReturnedIn=e.documentsReturnedIn),t},isSharded:function(t){if("mongos"===t.type)return!0;if(t.description&&t.description.type===o.Mongos)return!0;if(t.description&&t.description instanceof s){return Array.from(t.description.servers.values()).some(t=>t.type===o.Mongos)}return!1},databaseNamespace:function(t){return t.split(".")[0]},collectionNamespace:function(t){return t.split(".").slice(1).join(".")}}},function(t,e,n){"use strict";var r=n(67),i="undefined"==typeof navigator,o={e:{}},s,a="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null;function c(){try{var t=s;return s=null,t.apply(this,arguments)}catch(t){return o.e=t,o}}function u(t){return s=t,c}var l=function(t,e){var n={}.hasOwnProperty;function r(){for(var r in this.constructor=t,this.constructor$=e,e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}return r.prototype=e.prototype,t.prototype=new r,t.prototype};function h(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function f(t){return"function"==typeof t||"object"==typeof t&&null!==t}function p(t){return h(t)?new Error(T(t)):t}function d(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=t[n];return i[n]=e,i}function m(t,e,n){if(!r.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var i=Object.getOwnPropertyDescriptor(t,e);return null!=i?null==i.get&&null==i.set?i.value:n:void 0}function y(t,e,n){if(h(t))return t;var i={value:n,configurable:!0,enumerable:!1,writable:!0};return r.defineProperty(t,e,i),t}function g(t){throw t}var v=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(r.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var i=[],o=Object.create(null);null!=t&&!e(t);){var s;try{s=n(t)}catch(t){return i}for(var a=0;a<s.length;++a){var c=s[a];if(!o[c]){o[c]=!0;var u=Object.getOwnPropertyDescriptor(t,c);null!=u&&null==u.get&&null==u.set&&i.push(c)}}t=r.getPrototypeOf(t)}return i}}var i={}.hasOwnProperty;return function(n){if(e(n))return[];var r=[];t:for(var o in n)if(i.call(n,o))r.push(o);else{for(var s=0;s<t.length;++s)if(i.call(t[s],o))continue t;r.push(o)}return r}}(),b=/this\s*\.\s*\S+\s*=/;function _(t){try{if("function"==typeof t){var e=r.names(t.prototype),n=r.isES5&&e.length>1,i=e.length>0&&!(1===e.length&&"constructor"===e[0]),o=b.test(t+"")&&r.names(t).length>0;if(n||i||o)return!0}return!1}catch(t){return!1}}function w(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}var S=/^[a-z$_][a-z$_0-9]*$/i;function O(t){return S.test(t)}function E(t,e,n){for(var r=new Array(t),i=0;i<t;++i)r[i]=e+i+n;return r}function T(t){try{return t+""}catch(t){return"[no string representation]"}}function C(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function I(t){try{y(t,"isOperational",!0)}catch(t){}}function A(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function k(t){return C(t)&&r.propertyIsWritable(t,"stack")}var x="stack"in new Error?function(t){return k(t)?t:new Error(T(t))}:function(t){if(k(t))return t;try{throw new Error(T(t))}catch(t){return t}};function N(t){return{}.toString.call(t)}function P(t,e,n){for(var i=r.names(t),o=0;o<i.length;++o){var s=i[o];if(n(s))try{r.defineProperty(e,s,r.getDescriptor(t,s))}catch(t){}}}var j=function(t){return r.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var R="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};j=function(t){return r.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?R(t):null}}var M="undefined"!=typeof process&&"[object process]"===N(process).toLowerCase(),D="undefined"!=typeof process&&void 0!==process.env;function $(t){return D?process.env[t]:void 0}function L(){if("function"==typeof Promise)try{var t=new Promise((function(){}));if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function F(t,e){return t.bind(e)}var B={isClass:_,isIdentifier:O,inheritedDataKeys:v,getDataPropertyOrDefault:m,thrower:g,isArray:r.isArray,asArray:j,notEnumerableProp:y,isPrimitive:h,isObject:f,isError:C,canEvaluate:i,errorObj:o,tryCatch:u,inherits:l,withAppended:d,maybeWrapAsError:p,toFastProperties:w,filledRange:E,toString:T,canAttachTrace:k,ensureErrorObject:x,originatesFromRejection:A,markAsOriginatingFromRejection:I,classString:N,copyDescriptors:P,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:M,hasEnvVariables:D,env:$,global:a,getNativePromise:L,domainBind:F},U;B.isRecentNode=B.isNode&&(U=process.versions.node.split(".").map(Number),0===U[0]&&U[1]>10||U[0]>0),B.isNode&&B.toFastProperties(process);try{throw new Error}catch(t){B.lastLineError=t}t.exports=B},function(t,e,n){"use strict";const r=n(19),i=n(27).TopologyType,o=n(5).MongoError;function s(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}var a=function(t){return t.s.serverDescription||(t.s.serverDescription={address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),t.s.serverDescription},c=function(t,e){t.listeners("serverDescriptionChanged").length>0&&(t.emit("serverDescriptionChanged",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name,previousDescription:a(t),newDescription:e}),t.s.serverDescription=e)},u=function(t){return t.s.topologyDescription||(t.s.topologyDescription={topologyType:"Unknown",servers:[{address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),t.s.topologyDescription},l=function(t,e){return e||(e=t.ismaster),e?e.ismaster&&"isdbgrid"===e.msg?"Mongos":e.ismaster&&!e.hosts?"Standalone":e.ismaster?"RSPrimary":e.secondary?"RSSecondary":e.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},h=function(t){return function(e){if("destroyed"!==t.s.state){var n=(new Date).getTime();s(t,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0},(function(r,i){if(r)s(t,"serverHeartbeatFailed",{durationMS:o,failure:r,connectionId:t.name});else{t.emit("ismaster",i,t);var o=(new Date).getTime()-n;s(t,"serverHeartbeatSucceeded",{durationMS:o,reply:i.result,connectionId:t.name}),function(t,e,n){var r=l(t,e);return l(t,n)!==r}(t,t.s.ismaster,i.result)&&c(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:t.s.inTopology?l(t):"Standalone"}),t.s.ismaster=i.result,t.s.isMasterLatencyMS=o}if("function"==typeof e)return e(r,i);t.s.inquireServerStateTimeout=setTimeout(h(t),t.s.haInterval)}))}}};const f={endSessions:function(t,e){Array.isArray(t)||(t=[t]),this.command("admin.$cmd",{endSessions:t},{readPreference:r.primaryPreferred},()=>{"function"==typeof e&&e()})}};function p(t){return t.description?t.description.type:"mongos"===t.type?i.Sharded:"replset"===t.type?i.ReplicaSetWithPrimary:i.Single}const d="This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.";t.exports.SessionMixins=f,t.exports.resolveClusterTime=function(t,e){(null==t.clusterTime||e.clusterTime.greaterThan(t.clusterTime.clusterTime))&&(t.clusterTime=e)},t.exports.inquireServerState=h,t.exports.getTopologyType=l,t.exports.emitServerDescriptionChanged=c,t.exports.emitTopologyDescriptionChanged=function(t,e){t.listeners("topologyDescriptionChanged").length>0&&(t.emit("topologyDescriptionChanged",{topologyId:-1!==t.s.topologyId?t.s.topologyId:t.id,address:t.name,previousDescription:u(t),newDescription:e}),t.s.serverDescription=e)},t.exports.cloneOptions=function(t){var e={};for(var n in t)e[n]=t[n];return e},t.exports.createCompressionInfo=function(t){return t.compression&&t.compression.compressors?(t.compression.compressors.forEach((function(t){if("snappy"!==t&&"zlib"!==t)throw new Error("compressors must be at least one of snappy or zlib")})),t.compression.compressors):[]},t.exports.clone=function(t){return JSON.parse(JSON.stringify(t))},t.exports.diff=function(t,e){var n={servers:[]};t||(t={servers:[]});for(var r=0;r<t.servers.length;r++){for(var i=!1,o=0;o<e.servers.length;o++)if(e.servers[o].address.toLowerCase()===t.servers[r].address.toLowerCase()){i=!0;break}i||n.servers.push({address:t.servers[r].address,from:t.servers[r].type,to:"Unknown"})}for(o=0;o<e.servers.length;o++){for(i=!1,r=0;r<t.servers.length;r++)if(t.servers[r].address.toLowerCase()===e.servers[o].address.toLowerCase()){i=!0;break}i||n.servers.push({address:e.servers[o].address,from:"Unknown",to:e.servers[o].type})}for(r=0;r<t.servers.length;r++){var s=t.servers[r];for(o=0;o<e.servers.length;o++){var a=e.servers[o];s.address.toLowerCase()===a.address.toLowerCase()&&s.type!==a.type&&n.servers.push({address:s.address,from:s.type,to:a.type})}}return n},t.exports.Interval=function(t,e){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(t,e)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},t.exports.Timeout=function(t,e){var n=!1,r=()=>{n&&(clearTimeout(n),n=!1,t())};this.start=function(){return this.isRunning()||(n=setTimeout(r,e)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return!1!==n}},t.exports.isRetryableWritesSupported=function(t){return!(t.lastIsMaster().maxWireVersion<6)&&(!!t.logicalSessionTimeoutMinutes&&p(t)!==i.Single)},t.exports.getMMAPError=function(t){return 20===t.code&&t.errmsg.includes("Transaction numbers")?new o({message:d,errmsg:d,originalError:t}):t},t.exports.topologyType=p},function(t,e,n){"use strict";const r=n(28);
/*!
 * Module exports.
 */t.exports=r,r.messages=n(389),r.Messages=r.messages,r.DocumentNotFoundError=n(135),r.CastError=n(31),r.ValidationError=n(50),r.ValidatorError=n(200),r.VersionError=n(201),r.ParallelSaveError=n(202),r.OverwriteModelError=n(203),r.MissingSchemaError=n(390),r.DivergentArrayError=n(204),r.StrictModeError=n(68)},function(t,e,n){"use strict";var r,i,o=n(1),s=n(2),a=n(69),c=n(44),u=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),l=new s.c("app","Firebase",u),h=((i={})["@firebase/app"]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),f=new c.b("@firebase/app"),p=function(){function t(t,e,n){var r,i,c=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Object(s.m)(t),this.container=new a.b(e.name),this._addComponent(new a.a("app",(function(){return c}),"PUBLIC"));try{for(var u=Object(o.h)(this.firebase_.INTERNAL.components.values()),l=u.next();!l.done;l=u.next()){var h=l.value;this._addComponent(h)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){f.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},t}();p.prototype.name&&p.prototype.options||p.prototype.delete||console.log("dc");var d=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var a=o.name;if("string"!=typeof a||!a)throw l.create("bad-app-name",{appName:String(a)});if(Object(s.k)(e,a))throw l.create("duplicate-app",{appName:a});var c=new t(n,o,r);return e[a]=c,c},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=h[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&s&&c.push("and"),s&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void f.warn(c.join(" "))}u(new a.a(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:c.c,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw l.create("invalid-log-argument",{appName:name});Object(c.d)(t,e)},apps:null,SDK_VERSION:"7.17.1",INTERNAL:{registerComponent:u,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(t=t||"[DEFAULT]",!Object(s.k)(e,t))throw l.create("no-app",{appName:t});return e[t]}function u(a){var c,u,h=a.name;if(n.has(h))return f.debug("There were multiple attempts to register component "+h+"."),"PUBLIC"===a.type?r[h]:null;if(n.set(h,a),"PUBLIC"===a.type){var p=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[h])throw l.create("invalid-app-argument",{appName:h});return t[h]()};void 0!==a.serviceProps&&Object(s.n)(p,a.serviceProps),r[h]=p,t.prototype[h]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,h);return n.apply(this,a.multipleInstances?t:[])}}try{for(var d=Object(o.h)(Object.keys(e)),m=d.next();!m.done;m=d.next()){var y=m.value;e[y]._addComponent(a)}}catch(t){c={error:t}}finally{try{m&&!m.done&&(u=d.return)&&u.call(d)}finally{if(c)throw c.error}}return"PUBLIC"===a.type?r[h]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(p);return e.INTERNAL=Object(o.a)(Object(o.a)({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(s.n)(e,t)},createSubscribe:s.l,ErrorFactory:s.c,deepExtend:s.n}),e}(),m=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(Object(s.r)()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var y=self.firebase.SDK_VERSION;y&&y.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var g=d.initializeApp;d.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(s.y)()&&f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),g.apply(void 0,t)};var v=d;!function(t,e){t.INTERNAL.registerComponent(new a.a("platform-logger",(function(t){return new m(t)}),"PRIVATE")),t.registerVersion("@firebase/app","0.6.9",e),t.registerVersion("fire-js","")}(v),e.a=v},function(t,e,n){"use strict";const r=function(t,e,n){if(!r.isValid(t))throw new TypeError(`Invalid read preference mode ${t}`);if(e&&!Array.isArray(e)&&(console.warn("ReadPreference tags must be an array, this will change in the next major version"),void 0!==e.maxStalenessSeconds?(n=e,e=void 0):e=[e]),this.mode=t,this.tags=e,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===r.PRIMARY){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}};Object.defineProperty(r.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),r.PRIMARY="primary",r.PRIMARY_PREFERRED="primaryPreferred",r.SECONDARY="secondary",r.SECONDARY_PREFERRED="secondaryPreferred",r.NEAREST="nearest";const i=[r.PRIMARY,r.PRIMARY_PREFERRED,r.SECONDARY,r.SECONDARY_PREFERRED,r.NEAREST,null];r.fromOptions=function(t){const e=t.readPreference,n=t.readPreferenceTags;if(null==e)return null;if("string"==typeof e)return new r(e,n);if(!(e instanceof r)&&"object"==typeof e){const t=e.mode||e.preference;if(t&&"string"==typeof t)return new r(t,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds})}return e},r.isValid=function(t){return-1!==i.indexOf(t)},r.prototype.isValid=function(t){return r.isValid("string"==typeof t?t:this.mode)};const o=["primaryPreferred","secondary","secondaryPreferred","nearest"];r.prototype.slaveOk=function(){return-1!==o.indexOf(this.mode)},r.prototype.equals=function(t){return t.mode===this.mode},r.prototype.toJSON=function(){const t={mode:this.mode};return Array.isArray(this.tags)&&(t.tags=this.tags),this.maxStalenessSeconds&&(t.maxStalenessSeconds=this.maxStalenessSeconds),t},r.primary=new r("primary"),r.primaryPreferred=new r("primaryPreferred"),r.secondary=new r("secondary"),r.secondaryPreferred=new r("secondaryPreferred"),r.nearest=new r("nearest"),t.exports=r},function(t,e,n){"use strict";const r=n(0).applyWriteConcern,i=n(3).BSON.Code,o=n(0).resolveReadPreference,s=n(0).debugOptions,a=n(0).handleCallback,c=n(3).MongoError,u=n(0).parseIndexOptions,l=n(3).ReadPreference,h=n(0).toError,f=n(127),p=n(0).MongoDBNamespace,d=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];function m(t,e,n,i,o){let s=Object.assign({},{readPreference:l.PRIMARY},i);if(s=r(s,{db:t},i),s.writeConcern&&"function"!=typeof o)throw c.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(t.serverConfig&&t.serverConfig.isDestroyed())return o(new c("topology was destroyed"));!function(t,e,n,i,o){const s=u(n),f="string"==typeof i.name?i.name:s.name,p=[{name:f,key:s.fieldHash}],d=Object.keys(p[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let t in i)-1===d.indexOf(t)&&(p[0][t]=i[t]);const m=t.s.topology.capabilities();if(p[0].collation&&m&&!m.commandsTakeCollation){const t=new c("server/primary/mongos does not support collation");return t.code=67,o(t)}const g=r({createIndexes:e,indexes:p},{db:t},i);i.readPreference=l.PRIMARY,y(t,g,i,(t,e)=>t?a(o,t,null):0===e.ok?a(o,h(e),null):void a(o,null,f))}(t,e,n,s,(r,u)=>{if(null==r)return a(o,r,u);if(67===r.code||11e3===r.code||85===r.code||86===r.code||11600===r.code||197===r.code)return a(o,r,u);const l=v(t,e,n,i);s.checkKeys=!1,t.s.topology.insert(t.s.namespace.withCollection(f.SYSTEM_INDEX_COLLECTION),l,s,(t,e)=>{if(null!=o)return t?a(o,t):null==e?a(o,null,null):e.result.writeErrors?a(o,c.create(e.result.writeErrors[0]),null):void a(o,null,l.name)})})}function y(t,e,n,r){if(t.serverConfig&&t.serverConfig.isDestroyed())return r(new c("topology was destroyed"));const i=n.dbName||n.authdb||t.databaseName;n.readPreference=o(t,n),t.s.logger.isDebug()&&t.s.logger.debug(`executing command ${JSON.stringify(e)} against ${i}.$cmd with options [${JSON.stringify(s(d,n))}]`),t.s.topology.command(t.s.namespace.withCollection("$cmd"),e,n,(t,e)=>t?a(r,t):n.full?a(r,null,e):void a(r,null,e.result))}function g(t,e,n,r){const i=null!=n.full&&n.full;if(t.serverConfig&&t.serverConfig.isDestroyed())return r(new c("topology was destroyed"));t.collection(e).listIndexes(n).toArray((t,e)=>t?r(h(t)):Array.isArray(e)?i?a(r,null,e):void a(r,null,function(t){let e={};for(let n=0;n<t.length;n++){const r=t[n];e[r.name]=[];for(let t in r.key)e[r.name].push([t,r.key[t]])}return e}(e)):a(r,null,[]))}function v(t,e,n,r){const i=u(n),o=i.fieldHash,s="string"==typeof r.name?r.name:i.name,a={ns:t.s.namespace.withCollection(e).toString(),key:o,name:s},c=null!=r&&"object"!=typeof r&&r;r=null==r||"boolean"==typeof r?{}:r;const l=Object.keys(a);for(let t in r)-1===l.indexOf(t)&&(a[t]=r[t]);null==a.unique&&(a.unique=c);const h=["w","wtimeout","j","fsync","readPreference","session"];for(let t=0;t<h.length;t++)delete a[h[t]];return a}t.exports={createListener:function(t,e,n){return function(r){if(n.listeners(e).length>0){n.emit(e,r,t);for(let n=0;n<t.s.children.length;n++)t.s.children[n].emit(e,r,t.s.children[n])}}},createIndex:m,ensureIndex:function(t,e,n,i,o){const s=r({},{db:t},i),u=v(t,e,n,i).name;if(t.serverConfig&&t.serverConfig.isDestroyed())return o(new c("topology was destroyed"));s.readPreference=l.PRIMARY,g(t,e,s,(r,s)=>{if(null!=r&&26!==r.code)return a(o,r,null);if(null!=s&&s[u]){if("function"==typeof o)return a(o,null,u)}else m(t,e,n,i,o)})},evaluate:function(t,e,n,r,o){let s=e,u=[];if(t.serverConfig&&t.serverConfig.isDestroyed())return o(new c("topology was destroyed"));s&&"Code"===s._bsontype||(s=new i(s)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(u=n):u=[n];let h={$eval:s,args:u};r.nolock&&(h.nolock=r.nolock),r.readPreference=new l(l.PRIMARY),y(t,h,r,(t,e)=>t?a(o,t,null):e&&1===e.ok?a(o,null,e.retval):e?a(o,c.create({message:`eval failed: ${e.errmsg}`,driver:!0}),null):void a(o,t,e))},executeCommand:y,executeDbAdminCommand:function(t,e,n,r){const i=new p("admin","$cmd");t.s.topology.command(i,e,n,(e,n)=>t.serverConfig&&t.serverConfig.isDestroyed()?r(new c("topology was destroyed")):e?a(r,e):void a(r,null,n.result))},indexInformation:g,profilingInfo:function(t,e,n){try{t.collection("system.profile").find({},e).toArray(n)}catch(t){return n(t,null)}},validateDatabaseName:function(t){if("string"!=typeof t)throw c.create({message:"database name must be a string",driver:!0});if(0===t.length)throw c.create({message:"database name cannot be the empty string",driver:!0});if("$external"===t)return;const e=[" ",".","$","/","\\"];for(let n=0;n<e.length;n++)if(-1!==t.indexOf(e[n]))throw c.create({message:"database names cannot contain the character '"+e[n]+"'",driver:!0})}}},function(t,e,n){"use strict";const r=n(0).applyRetryableWrites,i=n(0).applyWriteConcern,o=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(20).executeCommand,c=n(0).formattedOrderClause,u=n(0).handleCallback,l=n(3).MongoError,h=n(3).ReadPreference,f=n(0).toError,p=n(35).CursorState;function d(t,e,n){const r="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:t.s.db.options.forceServerObjectId;return!0===r?e:e.map(e=>(!0!==r&&null==e._id&&(e._id=t.s.pkFactory.createPk()),e))}t.exports={buildCountCommand:function(t,e,n){const r=n.skip,i=n.limit;let a=n.hint;const c=n.maxTimeMS;e=e||{};const u={count:n.collectionName,query:e};return t.s.numberOfRetries?(t.options.hint?a=t.options.hint:t.cmd.hint&&(a=t.cmd.hint),o(u,t,t.cmd)):o(u,t,n),"number"==typeof r&&(u.skip=r),"number"==typeof i&&(u.limit=i),"number"==typeof c&&(u.maxTimeMS=c),a&&(u.hint=a),s(u,t),u},deleteCallback:function(t,e,n){if(null!=n){if(t&&n)return n(t);if(null==e)return n(null,{result:{ok:1}});e.deletedCount=e.result.n,n&&n(null,e)}},findAndModify:function(t,e,n,s,l,f){const p={findAndModify:t.collectionName,query:e};(n=c(n))&&(p.sort=n),p.new=!!l.new,p.remove=!!l.remove,p.upsert=!!l.upsert;const d=l.projection||l.fields;d&&(p.fields=d),l.arrayFilters&&(p.arrayFilters=l.arrayFilters,delete l.arrayFilters),s&&!l.remove&&(p.update=s),l.maxTimeMS&&(p.maxTimeMS=l.maxTimeMS),l.serializeFunctions=l.serializeFunctions||t.s.serializeFunctions,l.checkKeys=!1;let m=Object.assign({},l);m=r(m,t.s.db),m=i(m,{db:t.s.db,collection:t},l),m.writeConcern&&(p.writeConcern=m.writeConcern),!0===m.bypassDocumentValidation&&(p.bypassDocumentValidation=m.bypassDocumentValidation),m.readPreference=h.primary;try{o(p,t,m)}catch(t){return f(t,null)}a(t.s.db,p,m,(t,e)=>t?u(f,t,null):u(f,null,e))},indexInformation:function(t,e,n,r){const i=null!=n.full&&n.full;if(t.serverConfig&&t.serverConfig.isDestroyed())return r(new l("topology was destroyed"));t.collection(e).listIndexes(n).toArray((t,e)=>t?r(f(t)):Array.isArray(e)?i?u(r,null,e):void u(r,null,function(t){let e={};for(let n=0;n<t.length;n++){const r=t[n];e[r.name]=[];for(let t in r.key)e[r.name].push([t,r.key[t]])}return e}(e)):u(r,null,[]))},nextObject:function(t,e){if(t.s.state===p.CLOSED||t.isDead&&t.isDead())return u(e,l.create({message:"Cursor is closed",driver:!0}));if(t.s.state===p.INIT&&t.cmd&&t.cmd.sort)try{t.cmd.sort=c(t.cmd.sort)}catch(t){return u(e,t)}t._next((n,r)=>{if(t.s.state=p.OPEN,n)return u(e,n);u(e,null,r)})},prepareDocs:d,insertDocuments:function(t,e,n,o){"function"==typeof n&&(o=n,n={}),n=n||{},e=Array.isArray(e)?e:[e];let s=Object.assign({},n);s=r(s,t.s.db),s=i(s,{db:t.s.db,collection:t},n),!0===s.keepGoing&&(s.ordered=!1),s.serializeFunctions=n.serializeFunctions||t.s.serializeFunctions,e=d(t,e,n),t.s.topology.insert(t.s.namespace,e,s,(t,n)=>{if(null!=o){if(t)return u(o,t);if(null==n)return u(o,null,null);if(n.result.code)return u(o,f(n.result));if(n.result.writeErrors)return u(o,f(n.result.writeErrors[0]));n.ops=e,u(o,null,n)}})},removeDocuments:function(t,e,n,s){"function"==typeof n?(s=n,n={}):"function"==typeof e&&(s=e,n={},e={}),n=n||{};let a=Object.assign({},n);a=r(a,t.s.db),a=i(a,{db:t.s.db,collection:t},n),null==e&&(e={});const c={q:e,limit:0};n.single?c.limit=1:a.retryWrites&&(a.retryWrites=!1);try{o(a,t,n)}catch(t){return s(t,null)}t.s.topology.remove(t.s.namespace,[c],a,(t,e)=>{if(null!=s)return t?u(s,t,null):null==e?u(s,null,null):e.result.code?u(s,f(e.result)):e.result.writeErrors?u(s,f(e.result.writeErrors[0])):void u(s,null,e)})},updateDocuments:function(t,e,n,s,a){if("function"==typeof s&&(a=s,s=null),null==s&&(s={}),"function"!=typeof a&&(a=null),null==e||"object"!=typeof e)return a(f("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return a(f("document must be a valid JavaScript object"));let c=Object.assign({},s);c=r(c,t.s.db),c=i(c,{db:t.s.db,collection:t},s),c.serializeFunctions=s.serializeFunctions||t.s.serializeFunctions;const l={q:e,u:n};l.upsert=void 0!==s.upsert&&!!s.upsert,l.multi=void 0!==s.multi&&!!s.multi,s.hint&&(l.hint=s.hint),c.arrayFilters&&(l.arrayFilters=c.arrayFilters,delete c.arrayFilters),c.retryWrites&&l.multi&&(c.retryWrites=!1);try{o(c,t,s)}catch(t){return a(t,null)}t.s.topology.update(t.s.namespace,[l],c,(t,e)=>{if(null!=a)return t?u(a,t,null):null==e?u(a,null,null):e.result.code?u(a,f(e.result)):e.result.writeErrors?u(a,f(e.result.writeErrors[0])):void u(a,null,e)})},updateCallback:function(t,e,n){if(null!=n){if(t)return n(t);if(null==e)return n(null,{result:{ok:1}});e.modifiedCount=null!=e.result.nModified?e.result.nModified:e.result.n,e.upsertedId=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?e.result.upserted[0]:null,e.upsertedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length?e.result.upserted.length:0,e.matchedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?0:e.result.n,n(null,e)}}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(13).EventEmitter,i=n(343),o=n(17),s=n(77),a=n(206),c=n(207),u=n(392),l=n(79),h=n(68),f=n(50),p=n(200),d=n(138),m=n(24),y=n(221),g=n(146).compile,v=n(146).defineKey,b=n(82).flatten,_=n(11),w=n(420),S=n(224),O=n(421),E=n(83),T=n(422),C=n(6).inspect,I=n(51).internalToObjectOptions,A=n(65),k=n(12),x=n(423),N=k.clone,P=k.deepEqual,j=k.isMongooseObject,R=n(8).arrayAtomicsSymbol,M=n(8).documentArrayParent,D=n(8).documentSchemaSymbol,$=n(8).getSymbol,L=n(8).populateModelSymbol,F=n(8).scopeSymbol;let B,U,V;const q=k.specialProperties;function W(t,e,n,o){if("object"==typeof n&&null!=n&&(n=(o=n).skipId),o=o||{},null==this.schema){const t=k.isObject(e)&&!e.instanceOfSchema?new l(e):e;this.$__setSchema(t),e=n,n=o,o=arguments[4]||{}}if(this.$__=new i,this.$__.emitter=new r,this.isNew=!("isNew"in o)||o.isNew,this.errors=void 0,this.$__.$options=o||{},this.$locals={},this.$op=null,null!=t&&"object"!=typeof t)throw new c(t,"obj","Document");const s=this.schema;"boolean"==typeof e||"throw"===e?(this.$__.strictMode=e,e=void 0):(this.$__.strictMode=s.options.strict,this.$__.selected=e);const a=s.requiredPaths(!0);for(const t of a)this.$__.activePaths.require(t);this.$__.emitter.setMaxListeners(0);let u=null;k.isPOJO(e)&&(u=T(e));const h=!1===u&&e?z(e):{};if(null==this._doc&&(this.$__buildDoc(t,e,n,u,h,!1),H(this,e,n,u,h,!0,{isNew:this.isNew})),t&&(this.$__original_set?this.$__original_set(t,void 0,!0):this.$set(t,void 0,!0),t instanceof W&&(this.isNew=t.isNew)),o.willInit?r.prototype.once.call(this,"init",()=>{H(this,e,n,u,h,!1,o.skipDefaults,this.isNew)}):H(this,e,n,u,h,!1,o.skipDefaults,this.isNew),this.$__._id=this._id,!this.$__.strictMode&&t){const t=this;Object.keys(this._doc).forEach((function(e){e in s.tree||v(e,null,t)}))}Y(this)}
/*!
 * Document exposes the NodeJS event emitter API, so you can use
 * `on`, `once`, etc.
 */k.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],(function(t){W.prototype[t]=function(){return this.$__.emitter[t].apply(this.$__.emitter,arguments)}})),W.prototype.constructor=W;for(const t in r.prototype)W[t]=r.prototype[t];
/*!
 * ignore
 */
function z(t){const e={},n=Object.keys(t);for(const t of n){const n=t.split("."),r=[];for(const t of n)r.push(t),e[r.join(".")]=1}return e}
/*!
 * ignore
 */function H(t,e,n,r,i,o,s){const a=Object.keys(t.schema.paths),c=a.length;for(let u=0;u<c;++u){let c,l="";const h=a[u];if("_id"===h&&n)continue;const f=t.schema.paths[h],p=-1===h.indexOf(".")?[h]:h.split("."),d=p.length;let m=!1,y=t._doc;for(let n=0;n<d&&null!=y;++n){const a=p[n];if(l+=(l.length?".":"")+a,!0===r){if(l in e)break}else if(!1===r&&e&&!m)if(l in e)m=!0;else if(!i[l])break;if(n===d-1){if(void 0!==y[a])break;if("function"==typeof f.defaultValue){if(!f.defaultValue.$runBeforeSetters&&o)break;if(f.defaultValue.$runBeforeSetters&&!o)break}else if(!o)continue;if(s&&s[l])break;if(e&&null!==r)if(!0===r){if(h in e)continue;c=f.getDefault(t,!1),void 0!==c&&(y[a]=c,t.$__.activePaths.default(h))}else m&&(c=f.getDefault(t,!1),void 0!==c&&(y[a]=c,t.$__.activePaths.default(h)));else c=f.getDefault(t,!1),void 0!==c&&(y[a]=c,t.$__.activePaths.default(h))}else y=y[a]}}}function K(t){if(null==t)return!0;if("object"!=typeof t||Array.isArray(t))return!1;for(const e of Object.keys(t))if(!K(t[e]))return!1;return!0}
/*!
 * ignore
 */
function G(t){const e={};!
/*!
 * ignore
 */
function(t){Object.keys(t.$__.activePaths.states.require).forEach(e=>{const n=t.schema.path(e);null!=n&&"function"==typeof n.originalRequiredValue&&(t.$__.cachedRequired[e]=n.originalRequiredValue.call(t))})}(t);let n=new Set(Object.keys(t.$__.activePaths.states.require).filter((function(e){return!(!t.isSelected(e)&&!t.isModified(e))&&(!(e in t.$__.cachedRequired)||t.$__.cachedRequired[e])})));function r(t){n.add(t)}Object.keys(t.$__.activePaths.states.init).forEach(r),Object.keys(t.$__.activePaths.states.modify).forEach(r),Object.keys(t.$__.activePaths.states.default).forEach(r);const i=t.$__getAllSubdocs(),o=t.modifiedPaths();for(const r of i)if(r.$basePath){for(const t of n)(null===t||t.startsWith(r.$basePath+"."))&&n.delete(t);!t.isModified(r.$basePath,o)||t.isDirectModified(r.$basePath)||t.$isDefault(r.$basePath)||(n.add(r.$basePath),e[r.$basePath]=!0)}for(const e of n){const r=t.schema.path(e);r&&r.$isMongooseArray&&(!r.$isMongooseDocumentArray||_(r,"schemaOptions.required"))&&s(t.$__getValue(e),n,e)}function s(t,e,n){if(null!=t){const r=t.length;for(let i=0;i<r;++i)Array.isArray(t[i])?s(t[i],e,n+"."+i):e.add(n+"."+i)}}const a={skipArrays:!0};for(const e of n)if(t.schema.nested[e]){let n=t.$__getValue(e);j(n)&&(n=n.toObject({transform:!1}));const i=b(n,e,a,t.schema);Object.keys(i).forEach(r)}for(const e of n){if(t.schema.singleNestedPaths.hasOwnProperty(e)){n.delete(e);continue}const r=t.schema.path(e);if(!r||!r.$isSchemaMap)continue;const i=t.$__getValue(e);if(null!=i)for(const t of i.keys())n.add(e+"."+t)}return n=Array.from(n),[n,e]}
/*!
 * ignore
 */
/*!
 * ignore
 */
function Q(t,e){const n=new Set(e),r=new Map([]);for(const t of e){if(-1===t.indexOf("."))continue;const e=t.split(".");let n=e[0];for(let i=1;i<e.length;++i)r.set(n,t),n=n+"."+e[i]}const i=[];for(const e of t)n.has(e)?i.push(e):r.has(e)&&i.push(r.get(e));return i}
/*!
 * Runs queued functions
 */
function Y(t){const e=t.schema&&t.schema.callQueue;if(e.length)for(const n of e)"pre"!==n[0]&&"post"!==n[0]&&"on"!==n[0]&&t[n[0]].apply(t,n[1])}
/*!
 * ignore
 */
/*!
 * Applies virtuals properties to `json`.
 */
function X(t,e,n,r){const i=t.schema,o=Object.keys(i.virtuals);let s=o.length;const a=s;let c,u,l,h=t._doc;const f=_(r,"aliases",!0);if(!h)return e;for(n=n||{},s=0;s<a;++s){if(c=o[s],!f&&i.aliases.hasOwnProperty(c))continue;if(u=c,null!=n.path){if(!c.startsWith(n.path+"."))continue;u=c.substr(n.path.length+1)}const r=u.split(".");if(l=N(t.get(c),n),void 0===l)continue;const a=r.length;h=e;for(let t=0;t<a-1;++t)h[r[t]]=h[r[t]]||{},h=h[r[t]];h[r[a-1]]=l}return e}
/*!
 * Applies virtuals properties to `json`.
 *
 * @param {Document} self
 * @param {Object} json
 * @return {Object} `json`
 */function J(t,e){if(x(e))throw new Error("`transform` function must be synchronous, but the transform on path `"+t+"` returned a promise.")}W.prototype.schema,Object.defineProperty(W.prototype,"$locals",{configurable:!1,enumerable:!1,writable:!0}),W.prototype.isNew,W.prototype.id,W.prototype.errors,W.prototype.$op,W.prototype.$__buildDoc=function(t,e,n,r,i){const o={},s=Object.keys(this.schema.paths).filter(t=>!t.includes("$*")),a=s.length;let c=0;for(;c<a;++c){const a=s[c];if("_id"===a){if(n)continue;if(t&&"_id"in t)continue}const u=a.split("."),l=u.length,h=l-1;let f="",p=o,d=!1;for(let t=0;t<l;++t){const n=u[t];if(f+=(f.length?".":"")+n,!0===r){if(f in e)break}else if(!1===r&&e&&!d)if(f in e)d=!0;else if(!i[f])break;t<h&&(p=p[n]||(p[n]={}))}}this._doc=o},
/*!
 * Converts to POJO when you use the document for querying
 */
W.prototype.toBSON=function(){return this.toObject(I)},W.prototype.init=function(t,e,n){return"function"==typeof e&&(n=e,e=null),this.$__init(t,e),n&&n(null,this),this},
/*!
 * ignore
 */
W.prototype.$__init=function(t,e){if(this.isNew=!1,this.$init=!0,e=e||{},null!=t._id&&e.populated&&e.populated.length){const n=String(t._id);for(const r of e.populated)r.isVirtual?this.populated(r.path,k.getValue(r.path,t),r):this.populated(r.path,r._docs[n],r)}
/*!
 * Init helper.
 *
 * @param {Object} self document instance
 * @param {Object} obj raw mongodb doc
 * @param {Object} doc object we are initializing
 * @api private
 */
return function t(e,n,r,i,o){o=o||"";const s=Object.keys(n),a=s.length;let c,u,l,h=0;for(;h<a;)f(h++);function f(a){if(l=s[a],u=o+l,c=e.schema.path(u),!e.schema.$isRootDiscriminator||e.isSelected(u))if(!c&&k.isPOJO(n[l]))r[l]||(r[l]={}),t(e,n[l],r[l],i,u+".");else if(c){if(null===n[l])r[l]=c._castNullish(null);else if(void 0!==n[l]){const t=(n[l].$__||{}).wasPopulated||null;if(c&&!t)try{r[l]=c.cast(n[l],e,!0)}catch(t){e.invalidate(t.path,new p({path:t.path,message:t.message,type:"cast",value:t.value}))}else r[l]=n[l]}e.isModified(u)||e.$__.activePaths.init(u)}else r[l]=n[l]}}(this,t,this._doc,e),
/*!
 * If populating a path within a document array, make sure each
 * subdoc within the array knows its subpaths are populated.
 *
 * ####Example:
 *     const doc = await Article.findOne().populate('comments.author');
 *     doc.comments[0].populated('author'); // Should be set
 */
function(t,e){if(null==t._id||null==e||0===e.length)return;const n=String(t._id);for(const r of e){if(r.isVirtual)continue;const e=r.path.split(".");for(let i=0;i<e.length-1;++i){const o=e.slice(0,i+1).join("."),s=e.slice(i+1).join("."),a=t.get(o);if(null!=a&&a.isMongooseDocumentArray){for(let t=0;t<a.length;++t)a[t].populated(s,null==r._docs[n]?[]:r._docs[n][t],r);break}}}}(this,e.populated),this.emit("init",this),this.constructor.emit("init",this),this.$__._id=this._id,this},W.prototype.update=function(){const t=k.args(arguments);t.unshift({_id:this._id});const e=this.constructor.update.apply(this.constructor,t);return null!=this.$session()&&("session"in e.options||(e.options.session=this.$session())),e},W.prototype.updateOne=function(t,e,n){const r=this.constructor.updateOne({_id:this._id},t,e);return r._pre(t=>{this.constructor._middleware.execPre("updateOne",this,[this],t)}),r._post(t=>{this.constructor._middleware.execPost("updateOne",this,[this],{},t)}),null!=this.$session()&&("session"in r.options||(r.options.session=this.$session())),null!=n?r.exec(n):r},W.prototype.replaceOne=function(){const t=k.args(arguments);return t.unshift({_id:this._id}),this.constructor.replaceOne.apply(this.constructor,t)},W.prototype.$session=function(t){if(0===arguments.length)return this.$__.session;if(this.$__.session=t,!this.ownerDocument){const e=this.$__getAllSubdocs();for(const n of e)n.$session(t)}return t},W.prototype.overwrite=function(t){const e=Array.from(new Set(Object.keys(this._doc).concat(Object.keys(t))));for(const n of e)"_id"!==n&&(this.schema.options.versionKey&&n===this.schema.options.versionKey||this.schema.options.discriminatorKey&&n===this.schema.options.discriminatorKey||this.$set(n,t[n]));return this},W.prototype.$set=function(t,e,n,r){k.isPOJO(n)&&(r=n,n=void 0);const i=(r=r||{}).merge,c=n&&!0!==n,u=!0===n;let l,f,p,d,m,g=0;const v="strict"in r?r.strict:this.$__.strictMode;if(c&&(l=this.$__.adhocPaths||(this.$__.adhocPaths={}),l[t]=this.schema.interpretAsType(t,n,this.schema.options)),"string"!=typeof t){if(t instanceof W&&(t=t.$__isNested?t.toObject():t._doc),null!=t){m=e?e+".":"",f=Object.keys(t);const n=f.length,i=_(r,"_skipMinimizeTopLevel",!1);if(0===n&&i)return delete r._skipMinimizeTopLevel,e&&this.$set(e,{}),this;for(;g<n;)b.call(this,g++);return this}{const n=t;t=e,e=n}}else this.$__.$setCalled.add(t);function b(e){d=f[e];const i=m+d;if(p=this.schema.pathType(i),!0!==n||m||null==t[d]||"nested"!==p||null==this._doc[d]||0!==Object.keys(this._doc[d]).length||(delete this._doc[d],r=Object.assign({},r,{_skipMinimizeTopLevel:!0})),"object"!=typeof t[d]||k.isNativeObject(t[d])||k.isMongooseType(t[d])||null==t[d]||"virtual"===p||"real"===p||"adhocOrUndefined"===p||this.$__path(i)instanceof s||this.schema.paths[i]&&this.schema.paths[i].options&&this.schema.paths[i].options.ref)if(v){if(u&&void 0===t[d]&&void 0!==this.get(i))return;if("adhocOrUndefined"===p&&(p=w(this,i,{typeOnly:!0})),"real"===p||"virtual"===p){let e=t[d];this.schema.paths[i]&&this.schema.paths[i].$isSingleNested&&t[d]instanceof W&&(e=e.toObject({virtuals:!1,transform:!1})),this.$set(m+d,e,u,r)}else if("nested"===p&&t[d]instanceof W)this.$set(m+d,t[d].toObject({transform:!1}),u,r);else if("throw"===v)throw"nested"===p?new a(d,t[d]):new h(d)}else void 0!==t[d]&&this.$set(m+d,t[d],u,r);else this.$__.$setCalled.add(m+d),this.$set(t[d],m+d,u,r)}let O,E=this.schema.pathType(t);if("adhocOrUndefined"===E&&(E=w(this,t,{typeOnly:!0})),e=S(e),"nested"===E&&e){if("object"==typeof e&&null!=e){if(i)return this.$set(e,t,u);this.$__setValue(t,null),y(this,t);const n=Object.keys(e);this.$__setValue(t,{});for(const r of n)this.$set(t+"."+r,e[r],u);return this.markModified(t),y(this,t,{skipDocArrays:!0}),this}return this.invalidate(t,new o.CastError("Object",e,t)),this}const T=-1===t.indexOf(".")?[t]:t.split(".");if("string"==typeof this.schema.aliases[T[0]]&&(T[0]=this.schema.aliases[T[0]]),"adhocOrUndefined"===E&&v){let n;for(g=0;g<T.length;++g){const r=T.slice(0,g+1).join(".");if(g+1<T.length&&"virtual"===this.schema.pathType(r))return A.set(t,e,this),this;if(O=this.schema.path(r),null!=O&&O instanceof s){n=!0;break}}if(null==O&&(O=w(this,t)),!n&&!O){if("throw"===v)throw new h(t);return this}}else{if("virtual"===E)return O=this.schema.virtualpath(t),O.applySetters(e,this),this;O=this.$__path(t)}let C,I=this._doc,x="";for(g=0;g<T.length-1;++g)I=I[T[g]],x+=(x.length>0?".":"")+T[g],I||(this.$set(x,{}),this.isSelected(x)||this.unmarkModified(x),I=this.$__getValue(x));if(T.length<=1)C=t;else{for(g=0;g<T.length;++g){const t=T.slice(0,g+1).join(".");if(null===this.get(t,null,{getters:!1})){C=t;break}}C||(C=t)}const N=(()=>null!=this.$__.$options.priorDoc?this.$__.$options.priorDoc.$__getValue(t):u?void 0:this.$__getValue(t))();if(!O)return this.$__set(C,t,u,T,O,e,N),this;if((O.$isSingleNested||O.$isMongooseArray)&&
/*!
 * ignore
 */
function(t,e){if(!t.$__.validationError)return;const n=Object.keys(t.$__.validationError.errors);for(const r of n)r.startsWith(e+".")&&delete t.$__.validationError.errors[r];0===Object.keys(t.$__.validationError.errors).length&&(t.$__.validationError=null)}
/*!
 * ignore
 */(this,t),O.$isSingleNested&&null!=e&&i){e instanceof W&&(e=e.toObject({virtuals:!1,transform:!1}));const n=Object.keys(e);for(const i of n)this.$set(t+"."+i,e[i],u,r);return this}let P=!0;try{const n=(()=>{if(null==O.options)return!1;if(!(e instanceof W))return!1;const t=e.constructor,n=O.options.ref;if(null!=n&&(n===t.modelName||n===t.baseModelName))return!0;const r=O.options.refPath;if(null==r)return!1;const i=e.get(r);return i===t.modelName||i===t.baseModelName})();let r,i=!1;if(n&&e instanceof W&&(this.populated(t,e._id,{[L]:e.constructor}),i=!0),O.options&&Array.isArray(O.options[this.schema.options.typeKey])&&O.options[this.schema.options.typeKey].length&&O.options[this.schema.options.typeKey][0].ref&&
/*!
 * ignore
 */
function(t,e){if(!Array.isArray(t))return!1;if(0===t.length)return!1;for(const n of t){if(!(n instanceof W))return!1;if(null==n.constructor.modelName)return!1;if(n.constructor.modelName!=e&&n.constructor.baseModelName!=e)return!1}return!0}(e,O.options[this.schema.options.typeKey][0].ref)&&(this.ownerDocument?(r={[L]:e[0].constructor},this.ownerDocument().populated(this.$__fullPath(t),e.map((function(t){return t._id})),r)):(r={[L]:e[0].constructor},this.populated(t,e.map((function(t){return t._id})),r)),i=!0),null==this.schema.singleNestedPaths[t]&&(e=O.applySetters(e,this,!1,N)),O.$isMongooseDocumentArray&&Array.isArray(e)&&e.length>0&&null!=e[0]&&null!=e[0].$__&&null!=e[0].$__.populated){const n=Object.keys(e[0].$__.populated);for(const r of n)this.populated(t+"."+r,e.map(t=>t.populated(r)),e[0].$__.populated[r].options);i=!0}if(!i&&this.$__.populated){if(Array.isArray(e)&&this.$__.populated[t])for(let t=0;t<e.length;++t)e[t]instanceof W&&(e[t]=e[t]._id);delete this.$__.populated[t]}O.$isSingleNested&&null!=e&&function(t,e,n){const r=e.schema;if(null==r)return;for(const e of Object.keys(r.paths)){const i=r.paths[e];if(null==i.$immutableSetter)continue;const o=null==n?void 0:n.$__getValue(e);i.$immutableSetter.call(t,o)}}(e,O,N),this.$markValid(t)}catch(n){n instanceof o.StrictModeError&&n.isImmutableError?this.invalidate(t,n):n instanceof o.CastError?(this.invalidate(n.path,n),n.$originalErrorPath&&this.invalidate(t,new o.CastError(O.instance,e,t,n.$originalErrorPath))):this.invalidate(t,new o.CastError(O.instance,e,t,n)),P=!1}return P&&this.$__set(C,t,u,T,O,e,N),O.$isSingleNested&&(this.isDirectModified(t)||null==e)&&y(this,t),this},W.prototype.set=W.prototype.$set,W.prototype.$__shouldModify=function(t,e,n,r,i,o,s){return!!this.isNew||null==this.schema.singleNestedPaths[e]&&(void 0===o&&!this.isSelected(e)||(void 0!==o||!(e in this.$__.activePaths.states.default))&&(!(this.populated(e)&&o instanceof W&&P(o._id,s))&&(!P(o,s||this.get(e))||!(n||null==o||!(e in this.$__.activePaths.states.default)||!P(o,i.getDefault(this,n))))))},W.prototype.$__set=function(t,e,r,i,o,s,a){V=V||n(81);const c=this.$__shouldModify(t,e,r,i,o,s,a),u=this;c&&(this.markModified(t),U||(U=n(218)),s&&s.isMongooseArray&&(s._registerAtomic("$set",s),s.isMongooseDocumentArray&&s.forEach((function(t){t&&t.__parentArray&&(t.__parentArray=s)})),this.$__.activePaths.forEach((function(t){t.startsWith(e+".")&&u.$__.activePaths.ignore(t)}))));let l=this._doc,h=0;const f=i.length;let p="";for(;h<f;h++){const t=h+1===f;if(p+=p?"."+i[h]:i[h],q.has(i[h]))return;t?l instanceof Map?l.set(i[h],s):l[i[h]]=s:(k.isPOJO(l[i[h]])||l[i[h]]&&l[i[h]]instanceof V||l[i[h]]&&l[i[h]].$isSingleNested||l[i[h]]&&Array.isArray(l[i[h]])||(l[i[h]]=l[i[h]]||{}),l=l[i[h]])}},W.prototype.$__getValue=function(t){return k.getValue(t,this._doc)},W.prototype.$__setValue=function(t,e){return k.setValue(t,e,this._doc),this},W.prototype.get=function(t,e,n){let r;n=n||{},e&&(r=this.schema.interpretAsType(t,e,this.schema.options));let i=this.$__path(t);if(null==i&&(i=this.schema.virtualpath(t)),i instanceof s){const e=this.schema.virtualpath(t);null!=e&&(i=e)}const o=t.split(".");let a=this._doc;if(i instanceof d){if(0===i.getters.length)return;return i.applyGetters(null,this)}"string"==typeof this.schema.aliases[o[0]]&&(o[0]=this.schema.aliases[o[0]]);for(let t=0,e=o.length;t<e;t++)a&&a._doc&&(a=a._doc),a=null==a?void 0:a instanceof Map?a.get(o[t],{getters:!1}):t===e-1?k.getValue(o[t],a):a[o[t]];if(r&&(a=r.cast(a)),null!=i&&!1!==n.getters)a=i.applyGetters(a,this);else if(this.schema.nested[t]&&n.virtuals)return X(this,k.clone(a)||{},{path:t});return a},
/*!
 * ignore
 */
W.prototype[$]=W.prototype.get,W.prototype.$__path=function(t){const e=this.$__.adhocPaths,n=e&&e.hasOwnProperty(t)?e[t]:null;return n||this.schema.path(t)},W.prototype.markModified=function(t,e){this.$__.activePaths.modify(t),null==e||this.ownerDocument||(this.$__.pathsToScopes[t]=e)},W.prototype.unmarkModified=function(t){this.$__.activePaths.init(t),delete this.$__.pathsToScopes[t]},W.prototype.$ignore=function(t){this.$__.activePaths.ignore(t)},W.prototype.directModifiedPaths=function(){return Object.keys(this.$__.activePaths.states.modify)},W.prototype.$isEmpty=function(t){const e={minimize:!0,virtuals:!1,getters:!1,transform:!1};if(arguments.length>0){const n=this.get(t);return null==n||"object"==typeof n&&(k.isPOJO(n)?K(n):0===Object.keys(n.toObject(e)).length)}return 0===Object.keys(this.toObject(e)).length},W.prototype.modifiedPaths=function(t){t=t||{};const e=Object.keys(this.$__.activePaths.states.modify),n=this;return e.reduce((function(e,r){const i=r.split(".");if(e=e.concat(i.reduce((function(t,e,n){return t.concat(i.slice(0,n).concat(e).join("."))}),[]).filter((function(t){return-1===e.indexOf(t)}))),!t.includeChildren)return e;let o=n.get(r);if(null!=o&&"object"==typeof o)if(o._doc&&(o=o._doc),Array.isArray(o)){const t=o.length;for(let n=0;n<t;++n)if(-1===e.indexOf(r+"."+n)&&(e.push(r+"."+n),null!=o[n]&&o[n].$__)){const t=o[n].modifiedPaths();for(const i of t)e.push(r+"."+n+"."+i)}}else Object.keys(o).filter((function(t){return-1===e.indexOf(r+"."+t)})).forEach((function(t){e.push(r+"."+t)}));return e}),[])},W.prototype.isModified=function(t,e){if(t){Array.isArray(t)||(t=t.split(" "));const n=e||this.modifiedPaths(),r=Object.keys(this.$__.activePaths.states.modify);return t.some((function(t){return!!~n.indexOf(t)}))||t.some((function(t){return r.some((function(e){return e===t||t.startsWith(e+".")}))}))}return this.$__.activePaths.some("modify")},W.prototype.$isDefault=function(t){return t in this.$__.activePaths.states.default},W.prototype.$isDeleted=function(t){return 0===arguments.length?!!this.$__.isDeleted:(this.$__.isDeleted=!!t,this)},W.prototype.isDirectModified=function(t){return t in this.$__.activePaths.states.modify},W.prototype.isInit=function(t){return t in this.$__.activePaths.states.init},W.prototype.isSelected=function(t){if(this.$__.selected){if("_id"===t)return 0!==this.$__.selected._id;const e=Object.keys(this.$__.selected);let n,r=e.length,i=null;if(1===r&&"_id"===e[0])return 0===this.$__.selected._id;for(;r--;)if(n=e[r],"_id"!==n&&E(this.$__.selected[n])){i=!!this.$__.selected[n];break}if(null===i)return!0;if(t in this.$__.selected)return i;r=e.length;const o=t+".";for(;r--;)if(n=e[r],"_id"!==n){if(n.startsWith(o))return i||n!==o;if(o.startsWith(n+"."))return i}return!i}return!0},W.prototype.isDirectSelected=function(t){if(this.$__.selected){if("_id"===t)return 0!==this.$__.selected._id;const e=Object.keys(this.$__.selected);let n,r=e.length,i=null;if(1===r&&"_id"===e[0])return 0===this.$__.selected._id;for(;r--;)if(n=e[r],"_id"!==n&&E(this.$__.selected[n])){i=!!this.$__.selected[n];break}return null===i||(t in this.$__.selected?i:!i)}return!0},W.prototype.validate=function(t,e,n){let r;return this.$op="validate",null!=this.ownerDocument||(this.$__.validating?r=new u(this,{parentStack:e&&e.parentStack,conflictStack:this.$__.validating.stack}):this.$__.validating=new u(this,{parentStack:e&&e.parentStack})),"function"==typeof t?(n=t,e=null,t=null):"function"==typeof e&&(n=e,e=t,t=null),m(n,n=>{if(null!=r)return n(r);this.$__validate(t,e,t=>{this.$op=null,n(t)})},this.constructor.events)},W.prototype.$__validate=function(t,e,n){let r;"function"==typeof t?(n=t,e=null,t=null):"function"==typeof e&&(n=e,e=null),r=e&&"object"==typeof e&&"validateModifiedOnly"in e?!!e.validateModifiedOnly:this.schema.options.validateModifiedOnly;const i=this,s=()=>{let t=this.$__.validationError;if(this.$__.validationError=void 0,r&&null!=t){const e=Object.keys(t.errors);for(const n of e)this.isModified(n)||delete t.errors[n];0===Object.keys(t.errors).length&&(t=void 0)}if(this.$__.cachedRequired={},this.emit("validate",i),this.constructor.emit("validate",i),this.$__.validating=null,t){for(const e in t.errors)!this[M]&&t.errors[e]instanceof o.CastError&&this.invalidate(e,t.errors[e]);return t}},a=G(this);let c=r?a[0].filter(t=>this.isModified(t)):a[0];const u=a[1];if(Array.isArray(t)&&(c=Q(c,t)),0===c.length)return process.nextTick((function(){const t=s();if(t)return i.schema.s.hooks.execPost("validate:error",i,[i],{error:t},(function(t){n(t)}));n(null,i)}));const l={};let h=0;const p=function(){const t=s();if(t)return i.schema.s.hooks.execPost("validate:error",i,[i],{error:t},(function(t){n(t)}));n(null,i)},d=function(t){null==t||l[t]||(l[t]=!0,h++,process.nextTick((function(){const e=i.schema.path(t);if(!e)return--h||p();if(!i.$isValid(t))return void(--h||p());let n,r=i.$__getValue(t);null==r&&(n=i.populated(t))&&(r=n);const o=t in i.$__.pathsToScopes?i.$__.pathsToScopes[t]:i,s={skipSchemaValidators:u[t],path:t};e.doValidate(r,(function(n){if(n&&(!e.$isMongooseDocumentArray||n.$isArrayValidatorError)){if(e.$isSingleNested&&n instanceof f&&!1===e.schema.options.storeSubdocValidationError)return--h||p();i.invalidate(t,n,void 0,!0)}--h||p()}),o,s)})))},m=c.length;for(let t=0;t<m;++t)d(c[t])},W.prototype.validateSync=function(t,e){const n=this;let r;r=e&&"object"==typeof e&&"validateModifiedOnly"in e?!!e.validateModifiedOnly:this.schema.options.validateModifiedOnly,"string"==typeof t&&(t=t.split(" "));const i=G(this);let s=r?i[0].filter(t=>this.isModified(t)):i[0];const a=i[1];Array.isArray(t)&&(s=Q(s,t));const c={};s.forEach((function(t){if(c[t])return;c[t]=!0;const e=n.schema.path(t);if(!e)return;if(!n.$isValid(t))return;const r=n.$__getValue(t),i=e.doValidateSync(r,n,{skipSchemaValidators:a[t],path:t});if(i&&(!e.$isMongooseDocumentArray||i.$isArrayValidatorError)){if(e.$isSingleNested&&i instanceof f&&!1===e.schema.options.storeSubdocValidationError)return;n.invalidate(t,i,void 0,!0)}}));const u=n.$__.validationError;if(n.$__.validationError=void 0,n.emit("validate",n),n.constructor.emit("validate",n),u)for(const t in u.errors)u.errors[t]instanceof o.CastError&&n.invalidate(t,u.errors[t]);return u},W.prototype.invalidate=function(t,e,n,r){if(this.$__.validationError||(this.$__.validationError=new f(this)),!this.$__.validationError.errors[t])return e&&"string"!=typeof e||(e=new p({path:t,message:e,type:r||"user defined",value:n})),this.$__.validationError===e||this.$__.validationError.addError(t,e),this.$__.validationError},W.prototype.$markValid=function(t){this.$__.validationError&&this.$__.validationError.errors[t]&&(delete this.$__.validationError.errors[t],0===Object.keys(this.$__.validationError.errors).length&&(this.$__.validationError=null))},W.prototype.$isValid=function(t){return!this.$__.validationError||!this.$__.validationError.errors[t]},W.prototype.$__reset=function(){let t=this;return B||(B=n(52)),this.$__.activePaths.map("init","modify",(function(e){return t.$__getValue(e)})).filter((function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length})).forEach((function(e){let n=e.length;for(;n--;){const t=e[n];t&&t.$__reset()}t.$__.activePaths.init(e.$path()),e[R]={}})),this.$__.activePaths.map("init","modify",(function(e){return t.$__getValue(e)})).filter((function(t){return t&&t.$isSingleNested})).forEach((function(e){e.$__reset(),t.$__.activePaths.init(e.$basePath)})),this.$__dirty().forEach((function(t){const e=t.value;e&&e[R]&&(e[R]={})})),this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.errors=void 0,t=this,this.schema.requiredPaths().forEach((function(e){t.$__.activePaths.require(e)})),this},W.prototype.$__dirty=function(){const t=this;let e=this.$__.activePaths.map("modify",(function(e){return{path:e,value:t.$__getValue(e),schema:t.$__path(e)}}));e=e.concat(this.$__.activePaths.map("default",(function(e){if("_id"!==e&&null!=t.$__getValue(e))return{path:e,value:t.$__getValue(e),schema:t.$__path(e)}}))),e.sort((function(t,e){return t.path<e.path?-1:t.path>e.path?1:0}));const n=[];let r,i;return e.forEach((function(t){t&&(null==r||0!==t.path.indexOf(r)?(r=t.path+".",n.push(t),i=t):null!=i&&null!=i.value&&null!=i.value[R]&&i.value.hasAtomics()&&(i.value[R]={},i.value[R].$set=i.value))})),i=r=null,n},W.prototype.$__setSchema=function(t){t.plugin(O,{deduplicate:!0}),g(t.tree,this,void 0,t.options);for(const e of Object.keys(t.virtuals))t.virtuals[e]._applyDefaultGetters();this.schema=t,this[D]=t},W.prototype.$__getArrayPathsToValidate=function(){return B||(B=n(52)),this.$__.activePaths.map("init","modify",function(t){return this.$__getValue(t)}.bind(this)).filter((function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(t){return t}))},W.prototype.$__getAllSubdocs=function(){B||(B=n(52)),V=V||n(81);const t=this;return Object.keys(this._doc).reduce((function(e,n){return function t(e,n,r){let i=e;return r&&(i=e instanceof W&&e[D].paths[r]?e._doc[r]:e[r]),i instanceof V?n.push(i):i instanceof Map?n=Array.from(i.keys()).reduce((function(e,n){return t(i.get(n),e,null)}),n):i&&i.$isSingleNested?(n=Object.keys(i._doc).reduce((function(e,n){return t(i._doc,e,n)}),n)).push(i):i&&i.isMongooseDocumentArray?i.forEach((function(e){e&&e._doc&&(n=Object.keys(e._doc).reduce((function(n,r){return t(e._doc,n,r)}),n),e instanceof V&&n.push(e))})):i instanceof W&&i.$__isNested&&(n=Object.keys(i).reduce((function(e,n){return t(i,e,n)}),n)),n}(t,e,n)}),[])},W.prototype.$__handleReject=function(t){this.listeners("error").length?this.emit("error",t):this.constructor.listeners&&this.constructor.listeners("error").length&&this.constructor.emit("error",t)},W.prototype.$toObject=function(t,e){let n={transform:!0,flattenDecimals:!0};const r=e?"toJSON":"toObject",i=_(this,"constructor.base.options."+r,{}),o=_(this,"schema.options",{});let s;n=k.options(n,N(i)),n=k.options(n,N(o[r]||{})),"flattenMaps"in(t=k.isPOJO(t)?N(t):{})||(t.flattenMaps=n.flattenMaps),s=null!=t.minimize?t.minimize:null!=n.minimize?n.minimize:o.minimize;const a=Object.assign(k.clone(t),{_isNested:!0,json:e,minimize:s});if(k.hasUserDefinedProperty(t,"getters")&&(a.getters=t.getters),k.hasUserDefinedProperty(t,"virtuals")&&(a.virtuals=t.virtuals),(t.depopulate||_(t,"_parentOptions.depopulate",!1))&&t._isNested&&this.$__.wasPopulated)return N(this._id,a);(t=k.options(n,t))._isNested=!0,t.json=e,t.minimize=s,a._parentOptions=t,a._skipSingleNestedGetters=!0;const c=Object.assign({},a);c._skipSingleNestedGetters=!1;const u=t.transform;let l=N(this._doc,a)||{};t.getters&&(!function(t,e,n){const r=t.schema,i=Object.keys(r.paths);let o,s,a=i.length,c=t._doc;if(!c)return e;for(;a--;){o=i[a];const r=o.split("."),u=r.length,l=u-1;let h,f=e;if(c=t._doc,t.isSelected(o))for(let e=0;e<u;++e){if(h=r[e],s=c[h],e===l){const e=t.get(o);f[h]=N(e,n)}else{if(null==s){h in c&&(f[h]=s);break}f=f[h]||(f[h]={})}c=s}}}
/*!
 * Applies schema type transforms to `json`.
 *
 * @param {Document} self
 * @param {Object} json
 * @return {Object} `json`
 */(this,l,c),t.minimize&&(l=
/*!
 * Minimizes an object, removing undefined values and empty objects
 *
 * @param {Object} object to minimize
 * @return {Object}
 */
function t(e){const n=Object.keys(e);let r,i,o,s=n.length;for(;s--;)i=n[s],o=e[i],k.isObject(o)&&!Buffer.isBuffer(o)&&(e[i]=t(o)),void 0!==e[i]?r=!0:delete e[i];return r?e:void 0}(l)||{})),(t.virtuals||t.getters&&!1!==t.virtuals)&&X(this,l,c,t),!1===t.versionKey&&this.schema.options.versionKey&&delete l[this.schema.options.versionKey];let h=t.transform;if(h&&function(t,e){const n=t.schema,r=Object.keys(n.paths||{});if(!t._doc)return e;for(const i of r){const r=n.paths[i];if("function"==typeof r.options.transform){const n=t.get(i),o=r.options.transform.call(t,n);J(i,o),e[i]=o}else if(null!=r.$embeddedSchemaType&&"function"==typeof r.$embeddedSchemaType.options.transform){const n=[].concat(t.get(i)),o=r.$embeddedSchemaType.options.transform;for(let e=0;e<n.length;++e){const r=o.call(t,n[e]);n[e]=r,J(i,r)}e[i]=n}}}(this,l),!0===h||o.toObject&&h){const e=t.json?o.toJSON:o.toObject;e&&(h="function"==typeof t.transform?t.transform:e.transform)}else t.transform=u;if("function"==typeof h){const e=h(this,l,t);void 0!==e&&(l=e)}return l},W.prototype.toObject=function(t){return this.$toObject(t)},W.prototype.toJSON=function(t){return this.$toObject(t,!0)},W.prototype.inspect=function(t){let e;k.isPOJO(t)&&(e=t,e.minimize=!1);const n=this.toObject(e);return null==n?"MongooseDocument { "+n+" }":n},C.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
W.prototype[C.custom]=W.prototype.inspect),W.prototype.toString=function(){const t=this.inspect();return"string"==typeof t?t:C(t)},W.prototype.equals=function(t){if(!t)return!1;const e=this.get("_id"),n=t.get?t.get("_id"):t;return e||n?e&&e.equals?e.equals(n):e===n:P(this,t)},W.prototype.populate=function(){if(0===arguments.length)return this;const t=this.$__.populate||(this.$__.populate={}),e=k.args(arguments);let n;if("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){const n=k.populate.apply(null,e);for(const e of n)t[e.path]=e}if(n){const e=k.object.vals(t);this.$__.populate=void 0;let r=this.constructor;if(this.$__isNested){r=this.$__[F].constructor;const t=this.$__.nestedPath;e.forEach((function(e){e.path=t+"."+e.path}))}if(null!=this.$session()){const t=this.$session();e.forEach(e=>{null!=e.options?"session"in e.options||(e.options.session=t):e.options={session:t}})}r.populate(this,e,n)}return this},W.prototype.execPopulate=function(t){const e=null!=t&&"function"!=typeof t;return e?this.populate.apply(this,arguments).execPopulate():m(t,t=>{this.populate(t)},this.constructor.events)},W.prototype.populated=function(t,e,n){if(null==e){if(!this.$__.populated)return;const e=this.$__.populated[t];return e?e.value:void 0}if(!0===e){if(!this.$__.populated)return;return this.$__.populated[t]}this.$__.populated||(this.$__.populated={}),this.$__.populated[t]={value:e,options:n};const r=t.split(".");for(let t=0;t<r.length-1;++t){const i=r.slice(0,t+1).join("."),o=this.get(i);if(null!=o&&null!=o.$__&&this.populated(i)){const i=r.slice(t+1).join(".");o.populated(i,e,n);break}}return e},W.prototype.depopulate=function(t){let e;"string"==typeof t&&(t=t.split(" "));const n=this.$$populatedVirtuals?Object.keys(this.$$populatedVirtuals):[],r=_(this,"$__.populated",{});if(0===arguments.length){for(const t of n)delete this.$$populatedVirtuals[t],delete this._doc[t],delete r[t];const t=Object.keys(r);for(const n of t)e=this.populated(n),e&&(delete r[n],this.$set(n,e));return this}for(const i of t)e=this.populated(i),delete r[i],-1!==n.indexOf(i)?(delete this.$$populatedVirtuals[i],delete this._doc[i]):e&&this.$set(i,e);return this},W.prototype.$__fullPath=function(t){return t||""},
/*!
 * Module exports.
 */
W.ValidationError=f,t.exports=W},function(t,e,n){"use strict";const r=n(119);function i(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")}t.exports={debugOptions:function(t,e){var n={};return t.forEach((function(t){n[t]=e[t]})),n},retrieveBSON:function(){var t=n(153);t.native=!1;try{var e=r("bson-ext");if(e)return e.native=!0,e}catch(t){}return t},retrieveSnappy:function(){var t=null;try{t=r("snappy")}catch(t){}return t||(t={compress:i,uncompress:i,compressSync:i,uncompressSync:i}),t}}},function(t,e,n){"use strict";const r=n(108),i=Symbol.for("mongoose:emitted");t.exports=function(t,e,n){if("function"==typeof t)return e((function(e){if(null==e)t.apply(this,arguments);else{null!=n&&n.listeners("error").length>0&&!e[i]&&(e[i]=!0,n.emit("error",e));try{t(e)}catch(e){return process.nextTick(()=>{throw e})}}}));return new(r.get())((t,r)=>{e((function(e,o){return null!=e?(null!=n&&n.listeners("error").length>0&&!e[i]&&(e[i]=!0,n.emit("error",e)),r(e)):arguments.length>2?t(Array.prototype.slice.call(arguments,1)):void t(o)}))})}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17),i=n(32),o=n(136),s=n(205),a=n(11),c=n(391),u=n(62),l=n(8).schemaTypeSymbol,h=n(6),f=n(12),p=n(8).validatorErrorSymbol,d=r.CastError,m=r.ValidatorError;function y(t,e,n){this[l]=!0,this.path=t,this.instance=n,this.validators=[],this.getters=this.constructor.hasOwnProperty("getters")?this.constructor.getters.slice():[],this.setters=[],e=e||{};const r=this.constructor.defaultOptions||{},o=Object.keys(r);for(const t of o)r.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=r[t]);null==e.select&&delete e.select;const s=this.OptionsConstructor||i;this.options=new s(e),this._index=null,f.hasUserDefinedProperty(this.options,"immutable")&&(this.$immutable=this.options.immutable,c(this));const a=Object.keys(this.options);for(const t of a)if("cast"!==t&&f.hasUserDefinedProperty(this.options,t)&&"function"==typeof this[t]){if("index"===t&&this._index){if(!1===e.index){const t=this._index;if("object"==typeof t&&null!=t){if(t.unique)throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true');if(t.sparse)throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}this._index=!1}continue}const n=e[t];if("default"===t){this.default(n);continue}const r=Array.isArray(n)?n:[n];this[t].apply(this,r)}Object.defineProperty(this,"$$context",{enumerable:!1,configurable:!1,writable:!0,value:null})}
/*!
 * ignore
 */y.prototype.OptionsConstructor=i,y.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>t),this._cast=t),this._cast},y.set=function(t,e){this.hasOwnProperty("defaultOptions")||(this.defaultOptions=Object.assign({},this.defaultOptions)),this.defaultOptions[t]=e},y.get=function(t){this.getters=this.hasOwnProperty("getters")?this.getters:[],this.getters.push(t)},y.prototype.default=function(t){if(1===arguments.length){if(void 0===t)return void(this.defaultValue=void 0);if(null!=t&&t.instanceOfSchema)throw new r("Cannot set default value of path `"+this.path+"` to a mongoose Schema instance.");return this.defaultValue=t,this.defaultValue}return arguments.length>1&&(this.defaultValue=f.args(arguments)),this.defaultValue},y.prototype.index=function(t){return this._index=t,f.expires(this._index),this},y.prototype.unique=function(t){if(!1===this._index){if(!t)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true')}return null==this._index||!0===this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.unique=t,this},y.prototype.text=function(t){if(!1===this._index){if(!t)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `text` set to true')}return null===this._index||void 0===this._index||"boolean"==typeof this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.text=t,this},y.prototype.sparse=function(t){if(!1===this._index){if(!t)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}return null==this._index||"boolean"==typeof this._index?this._index={}:"string"==typeof this._index&&(this._index={type:this._index}),this._index.sparse=t,this},y.prototype.immutable=function(t){return this.$immutable=t,c(this),this},y.prototype.transform=function(t){return this.options.transform=t,this},y.prototype.set=function(t){if("function"!=typeof t)throw new TypeError("A setter must be a function.");return this.setters.push(t),this},y.prototype.get=function(t){if("function"!=typeof t)throw new TypeError("A getter must be a function.");return this.getters.push(t),this},y.prototype.validate=function(t,e,n){if("function"==typeof t||t&&"RegExp"===f.getFunctionName(t.constructor)){let i;return"function"==typeof e?(i={validator:t,message:e},i.type=n||"user defined"):e instanceof Object&&!n?(i=f.clone(e),i.message||(i.message=i.msg),i.validator=t,i.type=i.type||"user defined"):(null==e&&(e=r.messages.general.default),n||(n="user defined"),i={message:e,type:n,validator:t}),i.isAsync&&g(),this.validators.push(i),this}let i,o,s;for(i=0,o=arguments.length;i<o;i++){if(s=arguments[i],!f.isPOJO(s)){throw new Error("Invalid validator. Received ("+typeof s+") "+s+". See http://mongoosejs.com/docs/api.html#schematype_SchemaType-validate")}this.validate(s.validator,s)}return this};
/*!
 * ignore
 */
const g=h.deprecate((function(){}),"Mongoose: the `isAsync` option for custom validators is deprecated. Make your async validators return a promise instead: https://mongoosejs.com/docs/validation.html#async-custom-validators");
/*!
 * ignore
 */
function v(t){return this.castForQuery(t)}
/*!
 * ignore
 */
/*!
 * Just like handleArray, except also allows `[]` because surprisingly
 * `$in: [1, []]` works fine
 */
function b(t){const e=this;return Array.isArray(t)?t.map((function(t){return Array.isArray(t)&&0===t.length?t:e.castForQuery(t)})):[this.castForQuery(t)]}
/*!
 * ignore
 */y.prototype.required=function(t,e){let n={};if(arguments.length>0&&null==t)return this.validators=this.validators.filter((function(t){return t.validator!==this.requiredValidator}),this),this.isRequired=!1,delete this.originalRequiredValue,this;if("object"==typeof t&&(n=t,e=n.message||e,t=t.isRequired),!1===t)return this.validators=this.validators.filter((function(t){return t.validator!==this.requiredValidator}),this),this.isRequired=!1,delete this.originalRequiredValue,this;const i=this;this.isRequired=!0,this.requiredValidator=function(e){const n=a(this,"$__.cachedRequired");if(null!=n&&!this.isSelected(i.path)&&!this.isModified(i.path))return!0;if(null!=n&&i.path in n){const t=!n[i.path]||i.checkRequired(e,this);return delete n[i.path],t}return"function"==typeof t&&!t.apply(this)||i.checkRequired(e,this)},this.originalRequiredValue=t,"string"==typeof t&&(e=t,t=void 0);const o=e||r.messages.general.required;return this.validators.unshift(Object.assign({},n,{validator:this.requiredValidator,message:o,type:"required"})),this},y.prototype.ref=function(t){return this.options.ref=t,this},y.prototype.getDefault=function(t,e){let n="function"==typeof this.defaultValue?this.defaultValue.call(t):this.defaultValue;if(null!=n){"object"!=typeof n||this.options&&this.options.shared||(n=f.clone(n));const r=this.applySetters(n,t,e);return r&&r.$isSingleNested&&(r.$parent=t),r}return n},
/*!
 * Applies setters without casting
 *
 * @api private
 */
y.prototype._applySetters=function(t,e,n,i){let o=t;const s=this.setters,a=this.caster;for(const t of f.clone(s).reverse())o=t.call(e,o,this);if(Array.isArray(o)&&a&&a.setters){const t=[];for(let s=0;s<o.length;++s){const c=o[s];try{t.push(a.applySetters(c,e,n,i))}catch(t){throw t instanceof r.CastError&&(t.$originalErrorPath=t.path,t.path=t.path+"."+s),t}}o=t}return o},
/*!
 * ignore
 */
y.prototype._castNullish=function(t){return t},y.prototype.applySetters=function(t,e,n,r,i){let o=this._applySetters(t,e,n,r,i);return null==o?this._castNullish(o):(o=this.cast(o,e,n,r,i),o)},y.prototype.applyGetters=function(t,e){let n=t;const r=this.getters,i=r.length;if(0===i)return n;for(let t=0;t<i;++t)n=r[t].call(e,n,this);return n},y.prototype.select=function(t){return this.selected=!!t,this},y.prototype.doValidate=function(t,e,n,r){let i=!1;const o=this.path,s=this.validators.filter(t=>null!=t&&"object"==typeof t);let a=s.length;if(!a)return e(null);const c=this;function l(t,n){if(!i)if(void 0===t||t)--a<=0&&u((function(){e(null)}));else{const t=n.ErrorConstructor||m;i=new t(n),i[p]=!0,u((function(){e(i)}))}}s.forEach((function(e){if(i)return;const s=e.validator;let a;const u=f.clone(e);if(u.path=r&&r.path?r.path:o,u.value=t,s instanceof RegExp)l(s.test(t),u);else if("function"==typeof s)if(void 0!==t||s===c.requiredValidator)if(u.isAsync)!
/*!
 * Handle async validators
 */
function(t,e,n,r,i){let o=!1;const s=t.call(e,n,(function(t,e){o||(o=!0,e&&(r.message=e),i(t,r))}));"boolean"==typeof s?(o=!0,i(s,r)):s&&"function"==typeof s.then&&s.then((function(t){o||(o=!0,i(t,r))}),(function(t){o||(o=!0,r.reason=t,r.message=t.message,i(!1,r))}))}(s,n,t,u,l);else{try{a=u.propsParameter?s.call(n,t,u):s.call(n,t)}catch(t){a=!1,u.reason=t,t.message&&(u.message=t.message)}null!=a&&"function"==typeof a.then?a.then((function(t){l(t,u)}),(function(t){u.reason=t,u.message=t.message,a=!1,l(a,u)})):l(a,u)}else l(!0,u)}))},y.prototype.doValidateSync=function(t,e,n){const r=this.path;if(!this.validators.length)return null;let i=this.validators;if(void 0===t){if(!(this.validators.length>0&&"required"===this.validators[0].type))return null;i=[this.validators[0]]}let o=null;return i.forEach((function(i){if(o)return;if(null==i||"object"!=typeof i)return;const a=i.validator,c=f.clone(i);let u;if(c.path=n&&n.path?n.path:r,c.value=t,!a.isAsync)if(a instanceof RegExp)s(a.test(t),c);else if("function"==typeof a){try{u=c.propsParameter?a.call(e,t,c):a.call(e,t)}catch(t){u=!1,c.reason=t}null!=u&&"function"==typeof u.then||s(u,c)}})),o;function s(t,e){if(!o&&void 0!==t&&!t){const t=e.ErrorConstructor||m;o=new t(e),o[p]=!0}}},y._isRef=function(t,e,n,r){let i=r&&t.options&&(t.options.ref||t.options.refPath);if(!i&&n&&null!=n.$__){const e=n.$__fullPath(t.path);i=(n.ownerDocument?n.ownerDocument():n).populated(e)||n.populated(t.path)}if(i){if(null==e)return!0;if(!Buffer.isBuffer(e)&&"Binary"!==e._bsontype&&f.isObject(e))return!0}return!1},y.prototype.$conditionalHandlers={$all:function(t){const e=this;return Array.isArray(t)?t.map((function(t){return e.castForQuery(t)})):[this.castForQuery(t)]},$eq:v,$in:b,$ne:v,$nin:b,$exists:o,$type:s},
/*!
 * Wraps `castForQuery` to handle context
 */
y.prototype.castForQueryWrapper=function(t){return this.$$context=t.context,"$conditional"in t?this.castForQuery(t.$conditional,t.val):t.$skipQueryCastForUpdate||t.$applySetters?this._castForQuery(t.val):this.castForQuery(t.val)},y.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(n=this.$conditionalHandlers[t],!n)throw new Error("Can't use "+t);return n.call(this,e)}return e=t,this._castForQuery(e)},
/*!
 * Internal switch for runSetters
 *
 * @api private
 */
y.prototype._castForQuery=function(t){return this.applySetters(t,this.$$context)},y.checkRequired=function(t){return arguments.length>0&&(this._checkRequired=t),this._checkRequired},y.prototype.checkRequired=function(t){return null!=t},
/*!
 * ignore
 */
y.prototype.clone=function(){const t=Object.assign({},this.options),e=new this.constructor(this.path,t,this.instance);return e.validators=this.validators.slice(),void 0!==this.requiredValidator&&(e.requiredValidator=this.requiredValidator),void 0!==this.defaultValue&&(e.defaultValue=this.defaultValue),void 0!==this.$immutable&&void 0===this.options.immutable&&(e.$immutable=this.$immutable,c(e)),void 0!==this._index&&(e._index=this._index),void 0!==this.selected&&(e.selected=this.selected),void 0!==this.isRequired&&(e.isRequired=this.isRequired),void 0!==this.originalRequiredValue&&(e.originalRequiredValue=this.originalRequiredValue),e.getters=this.getters.slice(),e.setters=this.setters.slice(),e},
/*!
 * Module exports.
 */
t.exports=e=y,e.CastError=d,e.ValidatorError=m},function(t,e){t.exports=require("stream")},function(t,e,n){"use strict";t.exports={STATE_CLOSING:"closing",STATE_CLOSED:"closed",STATE_CONNECTING:"connecting",STATE_CONNECTED:"connected",TOPOLOGY_DEFAULTS:{useUnifiedTopology:!0,localThresholdMS:15,serverSelectionTimeoutMS:3e4,heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:500},TopologyType:{Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"},ServerType:{Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"},drainTimerQueue:function(t){t.forEach(clearTimeout),t.clear()},clearAndRemoveTimerFrom:function(t,e){return clearTimeout(t),e.delete(t)}}},function(t,e,n){"use strict";
/*!
 * ignore
 */class r extends Error{}Object.defineProperty(r.prototype,"name",{value:"MongooseError"}),t.exports=r},function(t,e,n){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=n(70),i=r.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,e),e.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).OperationBase,o=n(0).applyWriteConcern,s=n(0).debugOptions,a=n(0).handleCallback,c=n(3).MongoError,u=n(3).ReadPreference,l=n(0).resolveReadPreference,h=n(0).MongoDBNamespace,f=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];t.exports=class extends i{constructor(t,e,n,i){super(e),this.hasAspect(r.WRITE_OPERATION)?(o(this.options,null!=n?{db:t,coll:n}:{db:t},this.options),this.options.readPreference=u.primary):this.options.readPreference=l(null!=n?n:t,e),this.db=t,null!=i&&(this.command=i),null!=n&&(this.collection=n)}_buildCommand(){if(null!=this.command)return this.command}execute(t){const e=this.db,n=Object.assign({},this.options);if(e.serverConfig&&e.serverConfig.isDestroyed())return t(new c("topology was destroyed"));let i;try{i=this._buildCommand()}catch(e){return t(e)}const o=n.dbName||n.authdb||e.databaseName;this.hasAspect(r.WRITE_OPERATION)&&(!n.writeConcern||n.session&&n.session.inTransaction()||(i.writeConcern=n.writeConcern)),e.s.logger.isDebug()&&e.s.logger.debug(`executing command ${JSON.stringify(i)} against ${o}.$cmd with options [${JSON.stringify(s(f,n))}]`);const u=null!=this.namespace?this.namespace:new h(o,"$cmd");e.s.topology.command(u,i,n,(e,r)=>e?a(t,e):n.full?a(t,null,r):void a(t,null,r.result))}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(28),i=n(11),o=n(6);class s extends r{constructor(t,e,n,r,i){if(arguments.length>0){super(u(null,t,a(e),n,c(i))),this.init(t,e,n,r,i)}else super(u())}
/*!
   * ignore
   */init(t,e,n,r,i){this.stringValue=a(e),this.messageFormat=c(i),this.kind=t,this.value=e,this.path=n,this.reason=r}
/*!
   * ignore
   * @param {Readonly<CastError>} other
   */copy(t){this.messageFormat=t.messageFormat,this.stringValue=t.stringValue,this.kind=t.kind,this.value=t.value,this.path=t.path,this.reason=t.reason,this.message=t.message}
/*!
   * ignore
   */setModel(t){this.model=t,this.message=u(t,this.kind,this.stringValue,this.path,this.messageFormat)}}function a(t){let e=o.inspect(t);return e=e.replace(/^'|'$/g,'"'),e.startsWith('"')||(e='"'+e+'"'),e}function c(t){const e=i(t,"options.cast",null);if("string"==typeof e)return e}
/*!
 * ignore
 */function u(t,e,n,r,i){if(null!=i){let o=i.replace("{KIND}",e).replace("{VALUE}",n).replace("{PATH}",r);return null!=t&&(o=o.replace("{MODEL}",t.modelName)),o}{let i="Cast to "+e+" failed for value "+n+' at path "'+r+'"';return null!=t&&(i+=' for model "'+t.modelName+'"'),i}}
/*!
 * exports
 */Object.defineProperty(s.prototype,"name",{value:"CastError"}),t.exports=s},function(t,e,n){"use strict";const r=n(49);class i{constructor(t){if(null==t)return this;Object.assign(this,r(t))}}const o=n(36);Object.defineProperty(i.prototype,"type",o),Object.defineProperty(i.prototype,"validate",o),Object.defineProperty(i.prototype,"cast",o),Object.defineProperty(i.prototype,"required",o),Object.defineProperty(i.prototype,"default",o),Object.defineProperty(i.prototype,"ref",o),Object.defineProperty(i.prototype,"select",o),Object.defineProperty(i.prototype,"index",o),Object.defineProperty(i.prototype,"unique",o),Object.defineProperty(i.prototype,"immutable",o),Object.defineProperty(i.prototype,"sparse",o),Object.defineProperty(i.prototype,"text",o),Object.defineProperty(i.prototype,"transform",o),t.exports=i},function(t,e,n){"use strict";
/*!
 * ignore
 */let r=null;t.exports.get=function(){return r},t.exports.set=function(t){r=t}},function(t,e,n){"use strict";var r=n(6).format,i=n(5).MongoError,o={},s={},a=null,c=process.pid,u=null,l=function(t,e){if(!(this instanceof l))return new l(t,e);e=e||{},this.className=t,e.logger?u=e.logger:null==u&&(u=console.log),e.loggerLevel&&(a=e.loggerLevel||"error"),null==s[this.className]&&(o[this.className]=!0)};l.prototype.debug=function(t,e){if(this.isDebug()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&o[this.className])){var n=(new Date).getTime(),i=r("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,t),a={type:"debug",message:t,className:this.className,pid:c,date:n};e&&(a.meta=e),u(i,a)}},l.prototype.warn=function(t,e){if(this.isWarn()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&o[this.className])){var n=(new Date).getTime(),i=r("[%s-%s:%s] %s %s","WARN",this.className,c,n,t),a={type:"warn",message:t,className:this.className,pid:c,date:n};e&&(a.meta=e),u(i,a)}},l.prototype.info=function(t,e){if(this.isInfo()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&o[this.className])){var n=(new Date).getTime(),i=r("[%s-%s:%s] %s %s","INFO",this.className,c,n,t),a={type:"info",message:t,className:this.className,pid:c,date:n};e&&(a.meta=e),u(i,a)}},l.prototype.error=function(t,e){if(this.isError()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&o[this.className])){var n=(new Date).getTime(),i=r("[%s-%s:%s] %s %s","ERROR",this.className,c,n,t),a={type:"error",message:t,className:this.className,pid:c,date:n};e&&(a.meta=e),u(i,a)}},l.prototype.isInfo=function(){return"info"===a||"debug"===a},l.prototype.isError=function(){return"error"===a||"info"===a||"debug"===a},l.prototype.isWarn=function(){return"error"===a||"warn"===a||"info"===a||"debug"===a},l.prototype.isDebug=function(){return"debug"===a},l.reset=function(){a="error",s={}},l.currentLogger=function(){return u},l.setCurrentLogger=function(t){if("function"!=typeof t)throw new i("current logger must be a function");u=t},l.filter=function(t,e){"class"===t&&Array.isArray(e)&&(s={},e.forEach((function(t){s[t]=!0})))},l.setLevel=function(t){if("info"!==t&&"error"!==t&&"debug"!==t&&"warn"!==t)throw new Error(r("%s is an illegal logging level",t));a=t},t.exports=l},function(t,e,n){"use strict";const r=n(34),i=n(23).retrieveBSON,o=n(5).MongoError,s=n(5).MongoNetworkError,a=n(9).collationNotSupported,c=n(19),u=n(9).isUnifiedTopology,l=n(73),h=n(26).Readable,f=n(0).SUPPORTS,p=n(0).MongoDBNamespace,d=n(4).OperationBase,m=i().Long,y={INIT:0,OPEN:1,CLOSED:2,GET_MORE:3};function g(t,e,n){try{t(e,n)}catch(e){process.nextTick((function(){throw e}))}}class v extends h{constructor(t,e,n,i){super({objectMode:!0}),i=i||{},e instanceof d&&(this.operation=e,e=this.operation.ns.toString(),i=this.operation.options,n=this.operation.cmd?this.operation.cmd:{}),this.pool=null,this.server=null,this.disconnectHandler=i.disconnectHandler,this.bson=t.s.bson,this.ns=e,this.namespace=p.fromString(e),this.cmd=n,this.options=i,this.topology=t,this.cursorState={cursorId:null,cmd:n,documents:i.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:i.limit||n.limit||0,skip:i.skip||n.skip||0,batchSize:i.batchSize||n.batchSize||1e3,currentLimit:0,transforms:i.transforms,raw:i.raw||n&&n.raw},"object"==typeof i.session&&(this.cursorState.session=i.session);const o=t.s.options;"boolean"==typeof o.promoteLongs?this.cursorState.promoteLongs=o.promoteLongs:"boolean"==typeof i.promoteLongs&&(this.cursorState.promoteLongs=i.promoteLongs),"boolean"==typeof o.promoteValues?this.cursorState.promoteValues=o.promoteValues:"boolean"==typeof i.promoteValues&&(this.cursorState.promoteValues=i.promoteValues),"boolean"==typeof o.promoteBuffers?this.cursorState.promoteBuffers=o.promoteBuffers:"boolean"==typeof i.promoteBuffers&&(this.cursorState.promoteBuffers=i.promoteBuffers),o.reconnect&&(this.cursorState.reconnect=o.reconnect),this.logger=r("Cursor",o),"number"==typeof n?(this.cursorState.cursorId=m.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof m&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n),this.operation&&(this.operation.cursorState=this.cursorState)}setCursorBatchSize(t){this.cursorState.batchSize=t}cursorBatchSize(){return this.cursorState.batchSize}setCursorLimit(t){this.cursorState.limit=t}cursorLimit(){return this.cursorState.limit}setCursorSkip(t){this.cursorState.skip=t}cursorSkip(){return this.cursorState.skip}_next(t){!function t(e,n){if(e.cursorState.notified)return n(new Error("cursor is exhausted"));if(function(t,e){if(t.cursorState.killed)return _(t,e),!0;return!1}(e,n))return;if(function(t,e){if(t.cursorState.dead&&!t.cursorState.killed)return t.cursorState.killed=!0,_(t,e),!0;return!1}(e,n))return;if(function(t,e){if(t.cursorState.dead&&t.cursorState.killed)return g(e,new o("cursor is dead")),!0;return!1}(e,n))return;if(!e.cursorState.init){if(!e.topology.isConnected(e.options)){if("server"===e.topology._type&&!e.topology.s.options.reconnect)return n(new o("no connection available"));if(null!=e.disconnectHandler)return e.topology.isDestroyed()?n(new o("Topology was destroyed")):void e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[n],n)}return void e._initializeCursor((r,i)=>{r||null===i?n(r,i):t(e,n)})}if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),b(e,n);if(e.cursorState.cursorIndex!==e.cursorState.documents.length||m.ZERO.equals(e.cursorState.cursorId)){if(e.cursorState.documents.length===e.cursorState.cursorIndex&&e.cmd.tailable&&m.ZERO.equals(e.cursorState.cursorId))return g(n,new o({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length===e.cursorState.cursorIndex&&m.ZERO.equals(e.cursorState.cursorId))b(e,n);else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),b(e,n);e.cursorState.currentLimit+=1;let t=e.cursorState.documents[e.cursorState.cursorIndex++];if(!t||t.$err)return e.kill(),b(e,(function(){g(n,new o(t?t.$err:void 0))}));e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.doc&&(t=e.cursorState.transforms.doc(t)),g(n,null,t)}}else{if(e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.topology.isDestroyed())return n(new s("connection destroyed, not possible to instantiate cursor"));if(function(t,e){if(t.pool&&t.pool.isDestroyed()){t.cursorState.killed=!0;const n=new s(`connection to host ${t.pool.host}:${t.pool.port} was destroyed`);return w(t,()=>e(n)),!0}return!1}(e,n))return;e._getMore((function(r,i,s){return r?g(n,r):(e.connection=s,0===e.cursorState.documents.length&&e.cmd.tailable&&m.ZERO.equals(e.cursorState.cursorId)?g(n,new o({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData})):0===e.cursorState.documents.length&&e.cmd.tailable&&!m.ZERO.equals(e.cursorState.cursorId)?t(e,n):e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit?b(e,n):void t(e,n))}))}}(this,t)}clone(){return this.topology.cursor(this.ns,this.cmd,this.options)}isDead(){return!0===this.cursorState.dead}isKilled(){return!0===this.cursorState.killed}isNotified(){return!0===this.cursorState.notified}bufferedCount(){return this.cursorState.documents.length-this.cursorState.cursorIndex}readBufferedDocuments(t){const e=this.cursorState.documents.length-this.cursorState.cursorIndex,n=t<e?t:e;let r=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(let t=0;t<r.length;t++)r[t]=this.cursorState.transforms.doc(r[t]);return this.cursorState.limit>0&&this.cursorState.currentLimit+r.length>this.cursorState.limit&&(r=r.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+r.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+r.length,r}kill(t){this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init?t&&t(null,null):this.server.killCursors(this.ns,this.cursorState,t)}rewind(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)}_read(){if(this.s&&this.s.state===y.CLOSED||this.isDead())return this.push(null);this._next((t,e)=>t?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",t),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):this.cursorState.streamOptions&&"function"==typeof this.cursorState.streamOptions.transform&&null!=e?this.push(this.cursorState.streamOptions.transform(e)):(this.push(e),void(null===e&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))}_endSession(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=this.cursorState.session;return n&&(t.force||n.owner===this)?(this.cursorState.session=void 0,this.operation&&this.operation.clearSession(),n.endSession(e),!0):(e&&e(),!1)}_getMore(t){this.logger.isDebug()&&this.logger.debug(`schedule getMore call for query [${JSON.stringify(this.query)}]`);let e=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+e>this.cursorState.limit&&(e=this.cursorState.limit-this.cursorState.currentLimit);const n=this.cursorState;this.server.getMore(this.ns,n,e,this.options,(e,r,i)=>{(e||n.cursorId&&n.cursorId.isZero())&&this._endSession(),t(e,r,i)})}_initializeCursor(t){const e=this;if(u(e.topology)&&e.topology.shouldCheckForSessionSupport())return void e.topology.selectServer(c.primaryPreferred,e=>{e?t(e):this._initializeCursor(t)});function n(n,r){const i=e.cursorState;if((n||i.cursorId&&i.cursorId.isZero())&&e._endSession(),0===i.documents.length&&i.cursorId&&i.cursorId.isZero()&&!e.cmd.tailable&&!e.cmd.awaitData)return _(e,t);t(n,r)}const r=(t,r)=>{if(t)return n(t);const i=r.message;if(i.queryFailure)return n(new o(i.documents[0]),null);if(Array.isArray(i.documents)&&1===i.documents.length&&(!e.cmd.find||e.cmd.find&&!1===e.cmd.virtual)&&("string"!=typeof i.documents[0].cursor||i.documents[0].$err||i.documents[0].errmsg||Array.isArray(i.documents[0].result))){if(i.documents[0].$err||i.documents[0].errmsg)return n(new o(i.documents[0]),null);if(null!=i.documents[0].cursor&&"string"!=typeof i.documents[0].cursor){const t=i.documents[0].cursor.id;return i.documents[0].cursor.ns&&(e.ns=i.documents[0].cursor.ns),e.cursorState.cursorId="number"==typeof t?m.fromNumber(t):t,e.cursorState.lastCursorId=e.cursorState.cursorId,e.cursorState.operationTime=i.documents[0].operationTime,Array.isArray(i.documents[0].cursor.firstBatch)&&(e.cursorState.documents=i.documents[0].cursor.firstBatch),n(null,i)}if(Array.isArray(i.documents[0].result))return e.cursorState.documents=i.documents[0].result,e.cursorState.cursorId=m.ZERO,n(null,i)}const s=i.cursorId||0;e.cursorState.cursorId=s instanceof m?s:m.fromNumber(s),e.cursorState.documents=i.documents,e.cursorState.lastCursorId=i.cursorId,e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.query&&(e.cursorState.documents=e.cursorState.transforms.query(i)),n(null,i)};if(e.operation)return e.logger.isDebug()&&e.logger.debug(`issue initial query [${JSON.stringify(e.cmd)}] with flags [${JSON.stringify(e.query)}]`),void l(e.topology,e.operation,(t,i)=>{if(t)n(t);else{if(e.server=e.operation.server,e.cursorState.init=!0,null!=e.cursorState.cursorId)return n();r(t,i)}});const i={};return e.cursorState.session&&(i.session=e.cursorState.session),e.operation?i.readPreference=e.operation.readPreference:e.options.readPreference&&(i.readPreference=e.options.readPreference),e.topology.selectServer(i,(i,s)=>{if(i){const n=e.disconnectHandler;return null!=n?n.addObjectAndMethod("cursor",e,"next",[t],t):t(i)}if(e.server=s,e.cursorState.init=!0,a(e.server,e.cmd))return t(new o(`server ${e.server.name} does not support collation`));if(null!=e.cursorState.cursorId)return n();if(e.logger.isDebug()&&e.logger.debug(`issue initial query [${JSON.stringify(e.cmd)}] with flags [${JSON.stringify(e.query)}]`),null!=e.cmd.find)return void s.query(e.ns,e.cmd,e.cursorState,e.options,r);const c=Object.assign({session:e.cursorState.session},e.options);s.command(e.ns,e.cmd,c,r)})}}function b(t,e){t.cursorState.dead=!0,_(t,e)}function _(t,e){w(t,()=>g(e,null,null))}function w(t,e){if(t.cursorState.notified=!0,t.cursorState.documents=[],t.cursorState.cursorIndex=0,!t.cursorState.session)return e();t._endSession(e)}f.ASYNC_ITERATOR&&(v.prototype[Symbol.asyncIterator]=n(156).asyncIterator),t.exports={CursorState:y,CoreCursor:v}},function(t,e,n){"use strict";t.exports=Object.freeze({enumerable:!0,configurable:!0,writable:!0,value:void 0})},function(t,e,n){"use strict";var r=(0,n(23).retrieveBSON)().Long;const i=n(29).Buffer;var o=0,s=n(14).opcodes,a=function(t,e,n,r){if(null==e)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==e.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=t,this.ns=e,this.query=n,this.numberToSkip=r.numberToSkip||0,this.numberToReturn=r.numberToReturn||0,this.returnFieldSelector=r.returnFieldSelector||null,this.requestId=a.getRequestId(),this.pre32Limit=r.pre32Limit,this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.maxBsonSize=r.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof r.checkKeys||r.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof r.slaveOk&&r.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};a.prototype.incRequestId=function(){this.requestId=o++},a.nextRequestId=function(){return o+1},a.prototype.toBin=function(){var t=[],e=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var r=i.alloc(20+i.byteLength(this.ns)+1+4+4);t.push(r);var o=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(o),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(e=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),t.push(e));var a=r.length+o.length+(e?e.length:0),c=4;return r[3]=a>>24&255,r[2]=a>>16&255,r[1]=a>>8&255,r[0]=255&a,r[c+3]=this.requestId>>24&255,r[c+2]=this.requestId>>16&255,r[c+1]=this.requestId>>8&255,r[c]=255&this.requestId,r[(c+=4)+3]=0,r[c+2]=0,r[c+1]=0,r[c]=0,r[(c+=4)+3]=s.OP_QUERY>>24&255,r[c+2]=s.OP_QUERY>>16&255,r[c+1]=s.OP_QUERY>>8&255,r[c]=255&s.OP_QUERY,r[(c+=4)+3]=n>>24&255,r[c+2]=n>>16&255,r[c+1]=n>>8&255,r[c]=255&n,c=(c+=4)+r.write(this.ns,c,"utf8")+1,r[c-1]=0,r[c+3]=this.numberToSkip>>24&255,r[c+2]=this.numberToSkip>>16&255,r[c+1]=this.numberToSkip>>8&255,r[c]=255&this.numberToSkip,r[(c+=4)+3]=this.numberToReturn>>24&255,r[c+2]=this.numberToReturn>>16&255,r[c+1]=this.numberToReturn>>8&255,r[c]=255&this.numberToReturn,c+=4,t},a.getRequestId=function(){return++o};var c=function(t,e,n,r){r=r||{},this.numberToReturn=r.numberToReturn||0,this.requestId=o++,this.bson=t,this.ns=e,this.cursorId=n};c.prototype.toBin=function(){var t=4+i.byteLength(this.ns)+1+4+8+16,e=0,n=i.alloc(t);return n[e+3]=t>>24&255,n[e+2]=t>>16&255,n[e+1]=t>>8&255,n[e]=255&t,n[(e+=4)+3]=this.requestId>>24&255,n[e+2]=this.requestId>>16&255,n[e+1]=this.requestId>>8&255,n[e]=255&this.requestId,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=s.OP_GETMORE>>24&255,n[e+2]=s.OP_GETMORE>>16&255,n[e+1]=s.OP_GETMORE>>8&255,n[e]=255&s.OP_GETMORE,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,e=(e+=4)+n.write(this.ns,e,"utf8")+1,n[e-1]=0,n[e+3]=this.numberToReturn>>24&255,n[e+2]=this.numberToReturn>>16&255,n[e+1]=this.numberToReturn>>8&255,n[e]=255&this.numberToReturn,n[(e+=4)+3]=this.cursorId.getLowBits()>>24&255,n[e+2]=this.cursorId.getLowBits()>>16&255,n[e+1]=this.cursorId.getLowBits()>>8&255,n[e]=255&this.cursorId.getLowBits(),n[(e+=4)+3]=this.cursorId.getHighBits()>>24&255,n[e+2]=this.cursorId.getHighBits()>>16&255,n[e+1]=this.cursorId.getHighBits()>>8&255,n[e]=255&this.cursorId.getHighBits(),e+=4,n};var u=function(t,e,n){this.ns=e,this.requestId=o++,this.cursorIds=n};u.prototype.toBin=function(){var t=24+8*this.cursorIds.length,e=0,n=i.alloc(t);n[e+3]=t>>24&255,n[e+2]=t>>16&255,n[e+1]=t>>8&255,n[e]=255&t,n[(e+=4)+3]=this.requestId>>24&255,n[e+2]=this.requestId>>16&255,n[e+1]=this.requestId>>8&255,n[e]=255&this.requestId,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=s.OP_KILL_CURSORS>>24&255,n[e+2]=s.OP_KILL_CURSORS>>16&255,n[e+1]=s.OP_KILL_CURSORS>>8&255,n[e]=255&s.OP_KILL_CURSORS,n[(e+=4)+3]=0,n[e+2]=0,n[e+1]=0,n[e]=0,n[(e+=4)+3]=this.cursorIds.length>>24&255,n[e+2]=this.cursorIds.length>>16&255,n[e+1]=this.cursorIds.length>>8&255,n[e]=255&this.cursorIds.length,e+=4;for(var r=0;r<this.cursorIds.length;r++)n[e+3]=this.cursorIds[r].getLowBits()>>24&255,n[e+2]=this.cursorIds[r].getLowBits()>>16&255,n[e+1]=this.cursorIds[r].getLowBits()>>8&255,n[e]=255&this.cursorIds[r].getLowBits(),n[(e+=4)+3]=this.cursorIds[r].getHighBits()>>24&255,n[e+2]=this.cursorIds[r].getHighBits()>>16&255,n[e+1]=this.cursorIds[r].getHighBits()>>8&255,n[e]=255&this.cursorIds[r].getHighBits(),e+=4;return n};var l=function(t,e,n,i,o){o=o||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=e,this.data=i,this.bson=t,this.opts=o,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=i.readInt32LE(0),this.cursorId=new r(i.readInt32LE(4),i.readInt32LE(8)),this.startingFrom=i.readInt32LE(12),this.numberReturned=i.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(1&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof o.promoteLongs||o.promoteLongs,this.promoteValues="boolean"!=typeof o.promoteValues||o.promoteValues,this.promoteBuffers="boolean"==typeof o.promoteBuffers&&o.promoteBuffers};l.prototype.isParsed=function(){return this.parsed},l.prototype.parse=function(t){if(!this.parsed){var e,n,r=(t=t||{}).raw||!1,i=t.documentsReturnedIn||null;n={promoteLongs:"boolean"==typeof t.promoteLongs?t.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof t.promoteValues?t.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers?t.promoteBuffers:this.opts.promoteBuffers},this.index=20;for(var o=0;o<this.numberReturned;o++)e=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[o]=r?this.data.slice(this.index,this.index+e):this.bson.deserialize(this.data.slice(this.index,this.index+e),n),this.index=this.index+e;if(1===this.documents.length&&null!=i&&r){const t={};t[i]=!0,n.fieldsAsRaw=t;const e=this.bson.deserialize(this.documents[0],n);this.documents=[e]}this.parsed=!0}},t.exports={Query:a,GetMore:c,Response:l,KillCursor:u}},function(t,e,n){"use strict";const r=n(26).Transform,i=n(26).PassThrough,o=n(6).deprecate,s=n(0).handleCallback,a=n(3).ReadPreference,c=n(3).MongoError,u=n(35).CoreCursor,l=n(35).CursorState,h=n(3).BSON.Map,f=n(0).maybePromise,p=n(73),d=n(0).formattedOrderClause,m=n(299).each,y=n(300),g=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],v=["numberOfRetries","tailableRetryInterval"];class b extends u{constructor(t,e,n,r){super(t,e,n,r),this.operation&&(r=this.operation.options);const i=r.numberOfRetries||5,o=r.tailableRetryInterval||500,s=i,a=r.promiseLibrary||Promise;this.s={numberOfRetries:i,tailableRetryInterval:o,currentNumberOfRetries:s,state:l.INIT,promiseLibrary:a,explicitlyIgnoreSession:!!r.explicitlyIgnoreSession},!r.explicitlyIgnoreSession&&r.session&&(this.cursorState.session=r.session),!0===this.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0);let c=1e3;this.cmd.cursor&&this.cmd.cursor.batchSize?c=this.cmd.cursor.batchSize:r.cursor&&r.cursor.batchSize?c=r.cursor.batchSize:"number"==typeof r.batchSize&&(c=r.batchSize),this.setCursorBatchSize(c)}get readPreference(){return this.operation?this.operation.readPreference:this.options.readPreference}get sortValue(){return this.cmd.sort}_initializeCursor(t){this.operation&&null!=this.operation.session?this.cursorState.session=this.operation.session:this.s.explicitlyIgnoreSession||this.cursorState.session||!this.topology.hasSessionSupport()||(this.cursorState.session=this.topology.startSession({owner:this}),this.operation&&(this.operation.session=this.cursorState.session)),super._initializeCursor(t)}hasNext(t){if(this.s.state===l.CLOSED||this.isDead&&this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return f(this,t,t=>{const e=this;if(e.isNotified())return t(null,!1);e._next((n,r)=>n?t(n):null==r||e.s.state===b.CLOSED||e.isDead()?t(null,!1):(e.s.state=l.OPEN,e.cursorState.cursorIndex--,e.cursorState.limit>0&&e.cursorState.currentLimit--,void t(null,!0)))})}next(t){return f(this,t,t=>{const e=this;if(e.s.state===l.CLOSED||e.isDead&&e.isDead())t(c.create({message:"Cursor is closed",driver:!0}));else{if(e.s.state===l.INIT&&e.cmd.sort)try{e.cmd.sort=d(e.cmd.sort)}catch(e){return t(e)}e._next((n,r)=>{if(n)return t(n);e.s.state=l.OPEN,t(null,r)})}})}filter(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.query=t,this}maxScan(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxScan=t,this}hint(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.hint=t,this}min(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.min=t,this}max(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.max=t,this}returnKey(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.returnKey=t,this}showRecordId(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.showDiskLoc=t,this}snapshot(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.snapshot=t,this}setCursorOption(t,e){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===v.indexOf(t))throw c.create({message:`option ${t} is not a supported option ${v}`,driver:!0});return this.s[t]=e,"numberOfRetries"===t&&(this.s.currentNumberOfRetries=e),this}addCursorFlag(t,e){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===g.indexOf(t))throw c.create({message:`flag ${t} is not a supported flag ${g}`,driver:!0});if("boolean"!=typeof e)throw c.create({message:`flag ${t} must be a boolean value`,driver:!0});return this.cmd[t]=e,this}addQueryModifier(t,e){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("$"!==t[0])throw c.create({message:`${t} is not a valid query modifier`,driver:!0});const n=t.substr(1);return this.cmd[n]=e,"orderby"===n&&(this.cmd.sort=this.cmd[n]),this}comment(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.comment=t,this}maxAwaitTimeMS(t){if("number"!=typeof t)throw c.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxAwaitTimeMS=t,this}maxTimeMS(t){if("number"!=typeof t)throw c.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxTimeMS=t,this}project(t){if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.fields=t,this}sort(t,e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===l.CLOSED||this.s.state===l.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});let n=t;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new h(n.map(t=>{const e=[t[0],null];if("asc"===t[1])e[1]=1;else if("desc"===t[1])e[1]=-1;else{if(1!==t[1]&&-1!==t[1]&&!t[1].$meta)throw new c("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");e[1]=t[1]}return e}))),null!=e&&(n=[[t,e]]),this.cmd.sort=n,this}batchSize(t){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===l.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw c.create({message:"batchSize requires an integer",driver:!0});return this.cmd.batchSize=t,this.setCursorBatchSize(t),this}collation(t){return this.cmd.collation=t,this}limit(t){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===l.OPEN||this.s.state===l.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw c.create({message:"limit requires an integer",driver:!0});return this.cmd.limit=t,this.setCursorLimit(t),this}skip(t){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===l.OPEN||this.s.state===l.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw c.create({message:"skip requires an integer",driver:!0});return this.cmd.skip=t,this.setCursorSkip(t),this}each(t){this.rewind(),this.s.state=l.INIT,m(this,t)}forEach(t,e){if(this.rewind(),this.s.state=l.INIT,"function"!=typeof e)return new this.s.promiseLibrary((e,n)=>{m(this,(r,i)=>r?(n(r),!1):null==i?(e(null),!1):(t(i),!0))});m(this,(n,r)=>{if(n)return e(n),!1;if(null!=r)return t(r),!0;if(null==r&&e){const t=e;return e=null,t(null),!1}})}setReadPreference(t){if(this.s.state!==l.INIT)throw c.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof a)this.options.readPreference=t;else{if("string"!=typeof t)throw new TypeError("Invalid read preference: "+t);this.options.readPreference=new a(t)}return this}toArray(t){if(this.options.tailable)throw c.create({message:"Tailable cursor cannot be converted to array",driver:!0});return f(this,t,t=>{const e=this,n=[];e.rewind(),e.s.state=l.INIT;const r=()=>{e._next((i,o)=>{if(i)return s(t,i);if(null==o)return e.close({skipKillCursors:!0},()=>s(t,null,n));if(n.push(o),e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());Array.prototype.push.apply(n,t)}r()})};r()})}count(t,e,n){if(null==this.cmd.query)throw c.create({message:"count can only be used with find command",driver:!0});"function"==typeof e&&(n=e,e={}),e=e||{},"function"==typeof t&&(n=t,t=!0),this.cursorState.session&&(e=Object.assign({},e,{session:this.cursorState.session}));const r=new y(this,t,e);return p(this.topology,r,n)}close(t,e){return"function"==typeof t&&(e=t,t={}),t=Object.assign({},{skipKillCursors:!1},t),f(this,e,e=>{this.s.state=l.CLOSED,t.skipKillCursors||this.kill(),this._endSession(()=>{this.emit("close"),e(null,this)})})}map(t){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const e=this.cursorState.transforms.doc;this.cursorState.transforms.doc=n=>t(e(n))}else this.cursorState.transforms={doc:t};return this}isClosed(){return this.isDead()}destroy(t){t&&this.emit("error",t),this.pause(),this.close()}stream(t){return this.cursorState.streamOptions=t||{},this}transformStream(t){const e=t||{};if("function"==typeof e.transform){const t=new r({objectMode:!0,transform:function(t,n,r){this.push(e.transform(t)),r()}});return this.pipe(t)}return this.pipe(new i({objectMode:!0}))}explain(t){return this.operation&&null==this.operation.cmd?(this.operation.options.explain=!0,this.operation.fullResponse=!1,p(this.topology,this.operation,t)):(this.cmd.explain=!0,this.cmd.readConcern&&delete this.cmd.readConcern,f(this,t,t=>{u.prototype._next.apply(this,[t])}))}getLogger(){return this.logger}}b.prototype.maxTimeMs=b.prototype.maxTimeMS,o(b.prototype.each,"Cursor.each is deprecated. Use Cursor.forEach instead."),o(b.prototype.maxScan,"Cursor.maxScan is deprecated, and will be removed in a later version"),o(b.prototype.snapshot,"Cursor Snapshot is deprecated, and will be removed in a later version"),t.exports=b},function(t,e,n){"use strict";
/*!
* returns discriminator by discriminatorMapping.value
*
* @param {Model} model
* @param {string} value
*/t.exports=function(t,e){let n=null;if(!t.discriminators)return n;for(const r in t.discriminators){const i=t.discriminators[r];if(i.schema&&i.schema.discriminatorMapping&&i.schema.discriminatorMapping.value==e){n=i;break}}return n}},function(t,e,n){"use strict";const r=n(3),i=n(298),o=n(100).connect;o.MongoError=r.MongoError,o.MongoNetworkError=r.MongoNetworkError,o.MongoTimeoutError=r.MongoTimeoutError,o.MongoServerSelectionError=r.MongoServerSelectionError,o.MongoParseError=r.MongoParseError,o.MongoWriteConcernError=r.MongoWriteConcernError,o.MongoBulkWriteError=n(128).BulkWriteError,o.BulkWriteError=o.MongoBulkWriteError,o.Admin=n(184),o.MongoClient=n(100),o.Db=n(103),o.Collection=n(76),o.Server=n(104),o.ReplSet=n(188),o.Mongos=n(187),o.ReadPreference=r.ReadPreference,o.GridStore=n(336),o.Chunk=n(189),o.Logger=r.Logger,o.AggregationCursor=n(129),o.CommandCursor=n(130),o.Cursor=n(38),o.GridFSBucket=n(337),o.CoreServer=r.Server,o.CoreConnection=r.Connection,o.Binary=r.BSON.Binary,o.Code=r.BSON.Code,o.Map=r.BSON.Map,o.DBRef=r.BSON.DBRef,o.Double=r.BSON.Double,o.Int32=r.BSON.Int32,o.Long=r.BSON.Long,o.MinKey=r.BSON.MinKey,o.MaxKey=r.BSON.MaxKey,o.ObjectID=r.BSON.ObjectID,o.ObjectId=r.BSON.ObjectID,o.Symbol=r.BSON.Symbol,o.Timestamp=r.BSON.Timestamp,o.BSONRegExp=r.BSON.BSONRegExp,o.Decimal128=r.BSON.Decimal128,o.connect=o,o.instrument=function(t,e){"function"==typeof t&&(e=t,t={});const n=new i;return n.instrument(o.MongoClient,e),n},t.exports=o},function(t,e,n){"use strict";const r=n(23).retrieveSnappy(),i=n(263),o={snappy:1,zlib:2},s=new Set(["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"]);t.exports={compressorIDs:o,uncompressibleCommands:s,compress:function(t,e,n){switch(t.options.agreedCompressor){case"snappy":r.compress(e,n);break;case"zlib":var o={};t.options.zlibCompressionLevel&&(o.level=t.options.zlibCompressionLevel),i.deflate(e,o,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+t.options.agreedCompressor+'".')}},decompress:function(t,e,n){if(t<0||t>o.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+t+")");switch(t){case o.snappy:r.uncompress(e,n);break;case o.zlib:i.inflate(e,n);break;default:n(null,e)}}}},function(t,e,n){"use strict";const r=n(33).get().ObjectId,i=n(8).objectIdSymbol;
/*!
 * Getter for convenience with populate, see gh-6115
 */
Object.defineProperty(r.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}),r.prototype[i]=!0,t.exports=r},function(t,e,n){"use strict";var r,i,o=n(67),s=o.freeze,a=n(15),c=a.inherits,u=a.notEnumerableProp;function l(t,e){function n(r){if(!(this instanceof n))return new n(r);u(this,"message","string"==typeof r?r:e),u(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(n,Error),n}var h=l("Warning","warning"),f=l("CancellationError","cancellation error"),p=l("TimeoutError","timeout error"),d=l("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(t){r=l("TypeError","type error"),i=l("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<m.length;++y)"function"==typeof Array.prototype[m[y]]&&(d.prototype[m[y]]=Array.prototype[m[y]]);o.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var g=0;function v(t){if(!(this instanceof v))return new v(t);u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];e+=(r=i.join("\n"))+"\n"}return g--,e},c(v,Error);var b=Error.__BluebirdErrorTypes__;b||(b=s({CancellationError:f,TimeoutError:p,OperationalError:v,RejectionError:v,AggregateError:d}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:h}},function(t,e,n){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i;n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return f})),n.d(e,"d",(function(){return p}));var o,s=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(o||(o={}));var a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},c=o.INFO,u=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),l=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var o=(new Date).toISOString(),s=u[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,r(["["+o+"]  "+t.name+":"],n))}},h=function(){function t(t){this.name=t,this._logLevel=c,this._logHandler=l,this._userLogHandler=null,s.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?a[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],t)),this._logHandler.apply(this,r([this,o.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],t)),this._logHandler.apply(this,r([this,o.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],t)),this._logHandler.apply(this,r([this,o.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],t)),this._logHandler.apply(this,r([this,o.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],t)),this._logHandler.apply(this,r([this,o.ERROR],t))},t}();function f(t){s.forEach((function(e){e.setLogLevel(t)}))}function p(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=a[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:o[n].toLowerCase(),message:a,args:i,type:e.name})}},r=0,i=s;r<i.length;r++){n(i[r])}}},function(t,e,n){"use strict";function r(t,e){return new Buffer(t,e)}t.exports={normalizedFunctionString:function(t){return t.toString().replace(/function *\(/,"function (")},allocBuffer:"function"==typeof Buffer.alloc?function(){return Buffer.alloc.apply(Buffer,arguments)}:r,toBuffer:"function"==typeof Buffer.from?function(){return Buffer.from.apply(Buffer,arguments)}:r}},function(t,e,n){"use strict";class r{constructor(t,e,n,r){null!=t&&(this.w=t),null!=e&&(this.wtimeout=e),null!=n&&(this.j=n),null!=r&&(this.fsync=r)}static fromOptions(t){if(null!=t&&(null!=t.writeConcern||null!=t.w||null!=t.wtimeout||null!=t.j||null!=t.fsync))return t.writeConcern?new r(t.writeConcern.w,t.writeConcern.wtimeout,t.writeConcern.j,t.writeConcern.fsync):new r(t.w,t.wtimeout,t.j,t.fsync)}}t.exports=r},function(t,e,n){"use strict";const r=n(23).retrieveBSON,i=n(13),o=r(),s=o.Binary,a=n(9).uuidV4,c=n(5).MongoError,u=n(5).isRetryableError,l=n(5).MongoNetworkError,h=n(5).MongoWriteConcernError,f=n(97).Transaction,p=n(97).TxnState,d=n(9).isPromiseLike,m=n(19),y=n(97).isTransactionCommand,g=n(16).resolveClusterTime,v=n(14).isSharded,b=n(9).maxWireVersion,_=n(0).now,w=n(0).calculateDurationInMs;function S(t,e){if(null==t.serverSession){const t=new c("Cannot use a session that has ended");if("function"==typeof e)return e(t,null),!1;throw t}return!0}const O=Symbol("serverSession");class E extends i{constructor(t,e,n,r){if(super(),null==t)throw new Error("ClientSession requires a topology");if(null==e||!(e instanceof P))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},r=r||{},this.topology=t,this.sessionPool=e,this.hasEnded=!1,this.clientOptions=r,this[O]=void 0,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},this.clusterTime=n.initialClusterTime,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new f}get id(){return this.serverSession.id}get serverSession(){return null==this[O]&&(this[O]=this.sessionPool.acquire()),this[O]}endSession(t,e){"function"==typeof t&&(e=t,t={}),t=t||{},this.hasEnded||(this.serverSession&&this.inTransaction()&&this.abortTransaction(),this.sessionPool.release(this.serverSession),this[O]=void 0,this.hasEnded=!0,this.emit("ended",this)),"function"==typeof e&&e(null,null)}advanceOperationTime(t){null!=this.operationTime?t.greaterThan(this.operationTime)&&(this.operationTime=t):this.operationTime=t}equals(t){return t instanceof E&&this.id.id.buffer.equals(t.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(t){if(S(this),this.inTransaction())throw new c("Transaction already in progress");const e=b(this.topology);if(v(this.topology)&&null!=e&&e<8)throw new c("Transactions are not supported on sharded clusters in MongoDB < 4.2.");this.incrementTransactionNumber(),this.transaction=new f(Object.assign({},this.clientOptions,t||this.defaultTransactionOptions)),this.transaction.transition(p.STARTING_TRANSACTION)}commitTransaction(t){if("function"!=typeof t)return new Promise((t,e)=>{x(this,"commitTransaction",(n,r)=>n?e(n):t(r))});x(this,"commitTransaction",t)}abortTransaction(t){if("function"!=typeof t)return new Promise((t,e)=>{x(this,"abortTransaction",(n,r)=>n?e(n):t(r))});x(this,"abortTransaction",t)}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}withTransaction(t,e){return k(this,_(),t,e)}}const T=new Set(["CannotSatisfyWriteConcern","UnknownReplWriteConcern","UnsatisfiableWriteConcern"]);function C(t,e){return w(t)<e}function I(t){return null!=t&&(50===t.code||t.writeConcernError&&50===t.writeConcernError.code)}const A=new Set([p.NO_TRANSACTION,p.TRANSACTION_COMMITTED,p.TRANSACTION_ABORTED]);function k(t,e,n,r){let i;t.startTransaction(r);try{i=n(t)}catch(t){i=Promise.reject(t)}if(!d(i))throw t.abortTransaction(),new TypeError("Function provided to `withTransaction` must return a Promise");return i.then(()=>{if(!function(t){return A.has(t.transaction.state)}(t))return function t(e,n,r,i){return e.commitTransaction().catch(o=>{if(o instanceof c&&C(n,12e4)&&!I(o)){if(o.hasErrorLabel("UnknownTransactionCommitResult"))return t(e,n,r,i);if(o.hasErrorLabel("TransientTransactionError"))return k(e,n,r,i)}throw o})}(t,e,n,r)}).catch(i=>{function o(i){if(i instanceof c&&i.hasErrorLabel("TransientTransactionError")&&C(e,12e4))return k(t,e,n,r);throw I(i)&&(null==i.errorLabels&&(i.errorLabels=[]),i.errorLabels.push("UnknownTransactionCommitResult")),i}return t.transaction.isActive?t.abortTransaction().then(()=>o(i)):o(i)})}function x(t,e,n){if(!S(t,n))return;let r=t.transaction.state;if(r===p.NO_TRANSACTION)return void n(new c("No transaction started"));if("commitTransaction"===e){if(r===p.STARTING_TRANSACTION||r===p.TRANSACTION_COMMITTED_EMPTY)return t.transaction.transition(p.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(r===p.TRANSACTION_ABORTED)return void n(new c("Cannot call commitTransaction after calling abortTransaction"))}else{if(r===p.STARTING_TRANSACTION)return t.transaction.transition(p.TRANSACTION_ABORTED),void n(null,null);if(r===p.TRANSACTION_ABORTED)return void n(new c("Cannot call abortTransaction twice"));if(r===p.TRANSACTION_COMMITTED||r===p.TRANSACTION_COMMITTED_EMPTY)return void n(new c("Cannot call abortTransaction after calling commitTransaction"))}const i={[e]:1};let o;function s(r,i){if("commitTransaction"===e){if(t.transaction.transition(p.TRANSACTION_COMMITTED),r&&(r instanceof l||r instanceof h||u(r)||I(r))){if(r.errorLabels){const t=r.errorLabels.indexOf("TransientTransactionError");-1!==t&&r.errorLabels.splice(t,1)}else r.errorLabels=[];(I(o=r)||!T.has(o.codeName)&&100!==o.code&&79!==o.code)&&(r.errorLabels.push("UnknownTransactionCommitResult"),t.transaction.unpinServer())}}else t.transaction.transition(p.TRANSACTION_ABORTED);var o;n(r,i)}function a(t){return"commitTransaction"===e?t:null}t.transaction.options.writeConcern?o=Object.assign({},t.transaction.options.writeConcern):t.clientOptions&&t.clientOptions.w&&(o={w:t.clientOptions.w}),r===p.TRANSACTION_COMMITTED&&(o=Object.assign({wtimeout:1e4},o,{w:"majority"})),o&&Object.assign(i,{writeConcern:o}),"commitTransaction"===e&&t.transaction.options.maxTimeMS&&Object.assign(i,{maxTimeMS:t.transaction.options.maxTimeMS}),t.transaction.recoveryToken&&function(t){return!!t.topology.s.options.useRecoveryToken}(t)&&(i.recoveryToken=t.transaction.recoveryToken),t.topology.command("admin.$cmd",i,{session:t},(e,n)=>{if(e&&u(e))return i.commitTransaction&&(t.transaction.unpinServer(),i.writeConcern=Object.assign({wtimeout:1e4},i.writeConcern,{w:"majority"})),t.topology.command("admin.$cmd",i,{session:t},(t,e)=>s(a(t),e));s(a(e),n)})}class N{constructor(){this.id={id:new s(a(),s.SUBTYPE_UUID)},this.lastUse=_(),this.txnNumber=0,this.isDirty=!1}hasTimedOut(t){return Math.round(w(this.lastUse)%864e5%36e5/6e4)>t-1}}class P{constructor(t){if(null==t)throw new Error("ServerSessionPool requires a topology");this.topology=t,this.sessions=[]}endAllPooledSessions(t){this.sessions.length?this.topology.endSessions(this.sessions.map(t=>t.id),()=>{this.sessions=[],"function"==typeof t&&t()}):"function"==typeof t&&t()}acquire(){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const e=this.sessions.shift();if(!e.hasTimedOut(t))return e}return new N}release(t){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(e))break;this.sessions.pop()}if(!t.hasTimedOut(e)){if(t.isDirty)return;this.sessions.unshift(t)}}}function j(t,e){return!!(t.aggregate||t.count||t.distinct||t.find||t.parallelCollectionScan||t.geoNear||t.geoSearch)||!(!t.mapReduce||!e.out||1!==e.out.inline&&"inline"!==e.out)}t.exports={ClientSession:E,ServerSession:N,ServerSessionPool:P,TxnState:p,applySession:function(t,e,n){if(t.hasEnded)return new c("Cannot use a session that has ended");const r=t.serverSession;r.lastUse=_(),e.lsid=r.id;const i=t.inTransaction()||y(e),s=n.willRetryWrite,a=j(e);if(r.txnNumber&&(s||i)&&(e.txnNumber=o.Long.fromNumber(r.txnNumber)),!i)return t.transaction.state!==p.NO_TRANSACTION&&t.transaction.transition(p.NO_TRANSACTION),void(t.supports.causalConsistency&&t.operationTime&&a&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime})));if(n.readPreference&&!n.readPreference.equals(m.primary))return new c(`Read preference in a transaction must be primary, not: ${n.readPreference.mode}`);if(e.autocommit=!1,t.transaction.state===p.STARTING_TRANSACTION){t.transaction.transition(p.TRANSACTION_IN_PROGRESS),e.startTransaction=!0;const n=t.transaction.options.readConcern||t.clientOptions.readConcern;n&&(e.readConcern=n),t.supports.causalConsistency&&t.operationTime&&(e.readConcern=e.readConcern||{},Object.assign(e.readConcern,{afterClusterTime:t.operationTime}))}},updateSessionFromResponse:function(t,e){e.$clusterTime&&g(t,e.$clusterTime),e.operationTime&&t&&t.supports.causalConsistency&&t.advanceOperationTime(e.operationTime),e.recoveryToken&&t&&t.inTransaction()&&(t.transaction._recoveryToken=e.recoveryToken)},commandSupportsReadConcern:j}},function(t,e,n){"use strict";const r=n(13),i=n(3).MongoError,o=n(6).format,s=n(0).translateReadPreference,a=n(3).Sessions.ClientSession;var c=function(t,e){var n=this;e=e||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:e,topology:t},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};c.prototype.add=function(t,e,n,r,s){if(this.s.storeOptions.force)return s(i.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(i.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(i.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:t,n:e,o:n,op:r,c:s})},c.prototype.addObjectAndMethod=function(t,e,n,r,s){if(this.s.storeOptions.force)return s(i.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(i.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(i.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:t,m:n,o:e,p:r,c:s})},c.prototype.flush=function(t){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(t||i.create({message:o("no connection available for operation"),driver:!0}))};var u=["primary","primaryPreferred","nearest","secondaryPreferred"],l=["secondary","secondaryPreferred"];c.prototype.execute=function(t){t=t||{};var e=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof t.executePrimary||t.executePrimary,r="boolean"!=typeof t.executeSecondary||t.executeSecondary;e.length>0;){var i=e.shift();"cursor"===i.t?(n&&r||n&&i.o.options&&i.o.options.readPreference&&-1!==u.indexOf(i.o.options.readPreference.mode)||!n&&r&&i.o.options&&i.o.options.readPreference&&-1!==l.indexOf(i.o.options.readPreference.mode))&&i.o[i.m].apply(i.o,i.p):"auth"===i.t?this.s.topology[i.t].apply(this.s.topology,i.o):(n&&r||n&&i.op&&i.op.readPreference&&-1!==u.indexOf(i.op.readPreference.mode)||!n&&r&&i.op&&i.op.readPreference&&-1!==l.indexOf(i.op.readPreference.mode))&&this.s.topology[i.t](i.n,i.o,i.op,i.c)}},c.prototype.all=function(){return this.s.storedOps};var h=function(t){var e=function(t,e,n){Object.defineProperty(t,e,{enumerable:!0,get:function(){return n}})},n=!1,r=!1,i=!1,o=!1,s=!1,a=!1,c=t.maxWriteBatchSize||1e3,u=!1,l=!1;t.minWireVersion>=0&&(i=!0),t.maxWireVersion>=1&&(n=!0,o=!0),t.maxWireVersion>=2&&(r=!0),t.maxWireVersion>=3&&(s=!0,a=!0),t.maxWireVersion>=5&&(u=!0,l=!0),null==t.minWireVersion&&(t.minWireVersion=0),null==t.maxWireVersion&&(t.maxWireVersion=0),e(this,"hasAggregationCursor",n),e(this,"hasWriteCommands",r),e(this,"hasTextSearch",i),e(this,"hasAuthCommands",o),e(this,"hasListCollectionsCommand",s),e(this,"hasListIndexesCommand",a),e(this,"minWireVersion",t.minWireVersion),e(this,"maxWireVersion",t.maxWireVersion),e(this,"maxNumberOfDocsInBatch",c),e(this,"commandsTakeWriteConcern",u),e(this,"commandsTakeCollation",l)};class f extends r{constructor(){super(),this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(t,e){const n=new a(this,this.s.sessionPool,t,e);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(t,e){return this.s.coreTopology.endSessions(t,e)}get clientMetadata(){return this.s.coreTopology.s.options.metadata}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new h(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(t,e,n,r){this.s.coreTopology.command(t.toString(),e,s(n),r)}insert(t,e,n,r){this.s.coreTopology.insert(t.toString(),e,n,r)}update(t,e,n,r){this.s.coreTopology.update(t.toString(),e,n,r)}remove(t,e,n,r){this.s.coreTopology.remove(t.toString(),e,n,r)}isConnected(t){return t=s(t=t||{}),this.s.coreTopology.isConnected(t)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(t,e,n){return(n=s(n=n||{})).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(t,e,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(t,e,n){return this.s.coreTopology.selectServer(t,e,n)}unref(){return this.s.coreTopology.unref()}connections(){return this.s.coreTopology.connections()}close(t,e){this.s.sessions.forEach(t=>t.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),!0===t&&(this.s.storeOptions.force=t,this.s.store.flush()),this.s.coreTopology.destroy({force:"boolean"==typeof t&&t},e)}}Object.defineProperty(f.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(f.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(f.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(f.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),e.Store=c,e.ServerCapabilities=h,e.TopologyBase=f},function(t,e,n){"use strict";const r=n(192),i=n(63),o=n(42),s=n(133),a=n(107),c=n(193),u=n(194),l=n(64),h=n(8);
/*!
 * Object clone with Mongoose natives support.
 *
 * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.
 *
 * Functions are never cloned.
 *
 * @param {Object} obj the object to clone
 * @param {Object} options
 * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.
 * @return {Object} the cloned object
 * @api private
 */
function f(t,e,n){if(null==t)return t;if(Array.isArray(t))return function(t,e){const n=[];for(const r of t)n.push(f(r,e,!0));return n}(t,e);if(a(t))return e&&e._skipSingleNestedGetters&&t.$isSingleNested&&(e=Object.assign({},e,{getters:!1})),e&&e.json&&"function"==typeof t.toJSON?t.toJSON(e):t.toObject(e);if(t.constructor)switch(c(t.constructor)){case"Object":return p(t,e,n);case"Date":return new t.constructor(+t);case"RegExp":return r(t)}return t instanceof o?new o(t.id):u(t,"Decimal128")?e&&e.flattenDecimals?t.toJSON():i.fromString(t.toString()):!t.constructor&&l(t)?p(t,e,n):t[h.schemaTypeSymbol]?t.clone():e&&e.bson&&"function"==typeof t.toBSON?t:null!=t.valueOf?t.valueOf():p(t,e,n)}
/*!
 * ignore
 */
function p(t,e,n){const r=e&&e.minimize,i={};let o;for(const n in t){if(s.has(n))continue;const a=f(t[n],e);r&&void 0===a||(!1===r&&void 0===a?delete i[n]:(o||(o=!0),i[n]=a))}return r&&!n?o&&i:i}t.exports=f},function(t,e,n){"use strict";
/*!
 * Module requirements
 */const r=n(28),i=n(6);class o extends r{constructor(t){let e;e=t&&"model"===t.constructor.name?t.constructor.modelName+" validation failed":"Validation failed",super(e),this.errors={},this._message=e,t&&(t.errors=this.errors)}toString(){return this.name+": "+s(this)}
/*!
   * inspect helper
   */inspect(){return Object.assign(new Error(this.message),this)}
/*!
  * add message
  */addError(t,e){this.errors[t]=e,this.message=this._message+": "+s(this)}}
/*!
 * ignore
 */
function s(t){const e=Object.keys(t.errors||{}),n=e.length,r=[];let i;for(let o=0;o<n;++o)i=e[o],t!==t.errors[i]&&r.push(i+": "+t.errors[i].message);return r.join(", ")}
/*!
 * Module exports
 */i.inspect.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
o.prototype[i.inspect.custom]=o.prototype.inspect)
/*!
 * Helper for JSON.stringify
 */,Object.defineProperty(o.prototype,"toJSON",{enumerable:!1,writable:!1,configurable:!0,value:function(){return Object.assign({},this,{message:this.message})}}),Object.defineProperty(o.prototype,"name",{value:"ValidationError"}),t.exports=o},function(t,e,n){"use strict";
/*!
 * ignore
 */e.internalToObjectOptions={transform:!1,virtuals:!1,getters:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(219),i=n(22),o=n(42),s=n(222),a=n(39),c=n(51).internalToObjectOptions,u=n(6),l=n(12),h=n(8).arrayAtomicsSymbol,f=n(8).arrayParentSymbol,p=n(8).arrayPathSymbol,d=n(8).arraySchemaSymbol,m=n(8).documentArrayParent,y=Array.prototype.push;class g extends r{get isMongooseDocumentArray(){return!0}
/*!
   * ignore
   */toBSON(){return this.toObject(c)}
/*!
   * ignore
   */map(){const t=super.map.apply(this,arguments);return t[d]=null,t[p]=null,t[f]=null,t}_cast(t,e){if(null==this[d])return t;let n=this[d].casterConstructor;if((n.$isMongooseDocumentArray?t&&t.isMongooseDocumentArray:t instanceof n)||t&&t.constructor&&t.constructor.baseCasterConstructor===n)return t[m]&&t.__parentArray||(t[m]=this[f],t.__parentArray=this),t.$setIndex(e),t;if(null==t)return null;if((Buffer.isBuffer(t)||t instanceof o||!l.isObject(t))&&(t={_id:t}),t&&n.discriminators&&n.schema&&n.schema.options&&n.schema.options.discriminatorKey)if("string"==typeof t[n.schema.options.discriminatorKey]&&n.discriminators[t[n.schema.options.discriminatorKey]])n=n.discriminators[t[n.schema.options.discriminatorKey]];else{const e=a(n,t[n.schema.options.discriminatorKey]);e&&(n=e)}return n.$isMongooseDocumentArray?n.cast(t,this,void 0,void 0,e):new n(t,this,void 0,void 0,e)}id(t){let e,n,r;try{e=s(t).toString()}catch(t){e=null}for(const s of this)if(s&&(r=s.get("_id"),null!=r))if(r instanceof i){if(n||(n=String(t)),n==r._id)return s}else if(t instanceof o||r instanceof o){if(e==r)return s}else if(t==r||l.deepEqual(t,r))return s;return null}toObject(t){return[].concat(this.map((function(e){return null==e?null:"function"!=typeof e.toObject?e:e.toObject(t)})))}slice(){const t=super.slice.apply(this,arguments);return t[f]=this[f],t[p]=this[p],t}push(){const t=super.push.apply(this,arguments);return v(this),t}pull(){const t=super.pull.apply(this,arguments);return v(this),t}shift(){const t=super.shift.apply(this,arguments);return v(this),t}splice(){const t=super.splice.apply(this,arguments);return v(this),t}inspect(){return this.toObject()}create(t){let e=this[d].casterConstructor;if(t&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if("string"==typeof t[e.schema.options.discriminatorKey]&&e.discriminators[t[e.schema.options.discriminatorKey]])e=e.discriminators[t[e.schema.options.discriminatorKey]];else{const n=a(e,t[e.schema.options.discriminatorKey]);n&&(e=n)}return new e(t,this)}
/*!
   * ignore
   */notify(t){const e=this;return function n(r,i){let o=(i=i||e).length;for(;o--;)if(null!=i[o]){switch(t){case"save":r=e[o]}i[o].isMongooseArray?n(r,i[o]):i[o]&&i[o].emit(t,r)}}}}
/*!
 * If this is a document array, each element may contain single
 * populated paths, so we need to modify the top-level document's
 * populated cache. See gh-8247, gh-8265.
 */
function v(t){const e=t[f];if(!e||null==e.$__.populated)return;const n=Object.keys(e.$__.populated).filter(e=>e.startsWith(t[p]+"."));for(const r of n){const n=r.slice((t[p]+".").length);Array.isArray(e.$__.populated[r].value)&&(e.$__.populated[r].value=t.map(t=>t.populated(n)))}}u.inspect.custom&&(g.prototype[u.inspect.custom]=g.prototype.inspect),
/*!
 * Module exports.
 */
t.exports=function(t,e,n){const r=new g;if(r[h]={},r[d]=void 0,Array.isArray(t)&&(t instanceof g&&t[p]===e&&t[f]===n&&(r[h]=Object.assign({},t[h])),t.forEach(t=>{y.call(r,t)})),r[p]=e,n&&n instanceof i)for(r[f]=n,r[d]=n.schema.path(e);null!=r&&null!=r[d]&&r[d].$isMongooseArray&&!r[d].$isMongooseDocumentArray;)r[d]=r[d].casterConstructor;return r}},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("fs")},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this._bsontype="Long",this.low_=0|t,this.high_=0|e}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(t){var e=t||10;if(e<2||36<e)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(e),i=this.div(r),o=i.multiply(r).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}var s=n.fromNumber(Math.pow(e,6));o=this;for(var a="";!o.isZero();){var c=o.div(s),u=o.subtract(c.multiply(s)).toInt().toString(e);if((o=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!==this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!==this.high_?e+33:e+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},n.prototype.notEquals=function(t){return this.high_!==t.high_||this.low_!==t.low_},n.prototype.lessThan=function(t){return this.compare(t)<0},n.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},n.prototype.greaterThan=function(t){return this.compare(t)>0},n.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},n.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.subtract(t).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(t){var e=this.high_>>>16,r=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,c=t.low_>>>16,u=0,l=0,h=0,f=0;return h+=(f+=o+(65535&t.low_))>>>16,f&=65535,l+=(h+=i+c)>>>16,h&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=e+s,u&=65535,n.fromBits(h<<16|f,u<<16|l)},n.prototype.subtract=function(t){return this.add(t.negate())},n.prototype.multiply=function(t){if(this.isZero())return n.ZERO;if(t.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return t.isOdd()?n.MIN_VALUE:n.ZERO;if(t.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&t.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,r=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,c=t.low_>>>16,u=65535&t.low_,l=0,h=0,f=0,p=0;return f+=(p+=o*u)>>>16,p&=65535,h+=(f+=i*u)>>>16,f&=65535,h+=(f+=o*c)>>>16,f&=65535,l+=(h+=r*u)>>>16,h&=65535,l+=(h+=i*c)>>>16,h&=65535,l+=(h+=o*a)>>>16,h&=65535,l+=e*u+r*c+i*a+o*s,l&=65535,n.fromBits(f<<16|p,l<<16|h)},n.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(t.equals(n.ONE)||t.equals(n.NEG_ONE))return n.MIN_VALUE;if(t.equals(n.MIN_VALUE))return n.ONE;var e=this.shiftRight(1).div(t).shiftLeft(1);if(e.equals(n.ZERO))return t.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(t.multiply(e));return e.add(r.div(t))}if(t.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();var i=n.ZERO;for(r=this;r.greaterThanOrEqual(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(e)/Math.LN2),s=o<=48?1:Math.pow(2,o-48),a=n.fromNumber(e),c=a.multiply(t);c.isNegative()||c.greaterThan(r);)e-=s,c=(a=n.fromNumber(e)).multiply(t);a.isZero()&&(a=n.ONE),i=i.add(a),r=r.subtract(c)}return i},n.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(t){return n.fromBits(this.low_&t.low_,this.high_&t.high_)},n.prototype.or=function(t){return n.fromBits(this.low_|t.low_,this.high_|t.high_)},n.prototype.xor=function(t){return n.fromBits(this.low_^t.low_,this.high_^t.high_)},n.prototype.shiftLeft=function(t){if(0===(t&=63))return this;var e=this.low_;if(t<32){var r=this.high_;return n.fromBits(e<<t,r<<t|e>>>32-t)}return n.fromBits(0,e<<t-32)},n.prototype.shiftRight=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>t)}return n.fromBits(e>>t-32,e>=0?0:-1)},n.prototype.shiftRightUnsigned=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>>t)}return 32===t?n.fromBits(e,0):n.fromBits(e>>>t-32,0)},n.fromInt=function(t){if(-128<=t&&t<128){var e=n.INT_CACHE_[t];if(e)return e}var r=new n(0|t,t<0?-1:0);return-128<=t&&t<128&&(n.INT_CACHE_[t]=r),r},n.fromNumber=function(t){return isNaN(t)||!isFinite(t)?n.ZERO:t<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:t+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:t<0?n.fromNumber(-t).negate():new n(t%n.TWO_PWR_32_DBL_|0,t/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(t,e){return new n(t,e)},n.fromString=function(t,e){if(0===t.length)throw Error("number format error: empty string");var r=e||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===t.charAt(0))return n.fromString(t.substring(1),r).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=n.fromNumber(Math.pow(r,8)),o=n.ZERO,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));o=o.multiply(u).add(n.fromNumber(c))}else o=(o=o.multiply(i)).add(n.fromNumber(c))}return o},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),t.exports=n,t.exports.Long=n},function(t,e,n){"use strict";const r=n(29).Buffer,i=n(14).opcodes,o=n(14).databaseNamespace,s=n(19);let a=0;class c{constructor(t,e,n,r){if(null==n)throw new Error("query must be specified for query");this.bson=t,this.ns=e,this.command=n,this.command.$db=o(e),r.readPreference&&r.readPreference.mode!==s.PRIMARY&&(this.command.$readPreference=r.readPreference.toJSON()),this.options=r||{},this.requestId=r.requestId?r.requestId:c.getRequestId(),this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.checkKeys="boolean"==typeof r.checkKeys&&r.checkKeys,this.maxBsonSize=r.maxBsonSize||16777216,this.checksumPresent=!1,this.moreToCome=r.moreToCome||!1,this.exhaustAllowed="boolean"==typeof r.exhaustAllowed&&r.exhaustAllowed}toBin(){const t=[];let e=0;this.checksumPresent&&(e|=1),this.moreToCome&&(e|=2),this.exhaustAllowed&&(e|=65536);const n=r.alloc(20);t.push(n);let o=n.length;const s=this.command;return o+=this.makeDocumentSegment(t,s),n.writeInt32LE(o,0),n.writeInt32LE(this.requestId,4),n.writeInt32LE(0,8),n.writeInt32LE(i.OP_MSG,12),n.writeUInt32LE(e,16),t}makeDocumentSegment(t,e){const n=r.alloc(1);n[0]=0;const i=this.serializeBson(e);return t.push(n),t.push(i),n.length+i.length}serializeBson(t){return this.bson.serialize(t,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined})}}c.getRequestId=function(){return a=a+1&2147483647,a};t.exports={Msg:c,BinMsg:class{constructor(t,e,n,r,i){i=i||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=e,this.data=r,this.bson=t,this.opts=i,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=r.readInt32LE(0),this.checksumPresent=0!=(1&this.responseFlags),this.moreToCome=0!=(2&this.responseFlags),this.exhaustAllowed=0!=(65536&this.responseFlags),this.promoteLongs="boolean"!=typeof i.promoteLongs||i.promoteLongs,this.promoteValues="boolean"!=typeof i.promoteValues||i.promoteValues,this.promoteBuffers="boolean"==typeof i.promoteBuffers&&i.promoteBuffers,this.documents=[]}isParsed(){return this.parsed}parse(t){if(this.parsed)return;t=t||{},this.index=4;const e=t.raw||!1,n=t.documentsReturnedIn||null,r={promoteLongs:"boolean"==typeof t.promoteLongs?t.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof t.promoteValues?t.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers?t.promoteBuffers:this.opts.promoteBuffers};for(;this.index<this.data.length;){const t=this.data.readUInt8(this.index++);if(1===t)console.error("TYPE 1");else if(0===t){const t=this.data.readUInt32LE(this.index),n=this.data.slice(this.index,this.index+t);this.documents.push(e?n:this.bson.deserialize(n,r)),this.index+=t}}if(1===this.documents.length&&null!=n&&e){const t={};t[n]=!0,r.fieldsAsRaw=t;const e=this.bson.deserialize(this.documents[0],r);this.documents=[e]}this.parsed=!0}}}},function(t,e,n){"use strict";const r=n(5).MongoError;t.exports={AuthProvider:class{constructor(t){this.bson=t,this.authStore=[]}auth(t,e,n,i){let o=e.length;if(0===o)return void i(null,null);let s=0,a=null;const c=e=>{this._authenticateSingleConnection(t,e,n,(t,e)=>{o-=1,t?a=new r(t):e&&(e.$err||e.errmsg)?a=new r(e):s+=1,0===o&&(s>0?(this.addCredentials(n),i(null,!0)):(null==a&&(a=new r(`failed to authenticate using ${n.mechanism}`)),i(a,!1)))})},u=t=>process.nextTick(()=>c(t));for(;e.length>0;)u(e.shift())}_authenticateSingleConnection(){throw new Error("_authenticateSingleConnection must be overridden")}addCredentials(t){this.authStore.some(e=>e.equals(t))||this.authStore.push(t)}reauthenticate(t,e,n){const r=this.authStore.slice(0);let i=r.length;if(0===i)return n(null,null);for(let o=0;o<r.length;o++)this.auth(t,e,r[o],(function(t){i-=1,0===i&&n(t,null)}))}logout(t){this.authStore=this.authStore.filter(e=>e.source!==t)}}}},function(t,e,n){"use strict";class r{constructor(t){null!=t&&(this.level=t)}static fromOptions(t){if(null!=t)return t.readConcern?t.readConcern instanceof r?t.readConcern:new r(t.readConcern.level):t.level?new r(t.level):void 0}static get MAJORITY(){return"majority"}static get AVAILABLE(){return"available"}static get LINEARIZABLE(){return"linearizable"}static get SNAPSHOT(){return"snapshot"}}t.exports=r},function(t,e,n){"use strict";var r=n(98),i=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=h;var o=Object.create(n(74));o.inherits=n(75);var s=n(168),a=n(171);o.inherits(h,s);for(var c=i(a.prototype),u=0;u<c.length;u++){var l=c[u];h.prototype[l]||(h.prototype[l]=a.prototype[l])}function h(t){if(!(this instanceof h))return new h(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),h.prototype._destroy=function(t,e){this.push(null),this.end(),r.nextTick(e,t)}},function(t,e,n){"use strict";const r=n(0).applyWriteConcern,i=n(3).BSON.Code,o=n(20).createIndex,s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern,c=n(20).ensureIndex,u=n(20).evaluate,l=n(20).executeCommand,h=n(0).resolveReadPreference,f=n(0).handleCallback,p=n(20).indexInformation,d=n(3).BSON.Long,m=n(3).MongoError,y=n(3).ReadPreference,g=n(0).toError,v=n(21).insertDocuments,b=n(21).updateDocuments;function _(t,e,n){p(t.s.db,t.collectionName,e,n)}t.exports={checkForAtomicOperators:function t(e){if(Array.isArray(e))return e.reduce((e,n)=>e||t(n),null);const n=Object.keys(e);return 0===n.length?g("The update operation document must contain at least one atomic operator."):"$"!==n[0][0]?g("the update operation document must contain atomic operators."):void 0},createIndex:function(t,e,n,r){o(t.s.db,t.collectionName,e,n,r)},createIndexes:function(t,e,n,r){const i=t.s.topology.capabilities();for(let t=0;t<e.length;t++)if(null==e[t].name){const n=[];if(e[t].collation&&i&&!i.commandsTakeCollation)return r(new m("server/primary/mongos does not support collation"));for(let r in e[t].key)n.push(`${r}_${e[t].key[r]}`);e[t].name=n.join("_")}n=Object.assign({},n,{readPreference:y.PRIMARY}),l(t.s.db,{createIndexes:t.collectionName,indexes:e},n,r)},ensureIndex:function(t,e,n,r){c(t.s.db,t.collectionName,e,n,r)},group:function(t,e,n,r,o,c,p,d,m){if(p){const u=o&&"Code"===o._bsontype?o:new i(o),p={group:{ns:t.collectionName,$reduce:u,cond:n,initial:r,out:"inline"}};if(null!=c&&(p.group.finalize=c),"function"==typeof e||e&&"Code"===e._bsontype)p.group.$keyf=e&&"Code"===e._bsontype?e:new i(e);else{const t={};e.forEach(e=>{t[e]=1}),p.group.key=t}(d=Object.assign({},d)).readPreference=h(t,d),a(p,t,d);try{s(p,t,d)}catch(t){return m(t,null)}l(t.s.db,p,d,(t,e)=>{if(t)return f(m,t,null);f(m,null,e.retval)})}else{const s=null!=o&&"Code"===o._bsontype?o.scope:{};s.ns=t.collectionName,s.keys=e,s.condition=n,s.initial=r;const a='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}'.replace(/ reduce;/,o.toString()+";");u(t.s.db,new i(a,s),null,d,(t,e)=>{if(t)return f(m,t,null);f(m,null,e.result||e)})}},indexes:function(t,e,n){e=Object.assign({},{full:!0},e),p(t.s.db,t.collectionName,e,n)},indexExists:function(t,e,n,r){_(t,n,(t,n)=>{if(null!=t)return f(r,t,null);if(!Array.isArray(e))return f(r,null,null!=n[e]);for(let t=0;t<e.length;t++)if(null==n[e[t]])return f(r,null,!1);return f(r,null,!0)})},indexInformation:_,parallelCollectionScan:function(t,e,n){const r={parallelCollectionScan:t.collectionName,numCursors:e.numCursors};a(r,t,e);const i=e.raw;delete e.raw,l(t.s.db,r,e,(r,o)=>{if(r)return f(n,r,null);if(null==o)return f(n,new Error("no result returned for parallelCollectionScan"),null);e=Object.assign({explicitlyIgnoreSession:!0},e);const s=[];i&&(e.raw=i);for(let n=0;n<o.cursors.length;n++){const r=o.cursors[n].cursor.id,i="number"==typeof r?d.fromNumber(r):r;s.push(t.s.topology.cursor(t.namespace,i,e))}f(n,null,s)})},save:function(t,e,n,i){const o=r(Object.assign({},n),{db:t.s.db,collection:t},n);if(null!=e._id)return o.upsert=!0,b(t,{_id:e._id},e,o,i);v(t,[e],o,(t,n)=>{if(null!=i)return null==e?f(i,null,null):t?f(i,t,null):void f(i,null,n)})}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).OperationBase,o=n(0).resolveReadPreference,s=n(58),a=n(46),c=n(9).maxWireVersion,u=n(47).commandSupportsReadConcern,l=n(174).MongoError;t.exports=class extends i{constructor(t,e,n){super(e),this.ns=t.s.namespace.withCollection("$cmd"),this.readPreference=o(t,this.options),this.readConcern=function(t,e){return s.fromOptions(e)||t.readConcern}(t,this.options),this.writeConcern=function(t,e){return a.fromOptions(e)||t.writeConcern}(t,this.options),this.explain=!1,n&&"boolean"==typeof n.fullResponse&&(this.fullResponse=!0),this.options.readPreference=this.readPreference,t.s.logger?this.logger=t.s.logger:t.s.db&&t.s.db.logger&&(this.logger=t.s.db.logger)}executeCommand(t,e,n){this.server=t;const i=this.options,o=c(t),s=this.session&&this.session.inTransaction();this.readConcern&&u(e)&&!s&&Object.assign(e,{readConcern:this.readConcern}),i.collation&&o<5?n(new l(`Server ${t.name}, which reports wire version ${o}, does not support collation`)):(o>=5&&(this.writeConcern&&this.hasAspect(r.WRITE_OPERATION)&&Object.assign(e,{writeConcern:this.writeConcern}),i.collation&&"object"==typeof i.collation&&Object.assign(e,{collation:i.collation})),"number"==typeof i.maxTimeMS&&(e.maxTimeMS=i.maxTimeMS),"string"==typeof i.comment&&(e.comment=i.comment),this.logger&&this.logger.isDebug()&&this.logger.debug(`executing command ${JSON.stringify(e)} against ${this.ns}`),t.command(this.ns.toString(),e,this.options,(t,e)=>{t?n(t,null):this.fullResponse?n(null,e):n(null,e.result)}))}}},function(t,e,n){"use strict";
/*!
 * Centralize this so we can more easily work around issues with people
 * stubbing out `process.nextTick()` in tests using sinon:
 * https://github.com/sinonjs/lolex#automatically-incrementing-mocked-time
 * See gh-6074
 */t.exports=function(t){return process.nextTick(t)}},function(t,e,n){"use strict";t.exports=n(33).get().Decimal128},function(t,e,n){"use strict";
/*!
 * Determines if `arg` is an object.
 *
 * @param {Object|Array|String|Function|RegExp|any} arg
 * @api private
 * @return {Boolean}
 */t.exports=function(t){return!!Buffer.isBuffer(t)||"[object Object]"===Object.prototype.toString.call(t)}},function(t,e,n){t.exports=n(345)},function(t,e){t.exports=require("assert")},function(t,e){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var r={}.hasOwnProperty,i={}.toString,o={}.constructor.prototype,s=function(t){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e};t.exports={isArray:function(t){try{return"[object Array]"===i.call(t)}catch(t){return!1}},keys:s,names:s,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return o}},isES5:n,propertyIsWritable:function(){return!0}}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t,e,n){super(e=e||"Field `"+t+"` is not in schema and strict mode is set to throw."),this.isImmutableError=!!n,this.path=t}}Object.defineProperty(i.prototype,"name",{value:"StrictModeError"}),t.exports=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));var r=n(1),i=n(2),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),s=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.b;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=Object(r.a)({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(o);if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(t){if(i)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var i=Object(r.h)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=Object(r.e)(o.value,2),a=s[0],c=s[1],u=this.normalizeInstanceIdentifier(a);try{var l=this.getOrInitializeService(u);c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,(function(){var t;return Object(r.d)(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();var a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new s(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()},function(t,e){t.exports=require("buffer")},function(t,e,n){if("undefined"!=typeof global)var r=n(70).Buffer;var i=n(45);function o(t,e){if(!(this instanceof o))return new o(t,e);if(!(null==t||"string"==typeof t||r.isBuffer(t)||t instanceof Uint8Array||Array.isArray(t)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",t instanceof Number?(this.sub_type=t,this.position=0):(this.sub_type=null==e?s:e,this.position=0),null==t||t instanceof Number)void 0!==r?this.buffer=i.allocBuffer(o.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE)):this.buffer=new Array(o.BUFFER_SIZE),this.position=0;else{if("string"==typeof t)if(void 0!==r)this.buffer=i.toBuffer(t);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(t))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=a(t)}else this.buffer=t;this.position=t.length}}o.prototype.put=function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var e=null;if(e="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=e;else if(void 0!==r&&r.isBuffer(this.buffer)){var n=i.allocBuffer(o.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=e}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE+this.buffer.length)):new Array(o.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)n[s]=this.buffer[s];this.buffer=n,this.buffer[this.position++]=e}},o.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var n=null;if(void 0!==r&&r.isBuffer(this.buffer))n=i.allocBuffer(this.buffer.length+t.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var o=0;o<this.position;o++)n[o]=this.buffer[o]}this.buffer=n}if(void 0!==r&&r.isBuffer(t)&&r.isBuffer(this.buffer))t.copy(this.buffer,e,0,t.length),this.position=e+t.length>this.position?e+t.length:this.position;else if(void 0!==r&&"string"==typeof t&&r.isBuffer(this.buffer))this.buffer.write(t,e,"binary"),this.position=e+t.length>this.position?e+t.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(t)||"[object Array]"===Object.prototype.toString.call(t)&&"string"!=typeof t){for(o=0;o<t.length;o++)this.buffer[e++]=t[o];this.position=e>this.position?e:this.position}else if("string"==typeof t){for(o=0;o<t.length;o++)this.buffer[e++]=t.charCodeAt(o);this.position=e>this.position?e:this.position}},o.prototype.read=function(t,e){if(e=e&&e>0?e:this.position,this.buffer.slice)return this.buffer.slice(t,t+e);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e)):new Array(e),r=0;r<e;r++)n[r]=this.buffer[t++];return n},o.prototype.value=function(t){if((t=null!=t&&t)&&void 0!==r&&r.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==r&&r.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var e="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)e[n]=this.buffer[n];return e}return c(this.buffer,0,this.position)},o.prototype.length=function(){return this.position},o.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},o.prototype.toString=function(t){return null!=this.buffer?this.buffer.slice(0,this.position).toString(t):""};var s=0,a=function(t){for(var e="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t.length)):new Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e},c=function(t,e,n){for(var r="",i=e;i<n;i++)r+=String.fromCharCode(t[i]);return r};o.BUFFER_SIZE=256,o.SUBTYPE_DEFAULT=0,o.SUBTYPE_FUNCTION=1,o.SUBTYPE_BYTE_ARRAY=2,o.SUBTYPE_UUID_OLD=3,o.SUBTYPE_UUID=4,o.SUBTYPE_MD5=5,o.SUBTYPE_USER_DEFINED=128,t.exports=o,t.exports.Binary=o},function(t,e,n){"use strict";const r=n(37).Query,i=n(56).Msg,o=n(5).MongoError,s=n(14).getReadPreference,a=n(14).isSharded,c=n(14).databaseNamespace,u=n(97).isTransactionCommand,l=n(47).applySession,h=n(5).MongoNetworkError,f=n(9).maxWireVersion;function p(t,e,n,f,p){const d=t.s.bson,m=t.s.pool,y=s(n,f),g=function(t){const e=t.ismaster?t.ismaster:t.description;if(null==e)return!1;return e.maxWireVersion>=6&&null==e.__nodejs_mock_server__}(t),v=f.session;let b=t.clusterTime,_=Object.assign({},n);if(function(t){if(null==t)return!1;if(t.description)return t.description.maxWireVersion>=6;return null!=t.ismaster&&t.ismaster.maxWireVersion>=6}(t)&&v){v.clusterTime&&v.clusterTime.clusterTime.greaterThan(b.clusterTime)&&(b=v.clusterTime);const t=l(v,_,f);if(t)return p(t)}b&&(_.$clusterTime=b),a(t)&&!g&&y&&"primary"!==y.preference&&(_={$query:_,$readPreference:y.toJSON()});const w=Object.assign({command:!0,numberToSkip:0,numberToReturn:-1,checkKeys:!1},f);w.slaveOk=y.slaveOk();const S=`${c(e)}.$cmd`,O=g?new i(d,S,_,w):new r(d,S,_,w),E=v&&(v.inTransaction()||u(_))?function(t){return t&&t instanceof h&&!t.hasErrorLabel("TransientTransactionError")&&(null==t.errorLabels&&(t.errorLabels=[]),t.errorLabels.push("TransientTransactionError")),!n.commitTransaction&&t&&t instanceof o&&t.hasErrorLabel("TransientTransactionError")&&v.transaction.unpinServer(),p.apply(null,arguments)}:p;try{m.write(O,w,E)}catch(t){E(t)}}t.exports=function(t,e,n,r,i){if("function"==typeof r&&(i=r,r={}),r=r||{},null==n)return i(new o(`command ${JSON.stringify(n)} does not return a cursor`));if(!function(t){return f(t)&&t.autoEncrypter}(t))return void p(t,e,n,r,i);const s=f(t);"number"!=typeof s||s<8?i(new o("Auto-encryption requires a minimum MongoDB version of 4.2")):function(t,e,n,r,i){const o=t.autoEncrypter;function s(t,e){t||null==e?i(t,e):o.decrypt(e.result,r,(t,n)=>{t?i(t,null):(e.result=n,e.message.documents=[n],i(null,e))})}o.encrypt(e,n,r,(n,o)=>{n?i(n,null):p(t,e,o,r,s)})}(t,e,n,r,i)}},function(t,e,n){"use strict";const r=n(5).MongoError,i=n(4).Aspect,o=n(4).OperationBase,s=n(19),a=n(5).isRetryableError,c=n(9).maxWireVersion,u=n(9).isUnifiedTopology;function l(t,e,n){if(null==t)throw new TypeError("This method requires a valid topology instance");if(!(e instanceof o))throw new TypeError("This method requires a valid operation instance");if(u(t)&&t.shouldCheckForSessionSupport())return function(t,e,n){const r=t.s.promiseLibrary;let i;"function"!=typeof n&&(i=new r((t,e)=>{n=(n,r)=>{if(n)return e(n);t(r)}}));return t.selectServer(s.primaryPreferred,r=>{r?n(r):l(t,e,n)}),i}(t,e,n);const c=t.s.promiseLibrary;let f,p,d;if(t.hasSessionSupport())if(null==e.session)p=Symbol(),f=t.startSession({owner:p}),e.session=f;else if(e.session.hasEnded)throw new r("Use of expired sessions is not permitted");function m(t,r){f&&f.owner===p&&(f.endSession(),e.session===f&&e.clearSession()),n(t,r)}"function"!=typeof n&&(d=new c((t,e)=>{n=(n,r)=>{if(n)return e(n);t(r)}}));try{e.hasAspect(i.EXECUTE_WITH_SELECTION)?function(t,e,n){const o=e.readPreference||s.primary,c=e.session&&e.session.inTransaction();if(c&&!o.equals(s.primary))return void n(new r(`Read preference in a transaction must be primary, not: ${o.mode}`));const u={readPreference:o,session:e.session};function l(r,i){return null==r?n(null,i):a(r)?void t.selectServer(u,(t,r)=>{!t&&h(r)?e.execute(r,n):n(t,null)}):n(r)}t.selectServer(u,(r,o)=>{if(r)return void n(r,null);const s=!1!==t.s.options.retryReads&&e.session&&!c&&h(o)&&e.canRetryRead;e.hasAspect(i.RETRYABLE)&&s?e.execute(o,l):e.execute(o,n)})}(t,e,m):e.execute(m)}catch(t){throw f&&f.owner===p&&(f.endSession(),e.session===f&&e.clearSession()),t}return d}function h(t){return c(t)>=6}t.exports=l},function(t,e){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=Buffer.isBuffer},function(t,e,n){try{var r=n(6);if("function"!=typeof r.inherits)throw"";t.exports=r.inherits}catch(e){t.exports=n(286)}},function(t,e,n){"use strict";const r=n(6).deprecate,i=n(0).deprecateOptions,o=n(0).checkCollectionName,s=n(3).BSON.ObjectID,a=n(3).MongoError,c=n(0).toError,u=n(0).normalizeHintField,l=n(0).decorateCommand,h=n(0).decorateWithCollation,f=n(0).decorateWithReadConcern,p=n(0).formattedOrderClause,d=n(3).ReadPreference,m=n(301),y=n(302),g=n(126),v=n(0).executeLegacyOperation,b=n(0).resolveReadPreference,_=n(46),w=n(58),S=n(0).MongoDBNamespace,O=n(129),E=n(130),T=n(60).checkForAtomicOperators,C=n(60).ensureIndex,I=n(60).group,A=n(60).parallelCollectionScan,k=n(21).removeDocuments,x=n(60).save,N=n(21).updateDocuments,P=n(101),j=n(175),R=n(303),M=n(176),D=n(304),$=n(305),L=n(306),F=n(307),B=n(131).DropCollectionOperation,U=n(177),V=n(308),q=n(309),W=n(310),z=n(311),H=n(102),K=n(312),G=n(313),Q=n(314),Y=n(315),X=n(316),J=n(317),Z=n(178),tt=n(318),et=n(319),nt=n(320),rt=n(321),it=n(322),ot=n(179),st=n(183),at=n(330),ct=n(331),ut=n(332),lt=n(333),ht=n(334),ft=n(73),pt=["ignoreUndefined"];function dt(t,e,n,r,i,a){o(r);const c=null==a||null==a.slaveOk?t.slaveOk:a.slaveOk,u=null==a||null==a.serializeFunctions?t.s.options.serializeFunctions:a.serializeFunctions,l=null==a||null==a.raw?t.s.options.raw:a.raw,h=null==a||null==a.promoteLongs?t.s.options.promoteLongs:a.promoteLongs,f=null==a||null==a.promoteValues?t.s.options.promoteValues:a.promoteValues,p=null==a||null==a.promoteBuffers?t.s.options.promoteBuffers:a.promoteBuffers,m=new S(n,r),y=a.promiseLibrary||Promise;i=null==i?s:i,this.s={pkFactory:i,db:t,topology:e,options:a,namespace:m,readPreference:d.fromOptions(a),slaveOk:c,serializeFunctions:u,raw:l,promoteLongs:h,promoteValues:f,promoteBuffers:p,internalHint:null,collectionHint:null,promiseLibrary:y,readConcern:w.fromOptions(a),writeConcern:_.fromOptions(a)}}Object.defineProperty(dt.prototype,"dbName",{enumerable:!0,get:function(){return this.s.namespace.db}}),Object.defineProperty(dt.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.namespace.collection}}),Object.defineProperty(dt.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),Object.defineProperty(dt.prototype,"readConcern",{enumerable:!0,get:function(){return null==this.s.readConcern?this.s.db.readConcern:this.s.readConcern}}),Object.defineProperty(dt.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?this.s.db.readPreference:this.s.readPreference}}),Object.defineProperty(dt.prototype,"writeConcern",{enumerable:!0,get:function(){return null==this.s.writeConcern?this.s.db.writeConcern:this.s.writeConcern}}),Object.defineProperty(dt.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(t){this.s.collectionHint=u(t)}});const mt=["maxScan","fields","snapshot"];function yt(t,e,n,r,i){const o=Array.prototype.slice.call(arguments,1);return i="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length&&o.shift()||[],n=o.length?o.shift():null,r=o.length&&o.shift()||{},(r=Object.assign({},r)).readPreference=d.PRIMARY,ft(this.s.topology,new H(this,t,e,n,r),i)}dt.prototype.find=i({name:"collection.find",deprecatedOptions:mt,optionsIndex:1},(function(t,e,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let r=t;"function"!=typeof n&&("function"==typeof e?(n=e,e=void 0):null==e&&(n="function"==typeof r?r:void 0,r="object"==typeof r?r:void 0)),r=null==r?{}:r;const i=r;if(Buffer.isBuffer(i)){const t=i[0]|i[1]<<8|i[2]<<16|i[3]<<24;if(t!==i.length){const e=new Error("query selector raw message size does not match message header size ["+i.length+"] != ["+t+"]");throw e.name="MongoError",e}}null!=r&&"ObjectID"===r._bsontype&&(r={_id:r}),e||(e={});let o=e.projection||e.fields;o&&!Buffer.isBuffer(o)&&Array.isArray(o)&&(o=o.length?o.reduce((t,e)=>(t[e]=1,t),{}):{_id:1});let s=Object.assign({},e);for(let t in this.s.options)-1!==pt.indexOf(t)&&(s[t]=this.s.options[t]);if(s.skip=e.skip?e.skip:0,s.limit=e.limit?e.limit:0,s.raw="boolean"==typeof e.raw?e.raw:this.s.raw,s.hint=null!=e.hint?u(e.hint):this.s.collectionHint,s.timeout=void 0===e.timeout?void 0:e.timeout,s.slaveOk=null!=e.slaveOk?e.slaveOk:this.s.db.slaveOk,s.readPreference=b(this,s),null==s.readPreference||"primary"===s.readPreference&&"primary"===s.readPreference.mode||(s.slaveOk=!0),null!=r&&"object"!=typeof r)throw a.create({message:"query selector must be an object",driver:!0});const c={find:this.s.namespace.toString(),limit:s.limit,skip:s.skip,query:r};"boolean"==typeof s.awaitdata&&(s.awaitData=s.awaitdata),"boolean"==typeof s.timeout&&(s.noCursorTimeout=s.timeout),l(c,s,["session","collation"]),o&&(c.fields=o),s.db=this.s.db,s.promiseLibrary=this.s.promiseLibrary,null==s.raw&&"boolean"==typeof this.s.raw&&(s.raw=this.s.raw),null==s.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(s.promoteLongs=this.s.promoteLongs),null==s.promoteValues&&"boolean"==typeof this.s.promoteValues&&(s.promoteValues=this.s.promoteValues),null==s.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(s.promoteBuffers=this.s.promoteBuffers),c.sort&&(c.sort=p(c.sort)),f(c,this,e);try{h(c,this,e)}catch(t){if("function"==typeof n)return n(t,null);throw t}const d=this.s.topology.cursor(new W(this,this.s.namespace,c,s),s);if("function"!=typeof n)return d;n(null,d)})),dt.prototype.insertOne=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined);const r=new et(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.insertMany=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e?Object.assign({},e):{ordered:!0};const r=new tt(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.bulkWrite=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{ordered:!0},!Array.isArray(t))throw a.create({message:"operations must be an array of documents",driver:!0});const r=new j(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.insert=r((function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{ordered:!1},t=Array.isArray(t)?t:[t],!0===e.keepGoing&&(e.ordered=!1),this.insertMany(t,e,n)}),"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),dt.prototype.updateOne=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const i=T(e);if(i)return"function"==typeof r?r(i):this.s.promiseLibrary.reject(i);n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const o=new ht(this,t,e,n);return ft(this.s.topology,o,r)},dt.prototype.replaceOne=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const i=new ct(this,t,e,n);return ft(this.s.topology,i,r)},dt.prototype.updateMany=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};const i=T(e);if(i)return"function"==typeof r?r(i):this.s.promiseLibrary.reject(i);n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const o=new lt(this,t,e,n);return ft(this.s.topology,o,r)},dt.prototype.update=r((function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,N,[this,t,e,n,r])}),"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),dt.prototype.deleteOne=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},e),this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined);const r=new L(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.removeOne=dt.prototype.deleteOne,dt.prototype.deleteMany=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},e),this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined);const r=new $(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.removeMany=dt.prototype.deleteMany,dt.prototype.remove=r((function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,k,[this,t,e,n])}),"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),dt.prototype.save=r((function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},this.s.options.ignoreUndefined&&((e=Object.assign({},e)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,x,[this,t,e,n])}),"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),dt.prototype.findOne=i({name:"collection.find",deprecatedOptions:mt,optionsIndex:1},(function(t,e,n){"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof t&&(n=t,t={},e={}),"function"==typeof e&&(n=e,e={});const r=new z(this,t=t||{},e=e||{});return ft(this.s.topology,r,n)})),dt.prototype.rename=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},e,{readPreference:d.PRIMARY});const r=new st(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.drop=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new B(this.s.db,this.collectionName,t);return ft(this.s.topology,n,e)},dt.prototype.options=function(t,e){"function"==typeof t&&(e=t,t={});const n=new ot(this,t=t||{});return ft(this.s.topology,n,e)},dt.prototype.isCapped=function(t,e){"function"==typeof t&&(e=t,t={});const n=new nt(this,t=t||{});return ft(this.s.topology,n,e)},dt.prototype.createIndex=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=new M(this.s.db,this.collectionName,t,e);return ft(this.s.topology,r,n)},dt.prototype.createIndexes=function(t,e,n){"function"==typeof e&&(n=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS;const r=new D(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.dropIndex=function(t,e,n){const r=Array.prototype.slice.call(arguments,1);n="function"==typeof r[r.length-1]?r.pop():void 0,(e=r.length&&r.shift()||{}).readPreference=d.PRIMARY;const i=new U(this,t,e);return ft(this.s.topology,i,n)},dt.prototype.dropIndexes=function(t,e){"function"==typeof t&&(e=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS;const n=new V(this,t);return ft(this.s.topology,n,e)},dt.prototype.dropAllIndexes=r(dt.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),dt.prototype.reIndex=function(t,e){"function"==typeof t&&(e=t,t={});const n=new at(this,t=t||{});return ft(this.s.topology,n,e)},dt.prototype.listIndexes=function(t){return new E(this.s.topology,new rt(this,t),t)},dt.prototype.ensureIndex=r((function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},v(this.s.topology,C,[this,t,e,n])}),"collection.ensureIndex is deprecated. Use createIndexes instead."),dt.prototype.indexExists=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new J(this,t,e=e||{});return ft(this.s.topology,r,n)},dt.prototype.indexInformation=function(t,e){const n=Array.prototype.slice.call(arguments,0);e="function"==typeof n[n.length-1]?n.pop():void 0,t=n.length&&n.shift()||{};const r=new Z(this.s.db,this.collectionName,t);return ft(this.s.topology,r,e)},dt.prototype.count=r((function(t,e,n){const r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||{},"function"==typeof(e=r.length&&r.shift()||{})&&(n=e,e={}),e=e||{},ft(this.s.topology,new q(this,t,e),n)}),"collection.count is deprecated, and will be removed in a future version. Use Collection.countDocuments or Collection.estimatedDocumentCount instead"),dt.prototype.estimatedDocumentCount=function(t,e){"function"==typeof t&&(e=t,t={});const n=new q(this,t=t||{});return ft(this.s.topology,n,e)},dt.prototype.countDocuments=function(t,e,n){const r=Array.prototype.slice.call(arguments,0);n="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||{},e=r.length&&r.shift()||{};const i=new R(this,t,e);return ft(this.s.topology,i,n)},dt.prototype.distinct=function(t,e,n,r){const i=Array.prototype.slice.call(arguments,1);r="function"==typeof i[i.length-1]?i.pop():void 0;const o=i.length&&i.shift()||{},s=i.length&&i.shift()||{},a=new F(this,t,o,s);return ft(this.s.topology,a,r)},dt.prototype.indexes=function(t,e){"function"==typeof t&&(e=t,t={});const n=new X(this,t=t||{});return ft(this.s.topology,n,e)},dt.prototype.stats=function(t,e){const n=Array.prototype.slice.call(arguments,0);e="function"==typeof n[n.length-1]?n.pop():void 0,t=n.length&&n.shift()||{};const r=new ut(this,t);return ft(this.s.topology,r,e)},dt.prototype.findOneAndDelete=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},null==t||"object"!=typeof t)throw c("filter parameter must be an object");const r=new K(this,t,e);return ft(this.s.topology,r,n)},dt.prototype.findOneAndReplace=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==t||"object"!=typeof t)throw c("filter parameter must be an object");if(null==e||"object"!=typeof e)throw c("replacement parameter must be an object");const i=Object.keys(e);if(i[0]&&"$"===i[0][0])throw c("The replacement document must not contain atomic operators.");const o=new G(this,t,e,n);return ft(this.s.topology,o,r)},dt.prototype.findOneAndUpdate=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},null==t||"object"!=typeof t)throw c("filter parameter must be an object");if(null==e||"object"!=typeof e)throw c("update parameter must be an object");const i=T(e);if(i)return"function"==typeof r?r(i):this.s.promiseLibrary.reject(i);const o=new Q(this,t,e,n);return ft(this.s.topology,o,r)},dt.prototype.findAndModify=r(yt,"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),dt.prototype._findAndModify=yt,dt.prototype.findAndRemove=r((function(t,e,n,r){const i=Array.prototype.slice.call(arguments,1);return r="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length&&i.shift()||[],(n=i.length&&i.shift()||{}).remove=!0,ft(this.s.topology,new H(this,t,e,null,n),r)}),"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),dt.prototype.aggregate=function(t,e,n){if(Array.isArray(t))"function"==typeof e&&(n=e,e={}),null==e&&null==n&&(e={});else{const r=Array.prototype.slice.call(arguments,0);n=r.pop();const i=r[r.length-1];e=i&&(i.readPreference||i.explain||i.cursor||i.out||i.maxTimeMS||i.hint||i.allowDiskUse)?r.pop():{},t=r}const r=new O(this.s.topology,new P(this,t,e),e);if("function"!=typeof n)return r;n(null,r)},dt.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new g(this,t,e)},dt.prototype.parallelCollectionScan=r((function(t,e){return"function"==typeof t&&(e=t,t={numCursors:1}),t.numCursors=t.numCursors||1,t.batchSize=t.batchSize||1e3,(t=Object.assign({},t)).readPreference=b(this,t),t.promiseLibrary=this.s.promiseLibrary,t.session&&(t.session=void 0),v(this.s.topology,A,[this,t,e],{skipSessions:!0})}),"parallelCollectionScan is deprecated in MongoDB v4.1"),dt.prototype.geoHaystackSearch=function(t,e,n,r){const i=Array.prototype.slice.call(arguments,2);r="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length&&i.shift()||{};const o=new Y(this,t,e,n);return ft(this.s.topology,o,r)},dt.prototype.group=r((function(t,e,n,r,i,o,s,a){const c=Array.prototype.slice.call(arguments,3);return a="function"==typeof c[c.length-1]?c.pop():void 0,r=c.length?c.shift():null,i=c.length?c.shift():null,o=c.length?c.shift():null,s=c.length&&c.shift()||{},"function"!=typeof i&&(o=i,i=null),!Array.isArray(t)&&t instanceof Object&&"function"!=typeof t&&"Code"!==t._bsontype&&(t=Object.keys(t)),"function"==typeof r&&(r=r.toString()),"function"==typeof i&&(i=i.toString()),o=null==o||o,v(this.s.topology,I,[this,t,e,n,r,i,o,s,a])}),"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),dt.prototype.mapReduce=function(t,e,n,r){if("function"==typeof n&&(r=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");"function"==typeof t&&(t=t.toString()),"function"==typeof e&&(e=e.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString());const i=new it(this,t,e,n);return ft(this.s.topology,i,r)},dt.prototype.initializeUnorderedBulkOp=function(t){return null==(t=t||{}).ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),t.promiseLibrary=this.s.promiseLibrary,m(this.s.topology,this,t)},dt.prototype.initializeOrderedBulkOp=function(t){return null==(t=t||{}).ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),t.promiseLibrary=this.s.promiseLibrary,y(this.s.topology,this,t)},dt.prototype.getLogger=function(){return this.s.db.s.logger},t.exports=dt},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(25),i=n(78),o=n(64);function s(t,e){if(e&&e.default){const t=e.default;Array.isArray(t)&&0===t.length?e.default=Array:!e.shared&&o(t)&&0===Object.keys(t).length&&(e.default=function(){return{}})}r.call(this,t,e,"Mixed"),this[i.schemaMixedSymbol]=!0}s.schemaName="Mixed",s.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.get=r.get,s.set=r.set,s.prototype.cast=function(t){return t},s.prototype.castForQuery=function(t,e){return 2===arguments.length?e:t},
/*!
 * Module exports.
 */
t.exports=s},function(t,e,n){"use strict";e.schemaMixedSymbol=Symbol.for("mongoose:schema_mixed"),e.builtInMiddleware=Symbol.for("mongoose:built-in-middleware")},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(13).EventEmitter,i=n(208),o=n(28),s=n(25),a=n(32),c=n(393),u=n(138),l=n(209),h=n(210),f=n(212),p=n(8).arrayParentSymbol,d=n(11),m=n(394),y=n(211),g=n(395),v=n(65),b=n(33).get().ReadPreference,_=n(78),w=n(6),S=n(12),O=n(396);let E;const T=n(139).middlewareFunctions,C=n(140).middlewareFunctions,I=T.concat(C).reduce((t,e)=>t.add(e),new Set);let A=0;function k(t,e){if(!(this instanceof k))return new k(t,e);if(this.obj=t,this.paths={},this.aliases={},this.subpaths={},this.virtuals={},this.singleNestedPaths={},this.nested={},this.inherits={},this.callQueue=[],this._indexes=[],this.methods={},this.methodOptions={},this.statics={},this.tree={},this.query={},this.childSchemas=[],this.plugins=[],this.$id=++A,this.s={hooks:new i},this.options=this.defaultOptions(e),Array.isArray(t))for(const e of t)this.add(e);else t&&this.add(t);const n=t&&t._id&&S.isObject(t._id);!this.paths._id&&!this.options.noId&&this.options._id&&!n&&l(this),this.setupTimestamp(this.options.timestamps)}
/*!
 * Create virtual properties with alias field
 */
/*!
 * Inherit from EventEmitter.
 */
k.prototype=Object.create(r.prototype),k.prototype.constructor=k,k.prototype.instanceOfSchema=!0,
/*!
 * ignore
 */
Object.defineProperty(k.prototype,"$schemaType",{configurable:!1,enumerable:!1,writable:!0}),Object.defineProperty(k.prototype,"childSchemas",{configurable:!1,enumerable:!0,writable:!0}),k.prototype.obj,k.prototype.paths,k.prototype.tree,k.prototype.clone=function(){const t=new k({},this._userProvidedOptions);return t.base=this.base,t.obj=this.obj,t.options=S.clone(this.options),t.callQueue=this.callQueue.map((function(t){return t})),t.methods=S.clone(this.methods),t.methodOptions=S.clone(this.methodOptions),t.statics=S.clone(this.statics),t.query=S.clone(this.query),t.plugins=Array.prototype.slice.call(this.plugins),t._indexes=S.clone(this._indexes),t.s.hooks=this.s.hooks.clone(),t.tree=S.clone(this.tree),t.paths=S.clone(this.paths),t.nested=S.clone(this.nested),t.subpaths=S.clone(this.subpaths),t.singleNestedPaths=S.clone(this.singleNestedPaths),t.childSchemas=
/*!
 * ignore
 */
function(t){const e=[];for(const n of Object.keys(t.paths)){const r=t.paths[n];(r.$isMongooseDocumentArray||r.$isSingleNested)&&e.push({schema:r.schema,model:r.caster})}return e}
/*!
 * ignore
 */(t),t.virtuals=S.clone(this.virtuals),t.$globalPluginsApplied=this.$globalPluginsApplied,t.$isRootDiscriminator=this.$isRootDiscriminator,t.$implicitlyCreated=this.$implicitlyCreated,null!=this.discriminatorMapping&&(t.discriminatorMapping=Object.assign({},this.discriminatorMapping)),null!=this.discriminators&&(t.discriminators=Object.assign({},this.discriminators)),t.aliases=Object.assign({},this.aliases),t.on("init",t=>this.emit("init",t)),t},k.prototype.pick=function(t,e){const n=new k({},e||this.options);if(!Array.isArray(t))throw new o('Schema#pick() only accepts an array argument, got "'+typeof t+'"');for(const e of t)if(this.nested[e])n.add({[e]:d(this.tree,e)});else{const t=this.path(e);if(null==t)throw new o("Path `"+e+"` is not in the schema");n.add({[e]:t})}return n},k.prototype.defaultOptions=function(t){t&&!1===t.safe&&(t.safe={w:0}),t&&t.safe&&0===t.safe.w&&(t.versionKey=!1),this._userProvidedOptions=null==t?{}:S.clone(t);const e=d(this,"base.options",{});return(t=S.options({strict:!("strict"in e)||e.strict,bufferCommands:!0,capped:!1,versionKey:"__v",discriminatorKey:"__t",minimize:!0,autoIndex:null,shardKey:null,read:null,validateBeforeSave:!0,noId:!1,_id:!0,noVirtualId:!1,id:!0,typeKey:"type",typePojoToMixed:!("typePojoToMixed"in e)||e.typePojoToMixed},S.clone(t))).read&&(t.read=b(t.read)),t},k.prototype.add=function(t,e){if(t instanceof k)return g(this,t),this;!1===t._id&&null==e&&(this.options._id=!1),e=e||"";const n=Object.keys(t);for(const r of n){const n=e+r;if(null==t[r])throw new TypeError("Invalid value for schema path `"+n+'`, got value "'+t[r]+'"');if("_id"!==r||!1!==t[r])if(t[r]instanceof u)this.virtual(t[r]);else{if(Array.isArray(t[r])&&1===t[r].length&&null==t[r][0])throw new TypeError("Invalid value for schema Array path `"+n+'`, got value "'+t[r][0]+'"');if(S.isPOJO(t[r])||t[r]instanceof a)if(Object.keys(t[r]).length<1)e&&(this.nested[e.substr(0,e.length-1)]=!0),this.path(n,t[r]);else if(!t[r][this.options.typeKey]||"type"===this.options.typeKey&&t[r].type.type)this.nested[n]=!0,this.add(t[r],n+".");else if(!this.options.typePojoToMixed&&S.isPOJO(t[r][this.options.typeKey])){e&&(this.nested[e.substr(0,e.length-1)]=!0);const n={typePojoToMixed:!1},i=new k(t[r][this.options.typeKey],n),o=Object.assign({},t[r],{[this.options.typeKey]:i});this.path(e+r,o)}else e&&(this.nested[e.substr(0,e.length-1)]=!0),this.path(e+r,t[r]);else e&&(this.nested[e.substr(0,e.length-1)]=!0),this.path(e+r,t[r])}}return function(t,e){e=e||Object.keys(t.paths);for(const n of e){const e=d(t.paths[n],"options");if(null==e)continue;const r=t.paths[n].path,i=e.alias;if(i){if("string"!=typeof i)throw new Error("Invalid value for alias option on "+r+", got "+i);t.aliases[i]=r,t.virtual(i).get(function(t){return function(){return"function"==typeof this.get?this.get(t):this[t]}}(r)).set(function(t){return function(e){return this.set(t,e)}}(r))}}}(this,Object.keys(t).map(t=>e?e+t:t)),this},k.reserved=Object.create(null),k.prototype.reserved=k.reserved;const x=k.reserved;x.prototype=x.emit=x.listeners=x.on=x.removeListener=x.collection=x.errors=x.get=x.init=x.isModified=x.isNew=x.populated=x.remove=x.save=x.schema=x.toObject=x.validate=1;
/*!
 * Document keys to print warnings for
 */
const N={};
/*!
 * ignore
 */
function P(t){return/\.\d+/.test(t)?t.replace(/\.\d+\./g,".$.").replace(/\.\d+$/,".$"):t}
/*!
 * ignore
 */function j(t,e){for(const n of Object.keys(t.paths)){if(!n.includes(".$*"))continue;if(new RegExp("^"+n.replace(/\.\$\*/g,"\\.[^.]+")+"$").test(e))return t.paths[n]}return null}
/*!
 * ignore. Deprecated re: #6405
 */
function R(t,e){const n=e.split(/\.(\d+)\.|\.(\d+)$/).filter(Boolean);if(n.length<2)return t.paths.hasOwnProperty(n[0])?t.paths[n[0]]:"adhocOrUndefined";let r=t.path(n[0]),i=!1;if(!r)return"adhocOrUndefined";const o=n.length-1;for(let t=1;t<n.length;++t){i=!1;const e=n[t];if(t===o&&r&&!/\D/.test(e)){r=r.$isMongooseDocumentArray?r.$embeddedSchemaType:r instanceof E.Array?r.caster:void 0;break}if(/\D/.test(e)){if(!r||!r.schema){r=void 0;break}i="nested"===r.schema.pathType(e),r=r.schema.path(e)}else r instanceof E.Array&&t!==o&&(r=r.caster)}return t.subpaths[e]=r,r?"real":i?"nested":"adhocOrUndefined"}
/*!
 * ignore
 */N.increment="`increment` should not be used as a schema path name unless you have disabled versioning.",k.prototype.path=function(t,e){const n=P(t);if(void 0===e){let e=function(t,e,n){if(t.paths.hasOwnProperty(e))return t.paths[e];if(t.subpaths.hasOwnProperty(n))return t.subpaths[n];if(t.singleNestedPaths.hasOwnProperty(n))return t.singleNestedPaths[n];return null}(this,t,n);if(null!=e)return e;const r=j(this,t);return null!=r?r:(e=this.hasMixedParent(n),null!=e?e:/\.\d+\.?.*$/.test(t)?function(t,e){return R(t,e),t.subpaths[e]}(this,t):void 0)}const r=t.split(".")[0];if(x[r])throw new Error("`"+r+"` may not be used as a schema pathname");N[t]&&console.log("WARN: "+N[t]),"object"==typeof e&&S.hasUserDefinedProperty(e,"ref")&&O(e.ref,t);const i=t.split(/\./),o=i.pop();let a=this.tree,c="";for(const e of i){if(c=c+=(c.length>0?".":"")+e,a[e]||(this.nested[c]=!0,a[e]={}),"object"!=typeof a[e]){const n="Cannot set nested path `"+t+"`. Parent path `"+c+"` already set to type "+a[e].name+".";throw new Error(n)}a=a[e]}a[o]=S.clone(e),this.paths[t]=this.interpretAsType(t,e,this.options);const u=this.paths[t];if(u.$isSchemaMap){const n=t+".$*";let r={type:{}};if(S.hasUserDefinedProperty(e,"of")){r=S.isPOJO(e.of)&&Object.keys(e.of).length>0&&!S.hasUserDefinedProperty(e.of,this.options.typeKey)?new k(e.of):e.of}this.paths[n]=this.interpretAsType(n,r,this.options),u.$__schemaType=this.paths[n]}if(u.$isSingleNested){for(const e in u.schema.paths)this.singleNestedPaths[t+"."+e]=u.schema.paths[e];for(const e in u.schema.singleNestedPaths)this.singleNestedPaths[t+"."+e]=u.schema.singleNestedPaths[e];for(const e in u.schema.subpaths)this.singleNestedPaths[t+"."+e]=u.schema.subpaths[e];Object.defineProperty(u.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),u.caster.base=this.base,this.childSchemas.push({schema:u.schema,model:u.caster})}else u.$isMongooseDocumentArray&&(Object.defineProperty(u.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),u.casterConstructor.base=this.base,this.childSchemas.push({schema:u.schema,model:u.casterConstructor}));if(u.$isMongooseArray&&u.caster instanceof s){let e=t,n=u;const r=[];for(;n.$isMongooseArray;)e+=".$",n.$isMongooseDocumentArray?(n.$embeddedSchemaType._arrayPath=e,n=n.$embeddedSchemaType.clone()):(n.caster._arrayPath=e,n=n.caster.clone()),n.path=e,r.push(n);for(const t of r)this.subpaths[t.path]=t}if(u.$isMongooseDocumentArray){for(const e of Object.keys(u.schema.paths))this.subpaths[t+"."+e]=u.schema.paths[e],u.schema.paths[e].$isUnderneathDocArray=!0;for(const e of Object.keys(u.schema.subpaths))this.subpaths[t+"."+e]=u.schema.subpaths[e],u.schema.subpaths[e].$isUnderneathDocArray=!0;for(const e of Object.keys(u.schema.singleNestedPaths))this.subpaths[t+"."+e]=u.schema.singleNestedPaths[e],u.schema.singleNestedPaths[e].$isUnderneathDocArray=!0}return this},Object.defineProperty(k.prototype,"base",{configurable:!0,enumerable:!1,writable:!0,value:null}),k.prototype.interpretAsType=function(t,e,n){if(e instanceof s)return e;const r=null!=this.base?this.base.Schema.Types:k.Types;if(!(S.isPOJO(e)||e instanceof a)){if("Object"!==S.getFunctionName(e.constructor)){const t=e;(e={})[n.typeKey]=t}}let i,o=!e[n.typeKey]||"type"===n.typeKey&&e.type.type?{}:e[n.typeKey];if(S.isPOJO(o)||"mixed"===o)return new r.Mixed(t,e);if(Array.isArray(o)||o===Array||"array"===o||o===r.Array){let s=o===Array||"array"===o?e.cast:o[0];if(s&&s.instanceOfSchema)return new r.DocumentArray(t,s,e);if(s&&s[n.typeKey]&&s[n.typeKey].instanceOfSchema)return new r.DocumentArray(t,s[n.typeKey],e,s);if(Array.isArray(s))return new r.Array(t,this.interpretAsType(t,s,n),e);if("string"==typeof s)s=r[s.charAt(0).toUpperCase()+s.substring(1)];else if(s&&(!s[n.typeKey]||"type"===n.typeKey&&s.type.type)&&S.isPOJO(s)){if(Object.keys(s).length){const i={minimize:n.minimize};n.typeKey&&(i.typeKey=n.typeKey),n.hasOwnProperty("strict")&&(i.strict=n.strict),n.hasOwnProperty("typePojoToMixed")&&(i.typePojoToMixed=n.typePojoToMixed);const o=new k(s,i);return o.$implicitlyCreated=!0,new r.DocumentArray(t,o,e)}return new r.Array(t,r.Mixed,e)}if(s&&(o=!s[n.typeKey]||"type"===n.typeKey&&s.type.type?s:s[n.typeKey],i="string"==typeof o?o:o.schemaName||S.getFunctionName(o),!r.hasOwnProperty(i)))throw new TypeError("Invalid schema configuration: "+`\`${i}\` is not a valid type within the array \`${t}\`.`+"See http://bit.ly/mongoose-schematypes for a list of valid schema types.");return new r.Array(t,s||r.Mixed,e,n)}if(o&&o.instanceOfSchema)return new r.Embedded(o,t,e);if(i=Buffer.isBuffer(o)?"Buffer":"function"==typeof o||"object"==typeof o?o.schemaName||S.getFunctionName(o):null==o?""+o:o.toString(),i&&(i=i.charAt(0).toUpperCase()+i.substring(1)),"ObjectID"===i&&(i="ObjectId"),null==r[i])throw new TypeError(`Invalid schema configuration: \`${i}\` is not `+`a valid type at path \`${t}\`. See `+"http://bit.ly/mongoose-schematypes for a list of valid schema types.");return new r[i](t,e)},k.prototype.eachPath=function(t){const e=Object.keys(this.paths),n=e.length;for(let r=0;r<n;++r)t(e[r],this.paths[e[r]]);return this},k.prototype.requiredPaths=function(t){if(this._requiredpaths&&!t)return this._requiredpaths;const e=Object.keys(this.paths);let n=e.length;const r=[];for(;n--;){const t=e[n];this.paths[t].isRequired&&r.push(t)}return this._requiredpaths=r,this._requiredpaths},k.prototype.indexedPaths=function(){return this._indexedpaths||(this._indexedpaths=this.indexes()),this._indexedpaths},k.prototype.pathType=function(t){const e=P(t);return this.paths.hasOwnProperty(t)?"real":this.virtuals.hasOwnProperty(t)?"virtual":this.nested.hasOwnProperty(t)?"nested":this.subpaths.hasOwnProperty(e)||this.subpaths.hasOwnProperty(t)||this.singleNestedPaths.hasOwnProperty(e)||this.singleNestedPaths.hasOwnProperty(t)||null!=j(this,t)?"real":/\.\d+\.|\.\d+$/.test(t)?R(this,t):"adhocOrUndefined"},k.prototype.hasMixedParent=function(t){const e=t.split(/\./g);t="";for(let n=0;n<e.length;++n)if((t=n>0?t+"."+e[n]:e[n])in this.paths&&this.paths[t]instanceof E.Mixed)return this.paths[t];return null},k.prototype.setupTimestamp=function(t){const e=this.childSchemas.find((function(t){return!!t.schema.options.timestamps}));if(!t&&!e)return;const n=y(t,"createdAt"),r=y(t,"updatedAt"),i=null!=t&&t.hasOwnProperty("currentTime")?t.currentTime:null,o={};this.$timestamps={createdAt:n,updatedAt:r},r&&!this.paths[r]&&(o[r]=Date),n&&!this.paths[n]&&(o[n]=Date),this.add(o),this.pre("save",(function(t){const e=d(this,"$__.saveOptions.timestamps");if(!1===e)return t();const o=null!=e&&!1===e.updatedAt,s=null!=e&&!1===e.createdAt,a=null!=i?i():(this.ownerDocument?this.ownerDocument():this).constructor.base.now(),c=this._id&&this._id.auto;if(!s&&n&&!this.get(n)&&this.isSelected(n)&&this.set(n,c?this._id.getTimestamp():a),!o&&r&&(this.isNew||this.isModified())){let t=a;this.isNew&&(null!=n?t=this.$__getValue(n):c&&(t=this._id.getTimestamp())),this.set(r,t)}t()})),this.methods.initializeTimestamps=function(){const t=null!=i?i():this.constructor.base.now();return n&&!this.get(n)&&this.set(n,t),r&&!this.get(r)&&this.set(r,t),this},a[_.builtInMiddleware]=!0;const s={query:!0,model:!1};function a(t){const e=null!=i?i():this.model.base.now();f(e,n,r,this.getUpdate(),this.options,this.schema),h(e,this.getUpdate(),this.model.schema),t()}this.pre("findOneAndUpdate",s,a),this.pre("replaceOne",s,a),this.pre("update",s,a),this.pre("updateOne",s,a),this.pre("updateMany",s,a)},k.prototype.queue=function(t,e){return this.callQueue.push([t,e]),this},k.prototype.pre=function(t){if(t instanceof RegExp){const e=Array.prototype.slice.call(arguments,1);for(const n of I)t.test(n)&&this.pre.apply(this,[n].concat(e));return this}if(Array.isArray(t)){const e=Array.prototype.slice.call(arguments,1);for(const n of t)this.pre.apply(this,[n].concat(e));return this}return this.s.hooks.pre.apply(this.s.hooks,arguments),this},k.prototype.post=function(t){if(t instanceof RegExp){const e=Array.prototype.slice.call(arguments,1);for(const n of I)t.test(n)&&this.post.apply(this,[n].concat(e));return this}if(Array.isArray(t)){const e=Array.prototype.slice.call(arguments,1);for(const n of t)this.post.apply(this,[n].concat(e));return this}return this.s.hooks.post.apply(this.s.hooks,arguments),this},k.prototype.plugin=function(t,e){if("function"!=typeof t)throw new Error('First param to `schema.plugin()` must be a function, got "'+typeof t+'"');if(e&&e.deduplicate)for(const e of this.plugins)if(e.fn===t)return this;return this.plugins.push({fn:t,opts:e}),t(this,e),this},k.prototype.method=function(t,e,n){if("string"!=typeof t)for(const e in t)this.methods[e]=t[e],this.methodOptions[e]=S.clone(n);else this.methods[t]=e,this.methodOptions[t]=S.clone(n);return this},k.prototype.static=function(t,e){if("string"!=typeof t)for(const e in t)this.statics[e]=t[e];else this.statics[t]=e;return this},k.prototype.index=function(t,e){return t||(t={}),e||(e={}),e.expires&&S.expires(e),this._indexes.push([t,e]),this},k.prototype.set=function(t,e,n){if(1===arguments.length)return this.options[t];switch(t){case"read":this.options[t]=b(e,n),this._userProvidedOptions[t]=this.options[t];break;case"safe":M(this.options,e),this._userProvidedOptions[t]=this.options[t];break;case"timestamps":this.setupTimestamp(e),this.options[t]=e,this._userProvidedOptions[t]=this.options[t];break;default:this.options[t]=e,this._userProvidedOptions[t]=this.options[t]}return this};
/*!
 * ignore
 */
const M=w.deprecate((function(t,e){t.safe=!1===e?{w:0}:e}),"Mongoose: The `safe` option for schemas is deprecated. Use the `writeConcern` option instead: http://bit.ly/mongoose-write-concern");k.prototype.get=function(t){return this.options[t]};const D="2d 2dsphere hashed text".split(" ");
/*!
 * ignore
 */
function $(t,e){const n=e.split("."),r=n.pop();let i=t.tree;for(const t of n)i=i[t];delete i[r]}
/*!
 * ignore
 */
function L(t){return t.startsWith("$[")&&t.endsWith("]")}
/*!
 * Module exports.
 */Object.defineProperty(k,"indexTypes",{get:function(){return D},set:function(){throw new Error("Cannot overwrite Schema.indexTypes")}}),k.prototype.indexes=function(){return m(this)},k.prototype.virtual=function(t,e){if(t instanceof u)return this.virtual(t.path,t.options);if(e=new c(e),S.hasUserDefinedProperty(e,["ref","refPath"])){if(null==e.localField)throw new Error("Reference virtuals require `localField` option");if(null==e.foreignField)throw new Error("Reference virtuals require `foreignField` option");this.pre("init",(function(n){if(v.has(t,n)){const r=v.get(t,n);this.$$populatedVirtuals||(this.$$populatedVirtuals={}),e.justOne||e.count?this.$$populatedVirtuals[t]=Array.isArray(r)?r[0]:r:this.$$populatedVirtuals[t]=Array.isArray(r)?r:null==r?[]:[r],v.unset(t,n)}}));const n=this.virtual(t);return n.options=e,n.get((function(e){return this.$$populatedVirtuals&&this.$$populatedVirtuals.hasOwnProperty(t)?this.$$populatedVirtuals[t]:null!=e?e:void 0})).set((function(n){this.$$populatedVirtuals||(this.$$populatedVirtuals={}),e.justOne||e.count?(this.$$populatedVirtuals[t]=Array.isArray(n)?n[0]:n,"object"!=typeof this.$$populatedVirtuals[t]&&(this.$$populatedVirtuals[t]=e.count?n:null)):(this.$$populatedVirtuals[t]=Array.isArray(n)?n:null==n?[]:[n],this.$$populatedVirtuals[t]=this.$$populatedVirtuals[t].filter((function(t){return t&&"object"==typeof t})))}))}const n=this.virtuals,r=t.split(".");if("real"===this.pathType(t))throw new Error('Virtual path "'+t+'" conflicts with a real path in the schema');n[t]=r.reduce((function(n,i,o){return n[i]||(n[i]=o===r.length-1?new u(e,t):{}),n[i]}),this.tree);let i=r[0];for(let t=0;t<r.length-1;++t){if(null!=this.paths[i]&&this.paths[i].$isMongooseDocumentArray){const e=r.slice(t+1).join(".");this.paths[i].schema.virtual(e).get((t,n,r)=>{const o=r.__parentArray[p],s=i+"."+r.__index+"."+e;return o.get(s)});break}i+="."+r[t+1]}return n[t]},k.prototype.virtualpath=function(t){return this.virtuals.hasOwnProperty(t)?this.virtuals[t]:null},k.prototype.remove=function(t){return"string"==typeof t&&(t=[t]),Array.isArray(t)&&t.forEach((function(t){if(null!=this.path(t)||this.nested[t]){if(this.nested[t]){const e=Object.keys(this.paths).concat(Object.keys(this.nested));for(const n of e)n.startsWith(t+".")&&(delete this.paths[n],delete this.nested[n],$(this,n));return delete this.nested[t],void $(this,t)}delete this.paths[t],$(this,t)}}),this),this},k.prototype.loadClass=function(t,e){return t===Object.prototype||t===Function.prototype||t.prototype.hasOwnProperty("$isMongooseModelPrototype")||(this.loadClass(Object.getPrototypeOf(t)),e||Object.getOwnPropertyNames(t).forEach((function(e){if(e.match(/^(length|name|prototype)$/))return;const n=Object.getOwnPropertyDescriptor(t,e);"function"==typeof n.value&&this.static(e,n.value)}),this),Object.getOwnPropertyNames(t.prototype).forEach((function(n){if(n.match(/^(constructor)$/))return;const r=Object.getOwnPropertyDescriptor(t.prototype,n);e||"function"==typeof r.value&&this.method(n,r.value),"function"==typeof r.get&&this.virtual(n).get(r.get),"function"==typeof r.set&&this.virtual(n).set(r.set)}),this)),this},
/*!
 * ignore
 */
k.prototype._getSchema=function(t){const e=this.path(t),n=[];if(e)return e.$fullPath=t,e;const r=t.split(".");for(let t=0;t<r.length;++t)("$"===r[t]||L(r[t]))&&(r[t]="0");return function t(e,r){let i,o,s=e.length+1;for(;s--;)if(o=e.slice(0,s).join("."),i=r.path(o),i){if(n.push(o),i.caster){if(i.caster instanceof E.Mixed)return i.caster.$fullPath=n.join("."),i.caster;if(s!==e.length&&i.schema){let n;return"$"===e[s]||L(e[s])?s+1===e.length?i:(n=t(e.slice(s+1),i.schema),n&&(n.$isUnderneathDocArray=n.$isUnderneathDocArray||!i.schema.$isSingleNested),n):(n=t(e.slice(s),i.schema),n&&(n.$isUnderneathDocArray=n.$isUnderneathDocArray||!i.schema.$isSingleNested),n)}}return i.$fullPath=n.join("."),i}}(r,this)},
/*!
 * ignore
 */
k.prototype._getPathType=function(t){if(this.path(t))return"real";return function t(e,n){let r,i,o=e.length+1;for(;o--;){if(i=e.slice(0,o).join("."),r=n.path(i),r)return r.caster?r.caster instanceof E.Mixed?{schema:r,pathType:"mixed"}:o!==e.length&&r.schema?"$"===e[o]||L(e[o])?o===e.length-1?{schema:r,pathType:"nested"}:t(e.slice(o+1),r.schema):t(e.slice(o),r.schema):{schema:r,pathType:r.$isSingleNested?"nested":"array"}:{schema:r,pathType:"real"};if(o===e.length&&n.nested[i])return{schema:n,pathType:"nested"}}return{schema:r||n,pathType:"undefined"}}(t.split("."),this)},t.exports=e=k,k.Types=E=n(111),
/*!
 * ignore
 */
e.ObjectId=E.ObjectId},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(31),i=n(68),o=n(111),s=n(404),a=n(11),c=n(142),u=n(6),l=n(64),h=n(107),f=["Polygon","MultiPolygon"];function p(t,e,n){if(Array.isArray(t))t.forEach((function(r,i){if(Array.isArray(r)||l(r))return p(r,e,n);t[i]=e.castForQueryWrapper({val:r,context:n})}));else{const r=Object.keys(t);let i=r.length;for(;i--;){const o=r[i],s=t[o];Array.isArray(s)||l(s)?(p(s,e,n),t[o]=s):t[o]=e.castForQuery({val:s,context:n})}}}t.exports=function t(e,n,d,m){if(Array.isArray(n))throw new Error("Query filter must be an object, got an array ",u.inspect(n));if(null==n)return n;n.hasOwnProperty("_bsontype")&&"ObjectID"!==n._bsontype&&delete n._bsontype;const y=Object.keys(n);let g,v,b,_,w,S,O,E=y.length;for(d=d||{};E--;)if(w=y[E],O=n[w],"$or"===w||"$nor"===w||"$and"===w){if(!Array.isArray(O))throw new r("Array",O,w);for(let n=0;n<O.length;++n){if(null==O[n]||"object"!=typeof O[n])throw new r("Object",O[n],w+"."+n);O[n]=t(e,O[n],d,m)}}else{if("$where"===w){if(S=typeof O,"string"!==S&&"function"!==S)throw new Error("Must have a string or function for $where");"function"===S&&(n[w]=O.toString());continue}if("$elemMatch"===w)O=t(e,O,d,m);else if("$text"===w)O=s(O,w);else{if(!e)continue;if(b=e.path(w),!b){const t=w.split(".");let r=t.length;for(;r--;){const i=t.slice(0,r).join("."),o=t.slice(r).join("."),s=e.path(i),c=a(s,"schema.options.discriminatorKey");if(null!=s&&null!=a(s,"schema.discriminators")&&null!=c&&o!==c){const t=a(n,i+"."+c);null!=t&&(b=s.schema.discriminators[t].path(o))}}}if(b){if(null==O)continue;if("Object"===O.constructor.name)if(v=Object.keys(O).some(c),v){const n=Object.keys(O);let r,i=n.length;for(;i--;)if(r=n[i],_=O[r],"$not"===r){if(_&&b&&!b.caster){if(g=Object.keys(_),g.length&&c(g[0]))for(const t in _)_[t]=b.castForQueryWrapper({$conditional:t,val:_[t],context:m});else O[r]=b.castForQueryWrapper({$conditional:r,val:_,context:m});continue}t(b.caster?b.caster.schema:e,_,d,m)}else O[r]=b.castForQueryWrapper({$conditional:r,val:_,context:m})}else n[w]=b.castForQueryWrapper({val:O,context:m});else if(Array.isArray(O)&&-1===["Buffer","Array"].indexOf(b.instance)){const t=[],e=O;for(const n of e)t.push(b.castForQueryWrapper({val:n,context:m}));n[w]={$in:t}}else n[w]=b.castForQueryWrapper({val:O,context:m})}else{const r=w.split(".");let s,a,c,u=r.length;for(;u--&&(s=r.slice(0,u).join("."),b=e.path(s),!b););if(b){b.caster&&b.caster.schema?(c={},a=r.slice(u).join("."),c[a]=O,n[w]=t(b.caster.schema,c,d,m)[a]):n[w]=O;continue}if(l(O)){let t="";if(O.$near?t="$near":O.$nearSphere?t="$nearSphere":O.$within?t="$within":O.$geoIntersects?t="$geoIntersects":O.$geoWithin&&(t="$geoWithin"),t){const e=new o.Number("__QueryCasting__");let n=O[t];if(null!=O.$maxDistance&&(O.$maxDistance=e.castForQueryWrapper({val:O.$maxDistance,context:m})),null!=O.$minDistance&&(O.$minDistance=e.castForQueryWrapper({val:O.$minDistance,context:m})),"$within"===t){const t=n.$center||n.$centerSphere||n.$box||n.$polygon;if(!t)throw new Error("Bad $within parameter: "+JSON.stringify(O));n=t}else if("$near"===t&&"string"==typeof n.type&&Array.isArray(n.coordinates))n=n.coordinates;else if(("$near"===t||"$nearSphere"===t||"$geoIntersects"===t)&&n.$geometry&&"string"==typeof n.$geometry.type&&Array.isArray(n.$geometry.coordinates))null!=n.$maxDistance&&(n.$maxDistance=e.castForQueryWrapper({val:n.$maxDistance,context:m})),null!=n.$minDistance&&(n.$minDistance=e.castForQueryWrapper({val:n.$minDistance,context:m})),h(n.$geometry)&&(n.$geometry=n.$geometry.toObject({transform:!1,virtuals:!1})),n=n.$geometry.coordinates;else if("$geoWithin"===t)if(n.$geometry){h(n.$geometry)&&(n.$geometry=n.$geometry.toObject({virtuals:!1}));const t=n.$geometry.type;if(-1===f.indexOf(t))throw new Error('Invalid geoJSON type for $geoWithin "'+t+'", must be "Polygon" or "MultiPolygon"');n=n.$geometry.coordinates}else n=n.$box||n.$polygon||n.$center||n.$centerSphere,h(n)&&(n=n.toObject({virtuals:!1}));p(n,e,m);continue}}if(e.nested[w])continue;if(d.upsert&&d.strict){if("throw"===d.strict)throw new i(w);throw new i(w,'Path "'+w+'" is not in schema, strict mode is `true`, and upsert is `true`.')}if("throw"===d.strictQuery)throw new i(w,'Path "'+w+"\" is not in schema and strictQuery is 'throw'.");d.strictQuery&&delete n[w]}}}return n}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(220)(),i=n(13).EventEmitter,o=n(50),s=n(62),a=n(51).internalToObjectOptions,c=n(11),u=n(24),l=n(6),h=n(8).documentArrayParent,f=n(8).validatorErrorSymbol;function p(t,e,n,i,o){null!=e&&e.isMongooseDocumentArray?(this.__parentArray=e,this[h]=e.$parent()):(this.__parentArray=void 0,this[h]=void 0),this.$setIndex(o),this.$isDocumentArrayElement=!0,r.call(this,t,i,n);const s=this;this.on("isNew",(function(t){s.isNew=t})),s.on("save",(function(){s.constructor.emit("save",s)}))}
/*!
 * Inherit from Document
 */p.prototype=Object.create(r.prototype),p.prototype.constructor=p;for(const t in i.prototype)p[t]=i.prototype[t];p.prototype.toBSON=function(){return this.toObject(a)},
/*!
 * ignore
 */
p.prototype.$setIndex=function(t){if(this.__index=t,null!=c(this,"$__.validationError",null)){const t=Object.keys(this.$__.validationError.errors);for(const e of t)this.invalidate(e,this.$__.validationError.errors[e])}},p.prototype.markModified=function(t){this.$__.activePaths.modify(t),this.__parentArray&&(this.isNew?this.__parentArray._markModified():this.__parentArray._markModified(this,t))},
/*!
 * ignore
 */
p.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')},p.prototype.save=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),u(e,t=>{this.$__save(t)})},p.prototype.$__save=function(t){return s(()=>t(null,this))},
/*!
 * no-op for hooks
 */
p.prototype.$__remove=function(t){return t(null,this)},p.prototype.remove=function(t,e){if("function"!=typeof t||e||(e=t,t=void 0),!this.__parentArray||t&&t.noop)return e&&e(null),this;let n;if(!this.willRemove){if(n=this._doc._id,!n)throw new Error("For your own good, Mongoose does not know how to remove an EmbeddedDocument that has no _id");this.__parentArray.pull({_id:n}),this.willRemove=!0,
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
function(t){let e=t.ownerDocument();function n(){e.removeListener("save",n),e.removeListener("remove",n),t.emit("remove",t),t.constructor.emit("remove",t),e=t=null}e.on("save",n),e.on("remove",n)}(this)}return e&&e(null),this},p.prototype.update=function(){throw new Error("The #update method is not available on EmbeddedDocuments")},p.prototype.inspect=function(){return this.toObject({transform:!1,virtuals:!1,flattenDecimals:!1})},l.inspect.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
p.prototype[l.inspect.custom]=p.prototype.inspect),p.prototype.invalidate=function(t,e,n){if(r.prototype.invalidate.call(this,t,e,n),!this[h]||null==this.__index){if(e[f]||e instanceof o)return this.ownerDocument().$__.validationError;throw e}const i=this.__index,s=[this.__parentArray.$path(),i,t].join(".");return this[h].invalidate(s,e,n),this.ownerDocument().$__.validationError},p.prototype.$markValid=function(t){if(!this[h])return;const e=this.__index;if(void 0!==e){const n=[this.__parentArray.$path(),e,t].join(".");this[h].$markValid(n)}},
/*!
 * ignore
 */
p.prototype.$ignore=function(t){if(r.prototype.$ignore.call(this,t),!this[h])return;const e=this.__index;if(void 0!==e){const n=[this.__parentArray.$path(),e,t].join(".");this[h].$ignore(n)}},p.prototype.$isValid=function(t){return void 0===this.__index||!this[h]||(!this[h].$__.validationError||!this[h].$__.validationError.errors[this.$__fullPath(t)])},p.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this[h];if(!t)return this;for(;t[h]||t.$parent;)t=t[h]||t.$parent;return this.$__.ownerDocument=t,this.$__.ownerDocument},p.prototype.$__fullPath=function(t){if(!this.$__.fullPath){let e=this;if(!e[h])return t;const n=[];for(;e[h]||e.$parent;)e[h]?n.unshift(e.__parentArray.$path()):n.unshift(e.$basePath),e=e[h]||e.$parent;this.$__.fullPath=n.join("."),this.$__.ownerDocument||(this.$__.ownerDocument=e)}return t?this.$__.fullPath+"."+t:this.$__.fullPath},p.prototype.parent=function(){return this[h]},p.prototype.parentArray=function(){return this.__parentArray},
/*!
 * Module exports.
 */
t.exports=p},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(33).get().Binary,i=n(63),o=n(42),s=n(107);
/*!
 * ignore
 */
function a(t){return t&&"object"==typeof t&&!(t instanceof Date)&&!(t instanceof o)&&(!Array.isArray(t)||t.length>0)&&!(t instanceof Buffer)&&!(t instanceof i)&&!(t instanceof r)}e.flatten=
/*!
 * ignore
 */
function t(e,n,r,i){let o;o=e&&s(e)&&!Buffer.isBuffer(e)?Object.keys(e.toObject({transform:!1,virtuals:!1})):Object.keys(e||{});const c=o.length,u={};n=n?n+".":"";for(let s=0;s<c;++s){const c=o[s],l=e[c];u[n+c]=l;const h=i&&i.path&&i.path(n+c),f=i&&i.nested&&i.nested[n+c];if(!h||"Mixed"!==h.instance){if(a(l)){if(r&&r.skipArrays&&Array.isArray(l))continue;const e=t(l,n+c,r,i);for(const t in e)u[t]=e[t];Array.isArray(l)&&(u[n+c]=l)}if(f){const t=Object.keys(i.paths);for(const e of t)e.startsWith(n+c+".")&&!u.hasOwnProperty(e)&&(u[e]=void 0)}}}return u}
/*!
 * ignore
 */,e.modifiedPaths=function t(e,n,r){const i=Object.keys(e||{}),o=i.length;r=r||{},n=n?n+".":"";for(let c=0;c<o;++c){const o=i[c];let u=e[o];r[n+o]=!0,s(u)&&!Buffer.isBuffer(u)&&(u=u.toObject({transform:!1,virtuals:!1})),a(u)&&t(u,n+o,r)}return r}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){return null==t||("object"!=typeof t||!("$meta"in t)&&!("$slice"in t))}},function(t,e){t.exports=require("path")},function(t,e){function n(t){if(!(this instanceof n))return new n(t);this._bsontype="Double",this.value=t}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},t.exports=n,t.exports.Double=n},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this._bsontype="Timestamp",this.low_=0|t,this.high_=0|e}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(t){var e=t||10;if(e<2||36<e)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(e),i=this.div(r),o=i.multiply(r).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}var s=n.fromNumber(Math.pow(e,6));o=this;for(var a="";!o.isZero();){var c=o.div(s),u=o.subtract(c.multiply(s)).toInt().toString(e);if((o=c).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!==this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!==this.high_?e+33:e+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(t){return this.high_===t.high_&&this.low_===t.low_},n.prototype.notEquals=function(t){return this.high_!==t.high_||this.low_!==t.low_},n.prototype.lessThan=function(t){return this.compare(t)<0},n.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},n.prototype.greaterThan=function(t){return this.compare(t)>0},n.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},n.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.subtract(t).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(t){var e=this.high_>>>16,r=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,c=t.low_>>>16,u=0,l=0,h=0,f=0;return h+=(f+=o+(65535&t.low_))>>>16,f&=65535,l+=(h+=i+c)>>>16,h&=65535,u+=(l+=r+a)>>>16,l&=65535,u+=e+s,u&=65535,n.fromBits(h<<16|f,u<<16|l)},n.prototype.subtract=function(t){return this.add(t.negate())},n.prototype.multiply=function(t){if(this.isZero())return n.ZERO;if(t.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return t.isOdd()?n.MIN_VALUE:n.ZERO;if(t.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&t.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,r=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,c=t.low_>>>16,u=65535&t.low_,l=0,h=0,f=0,p=0;return f+=(p+=o*u)>>>16,p&=65535,h+=(f+=i*u)>>>16,f&=65535,h+=(f+=o*c)>>>16,f&=65535,l+=(h+=r*u)>>>16,h&=65535,l+=(h+=i*c)>>>16,h&=65535,l+=(h+=o*a)>>>16,h&=65535,l+=e*u+r*c+i*a+o*s,l&=65535,n.fromBits(f<<16|p,l<<16|h)},n.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(t.equals(n.ONE)||t.equals(n.NEG_ONE))return n.MIN_VALUE;if(t.equals(n.MIN_VALUE))return n.ONE;var e=this.shiftRight(1).div(t).shiftLeft(1);if(e.equals(n.ZERO))return t.isNegative()?n.ONE:n.NEG_ONE;var r=this.subtract(t.multiply(e));return e.add(r.div(t))}if(t.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();var i=n.ZERO;for(r=this;r.greaterThanOrEqual(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(e)/Math.LN2),s=o<=48?1:Math.pow(2,o-48),a=n.fromNumber(e),c=a.multiply(t);c.isNegative()||c.greaterThan(r);)e-=s,c=(a=n.fromNumber(e)).multiply(t);a.isZero()&&(a=n.ONE),i=i.add(a),r=r.subtract(c)}return i},n.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(t){return n.fromBits(this.low_&t.low_,this.high_&t.high_)},n.prototype.or=function(t){return n.fromBits(this.low_|t.low_,this.high_|t.high_)},n.prototype.xor=function(t){return n.fromBits(this.low_^t.low_,this.high_^t.high_)},n.prototype.shiftLeft=function(t){if(0===(t&=63))return this;var e=this.low_;if(t<32){var r=this.high_;return n.fromBits(e<<t,r<<t|e>>>32-t)}return n.fromBits(0,e<<t-32)},n.prototype.shiftRight=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>t)}return n.fromBits(e>>t-32,e>=0?0:-1)},n.prototype.shiftRightUnsigned=function(t){if(0===(t&=63))return this;var e=this.high_;if(t<32){var r=this.low_;return n.fromBits(r>>>t|e<<32-t,e>>>t)}return 32===t?n.fromBits(e,0):n.fromBits(e>>>t-32,0)},n.fromInt=function(t){if(-128<=t&&t<128){var e=n.INT_CACHE_[t];if(e)return e}var r=new n(0|t,t<0?-1:0);return-128<=t&&t<128&&(n.INT_CACHE_[t]=r),r},n.fromNumber=function(t){return isNaN(t)||!isFinite(t)?n.ZERO:t<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:t+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:t<0?n.fromNumber(-t).negate():new n(t%n.TWO_PWR_32_DBL_|0,t/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(t,e){return new n(t,e)},n.fromString=function(t,e){if(0===t.length)throw Error("number format error: empty string");var r=e||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"===t.charAt(0))return n.fromString(t.substring(1),r).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=n.fromNumber(Math.pow(r,8)),o=n.ZERO,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));o=o.multiply(u).add(n.fromNumber(c))}else o=(o=o.multiply(i)).add(n.fromNumber(c))}return o},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),t.exports=n,t.exports.Timestamp=n},function(t,e,n){var r="inspect",i=n(45),o=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var a=!0;r=n(6).inspect.custom||"inspect"}}catch(t){a=!1}for(var c=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);if(this._bsontype="ObjectID",null==e||"number"==typeof e)return this.id=this.generate(e),void(t.cacheHexString&&(this.__id=this.toString("hex")));var n=t.isValid(e);if(!n&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof e&&24===e.length&&a)return new t(i.toBuffer(e,"hex"));if(n&&"string"==typeof e&&24===e.length)return t.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e,t.cacheHexString&&(this.__id=this.toString("hex"))},u=[],l=0;l<256;l++)u[l]=(l<=15?"0":"")+l.toString(16);c.prototype.toHexString=function(){if(c.cacheHexString&&this.__id)return this.__id;var t="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof f)return t=p(this.id),c.cacheHexString&&(this.__id=t),t;for(var e=0;e<this.id.length;e++)t+=u[this.id.charCodeAt(e)];return c.cacheHexString&&(this.__id=t),t},c.prototype.get_inc=function(){return c.index=(c.index+1)%16777215},c.prototype.getInc=function(){return this.get_inc()},c.prototype.generate=function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var e=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),r=i.allocBuffer(12);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[6]=255&o,r[5]=o>>8&255,r[4]=o>>16&255,r[8]=255&e,r[7]=e>>8&255,r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},c.prototype.toString=function(t){return this.id&&this.id.copy?this.id.toString("string"==typeof t?t:"hex"):this.toHexString()},c.prototype[r]=c.prototype.toString,c.prototype.toJSON=function(){return this.toHexString()},c.prototype.equals=function(t){return t instanceof c?this.toString()===t.toString():"string"==typeof t&&c.isValid(t)&&12===t.length&&this.id instanceof f?t===this.id.toString("binary"):"string"==typeof t&&c.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&c.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof c||t.toHexString))&&t.toHexString()===this.toHexString()},c.prototype.getTimestamp=function(){var t=new Date,e=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return t.setTime(1e3*Math.floor(e)),t},c.index=~~(16777215*Math.random()),c.createPk=function(){return new c},c.createFromTime=function(t){var e=i.toBuffer([0,0,0,0,0,0,0,0,0,0,0,0]);return e[3]=255&t,e[2]=t>>8&255,e[1]=t>>16&255,e[0]=t>>24&255,new c(e)};var h=[];for(l=0;l<10;)h[48+l]=l++;for(;l<16;)h[55+l]=h[87+l]=l++;var f=Buffer,p=function(t){return t.toString("hex")};c.createFromHexString=function(t){if(void 0===t||null!=t&&24!==t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(a)return new c(i.toBuffer(t,"hex"));for(var e=new f(12),n=0,r=0;r<24;)e[n++]=h[t.charCodeAt(r++)]<<4|h[t.charCodeAt(r++)];return new c(e)},c.isValid=function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&s.test(t):t instanceof c||(t instanceof f||!!t.toHexString&&(12===t.id.length||24===t.id.length&&s.test(t.id)))))},Object.defineProperty(c.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(t){this.id[3]=255&t,this.id[2]=t>>8&255,this.id[1]=t>>16&255,this.id[0]=t>>24&255}}),t.exports=c,t.exports.ObjectID=c,t.exports.ObjectId=c},function(t,e){function n(t,e){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=t||"",this.options=e||"";for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}t.exports=n,t.exports.BSONRegExp=n},function(t,e,n){var r=Buffer&&n(6).inspect.custom||"inspect";function i(t){if(!(this instanceof i))return new i(t);this._bsontype="Symbol",this.value=t}i.prototype.valueOf=function(){return this.value},i.prototype.toString=function(){return this.value},i.prototype[r]=function(){return this.value},i.prototype.toJSON=function(){return this.value},t.exports=i,t.exports.Symbol=i},function(t,e){var n=function t(e,n){if(!(this instanceof t))return new t(e,n);this._bsontype="Code",this.code=e,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},t.exports=n,t.exports.Code=n},function(t,e,n){"use strict";var r=n(55),i=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,o=/^(\+|-)?(Infinity|inf)$/i,s=/^(\+|-)?NaN$/i,a=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),h=/^([-+])?(\d+)?$/,f=n(45),p=function(t){return!isNaN(parseInt(t,10))},d=function(t){var e=r.fromNumber(1e9),n=r.fromNumber(0),i=0;if(!(t.parts[0]||t.parts[1]||t.parts[2]||t.parts[3]))return{quotient:t,rem:n};for(i=0;i<=3;i++)n=(n=n.shiftLeft(32)).add(new r(t.parts[i],0)),t.parts[i]=n.div(e).low_,n=n.modulo(e);return{quotient:t,rem:n}},m=function(t){this._bsontype="Decimal128",this.bytes=t};m.fromString=function(t){var e,n=!1,d=!1,y=!1,g=0,v=0,b=0,_=0,w=0,S=[0],O=0,E=0,T=0,C=0,I=0,A=0,k=[0,0],x=[0,0],N=0;if((t=t.trim()).length>=7e3)throw new Error(t+" not a valid Decimal128 string");var P=t.match(i),j=t.match(o),R=t.match(s);if(!P&&!j&&!R||0===t.length)throw new Error(t+" not a valid Decimal128 string");if(P&&P[4]&&void 0===P[2])throw new Error(t+" not a valid Decimal128 string");if("+"!==t[N]&&"-"!==t[N]||(n="-"===t[N++]),!p(t[N])&&"."!==t[N]){if("i"===t[N]||"I"===t[N])return new m(f.toBuffer(n?u:l));if("N"===t[N])return new m(f.toBuffer(c))}for(;p(t[N])||"."===t[N];)if("."!==t[N])O<34&&("0"!==t[N]||y)&&(y||(w=v),y=!0,S[E++]=parseInt(t[N],10),O+=1),y&&(b+=1),d&&(_+=1),v+=1,N+=1;else{if(d)return new m(f.toBuffer(c));d=!0,N+=1}if(d&&!v)throw new Error(t+" not a valid Decimal128 string");if("e"===t[N]||"E"===t[N]){var M=t.substr(++N).match(h);if(!M||!M[2])return new m(f.toBuffer(c));I=parseInt(M[0],10),N+=M[0].length}if(t[N])return new m(f.toBuffer(c));if(T=0,O){if(C=O-1,g=b,0!==I&&1!==g)for(;"0"===t[w+g-1];)g-=1}else T=0,C=0,S[0]=0,b=1,O=1,g=0;for(I<=_&&_-I>16384?I=-6176:I-=_;I>6111;){if((C+=1)-T>34){var D=S.join("");if(D.match(/^0+$/)){I=6111;break}return new m(f.toBuffer(n?u:l))}I-=1}for(;I<-6176||O<b;){if(0===C){I=-6176,g=0;break}if(O<b?b-=1:C-=1,!(I<6111)){if((D=S.join("")).match(/^0+$/)){I=6111;break}return new m(f.toBuffer(n?u:l))}I+=1}if(C-T+1<g&&"0"!==t[g]){var $=v;d&&-6176===I&&(w+=1,$+=1);var L=parseInt(t[w+C+1],10),F=0;if(L>=5&&(F=1,5===L))for(F=S[C]%2==1,A=w+C+2;A<$;A++)if(parseInt(t[A],10)){F=1;break}if(F)for(var B=C;B>=0&&++S[B]>9;B--)if(S[B]=0,0===B){if(!(I<6111))return new m(f.toBuffer(n?u:l));I+=1,S[B]=1}}if(k=r.fromNumber(0),x=r.fromNumber(0),0===g)k=r.fromNumber(0),x=r.fromNumber(0);else if(C-T<17)for(B=T,x=r.fromNumber(S[B++]),k=new r(0,0);B<=C;B++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(S[B]));else{for(B=T,k=r.fromNumber(S[B++]);B<=C-17;B++)k=(k=k.multiply(r.fromNumber(10))).add(r.fromNumber(S[B]));for(x=r.fromNumber(S[B++]);B<=C;B++)x=(x=x.multiply(r.fromNumber(10))).add(r.fromNumber(S[B]))}var U,V,q,W,z=function(t,e){if(!t&&!e)return{high:r.fromNumber(0),low:r.fromNumber(0)};var n=t.shiftRightUnsigned(32),i=new r(t.getLowBits(),0),o=e.shiftRightUnsigned(32),s=new r(e.getLowBits(),0),a=n.multiply(o),c=n.multiply(s),u=i.multiply(o),l=i.multiply(s);return a=a.add(c.shiftRightUnsigned(32)),c=new r(c.getLowBits(),0).add(u).add(l.shiftRightUnsigned(32)),{high:a=a.add(c.shiftRightUnsigned(32)),low:l=c.shiftLeft(32).add(new r(l.getLowBits(),0))}}(k,r.fromString("100000000000000000"));z.low=z.low.add(x),U=z.low,V=x,q=U.high_>>>0,W=V.high_>>>0,(q<W||q===W&&U.low_>>>0<V.low_>>>0)&&(z.high=z.high.add(r.fromNumber(1))),e=I+a;var H={low:r.fromNumber(0),high:r.fromNumber(0)};z.high.shiftRightUnsigned(49).and(r.fromNumber(1)).equals(r.fromNumber)?(H.high=H.high.or(r.fromNumber(3).shiftLeft(61)),H.high=H.high.or(r.fromNumber(e).and(r.fromNumber(16383).shiftLeft(47))),H.high=H.high.or(z.high.and(r.fromNumber(0x7fffffffffff)))):(H.high=H.high.or(r.fromNumber(16383&e).shiftLeft(49)),H.high=H.high.or(z.high.and(r.fromNumber(562949953421311)))),H.low=z.low,n&&(H.high=H.high.or(r.fromString("9223372036854775808")));var K=f.allocBuffer(16);return N=0,K[N++]=255&H.low.low_,K[N++]=H.low.low_>>8&255,K[N++]=H.low.low_>>16&255,K[N++]=H.low.low_>>24&255,K[N++]=255&H.low.high_,K[N++]=H.low.high_>>8&255,K[N++]=H.low.high_>>16&255,K[N++]=H.low.high_>>24&255,K[N++]=255&H.high.low_,K[N++]=H.high.low_>>8&255,K[N++]=H.high.low_>>16&255,K[N++]=H.high.low_>>24&255,K[N++]=255&H.high.high_,K[N++]=H.high.high_>>8&255,K[N++]=H.high.high_>>16&255,K[N++]=H.high.high_>>24&255,new m(K)};a=6176,m.prototype.toString=function(){for(var t,e,n,i,o,s,c=0,u=new Array(36),l=0;l<u.length;l++)u[l]=0;var h,f,p,m,y,g=0,v=!1,b={parts:new Array(4)},_=[];g=0;var w=this.bytes;if(i=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,n=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,e=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,t=w[g++]|w[g++]<<8|w[g++]<<16|w[g++]<<24,g=0,{low:new r(i,n),high:new r(e,t)}.high.lessThan(r.ZERO)&&_.push("-"),(o=t>>26&31)>>3==3){if(30===o)return _.join("")+"Infinity";if(31===o)return"NaN";s=t>>15&16383,p=8+(t>>14&1)}else p=t>>14&7,s=t>>17&16383;if(h=s-a,b.parts[0]=(16383&t)+((15&p)<<14),b.parts[1]=e,b.parts[2]=n,b.parts[3]=i,0===b.parts[0]&&0===b.parts[1]&&0===b.parts[2]&&0===b.parts[3])v=!0;else for(y=3;y>=0;y--){var S=0,O=d(b);if(b=O.quotient,S=O.rem.low_)for(m=8;m>=0;m--)u[9*y+m]=S%10,S=Math.floor(S/10)}if(v)c=1,u[g]=0;else for(c=36,l=0;!u[g];)l++,c-=1,g+=1;if((f=c-1+h)>=34||f<=-7||h>0){for(_.push(u[g++]),(c-=1)&&_.push("."),l=0;l<c;l++)_.push(u[g++]);_.push("E"),f>0?_.push("+"+f):_.push(f)}else if(h>=0)for(l=0;l<c;l++)_.push(u[g++]);else{var E=c+h;if(E>0)for(l=0;l<E;l++)_.push(u[g++]);else _.push("0");for(_.push(".");E++<0;)_.push("0");for(l=0;l<c-Math.max(E-1,0);l++)_.push(u[g++])}return _.join("")},m.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.exports=m,t.exports.Decimal128=m},function(t,e){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}t.exports=n,t.exports.MinKey=n},function(t,e){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}t.exports=n,t.exports.MaxKey=n},function(t,e){function n(t,e,r){if(!(this instanceof n))return new n(t,e,r);this._bsontype="DBRef",this.namespace=t,this.oid=e,this.db=r}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},t.exports=n,t.exports.DBRef=n},function(t,e,n){"use strict";const r=n(9).arrayStrictEqual,i=n(9).tagsStrictEqual,o=n(9).errorStrictEqual,s=n(27).ServerType,a=n(0).now,c=new Set([s.RSPrimary,s.Standalone,s.Mongos]),u=new Set([s.RSPrimary,s.RSSecondary,s.Mongos,s.Standalone]),l=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","compression","me","hosts","passives","arbiters","tags","setName","setVersion","electionId","primary","logicalSessionTimeoutMinutes","saslSupportedMechs","__nodejs_mock_server__","$clusterTime"];function h(t){return t&&t.ok?t.isreplicaset?s.RSGhost:t.msg&&"isdbgrid"===t.msg?s.Mongos:t.setName?t.hidden?s.RSOther:t.ismaster?s.RSPrimary:t.secondary?s.RSSecondary:t.arbiterOnly?s.RSArbiter:s.RSOther:s.Standalone:s.Unknown}t.exports={ServerDescription:class{constructor(t,e,n){n=n||{},e=Object.assign({minWireVersion:0,maxWireVersion:0,hosts:[],passives:[],arbiters:[],tags:[]},e),this.address=t,this.error=n.error,this.roundTripTime=n.roundTripTime||-1,this.lastUpdateTime=a(),this.lastWriteDate=e.lastWrite?e.lastWrite.lastWriteDate:null,this.opTime=e.lastWrite?e.lastWrite.opTime:null,this.type=h(e),l.forEach(t=>{void 0!==e[t]&&(this[t]=e[t])}),this.me&&(this.me=this.me.toLowerCase()),this.hosts=this.hosts.map(t=>t.toLowerCase()),this.passives=this.passives.map(t=>t.toLowerCase()),this.arbiters=this.arbiters.map(t=>t.toLowerCase())}get allHosts(){return this.hosts.concat(this.arbiters).concat(this.passives)}get isReadable(){return this.type===s.RSSecondary||this.isWritable}get isDataBearing(){return u.has(this.type)}get isWritable(){return c.has(this.type)}equals(t){return null!=t&&o(this.error,t.error)&&this.type===t.type&&this.minWireVersion===t.minWireVersion&&this.me===t.me&&r(this.hosts,t.hosts)&&i(this.tags,t.tags)&&this.setName===t.setName&&this.setVersion===t.setVersion&&(this.electionId?t.electionId&&this.electionId.equals(t.electionId):this.electionId===t.electionId)&&this.primary===t.primary&&this.logicalSessionTimeoutMinutes===t.logicalSessionTimeoutMinutes}},parseServerType:h}},function(t,e,n){"use strict";const r=n(53),i=n(29).Buffer,o=n(23).retrieveBSON,s=n(5).MongoError,a=n(57).AuthProvider,c=o().Binary;let u;try{u=n(268)}catch(t){}var l=function(t){for(var e={},n=t.split(","),r=0;r<n.length;r++){var i=n[r].split("=");e[i[0]]=i[1]}return e};function h(t,e,n){return r.createHmac(t,e).update(n).digest()}var f={},p=0;const d={sha256:32,sha1:20};function m(t,e,n,i){const o=[t,e.toString("base64"),n].join("_");if(void 0!==f[o])return f[o];const s=r.pbkdf2Sync(t,e,n,d[i],i);return p>=200&&(f={},p=0),f[o]=s,p+=1,s}class y extends a{constructor(t,e){super(t),this.cryptoMethod=e||"sha1"}static _getError(t,e){return t||(e.$err||e.errmsg?new s(e):void 0)}_executeScram(t,e,n,o,a){let f=n.username;const p=n.password,d=n.source,g=this.cryptoMethod;let v,b="SCRAM-SHA-1";if("sha256"===g)b="SCRAM-SHA-256",v=u?u(p):p;else try{v=function(t,e){if("string"!=typeof t)throw new s("username must be a string");if("string"!=typeof e)throw new s("password must be a string");if(0===e.length)throw new s("password cannot be empty");var n=r.createHash("md5");return n.update(t+":mongo:"+e,"utf8"),n.digest("hex")}(f,p)}catch(t){return a(t)}f=f.replace("=","=3D").replace(",","=2C");const _=i.concat([i.from("n=","utf8"),i.from(f,"utf8"),i.from(",r=","utf8"),i.from(o,"utf8")]),w={saslStart:1,mechanism:b,payload:new c(i.concat([i.from("n,,","utf8"),_])),autoAuthorize:1};t(e,`${d}.$cmd`,w,(n,o)=>{let u=y._getError(n,o);if(u)return a(u,null);const f=i.isBuffer(o.payload)?new c(o.payload):o.payload,p=l(f.value()),b=parseInt(p.i,10);if(b&&b<4096)return void a(new s(`Server returned an invalid iteration count ${b}`),!1);const w=p.s,S=p.r;if(S.startsWith("nonce"))return void a(new s(`Server returned an invalid nonce: ${S}`),!1);const O=`c=biws,r=${S}`,E=m(v,i.from(w,"base64"),b,g),T=h(g,E,"Client Key"),C=h(g,E,"Server Key"),I=(A=g,k=T,r.createHash(A).update(k).digest());var A,k;const x=[_,f.value().toString("base64"),O].join(","),N=[O,`p=${function(t,e){i.isBuffer(t)||(t=i.from(t)),i.isBuffer(e)||(e=i.from(e));const n=Math.max(t.length,e.length),r=[];for(let i=0;i<n;i+=1)r.push(t[i]^e[i]);return i.from(r).toString("base64")}(T,h(g,I,x))}`].join(","),P=h(g,C,x),j={saslContinue:1,conversationId:o.conversationId,payload:new c(i.from(N))};t(e,`${d}.$cmd`,j,(n,o)=>{if(n||o&&"number"==typeof o.ok&&0===o.ok)return void a(n,o);const c=l(o.payload.value());if(!function(t,e){if(t.length!==e.length)return!1;if("function"==typeof r.timingSafeEqual)return r.timingSafeEqual(t,e);let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}(i.from(c.v,"base64"),P))return void a(new s("Server returned an invalid signature"));if(!o||!1!==o.done)return a(n,o);const u={saslContinue:1,conversationId:o.conversationId,payload:i.alloc(0)};t(e,`${d}.$cmd`,u,a)})})}_authenticateSingleConnection(t,e,n,i){r.randomBytes(24,(r,o)=>r?i(r,null):this._executeScram(t,e,n,o.toString("base64"),i))}auth(t,e,n,r){this._checkSaslprep(),super.auth(t,e,n,r)}_checkSaslprep(){"sha256"===this.cryptoMethod&&(u||console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"))}}t.exports={ScramSHA1:class extends y{constructor(t){super(t,"sha1")}},ScramSHA256:class extends y{constructor(t){super(t,"sha256")}}}},function(t,e,n){"use strict";const r=n(5).MongoError,i=n(19),o=n(58),s=n(46);let a,c;a={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},c={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};t.exports={TxnState:a,Transaction:class{constructor(t){t=t||{},this.state=a.NO_TRANSACTION,this.options={};const e=s.fromOptions(t);if(e){if(e.w<=0)throw new r("Transactions do not support unacknowledged write concern");this.options.writeConcern=e}t.readConcern&&(this.options.readConcern=o.fromOptions(t)),t.readPreference&&(this.options.readPreference=i.fromOptions(t)),t.maxCommitTimeMS&&(this.options.maxTimeMS=t.maxCommitTimeMS),this._pinnedServer=void 0,this._recoveryToken=void 0}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return-1!==[a.STARTING_TRANSACTION,a.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(t){const e=c[this.state];if(e&&-1!==e.indexOf(t))return this.state=t,void(this.state!==a.NO_TRANSACTION&&this.state!==a.STARTING_TRANSACTION||this.unpinServer());throw new r(`Attempted illegal state transition from [${this.state}] to [${t}]`)}pinServer(t){this.isActive&&(this._pinnedServer=t)}unpinServer(){this._pinnedServer=void 0}},isTransactionCommand:function(t){return!(!t.commitTransaction&&!t.abortTransaction)}}},function(t,e,n){"use strict";"undefined"==typeof process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?t.exports={nextTick:function(t,e,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(t);case 2:return process.nextTick((function(){t.call(null,e)}));case 3:return process.nextTick((function(){t.call(null,e,n)}));case 4:return process.nextTick((function(){t.call(null,e,n,r)}));default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return process.nextTick((function(){t.apply(null,i)}))}}}:t.exports=process},function(t,e,n){"use strict";class r{constructor(t){this.time=new Date,this.address=t.address}}t.exports={CMAP_EVENT_NAMES:["connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"],ConnectionPoolCreatedEvent:class extends r{constructor(t){super(t),this.options=t.options}},ConnectionPoolClosedEvent:class extends r{constructor(t){super(t)}},ConnectionCreatedEvent:class extends r{constructor(t,e){super(t),this.connectionId=e.id}},ConnectionReadyEvent:class extends r{constructor(t,e){super(t),this.connectionId=e.id}},ConnectionClosedEvent:class extends r{constructor(t,e,n){super(t),this.connectionId=e.id,this.reason=n||"unknown"}},ConnectionCheckOutStartedEvent:class extends r{constructor(t){super(t)}},ConnectionCheckOutFailedEvent:class extends r{constructor(t,e){super(t),this.reason=e}},ConnectionCheckedOutEvent:class extends r{constructor(t,e){super(t),this.connectionId=e.id}},ConnectionCheckedInEvent:class extends r{constructor(t,e){super(t),this.connectionId=e.id}},ConnectionPoolClearedEvent:class extends r{constructor(t){super(t)}}}},function(t,e,n){"use strict";const r=n(126),i=n(103),o=n(13).EventEmitter,s=n(6).inherits,a=n(3).MongoError,c=n(6).deprecate,u=n(46),l=n(0).MongoDBNamespace,h=n(19),f=n(0).maybePromise,p=n(185),d=n(186).connect,m=n(186).validOptions;function y(t,e){if(!(this instanceof y))return new y(t,e);o.call(this),this.s={url:t,options:e||{},promiseLibrary:e&&e.promiseLibrary||Promise,dbCache:new Map,sessions:new Set,writeConcern:u.fromOptions(e),namespace:new l("admin")}}s(y,o),Object.defineProperty(y.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(y.prototype,"readPreference",{enumerable:!0,get:function(){return h.primary}}),y.prototype.connect=function(t){if("string"==typeof t)throw new TypeError("`connect` only accepts a callback");const e=this;return f(this,t,t=>{const n=m(e.s.options);if(n)return t(n);d(e,e.s.url,e.s.options,n=>{if(n)return t(n);t(null,e)})})},y.prototype.logout=c((function(t,e){"function"==typeof t&&(e=t,t={}),"function"==typeof e&&e(null,!0)}),"Multiple authentication is prohibited on a connected client, please only authenticate once per MongoClient"),y.prototype.close=function(t,e){"function"==typeof t&&(e=t,t=!1);const n=this;return f(this,e,e=>{const r=t=>{if(n.emit("close",n),!(n.topology instanceof p))for(const t of n.s.dbCache)t[1].emit("close",n);n.removeAllListeners("close"),e(t)};null!=n.topology?n.topology.close(t,e=>{const i=n.topology.s.options.autoEncrypter;i?i.teardown(t,t=>r(e||t)):r(e)}):r()})},y.prototype.db=function(t,e){e=e||{},t||(t=this.s.options.dbName);const n=Object.assign({},this.s.options,e);if(this.s.dbCache.has(t)&&!0!==n.returnNonCachedInstance)return this.s.dbCache.get(t);if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new a("MongoClient must be connected before calling MongoClient.prototype.db");const r=new i(t,this.topology,n);return this.s.dbCache.set(t,r),r},y.prototype.isConnected=function(t){return t=t||{},!!this.topology&&this.topology.isConnected(t)},y.connect=function(t,e,n){const r=Array.prototype.slice.call(arguments,1);n="function"==typeof r[r.length-1]?r.pop():void 0;const i=new y(t,e=(e=r.length?r.shift():null)||{});return i.connect(n)},y.prototype.startSession=function(t){if(t=Object.assign({explicit:!0},t),!this.topology)throw new a("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new a("Current topology does not support sessions");return this.topology.startSession(t,this.s.options)},y.prototype.withSession=function(t,e){"function"==typeof t&&(e=t,t=void 0);const n=this.startSession(t);let r=(t,e,i)=>{if(r=()=>{throw new ReferenceError("cleanupHandler was called too many times")},i=Object.assign({throw:!0},i),n.endSession(),t){if(i.throw)throw t;return Promise.reject(t)}};try{const t=e(n);return Promise.resolve(t).then(t=>r(null,t)).catch(t=>r(t,null,{throw:!0}))}catch(t){return r(t,null,{throw:!1})}},y.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new r(this,t,e)},y.prototype.getLogger=function(){return this.s.options.logger},t.exports=y},function(t,e,n){"use strict";const r=n(61),i=n(3).MongoError,o=n(9).maxWireVersion,s=n(3).ReadPreference,a=n(4).Aspect,c=n(4).defineAspects;class u extends r{constructor(t,e,n){if(super(t,n,{fullResponse:!0}),this.target=t.s.namespace&&t.s.namespace.collection?t.s.namespace.collection:1,this.pipeline=e,this.hasWriteStage=!1,"string"==typeof n.out)this.pipeline=this.pipeline.concat({$out:n.out}),this.hasWriteStage=!0;else if(e.length>0){const t=e[e.length-1];(t.$out||t.$merge)&&(this.hasWriteStage=!0)}if(this.hasWriteStage&&(this.readPreference=s.primary),n.explain&&(this.readConcern||this.writeConcern))throw new i('"explain" cannot be used on an aggregate call with readConcern/writeConcern');if(null!=n.cursor&&"object"!=typeof n.cursor)throw new i("cursor options must be an object")}get canRetryRead(){return!this.hasWriteStage}addToPipeline(t){this.pipeline.push(t)}execute(t,e){const n=this.options,r=o(t),i={aggregate:this.target,pipeline:this.pipeline};this.hasWriteStage&&r<8&&(this.readConcern=null),r>=5&&this.hasWriteStage&&this.writeConcern&&Object.assign(i,{writeConcern:this.writeConcern}),!0===n.bypassDocumentValidation&&(i.bypassDocumentValidation=n.bypassDocumentValidation),"boolean"==typeof n.allowDiskUse&&(i.allowDiskUse=n.allowDiskUse),n.hint&&(i.hint=n.hint),n.explain&&(n.full=!1,i.explain=n.explain),i.cursor=n.cursor||{},n.batchSize&&!this.hasWriteStage&&(i.cursor.batchSize=n.batchSize),super.executeCommand(t,i,e)}}c(u,[a.READ_OPERATION,a.RETRYABLE,a.EXECUTE_WITH_SELECTION]),t.exports=u},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).applyRetryableWrites,o=n(0).applyWriteConcern,s=n(0).decorateWithCollation,a=n(20).executeCommand,c=n(0).formattedOrderClause,u=n(0).handleCallback,l=n(3).ReadPreference;t.exports=class extends r{constructor(t,e,n,r,i){super(i),this.collection=t,this.query=e,this.sort=n,this.doc=r}execute(t){const e=this.collection,n=this.query,r=c(this.sort),h=this.doc;let f=this.options;const p={findAndModify:e.collectionName,query:n};r&&(p.sort=r),p.new=!!f.new,p.remove=!!f.remove,p.upsert=!!f.upsert;const d=f.projection||f.fields;d&&(p.fields=d),f.arrayFilters&&(p.arrayFilters=f.arrayFilters),h&&!f.remove&&(p.update=h),f.maxTimeMS&&(p.maxTimeMS=f.maxTimeMS),f.serializeFunctions=f.serializeFunctions||e.s.serializeFunctions,f.checkKeys=!1,f=i(f,e.s.db),f=o(f,{db:e.s.db,collection:e},f),f.writeConcern&&(p.writeConcern=f.writeConcern),!0===f.bypassDocumentValidation&&(p.bypassDocumentValidation=f.bypassDocumentValidation),f.readPreference=l.primary;try{s(p,e,f)}catch(e){return t(e,null)}a(e.s.db,p,f,(e,n)=>e?u(t,e,null):u(t,null,n))}}},function(t,e,n){"use strict";const r=n(13).EventEmitter,i=n(6).inherits,o=n(0).getSingleProperty,s=n(130),a=n(0).handleCallback,c=n(0).filterOptions,u=n(0).toError,l=n(3).ReadPreference,h=n(3).MongoError,f=n(3).ObjectID,p=n(3).Logger,d=n(76),m=n(0).mergeOptionsAndWriteConcern,y=n(0).executeLegacyOperation,g=n(0).resolveReadPreference,v=n(126),b=n(6).deprecate,_=n(0).deprecateOptions,w=n(0).MongoDBNamespace,S=n(127),O=n(46),E=n(58),T=n(129),C=n(20).createListener,I=n(20).ensureIndex,A=n(20).evaluate,k=n(20).profilingInfo,x=n(20).validateDatabaseName,N=n(101),P=n(180),j=n(323),R=n(30),M=n(324),D=n(176),$=n(131).DropCollectionOperation,L=n(131).DropDatabaseOperation,F=n(181),B=n(178),U=n(325),V=n(326),q=n(182),W=n(183),z=n(327),H=n(73),K=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function G(t,e,n){if(n=n||{},!(this instanceof G))return new G(t,e,n);r.call(this);const i=n.promiseLibrary||Promise;(n=c(n,K)).promiseLibrary=i,this.s={dbCache:{},children:[],topology:e,options:n,logger:p("Db",n),bson:e?e.bson:null,readPreference:l.fromOptions(n),bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||f,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:i,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:E.fromOptions(n),writeConcern:O.fromOptions(n),namespace:new w(t)},x(t),o(this,"serverConfig",this.s.topology),o(this,"bufferMaxEntries",this.s.bufferMaxEntries),o(this,"databaseName",this.s.namespace.db),n.parentDb||this.s.noListener||(e.on("error",C(this,"error",this)),e.on("timeout",C(this,"timeout",this)),e.on("close",C(this,"close",this)),e.on("parseError",C(this,"parseError",this)),e.once("open",C(this,"open",this)),e.once("fullsetup",C(this,"fullsetup",this)),e.once("all",C(this,"all",this)),e.on("reconnect",C(this,"reconnect",this)))}i(G,r),Object.defineProperty(G.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty(G.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty(G.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty(G.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern}}),Object.defineProperty(G.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?l.primary:this.s.readPreference}}),Object.defineProperty(G.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(G.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),G.prototype.command=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},e);const r=new R(this,e,null,t);return H(this.s.topology,r,n)},G.prototype.aggregate=function(t,e,n){"function"==typeof e&&(n=e,e={}),null==e&&null==n&&(e={});const r=new T(this.s.topology,new N(this,t,e),e);if("function"!=typeof n)return r;n(null,r)},G.prototype.admin=function(){return new(n(184))(this,this.s.topology,this.s.promiseLibrary)};const Q=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];G.prototype.collection=function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},(e=Object.assign({},e)).promiseLibrary=this.s.promiseLibrary,e.readConcern=e.readConcern?new E(e.readConcern.level):this.readConcern,this.s.options.ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),null==(e=m(e,this.s.options,Q,!0))||!e.strict)try{const r=new d(this,this.s.topology,this.databaseName,t,this.s.pkFactory,e);return n&&n(null,r),r}catch(t){if(t instanceof h&&n)return n(t);throw t}if("function"!=typeof n)throw u(`A callback is required in strict mode. While getting collection ${t}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new h("topology was destroyed"));const r=Object.assign({},e,{nameOnly:!0});this.listCollections({name:t},r).toArray((r,i)=>{if(null!=r)return a(n,r,null);if(0===i.length)return a(n,u(`Collection ${t} does not exist. Currently in strict mode.`),null);try{return a(n,null,new d(this,this.s.topology,this.databaseName,t,this.s.pkFactory,e))}catch(r){return a(n,r,null)}})},G.prototype.createCollection=_({name:"Db.createCollection",deprecatedOptions:["autoIndexId"],optionsIndex:1},(function(t,e,n){"function"==typeof e&&(n=e,e={}),(e=e||{}).promiseLibrary=e.promiseLibrary||this.s.promiseLibrary,e.readConcern=e.readConcern?new E(e.readConcern.level):this.readConcern;const r=new M(this,t,e);return H(this.s.topology,r,n)})),G.prototype.stats=function(t,e){"function"==typeof t&&(e=t,t={});const n={dbStats:!0};null!=(t=t||{}).scale&&(n.scale=t.scale),null==t.readPreference&&this.s.readPreference&&(t.readPreference=this.s.readPreference);const r=new R(this,t,null,n);return H(this.s.topology,r,e)},G.prototype.listCollections=function(t,e){return t=t||{},e=e||{},new s(this.s.topology,new U(this,t,e),e)},G.prototype.eval=b((function(t,e,n,r){const i=Array.prototype.slice.call(arguments,1);return r="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():e,n=i.length&&i.shift()||{},y(this.s.topology,A,[this,t,e,n,r])}),"Db.eval is deprecated as of MongoDB version 3.2"),G.prototype.renameCollection=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),(n=Object.assign({},n,{readPreference:l.PRIMARY})).new_collection=!0;const i=new W(this.collection(t),e,n);return H(this.s.topology,i,r)},G.prototype.dropCollection=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new $(this,t,e=e||{});return H(this.s.topology,r,n)},G.prototype.dropDatabase=function(t,e){"function"==typeof t&&(e=t,t={});const n=new L(this,t=t||{});return H(this.s.topology,n,e)},G.prototype.collections=function(t,e){"function"==typeof t&&(e=t,t={});const n=new j(this,t=t||{});return H(this.s.topology,n,e)},G.prototype.executeDbAdminCommand=function(t,e,n){"function"==typeof e&&(n=e,e={}),(e=e||{}).readPreference=g(this,e);const r=new F(this,t,e);return H(this.s.topology,r,n)},G.prototype.createIndex=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n?Object.assign({},n):{};const i=new D(this,t,e,n);return H(this.s.topology,i,r)},G.prototype.ensureIndex=b((function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},y(this.s.topology,I,[this,t,e,n,r])}),"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),G.prototype.addChild=function(t){if(this.s.parentDb)return this.s.parentDb.addChild(t);this.s.children.push(t)},G.prototype.addUser=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},"string"==typeof t&&null!=e&&"object"==typeof e&&(n=e,e=null);const i=new P(this,t,e,n);return H(this.s.topology,i,r)},G.prototype.removeUser=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new q(this,t,e=e||{});return H(this.s.topology,r,n)},G.prototype.setProfilingLevel=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new z(this,t,e=e||{});return H(this.s.topology,r,n)},G.prototype.profilingInfo=b((function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},y(this.s.topology,k,[this,t,e])}),"Db.profilingInfo is deprecated. Query the system.profile collection directly."),G.prototype.profilingLevel=function(t,e){"function"==typeof t&&(e=t,t={});const n=new V(this,t=t||{});return H(this.s.topology,n,e)},G.prototype.indexInformation=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new B(this,t,e=e||{});return H(this.s.topology,r,n)},G.prototype.unref=function(){this.s.topology.unref()},G.prototype.watch=function(t,e){return t=t||[],e=e||{},Array.isArray(t)||(e=t,t=[]),new v(this,t,e)},G.prototype.getLogger=function(){return this.s.logger},G.SYSTEM_NAMESPACE_COLLECTION=S.SYSTEM_NAMESPACE_COLLECTION,G.SYSTEM_INDEX_COLLECTION=S.SYSTEM_INDEX_COLLECTION,G.SYSTEM_PROFILE_COLLECTION=S.SYSTEM_PROFILE_COLLECTION,G.SYSTEM_USER_COLLECTION=S.SYSTEM_USER_COLLECTION,G.SYSTEM_COMMAND_COLLECTION=S.SYSTEM_COMMAND_COLLECTION,G.SYSTEM_JS_COLLECTION=S.SYSTEM_JS_COLLECTION,t.exports=G},function(t,e,n){"use strict";const r=n(3).Server,i=n(38),o=n(48).TopologyBase,s=n(48).Store,a=n(3).MongoError,c=n(0).MAX_JS_INT,u=n(0).translateOptions,l=n(0).filterOptions,h=n(0).mergeOptions;var f=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class p extends o{constructor(t,e,n){super();const o=(n=l(n,f)).promiseLibrary;var p={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},d=n.store||new s(this,p);if(-1!==t.indexOf("/"))null!=e&&"object"==typeof e&&(n=e,e=null);else if(null==e)throw a.create({message:"port must be specified",driver:!0});var m="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;m="boolean"==typeof n.autoReconnect?n.autoReconnect:m;var y=h({},{host:t,port:e,disconnectHandler:d,cursorFactory:i,reconnect:m,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});y=u(y,n);var g=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;y=u(y,g),this.s={coreTopology:new r(y),sCapabilities:null,clonedOptions:y,reconnect:y.reconnect,emitError:y.emitError,poolSize:y.size,storeOptions:p,store:d,host:t,port:e,options:n,sessionPool:null,sessions:new Set,promiseLibrary:o||Promise}}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t=this.s.clonedOptions),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(){return function(t){["timeout","error","close"].forEach((function(t){n.s.coreTopology.removeListener(t,a[t])})),n.s.coreTopology.removeListener("connect",r);try{e(t)}catch(t){process.nextTick((function(){throw t}))}}},i=function(t){return function(e){"error"!==t&&n.emit(t,e)}},o=function(){n.s.store.flush()},s=function(t){return function(e,r){n.emit(t,e,r)}},a={timeout:r("timeout"),error:r("error"),close:r("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(t){n.s.coreTopology.removeAllListeners(t)})),n.s.coreTopology.once("timeout",a.timeout),n.s.coreTopology.once("error",a.error),n.s.coreTopology.once("close",a.close),n.s.coreTopology.once("connect",(function(){["timeout","error","close","destroy"].forEach((function(t){n.s.coreTopology.removeAllListeners(t)})),n.s.coreTopology.on("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.on("close",i("close")),n.s.coreTopology.on("destroy",o),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick((function(){throw t}))}})),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect",n),n.s.store.execute()})),n.s.coreTopology.on("reconnectFailed",(function(t){n.emit("reconnectFailed",t),n.s.store.flush(t)})),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.on("attemptReconnect",s("attemptReconnect")),n.s.coreTopology.on("monitoring",s("monitoring")),n.s.coreTopology.connect(t)}}Object.defineProperty(p.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(p.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(p.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(p.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),t.exports=p},function(t,e,n){"use strict";
/*!
 * Connection states
 */const r=t.exports=Object.create(null);r[0]="disconnected",r[1]="connected",r[2]="connecting",r[3]="disconnecting",r[99]="uninitialized",r.disconnected=0,r.connected=1,r.connecting=2,r.disconnecting=3,r.uninitialized=99},function(t,e){t.exports=function(t,e,n){var r=[],i=t.length;if(0===i)return r;var o=e<0?Math.max(0,e+i):e||0;for(void 0!==n&&(i=n<0?n+i:n);i-- >o;)r[i-o]=t[i];return r}},function(t,e,n){"use strict";
/*!
 * Returns if `v` is a mongoose object that has a `toObject()` method we can use.
 *
 * This is for compatibility with libs like Date.js which do foolish things to Natives.
 *
 * @param {any} v
 * @api private
 */t.exports=function(t){return null!=t&&(null!=t.$__||t.isMongooseArray||t.isMongooseBuffer||t.$isMongooseMap)}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(66),i=n(134),o={_promise:null,get:function(){return o._promise},set:function(t){r.ok("function"==typeof t,`mongoose.Promise must be a function, got ${t}`),o._promise=t,i.Promise=t}};
/*!
 * Use native promises by default
 */
o.set(global.Promise),t.exports=o},function(t,e,n){"use strict";var r=["find","findOne","update","updateMany","updateOne","replaceOne","remove","count","distinct","findAndModify","aggregate","findStream","deleteOne","deleteMany"];function i(){}for(var o=0,s=r.length;o<s;++o){var a=r[o];i.prototype[a]=c(a)}function c(t){return function(){throw new Error("collection."+t+" not implemented")}}t.exports=i,i.methods=r},function(t,e,n){"use strict";t.exports=function(t){return t.replace(/\.\$(\[[^\]]*\])?\./g,".0.").replace(/\.(\[[^\]]*\])?\$$/g,".0")}},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.String=n(397),e.Number=n(214),e.Boolean=n(400),e.DocumentArray=n(401),e.Embedded=n(407),e.Array=n(141),e.Buffer=n(409),e.Date=n(411),e.ObjectId=n(414),e.Mixed=n(77),e.Decimal128=e.Decimal=n(416),e.Map=n(418),e.Oid=e.ObjectId,e.Object=e.Mixed,e.Bool=e.Boolean,e.ObjectID=e.ObjectId},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(214);
/*!
 * @ignore
 */
/*!
 * @ignore
 */
function i(t){return r.cast()(t)}e.castToNumber=i,e.castArraysOfNumbers=function t(e,n){e.forEach((function(r,o){Array.isArray(r)?t(r,n):e[o]=i.call(n,r)}))}},function(t,e,n){"use strict";
/*!
 * Module dependencies
 */const r=n(426),i=n(11),o=n(39),s=n(83),a=n(49);
/*!
 * Set each path query option to lean
 *
 * @param {Object} option
 */
function c(t){return function(e){e.options||(e.options={}),e.options.lean=t}}
/*!
 * Handle the `WriteOpResult` from the server
 */
/*!
 * Prepare a set of path options for query population.
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
e.preparePopulationOptions=function(t,e){const n=t.options.populate,r=Object.keys(n).reduce((t,e)=>t.concat([n[e]]),[]);return null!=e.lean&&r.filter(t=>null==i(t,"options.lean")).forEach(c(e.lean)),r},
/*!
 * Prepare a set of path options for query population. This is the MongooseQuery
 * version
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */
e.preparePopulationOptionsMQ=function(t,e){const n=t._mongooseOptions.populate,r=Object.keys(n).reduce((t,e)=>t.concat([n[e]]),[]);null!=e.lean&&r.filter(t=>null==i(t,"options.lean")).forEach(c(e.lean));const o=i(t,"options.session",null);null!=o&&r.forEach(t=>{null!=t.options?"session"in t.options||(t.options.session=o):t.options={session:o}});const s=t._fieldsForExec();return r.forEach(t=>{t._queryProjection=s}),r},
/*!
 * If the document is a mapped discriminator type, it returns a model instance for that type, otherwise,
 * it returns an instance of the given model.
 *
 * @param {Model}  model
 * @param {Object} doc
 * @param {Object} fields
 *
 * @return {Document}
 */
e.createModel=function(t,n,r,i){t.hooks.execPreSync("createModel",n);const s=t.schema?t.schema.discriminatorMapping:null,c=s&&s.isRoot?s.key:null,u=n[c];if(c&&u&&t.discriminators){const n=t.discriminators[u]||o(t,u);if(n){const t=a(i);return e.applyPaths(t,n.schema),new n(void 0,t,!0)}}return new t(void 0,r,{skipId:!0,isNew:!1,willInit:!0})},
/*!
 * ignore
 */
e.applyPaths=function(t,e){let n,o,a;if(t)for(o=Object.keys(t),a=o.length;a--;){if("+"===o[a][0])continue;const e=t[o[a]];if(s(e)){n=!e;break}}const c=[],u=[],l=[];switch(function e(s,a){if(a||(a=""),-1!==l.indexOf(s))return[];l.push(s);const h=[];return s.eachPath((function(s,l){a&&(s=a+"."+s);const f=function(e,r){const s="+"+e,a=t&&s in t;a&&delete t[s];if("boolean"!=typeof r.selected)return;if(a)return delete t[s],void(!1===n&&o.length>1&&!~o.indexOf(e)&&(t[e]=1));const l=e.split(".");let h="";for(let t=0;t<l.length;++t)if(h+=h.length?"."+l[t]:l[t],-1!==u.indexOf(h))return;if(!n&&i(r,"options.$skipDiscriminatorCheck",!1)){let e="";for(let n=0;n<l.length;++n){e+=(0===e.length?"":".")+l[n];const r=i(t,e,!1);if(r&&"object"!=typeof r)return}}return(r.selected?c:u).push(e),e}(s,l);if(null!=f&&h.push(f),l.schema){const i=e(l.schema,s);!1===n&&r(t,s,l.schema,c,i)}})),l.pop(),h}(e),n){case!0:for(const e of u)t[e]=0;break;case!1:e&&e.paths._id&&e.paths._id.options&&!1===e.paths._id.options.select&&(t._id=0);for(const e of c)t[e]=t[e]||1;break;case void 0:if(null==t)break;for(const e of Object.keys(t||{}))e.startsWith("+")&&delete t[e];for(const e of u)t[e]=0}},e.handleDeleteWriteOpResult=function(t){return function(e,n){if(e)return t(e);const r=Object.assign({},n.result);return null!=i(n,"result.n",null)&&(r.deletedCount=n.result.n),null!=n.deletedCount&&(r.deletedCount=n.deletedCount),t(null,r)}}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=new WeakMap},,function(t,e,n){"use strict";t.exports=n(249)},function(t,e,n){"use strict";if(void 0!==global.Map)t.exports=global.Map,t.exports.Map=global.Map;else{var r=function(t){this._keys=[],this._values={};for(var e=0;e<t.length;e++)if(null!=t[e]){var n=t[e],r=n[0],i=n[1];this._keys.push(r),this._values[r]={v:i,i:this._keys.length-1}}};r.prototype.clear=function(){this._keys=[],this._values={}},r.prototype.delete=function(t){var e=this._values[t];return null!=e&&(delete this._values[t],this._keys.splice(e.i,1),!0)},r.prototype.entries=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?[n,t._values[n].v]:void 0,done:void 0===n}}}},r.prototype.forEach=function(t,e){e=e||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];t.call(e,this._values[r].v,r,e)}},r.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},r.prototype.has=function(t){return null!=this._values[t]},r.prototype.keys=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},r.prototype.set=function(t,e){return this._values[t]?(this._values[t].v=e,this):(this._keys.push(t),this._values[t]={v:e,i:this._keys.length-1},this)},r.prototype.values=function(){var t=this,e=0;return{next:function(){var n=t._keys[e++];return{value:void 0!==n?t._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(r.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),t.exports=r,t.exports.Map=r}},function(t,e){var n=function(t){if(!(this instanceof n))return new n(t);this._bsontype="Int32",this.value=t};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},t.exports=n,t.exports.Int32=n},function(t,e,n){(function(t){var e=n(84),r=n(54),i=n(6).format,o=n(259),s=n(261),a=r.existsSync||e.existsSync,c=function(t){for(var n=!1;!n;)if(a(t+"/package.json"))n=t;else{if("/"===t)return!1;t=e.dirname(t)}return t},u=function(e,a){(a=a||{}).strict="boolean"!=typeof a.strict||a.strict;var u=function(e){for(var n=t,o=!1;n;){s=n.filename;var s=c(s);if(s){var a=JSON.parse(r.readFileSync(i("%s/package.json",s))),u=e.split(/\//);if(a.peerOptionalDependencies&&(!a.peerOptionalDependencies||a.peerOptionalDependencies[u[0]])){o=!0;break}n=n.parent}else n=n.parent}if(!o)throw new Error(i("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",u[0]));return{object:a,parts:u}}(e),l=u.object,h=u.parts,f=l.peerOptionalDependencies[h[0]],p=void 0,d=e;try{p=n(120)(d)}catch(t){try{if(null==(d=o(process.cwd(),e)))return;p=n(120)(d)}catch(t){if("MODULE_NOT_FOUND"===t.code)return}}var m=c(n(120).resolve(d));if(!m)throw new Error("package.json can not be located");var y=JSON.parse(r.readFileSync(i("%s/package.json",m))).version;if(0==s.satisfies(y,f)&&a.strict){var g=new Error(i("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",h[0],y,f));throw g.code="OPTIONAL_MODULE_NOT_FOUND",g}return p};u.exists=function(t){try{return void 0!==u(t)}catch(t){return!1}},t.exports=u}).call(this,n(258)(t))},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=120},function(t,e,n){"use strict";var r=n(6).inherits,i=n(6).format,o=n(13).EventEmitter,s=n(19),a=n(34),c=n(23).debugOptions,u=n(23).retrieveBSON,l=n(264),h=n(5).MongoError,f=n(5).MongoNetworkError,p=n(165),d=n(35).CoreCursor,m=n(16),y=n(16).createCompressionInfo,g=n(16).resolveClusterTime,v=n(16).SessionMixins,b=n(9).relayEvents;const _=n(9).collationNotSupported,w=n(9).makeClientMetadata;var S=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],O=0,E=!1,T={},C=u();function I(t){return null==t.s.parent?t.id:t.s.parent.id}var A=function(t){t=t||{},o.call(this),this.id=O++,this.s={options:Object.assign({metadata:w(t)},t),logger:a("Server",t),Cursor:t.cursorFactory||d,bson:t.bson||new C([C.Binary,C.Code,C.DBRef,C.Decimal128,C.Double,C.Int32,C.Long,C.Map,C.MaxKey,C.MinKey,C.ObjectId,C.BSONRegExp,C.Symbol,C.Timestamp]),pool:null,disconnectHandler:t.disconnectHandler,monitoring:"boolean"!=typeof t.monitoring||t.monitoring,inTopology:!!t.parent,monitoringInterval:"number"==typeof t.monitoringInterval?t.monitoringInterval:5e3,compression:{compressors:y(t)},parent:t.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this._type="server",this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function k(t,e,n,r,o,s){return t.s.pool.isConnected()||!t.s.options.reconnect||null==t.s.disconnectHandler||o.monitoring?t.s.pool.isConnected()?void 0:(s(new h(i("no connection available to server %s",t.name))),!0):(t.s.disconnectHandler.add(e,n,r,o,s),!0)}r(A,o),Object.assign(A.prototype,v),Object.defineProperty(A.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(A.prototype,"parserType",{enumerable:!0,get:function(){return C.native?"c++":"js"}}),Object.defineProperty(A.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty(A.prototype,"clientMetadata",{enumerable:!0,get:function(){return this.s.options.metadata}}),Object.defineProperty(A.prototype,"clusterTime",{enumerable:!0,set:function(t){const e=this.s.parent?this.s.parent:this.s;g(e,t)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),A.enableServerAccounting=function(){E=!0,T={}},A.disableServerAccounting=function(){E=!1},A.servers=function(){return T},Object.defineProperty(A.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var x=function(t,e){return function(n,r){if(t.s.logger.isInfo()){var o=n instanceof h?JSON.stringify(n):{};t.s.logger.info(i("server %s fired event %s out with message %s",t.name,e,o))}if("connect"===e){if(t.initialConnect=!1,t.ismaster=r.ismaster,t.lastIsMasterMS=r.lastIsMasterMS,r.agreedCompressor&&(t.s.pool.options.agreedCompressor=r.agreedCompressor),r.zlibCompressionLevel&&(t.s.pool.options.zlibCompressionLevel=r.zlibCompressionLevel),r.ismaster.$clusterTime){const e=r.ismaster.$clusterTime;t.clusterTime=e}"isdbgrid"===t.ismaster.msg&&(t._type="mongos"),t.s.monitoring&&(t.monitoringProcessId=setTimeout(function t(e){return function(){if(!e.s.pool.isDestroyed()){e.emit("monitoring",e);var n=(new Date).getTime();e.command("admin.$cmd",{ismaster:!0},{socketTimeout:"number"!=typeof e.s.options.connectionTimeout?2e3:e.s.options.connectionTimeout,monitoring:!0},(r,i)=>{e.lastIsMasterMS=(new Date).getTime()-n,e.s.pool.isDestroyed()||(i&&(e.ismaster=i.result),e.monitoringProcessId=setTimeout(t(e),e.s.monitoringInterval))})}}}(t),t.s.monitoringInterval)),m.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(t)}),t.s.inTopology||m.emitTopologyDescriptionChanged(t,{topologyType:"Single",servers:[{address:t.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(t)}]}),t.s.logger.isInfo()&&t.s.logger.info(i("server %s connected with ismaster [%s]",t.name,JSON.stringify(t.ismaster))),t.emit("connect",t)}else{if(E&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(e)&&(t.s.inTopology||t.emit("topologyOpening",{topologyId:t.id}),delete T[t.id]),"close"===e&&m.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===e)return t.emit("reconnectFailed",n),void(t.listeners("error").length>0&&t.emit("error",n));if(-1!==["disconnected","connecting"].indexOf(t.s.pool.state)&&t.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(e))return t.initialConnect=!1,t.emit("error",new f(i("failed to connect to server [%s] on first connect [%s]",t.name,n)));if("reconnect"===e)return m.emitServerDescriptionChanged(t,{address:t.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(t)}),t.emit(e,t);t.emit(e,n)}}};function N(t){return t.s.pool?t.s.pool.isDestroyed()?new h("server instance pool was destroyed"):void 0:new h("server instance is not connected")}A.prototype.connect=function(t){if(t=t||{},E&&(T[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new h(i("server instance in invalid state %s",this.s.pool.state));this.s.pool=new l(this,Object.assign(this.s.options,t,{bson:this.s.bson})),this.s.pool.on("close",x(this,"close")),this.s.pool.on("error",x(this,"error")),this.s.pool.on("timeout",x(this,"timeout")),this.s.pool.on("parseError",x(this,"parseError")),this.s.pool.on("connect",x(this,"connect")),this.s.pool.on("reconnect",x(this,"reconnect")),this.s.pool.on("reconnectFailed",x(this,"reconnectFailed")),b(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:I(this)}),this.emit("serverOpening",{topologyId:I(this),address:this.name}),this.s.pool.connect()},A.prototype.auth=function(t,e){"function"==typeof e&&e(null,null)},A.prototype.getDescription=function(){var t=this.ismaster||{},e={type:m.getTopologyType(this),address:this.name};return t.hosts&&(e.hosts=t.hosts),t.arbiters&&(e.arbiters=t.arbiters),t.passives&&(e.passives=t.passives),t.setName&&(e.setName=t.setName),e},A.prototype.lastIsMaster=function(){return this.ismaster},A.prototype.unref=function(){this.s.pool.unref()},A.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},A.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},A.prototype.command=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var o=function(t,e){if(N(t),e.readPreference&&!(e.readPreference instanceof s))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);return o?r(o):(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(i("executing command [%s] against %s",JSON.stringify({ns:t,cmd:e,options:c(S,n)}),this.name)),k(this,"command",t,e,n,r)?void 0:_(this,e)?r(new h(`server ${this.name} does not support collation`)):void p.command(this,t,e,n,r))},A.prototype.query=function(t,e,n,r,i){p.query(this,t,e,n,r,i)},A.prototype.getMore=function(t,e,n,r,i){p.getMore(this,t,e,n,r,i)},A.prototype.killCursors=function(t,e,n){p.killCursors(this,t,e,n)},A.prototype.insert=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var i=N(this);return i?r(i):k(this,"insert",t,e,n,r)?void 0:(e=Array.isArray(e)?e:[e],p.insert(this,t,e,n,r))},A.prototype.update=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var i=N(this);return i?r(i):k(this,"update",t,e,n,r)?void 0:_(this,n)?r(new h(`server ${this.name} does not support collation`)):(e=Array.isArray(e)?e:[e],p.update(this,t,e,n,r))},A.prototype.remove=function(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{});var i=N(this);return i?r(i):k(this,"remove",t,e,n,r)?void 0:_(this,n)?r(new h(`server ${this.name} does not support collation`)):(e=Array.isArray(e)?e:[e],p.remove(this,t,e,n,r))},A.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(r,t,e,n)},A.prototype.equals=function(t){return"string"==typeof t?this.name.toLowerCase()===t.toLowerCase():!!t.name&&this.name.toLowerCase()===t.name.toLowerCase()},A.prototype.connections=function(){return this.s.pool.allConnections()},A.prototype.selectServer=function(t,e,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t,t=void 0),n(null,this)};var P=["close","error","timeout","parseError","connect"];A.prototype.destroy=function(t,e){if(this._destroyed)"function"==typeof e&&e(null,null);else{"function"==typeof t&&(e=t,t={}),t=t||{};var n=this;if(E&&delete T[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),!n.s.pool)return this._destroyed=!0,void("function"==typeof e&&e(null,null));t.emitClose&&n.emit("close",n),t.emitDestroy&&n.emit("destroy",n),P.forEach((function(t){n.s.pool.removeAllListeners(t)})),n.listeners("serverClosed").length>0&&n.emit("serverClosed",{topologyId:I(n),address:n.name}),n.listeners("topologyClosed").length>0&&!n.s.inTopology&&n.emit("topologyClosed",{topologyId:I(n)}),n.s.logger.isDebug()&&n.s.logger.debug(i("destroy called on server %s",n.name)),this.s.pool.destroy(t.force,e),this._destroyed=!0}},t.exports=A},function(t,e,n){"use strict";const r=n(265),i=n(266),o=n(154),s=n(37).Query,a=n(5).MongoError,c=n(5).MongoNetworkError,u=n(160).defaultAuthProviders,l=n(157),h=n(9).makeClientMetadata,f=l.MAX_SUPPORTED_WIRE_VERSION,p=l.MAX_SUPPORTED_SERVER_VERSION,d=l.MIN_SUPPORTED_WIRE_VERSION,m=l.MIN_SUPPORTED_SERVER_VERSION;let y;function g(t){return"function"==typeof t.command}const v=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize","crl","rejectUnauthorized"];function b(t,e){const n="string"==typeof e.host?e.host:"localhost";return-1!==n.indexOf("/")?{path:n}:{family:t,host:n,port:"number"==typeof e.port?e.port:27017,rejectUnauthorized:!1}}const _=new Set(["error","close","timeout","parseError"]);const w=["error","close","timeout","parseError"];function S(t,e,n,r,i){if("function"==typeof r&&(i=r,r={}),g(t))return void t.command(e,n,r,(t,e)=>{t?i(t):i(void 0,e.result)});const o="number"==typeof r.socketTimeout?r.socketTimeout:36e4,c=t.options.bson,u=new s(c,e,n,{numberToSkip:0,numberToReturn:1}),l=()=>{};function h(t,e){i(t,e),i=l}function f(e){t.resetSocketTimeout(),w.forEach(e=>t.removeListener(e,f)),t.removeListener("message",p),null==e&&(e=new a(`runCommand failed for connection to '${t.address}'`)),t.on("error",l),h(e)}function p(e){e.responseTo===u.requestId&&(t.resetSocketTimeout(),w.forEach(e=>t.removeListener(e,f)),t.removeListener("message",p),e.parse({promoteValues:!0}),h(void 0,e.documents[0]))}t.setSocketTimeout(o),w.forEach(e=>t.once(e,f)),t.on("message",p),t.write(u.toBin())}t.exports=function(t,e,n){"function"==typeof e&&(n=e,e=void 0);const s=t&&t.connectionType?t.connectionType:o;null==y&&(y=u(t.bson)),function(t,e,n,o){const s="boolean"==typeof e.ssl&&e.ssl,a="boolean"!=typeof e.keepAlive||e.keepAlive;let u="number"==typeof e.keepAliveInitialDelay?e.keepAliveInitialDelay:3e5;const l="boolean"!=typeof e.noDelay||e.noDelay,h="number"==typeof e.connectionTimeout?e.connectionTimeout:"number"==typeof e.connectTimeoutMS?e.connectTimeoutMS:3e4,f="number"==typeof e.socketTimeout?e.socketTimeout:36e4,p="boolean"!=typeof e.rejectUnauthorized||e.rejectUnauthorized;u>f&&(u=Math.round(f/2));let d;const m=function(t,e){t&&d&&d.destroy(),o(t,e)};try{s?(d=i.connect(function(t,e){const n=b(t,e);for(const t in e)null!=e[t]&&-1!==v.indexOf(t)&&(n[t]=e[t]);!1===e.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof e.checkServerIdentity&&(n.checkServerIdentity=e.checkServerIdentity);null==n.servername&&(n.servername=n.host);return n}(t,e)),"function"==typeof d.disableRenegotiation&&d.disableRenegotiation()):d=r.createConnection(b(t,e))}catch(t){return m(t)}d.setKeepAlive(a,u),d.setTimeout(h),d.setNoDelay(l);const y=s?"secureConnect":"connect";let g;function w(t){return e=>{_.forEach(t=>d.removeAllListeners(t)),g&&n.removeListener("cancel",g),d.removeListener(y,S),m(function(t,e){switch(t){case"error":return new c(e);case"timeout":return new c("connection timed out");case"close":return new c("connection closed");case"cancel":return new c("connection establishment was cancelled");default:return new c("unknown network error")}}(t,e))}}function S(){if(_.forEach(t=>d.removeAllListeners(t)),g&&n.removeListener("cancel",g),d.authorizationError&&p)return m(d.authorizationError);d.setTimeout(f),m(null,d)}_.forEach(t=>d.once(t,w(t))),n&&(g=w("cancel"),n.once("cancel",g));d.once(y,S)}(void 0!==t.family?t.family:0,t,e,(e,r)=>{e?n(e,r):function(t,e,n){const r=function(e,r){e&&t&&t.destroy(),n(e,r)};let i=[];e.compression&&e.compression.compressors&&(i=e.compression.compressors);const o=Object.assign({ismaster:!0,client:e.metadata||h(e),compression:i},function(t){if(!t||!t.credentials)return{};const e=t.credentials,n=e.mechanism,r=e.source||t.dbName||"admin",i=e.username||t.user;if("string"==typeof n&&"DEFAULT"!==n.toUpperCase())return{};if(!i)return{};return{saslSupportedMechs:`${r}.${i}`}}(e)),s=Object.assign({},e);(e.connectTimeoutMS||e.connectionTimeout)&&(s.socketTimeout=e.connectTimeoutMS||e.connectionTimeout);const c=(new Date).getTime();S(t,"admin.$cmd",o,s,(n,o)=>{if(n)return void r(n);if(0===o.ok)return void r(new a(o));const s=function(t,e){const n=t&&"number"==typeof t.maxWireVersion&&t.maxWireVersion>=d,r=t&&"number"==typeof t.minWireVersion&&t.minWireVersion<=f;if(n){if(r)return null;const n=`Server at ${e.host}:${e.port} reports minimum wire version ${t.minWireVersion}, but this version of the Node.js Driver requires at most ${f} (MongoDB ${p})`;return new a(n)}const i=`Server at ${e.host}:${e.port} reports maximum wire version ${t.maxWireVersion||0}, but this version of the Node.js Driver requires at least ${d} (MongoDB ${m})`;return new a(i)}(o,e);if(s)return void r(s);if(!g(t)&&o.compression){const n=i.filter(t=>-1!==o.compression.indexOf(t));n.length&&(t.agreedCompressor=n[0]),e.compression&&e.compression.zlibCompressionLevel&&(t.zlibCompressionLevel=e.compression.zlibCompressionLevel)}t.ismaster=o,t.lastIsMasterMS=(new Date).getTime()-c;const u=e.credentials;if(!o.arbiterOnly&&u)return u.resolveAuthMechanism(o),void function(t,e,n){const r=e.mechanism;if(!y[r])return void n(new a(`authMechanism '${r}' not supported`));y[r].auth(S,[t],e,e=>{if(e)return n(e);n(void 0,t)})}(t,u,r);r(void 0,t)})}(new s(r,t),t,n)})}},function(t,e,n){"use strict";function r(t){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}r.prototype.peekAt=function(t){var e=t;if(e===(0|e)){var n=this.size();if(!(e>=n||e<-n))return e<0&&(e+=n),e=this._head+e&this._capacityMask,this._list[e]}},r.prototype.get=function(t){return this.peekAt(t)},r.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},r.prototype.peekFront=function(){return this.peek()},r.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(r.prototype,"length",{get:function(){return this.size()}}),r.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.unshift=function(t){if(void 0===t)return this.size();var e=this._list.length;return this._head=this._head-1+e&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.shift=function(){var t=this._head;if(t!==this._tail){var e=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),e}},r.prototype.push=function(t){if(void 0===t)return this.size();var e=this._tail;return this._list[e]=t,this._tail=e+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.pop=function(){var t=this._tail;if(t!==this._head){var e=this._list.length;this._tail=t-1+e&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=e>>>2&&this._shrinkArray(),n}},r.prototype.removeOne=function(t){var e=t;if(e===(0|e)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(e>=n||e<-n)){e<0&&(e+=n),e=this._head+e&this._capacityMask;var i,o=this._list[e];if(t<n/2){for(i=t;i>0;i--)this._list[e]=this._list[e=e-1+r&this._capacityMask];this._list[e]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(i=n-1-t;i>0;i--)this._list[e]=this._list[e=e+1+r&this._capacityMask];this._list[e]=void 0,this._tail=this._tail-1+r&this._capacityMask}return o}}},r.prototype.remove=function(t,e){var n,r=t,i=e;if(r===(0|r)&&this._head!==this._tail){var o=this.size(),s=this._list.length;if(!(r>=o||r<-o||e<1)){if(r<0&&(r+=o),1===e||!e)return(n=new Array(1))[0]=this.removeOne(r),n;if(0===r&&r+e>=o)return n=this.toArray(),this.clear(),n;var a;for(r+e>o&&(e=o-r),n=new Array(e),a=0;a<e;a++)n[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,t+e===o){for(this._tail=this._tail-e+s&this._capacityMask,a=e;a>0;a--)this._list[r=r+1+s&this._capacityMask]=void 0;return n}if(0===t){for(this._head=this._head+e+s&this._capacityMask,a=e-1;a>0;a--)this._list[r=r+1+s&this._capacityMask]=void 0;return n}if(r<o/2){for(this._head=this._head+t+e+s&this._capacityMask,a=t;a>0;a--)this.unshift(this._list[r=r-1+s&this._capacityMask]);for(r=this._head-1+s&this._capacityMask;i>0;)this._list[r=r-1+s&this._capacityMask]=void 0,i--;t<0&&(this._tail=r)}else{for(this._tail=r,r=r+e+s&this._capacityMask,a=o-(e+t);a>0;a--)this.push(this._list[r++]);for(r=this._tail;i>0;)this._list[r=r+1+s&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=s>>>2&&this._shrinkArray(),n}}},r.prototype.splice=function(t,e){var n=t;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var i,o,s,a=arguments.length,c=this._list.length,u=2;if(!r||n<r/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(0===e?(s=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(s=this.remove(n,e),this._head=this._head+n+c&this._capacityMask);a>u;)this.unshift(arguments[--a]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{var l=(o=new Array(r-(n+e))).length;for(i=0;i<l;i++)o[i]=this._list[this._head+n+e+i&this._capacityMask];for(0===e?(s=[],n!=r&&(this._tail=this._head+n+c&this._capacityMask)):(s=this.remove(n,e),this._tail=this._tail-l+c&this._capacityMask);u<a;)this.push(arguments[u++]);for(i=0;i<l;i++)this.push(o[i])}return s}return this.remove(n,e)}}},r.prototype.clear=function(){this._head=0,this._tail=0},r.prototype.isEmpty=function(){return this._head===this._tail},r.prototype.toArray=function(){return this._copyArray(!1)},r.prototype._fromArray=function(t){for(var e=0;e<t.length;e++)this.push(t[e])},r.prototype._copyArray=function(t){var e,n=[],r=this._list,i=r.length;if(t||this._head>this._tail){for(e=this._head;e<i;e++)n.push(r[e]);for(e=0;e<this._tail;e++)n.push(r[e])}else for(e=this._head;e<this._tail;e++)n.push(r[e]);return n},r.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},r.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.exports=r},function(t,e,n){var r=n(70),i=r.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,e),e.Buffer=s),o(i,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e){t.exports=require("dns")},function(t,e,n){"use strict";const r=n(123),i=n(13),o=n(174).isResumableError,s=n(3).MongoError,a=n(38),c=n(9).relayEvents,u=n(9).maxWireVersion,l=n(0).maybePromise,h=n(0).now,f=n(0).calculateDurationInMs,p=n(101),d=Symbol("resumeQueue"),m=["resumeAfter","startAfter","startAtOperationTime","fullDocument"],y=["batchSize","maxAwaitTimeMS","collation","readPreference"].concat(m),g={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};class v extends a{constructor(t,e,n){super(t,e,n),n=n||{},this._resumeToken=null,this.startAtOperationTime=n.startAtOperationTime,n.startAfter?this.resumeToken=n.startAfter:n.resumeAfter&&(this.resumeToken=n.resumeAfter)}set resumeToken(t){this._resumeToken=t,this.emit("resumeTokenChanged",t)}get resumeToken(){return this._resumeToken}get resumeOptions(){const t={};for(const e of y)this.options[e]&&(t[e]=this.options[e]);if(this.resumeToken||this.startAtOperationTime)if(["resumeAfter","startAfter","startAtOperationTime"].forEach(e=>delete t[e]),this.resumeToken){const e=this.options.startAfter&&!this.hasReceived?"startAfter":"resumeAfter";t[e]=this.resumeToken}else this.startAtOperationTime&&u(this.server)>=7&&(t.startAtOperationTime=this.startAtOperationTime);return t}cacheResumeToken(t){0===this.bufferedCount()&&this.cursorState.postBatchResumeToken?this.resumeToken=this.cursorState.postBatchResumeToken:this.resumeToken=t,this.hasReceived=!0}_processBatch(t,e){const n=e.cursor;n.postBatchResumeToken&&(this.cursorState.postBatchResumeToken=n.postBatchResumeToken,0===n[t].length&&(this.resumeToken=n.postBatchResumeToken))}_initializeCursor(t){super._initializeCursor((e,n)=>{if(e)return void t(e);const r=n.documents[0];null==this.startAtOperationTime&&null==this.resumeAfter&&null==this.startAfter&&u(this.server)>=7&&(this.startAtOperationTime=r.operationTime),this._processBatch("firstBatch",r),this.emit("init",n),this.emit("response"),t(e,n)})}_getMore(t){super._getMore((e,n)=>{e?t(e):(this._processBatch("nextBatch",n),this.emit("more",n),this.emit("response"),t(e,n))})}}function b(t,e){const n={fullDocument:e.fullDocument||"default"};_(n,e,m),t.type===g.CLUSTER&&(n.allChangesForCluster=!0);const r=[{$changeStream:n}].concat(t.pipeline),i=_({},e,y),o=new v(t.topology,new p(t.parent,r,e),i);if(c(o,t,["resumeTokenChanged","end","close"]),t.listenerCount("change")>0&&o.on("data",(function(e){w(t,e)})),o.on("error",(function(e){S(t,e)})),t.pipeDestinations){const e=o.stream(t.streamOptions);for(let n in t.pipeDestinations)e.pipe(n)}return o}function _(t,e,n){return n.forEach(n=>{e[n]&&(t[n]=e[n])}),t}function w(t,e,n){const r=t.cursor;if(!t.closed){if(e&&!e._id){const e=new Error("A change stream document has been received that lacks a resume token (_id).");return n?n(e):t.emit("error",e)}return r.cacheResumeToken(e._id),t.options.startAtOperationTime=void 0,n?n(void 0,e):t.emit("change",e)}n&&n(new s("ChangeStream is closed"))}function S(t,e,n){const r=t.topology,i=t.cursor;if(!t.closed)return i&&o(e,u(i.server))?(t.cursor=void 0,["data","close","end","error"].forEach(t=>i.removeAllListeners(t)),i.close(),void function t(e,n,r){setTimeout(()=>{n&&null==n.start&&(n.start=h());const i=n.start||h(),o=n.timeout||3e4,a=n.readPreference;return e.isConnected({readPreference:a})?r():f(i)>o?r(new s("Timed out waiting for connection")):void t(e,n,r)},500)}(r,{readPreference:i.options.readPreference},e=>{if(e)return c(e);const r=b(t,i.resumeOptions);if(!n)return a(r);r.hasNext(t=>{if(t)return c(t);a(r)})})):n?n(e):t.emit("error",e);function a(e){t.cursor=e,E(t)}function c(e){n||(t.emit("error",e),t.emit("close")),E(t,e),t.closed=!0}n&&n(new s("ChangeStream is closed"))}function O(t,e){t.isClosed()?e(new s("ChangeStream is closed.")):t.cursor?e(void 0,t.cursor):t[d].push(e)}function E(t,e){for(;t[d].length;){const n=t[d].pop();if(t.isClosed()&&!e)return void n(new s("Change Stream is not open."));n(e,t.cursor)}}t.exports=class extends i{constructor(t,e,i){super();const o=n(76),s=n(103),a=n(100);if(this.pipeline=e||[],this.options=i||{},this.parent=t,this.namespace=t.s.namespace,t instanceof o)this.type=g.COLLECTION,this.topology=t.s.db.serverConfig;else if(t instanceof s)this.type=g.DATABASE,this.topology=t.serverConfig;else{if(!(t instanceof a))throw new TypeError("parent provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=g.CLUSTER,this.topology=t.topology}this.promiseLibrary=t.s.promiseLibrary,!this.options.readPreference&&t.s.readPreference&&(this.options.readPreference=t.s.readPreference),this[d]=new r,this.cursor=b(this,i),this.closed=!1,this.on("newListener",t=>{"change"===t&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",t=>w(this,t))}),this.on("removeListener",t=>{"change"===t&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}get resumeToken(){return this.cursor.resumeToken}hasNext(t){return l(this.parent,t,t=>{O(this,(e,n)=>{if(e)return t(e);n.hasNext(t)})})}next(t){return l(this.parent,t,t=>{O(this,(e,n)=>{if(e)return t(e);n.next((e,n)=>{if(e)return this[d].push(()=>this.next(t)),void S(this,e,t);w(this,n,t)})})})}isClosed(){return this.closed||this.cursor&&this.cursor.isClosed()}close(t){return l(this.parent,t,t=>{if(this.closed)return t();if(this.closed=!0,!this.cursor)return t();const e=this.cursor;return e.close(n=>(["data","close","end","error"].forEach(t=>e.removeAllListeners(t)),this.cursor=void 0,t(n)))})}pipe(t,e){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(t),this.cursor.pipe(t,e)}unpipe(t){return this.pipeDestinations&&this.pipeDestinations.indexOf(t)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(t),1),this.cursor.unpipe(t)}stream(t){return this.streamOptions=t,this.cursor.stream(t)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(t,e,n){"use strict";t.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(t,e,n){"use strict";const r=n(3).BSON.Long,i=n(3).MongoError,o=n(3).BSON.ObjectID,s=n(3).BSON,a=n(3).MongoWriteConcernError,c=n(0).toError,u=n(0).handleCallback,l=n(0).applyRetryableWrites,h=n(0).applyWriteConcern,f=n(0).executeLegacyOperation,p=n(0).isPromiseLike,d=new s([s.Binary,s.Code,s.DBRef,s.Decimal128,s.Double,s.Int32,s.Long,s.Map,s.MaxKey,s.MinKey,s.ObjectId,s.BSONRegExp,s.Symbol,s.Timestamp]);class m{constructor(t){this.result=t}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(t){return this.result.upserted[t]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(t){return t<this.result.writeErrors.length?this.result.writeErrors[t]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let t="";for(let e=0;e<this.result.writeConcernErrors.length;e++){t+=this.result.writeConcernErrors[e].errmsg,0===e&&(t+=" and ")}return new y({errmsg:t,code:64})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class y{constructor(t){this.err=t}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class g{constructor(t){this.err=t}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function v(t,e,n,i){if(n)i=n;else if(i&&i.result)i=i.result;else if(null==i)return;if(0===i.ok&&1===e.ok){e.ok=0;const n={index:0,code:i.code||0,errmsg:i.message,op:t.operations[0]};return void e.writeErrors.push(new g(n))}if(0===i.ok&&0===e.ok)return;if(i.opTime||i.lastOp){const t=i.lastOp||i.opTime;let n=null,o=null;if(t&&"Timestamp"===t._bsontype)(null==e.lastOp||t.greaterThan(e.lastOp))&&(e.lastOp=t);else{e.lastOp&&(n="number"==typeof e.lastOp.ts?r.fromNumber(e.lastOp.ts):e.lastOp.ts,o="number"==typeof e.lastOp.t?r.fromNumber(e.lastOp.t):e.lastOp.t);const i="number"==typeof t.ts?r.fromNumber(t.ts):t.ts,s="number"==typeof t.t?r.fromNumber(t.t):t.t;(null==e.lastOp||i.greaterThan(n)||i.equals(n)&&s.greaterThan(o))&&(e.lastOp=t)}}1===t.batchType&&i.n&&(e.nInserted=e.nInserted+i.n),3===t.batchType&&i.n&&(e.nRemoved=e.nRemoved+i.n);let o=0;if(Array.isArray(i.upserted)){o=i.upserted.length;for(let n=0;n<i.upserted.length;n++)e.upserted.push({index:i.upserted[n].index+t.originalZeroIndex,_id:i.upserted[n]._id})}else i.upserted&&(o=1,e.upserted.push({index:t.originalZeroIndex,_id:i.upserted}));if(2===t.batchType&&i.n){const t=i.nModified;e.nUpserted=e.nUpserted+o,e.nMatched=e.nMatched+(i.n-o),e.nModified="number"==typeof t?e.nModified+t:null}if(Array.isArray(i.writeErrors))for(let n=0;n<i.writeErrors.length;n++){const r={index:t.originalIndexes[i.writeErrors[n].index],code:i.writeErrors[n].code,errmsg:i.writeErrors[n].errmsg,op:t.operations[i.writeErrors[n].index]};e.writeErrors.push(new g(r))}i.writeConcernError&&e.writeConcernErrors.push(new y(i.writeConcernError))}function b(t,e,n){if(0===t.s.batches.length)return u(n,null,new m(t.s.bulkResult));const r=t.s.batches.shift();t.finalOptionsHandler({options:e,batch:r,resultHandler:function(i,o){if((i&&i.driver||i&&i.message)&&!(i instanceof a))return u(n,i);if(i&&(i.ok=0),i instanceof a)return function(t,e,n,r){v(t,e,null,n.result);const i=new y({errmsg:n.result.writeConcernError.errmsg,code:n.result.writeConcernError.result});return u(r,new _(c(i),new m(e)),null)}(r,t.s.bulkResult,i,n);const s=new m(t.s.bulkResult);if(null!=v(r,t.s.bulkResult,i,o))return u(n,null,s);t.handleWriteError(n,s)||b(t,e,n)}},n)}class _ extends i{constructor(t,e){super(t.err||t.errmsg||t.errMessage||t),Object.assign(this,t),this.name="BulkWriteError",this.result=e}}class w{constructor(t){this.s=t.s}update(t){const e="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:t,multi:!0,upsert:e};return t.hint&&(n.hint=t.hint),this.s.currentOp=null,this.s.options.addToOperationsList(this,2,n)}updateOne(t){const e="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:t,multi:!1,upsert:e};return t.hint&&(n.hint=t.hint),this.s.currentOp=null,this.s.options.addToOperationsList(this,2,n)}replaceOne(t){this.updateOne(t)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const t={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,3,t)}delete(){const t={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,3,t)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class S{constructor(t,e,n,r){this.isOrdered=r,n=null==n?{}:n;const i=e.s.namespace,o=t.bson,s=t.lastIsMaster(),a=!(!t.s.options||!t.s.options.autoEncrypter),c=s&&s.maxBsonObjectSize?s.maxBsonObjectSize:16777216,u=a?2097152:c,f=s&&s.maxWriteBatchSize?s.maxWriteBatchSize:1e3,p=(f-1).toString(10).length+2;let d=Object.assign({},n);d=l(d,e.s.db),d=h(d,{collection:e},n);const m=d.writeConcern,y=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:m,maxBsonObjectSize:c,maxBatchSizeBytes:u,maxWriteBatchSize:f,maxKeySize:p,namespace:i,bson:o,topology:t,options:d,currentOp:null,executed:!1,collection:e,promiseLibrary:y,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(t){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==t._id&&(t._id=new o),this.s.options.addToOperationsList(this,1,t)}find(t){if(!t)throw c("Bulk find operation must specify a selector");return this.s.currentOp={selector:t},new w(this)}raw(t){const e=Object.keys(t)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(t.updateOne&&t.updateOne.q||t.updateMany&&t.updateMany.q||t.replaceOne&&t.replaceOne.q)return t[e].multi=!t.updateOne&&!t.replaceOne,this.s.options.addToOperationsList(this,2,t[e]);if(t.updateOne||t.updateMany||t.replaceOne){const n=!t.updateOne&&!t.replaceOne,r={q:t[e].filter,u:t[e].update||t[e].replacement,multi:n};return t[e].hint&&(r.hint=t[e].hint),this.isOrdered?(r.upsert=!!t[e].upsert,t.collation&&(r.collation=t.collation)):t[e].upsert&&(r.upsert=!0),t[e].arrayFilters&&(r.arrayFilters=t[e].arrayFilters),this.s.options.addToOperationsList(this,2,r)}if(t.removeOne||t.removeMany||t.deleteOne&&t.deleteOne.q||t.deleteMany&&t.deleteMany.q)return t[e].limit=t.removeOne?1:0,this.s.options.addToOperationsList(this,3,t[e]);if(t.deleteOne||t.deleteMany){const n=t.deleteOne?1:0,r={q:t[e].filter,limit:n};return this.isOrdered&&t.collation&&(r.collation=t.collation),this.s.options.addToOperationsList(this,3,r)}if(t.insertOne&&null==t.insertOne.document)return!0!==n&&null==t.insertOne._id&&(t.insertOne._id=new o),this.s.options.addToOperationsList(this,1,t.insertOne);if(t.insertOne&&t.insertOne.document)return!0!==n&&null==t.insertOne.document._id&&(t.insertOne.document._id=new o),this.s.options.addToOperationsList(this,1,t.insertOne.document);if(!t.insertMany)throw c("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let e=0;e<t.insertMany.length;e++)!0!==n&&null==t.insertMany[e]._id&&(t.insertMany[e]._id=new o),this.s.options.addToOperationsList(this,1,t.insertMany[e])}_handleEarlyError(t,e){if("function"!=typeof e)return this.s.promiseLibrary.reject(t);e(t,null)}bulkExecute(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},"function"==typeof t?n=t:t&&"object"==typeof t&&(this.s.writeConcern=t),this.s.executed){const t=c("batch cannot be re-executed");return this._handleEarlyError(t,n)}if(this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const t=c("Invalid Operation, no operations specified");return this._handleEarlyError(t,n)}return{options:e,callback:n}}execute(t,e,n){const r=this.bulkExecute(t,e,n);return!r||p(r)?r:(e=r.options,n=r.callback,f(this.s.topology,b,[this,e,n]))}finalOptionsHandler(t,e){const n=Object.assign({ordered:this.isOrdered},t.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(t.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(2===t.batch.batchType&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(t=>t.multi)),3===t.batch.batchType&&(n.retryWrites=n.retryWrites&&!t.batch.operations.some(t=>0===t.limit)));try{1===t.batch.batchType?this.s.topology.insert(this.s.namespace,t.batch.operations,n,t.resultHandler):2===t.batch.batchType?this.s.topology.update(this.s.namespace,t.batch.operations,n,t.resultHandler):3===t.batch.batchType&&this.s.topology.remove(this.s.namespace,t.batch.operations,n,t.resultHandler)}catch(n){n.ok=0,u(e,null,v(t.batch,this.s.bulkResult,n,null))}}handleWriteError(t,e){if(this.s.bulkResult.writeErrors.length>0){const n=this.s.bulkResult.writeErrors[0].errmsg?this.s.bulkResult.writeErrors[0].errmsg:"write operation failed";return u(t,new _(c({message:n,code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),e),null),!0}if(e.getWriteConcernError())return u(t,new _(c(e.getWriteConcernError()),e),null),!0}}Object.defineProperty(S.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),t.exports={Batch:class{constructor(t,e){this.originalZeroIndex=e,this.currentIndex=0,this.originalIndexes=[],this.batchType=t,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:S,bson:d,INSERT:1,UPDATE:2,REMOVE:3,BulkWriteError:_}},function(t,e,n){"use strict";const r=n(3).MongoError,i=n(38),o=n(35).CursorState,s=n(6).deprecate;class a extends i{constructor(t,e,n){super(t,e,n)}batchSize(t){if(this.s.state===o.CLOSED||this.isDead())throw r.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw r.create({message:"batchSize requires an integer",driver:!0});return this.operation.options.batchSize=t,this.setCursorBatchSize(t),this}geoNear(t){return this.operation.addToPipeline({$geoNear:t}),this}group(t){return this.operation.addToPipeline({$group:t}),this}limit(t){return this.operation.addToPipeline({$limit:t}),this}match(t){return this.operation.addToPipeline({$match:t}),this}maxTimeMS(t){return this.operation.options.maxTimeMS=t,this}out(t){return this.operation.addToPipeline({$out:t}),this}project(t){return this.operation.addToPipeline({$project:t}),this}lookup(t){return this.operation.addToPipeline({$lookup:t}),this}redact(t){return this.operation.addToPipeline({$redact:t}),this}skip(t){return this.operation.addToPipeline({$skip:t}),this}sort(t){return this.operation.addToPipeline({$sort:t}),this}unwind(t){return this.operation.addToPipeline({$unwind:t}),this}getLogger(){return this.logger}}a.prototype.get=a.prototype.toArray,s(a.prototype.geoNear,"The `$geoNear` stage is deprecated in MongoDB 4.0, and removed in version 4.2."),t.exports=a},function(t,e,n){"use strict";const r=n(3).ReadPreference,i=n(3).MongoError,o=n(38),s=n(35).CursorState;class a extends o{constructor(t,e,n,r){super(t,e,n,r)}setReadPreference(t){if(this.s.state===s.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if(this.s.state!==s.INIT)throw i.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(t instanceof r)this.options.readPreference=t;else{if("string"!=typeof t)throw new TypeError("Invalid read preference: "+t);this.options.readPreference=new r(t)}return this}batchSize(t){if(this.s.state===s.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if("number"!=typeof t)throw i.create({message:"batchSize requires an integer",driver:!0});return this.cmd.cursor&&(this.cmd.cursor.batchSize=t),this.setCursorBatchSize(t),this}maxTimeMS(t){return this.topology.lastIsMaster().minWireVersion>2&&(this.cmd.maxTimeMS=t),this}getLogger(){return this.logger}}a.prototype.get=a.prototype.toArray,t.exports=a},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(30),o=n(4).defineAspects,s=n(0).handleCallback;class a extends i{constructor(t,e){const n=Object.assign({},e,t.s.options);e.session&&(n.session=e.session),super(t,n)}execute(t){super.execute((e,n)=>e?s(t,e):n.ok?s(t,null,!0):void s(t,null,!1))}}o(a,r.WRITE_OPERATION);t.exports={DropOperation:a,DropCollectionOperation:class extends a{constructor(t,e,n){super(t,n),this.name=e,this.namespace=`${t.namespace}.${e}`}_buildCommand(){return{drop:this.name}}},DropDatabaseOperation:class extends a{_buildCommand(){return{dropDatabase:1}}}}},function(t,e,n){"use strict";let r,i,o;t.exports={loadCollection:function(){return r||(r=n(76)),r},loadCursor:function(){return i||(i=n(38)),i},loadDb:function(){return o||(o=n(103)),o}}},function(t,e,n){"use strict";t.exports=new Set(["__proto__","constructor","prototype"])},function(t,e,n){"use strict";var r=n(106),i=n(66),o=n(6),s=n(195),a=n(348)("mquery");function c(t,e){if(!(this instanceof c))return new c(t,e);var n=this.constructor.prototype;this.op=n.op||void 0,this.options=Object.assign({},n.options),this._conditions=n._conditions?s.clone(n._conditions):{},this._fields=n._fields?s.clone(n._fields):void 0,this._update=n._update?s.clone(n._update):void 0,this._path=n._path||void 0,this._distinct=n._distinct||void 0,this._collection=n._collection||void 0,this._traceFunction=n._traceFunction||void 0,e&&this.setOptions(e),t&&(t.find&&t.remove&&t.update?this.collection(t):this.find(t))}var u="$geoWithin";Object.defineProperty(c,"use$geoWithin",{get:function(){return"$geoWithin"==u},set:function(t){u=!0===t?"$geoWithin":"$within"}}),c.prototype.toConstructor=function(){function t(e,n){if(!(this instanceof t))return new t(e,n);c.call(this,e,n)}s.inherits(t,c);var e=t.prototype;return e.options={},e.setOptions(this.options),e.op=this.op,e._conditions=s.clone(this._conditions),e._fields=s.clone(this._fields),e._update=s.clone(this._update),e._path=this._path,e._distinct=this._distinct,e._collection=this._collection,e._traceFunction=this._traceFunction,t},c.prototype.setOptions=function(t){if(!t||!s.isObject(t))return this;for(var e,n=s.keys(t),r=0;r<n.length;++r)if("function"==typeof this[e=n[r]]){var i=s.isArray(t[e])?t[e]:[t[e]];this[e].apply(this,i)}else this.options[e]=t[e];return this},c.prototype.collection=function(t){return this._collection=new c.Collection(t),this},c.prototype.collation=function(t){return this.options.collation=t,this},c.prototype.$where=function(t){return this._conditions.$where=t,this},c.prototype.where=function(){if(!arguments.length)return this;this.op||(this.op="find");var t=typeof arguments[0];if("string"==t)return this._path=arguments[0],2===arguments.length&&(this._conditions[this._path]=arguments[1]),this;if("object"==t&&!Array.isArray(arguments[0]))return this.merge(arguments[0]);throw new TypeError("path must be a string or object")},c.prototype.equals=function(t){this._ensurePath("equals");var e=this._path;return this._conditions[e]=t,this},c.prototype.eq=function(t){this._ensurePath("eq");var e=this._path;return this._conditions[e]=t,this},c.prototype.or=function(t){var e=this._conditions.$or||(this._conditions.$or=[]);return s.isArray(t)||(t=[t]),e.push.apply(e,t),this},c.prototype.nor=function(t){var e=this._conditions.$nor||(this._conditions.$nor=[]);return s.isArray(t)||(t=[t]),e.push.apply(e,t),this},c.prototype.and=function(t){var e=this._conditions.$and||(this._conditions.$and=[]);return Array.isArray(t)||(t=[t]),e.push.apply(e,t),this},
/*!
 * gt, gte, lt, lte, ne, in, nin, all, regex, size, maxDistance
 *
 *     Thing.where('type').nin(array)
 */
"gt gte lt lte ne in nin all regex size maxDistance minDistance".split(" ").forEach((function(t){c.prototype[t]=function(){var e,n;1===arguments.length?(this._ensurePath(t),n=arguments[0],e=this._path):(n=arguments[1],e=arguments[0]);var r=null===this._conditions[e]||"object"==typeof this._conditions[e]?this._conditions[e]:this._conditions[e]={};return r["$"+t]=n,this}})),c.prototype.mod=function(){var t,e;1===arguments.length?(this._ensurePath("mod"),t=arguments[0],e=this._path):2!==arguments.length||s.isArray(arguments[1])?3===arguments.length?(t=r(arguments,1),e=arguments[0]):(t=arguments[1],e=arguments[0]):(this._ensurePath("mod"),t=r(arguments),e=this._path);var n=this._conditions[e]||(this._conditions[e]={});return n.$mod=t,this},c.prototype.exists=function(){var t,e;0===arguments.length?(this._ensurePath("exists"),t=this._path,e=!0):1===arguments.length?"boolean"==typeof arguments[0]?(this._ensurePath("exists"),t=this._path,e=arguments[0]):(t=arguments[0],e=!0):2===arguments.length&&(t=arguments[0],e=arguments[1]);var n=this._conditions[t]||(this._conditions[t]={});return n.$exists=e,this},c.prototype.elemMatch=function(){if(null==arguments[0])throw new TypeError("Invalid argument");var t,e,n;if("function"==typeof arguments[0])this._ensurePath("elemMatch"),e=this._path,t=arguments[0];else if(s.isObject(arguments[0]))this._ensurePath("elemMatch"),e=this._path,n=arguments[0];else if("function"==typeof arguments[1])e=arguments[0],t=arguments[1];else{if(!arguments[1]||!s.isObject(arguments[1]))throw new TypeError("Invalid argument");e=arguments[0],n=arguments[1]}t&&(t(n=new c),n=n._conditions);var r=this._conditions[e]||(this._conditions[e]={});return r.$elemMatch=n,this},c.prototype.within=function(){if(this._ensurePath("within"),this._geoComparison=u,0===arguments.length)return this;if(2===arguments.length)return this.box.apply(this,arguments);if(2<arguments.length)return this.polygon.apply(this,arguments);var t=arguments[0];if(!t)throw new TypeError("Invalid argument");if(t.center)return this.circle(t);if(t.box)return this.box.apply(this,t.box);if(t.polygon)return this.polygon.apply(this,t.polygon);if(t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")},c.prototype.box=function(){var t,e;if(3===arguments.length)t=arguments[0],e=[arguments[1],arguments[2]];else{if(2!==arguments.length)throw new TypeError("Invalid argument");this._ensurePath("box"),t=this._path,e=[arguments[0],arguments[1]]}var n=this._conditions[t]||(this._conditions[t]={});return n[this._geoComparison||u]={$box:e},this},c.prototype.polygon=function(){var t,e;"string"==typeof arguments[0]?(e=arguments[0],t=r(arguments,1)):(this._ensurePath("polygon"),e=this._path,t=r(arguments));var n=this._conditions[e]||(this._conditions[e]={});return n[this._geoComparison||u]={$polygon:t},this},c.prototype.circle=function(){var t,e;if(1===arguments.length)this._ensurePath("circle"),t=this._path,e=arguments[0];else{if(2!==arguments.length)throw new TypeError("Invalid argument");t=arguments[0],e=arguments[1]}if(!("radius"in e)||!e.center)throw new Error("center and radius are required");var n=this._conditions[t]||(this._conditions[t]={}),r=e.spherical?"$centerSphere":"$center",i=this._geoComparison||u;return n[i]={},n[i][r]=[e.center,e.radius],"unique"in e&&(n[i].$uniqueDocs=!!e.unique),this},c.prototype.near=function(){var t,e;if(this._geoComparison="$near",0===arguments.length)return this;if(1===arguments.length)this._ensurePath("near"),t=this._path,e=arguments[0];else{if(2!==arguments.length)throw new TypeError("Invalid argument");t=arguments[0],e=arguments[1]}if(!e.center)throw new Error("center is required");var n=this._conditions[t]||(this._conditions[t]={}),r=e.spherical?"$nearSphere":"$near";if(Array.isArray(e.center)){n[r]=e.center;var i="maxDistance"in e?e.maxDistance:null;null!=i&&(n.$maxDistance=i),null!=e.minDistance&&(n.$minDistance=e.minDistance)}else{if("Point"!=e.center.type||!Array.isArray(e.center.coordinates))throw new Error(o.format("Invalid GeoJSON specified for %s",r));n[r]={$geometry:e.center},"maxDistance"in e&&(n[r].$maxDistance=e.maxDistance),"minDistance"in e&&(n[r].$minDistance=e.minDistance)}return this},c.prototype.intersects=function(){if(this._ensurePath("intersects"),this._geoComparison="$geoIntersects",0===arguments.length)return this;var t=arguments[0];if(null!=t&&t.type&&t.coordinates)return this.geometry(t);throw new TypeError("Invalid argument")},c.prototype.geometry=function(){if("$within"!=this._geoComparison&&"$geoWithin"!=this._geoComparison&&"$near"!=this._geoComparison&&"$geoIntersects"!=this._geoComparison)throw new Error("geometry() must come after `within()`, `intersects()`, or `near()");var t,e;if(1!==arguments.length)throw new TypeError("Invalid argument");if(this._ensurePath("geometry"),e=this._path,!(t=arguments[0]).type||!Array.isArray(t.coordinates))throw new TypeError("Invalid argument");var n=this._conditions[e]||(this._conditions[e]={});return n[this._geoComparison]={$geometry:t},this},c.prototype.select=function(){var t=arguments[0];if(!t)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");var e,n,r=this._fields||(this._fields={}),i=typeof t;if(("string"==i||s.isArgumentsObject(t))&&"number"==typeof t.length||Array.isArray(t)){for("string"==i&&(t=t.split(/\s+/)),e=0,n=t.length;e<n;++e){var o=t[e];if(o){var a="-"==o[0]?0:1;0===a&&(o=o.substring(1)),r[o]=a}}return this}if(s.isObject(t)){var c=s.keys(t);for(e=0;e<c.length;++e)r[c[e]]=t[c[e]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},c.prototype.slice=function(){if(0===arguments.length)return this;var t,e;if(this._validate("slice"),1===arguments.length){var n=arguments[0];if("object"==typeof n&&!Array.isArray(n)){for(var i=Object.keys(n),o=i.length,s=0;s<o;++s)this.slice(i[s],n[i[s]]);return this}this._ensurePath("slice"),t=this._path,e=arguments[0]}else 2===arguments.length?"number"==typeof arguments[0]?(this._ensurePath("slice"),t=this._path,e=r(arguments)):(t=arguments[0],e=arguments[1]):3===arguments.length&&(t=arguments[0],e=r(arguments,1));var a=this._fields||(this._fields={});return a[t]={$slice:e},this},c.prototype.sort=function(t){if(!t)return this;var e,n,r;this._validate("sort");var i=typeof t;if(Array.isArray(t)){for(n=t.length,e=0;e<t.length;++e){if(!Array.isArray(t[e]))throw new Error("Invalid sort() argument, must be array of arrays");f(this.options,t[e][0],t[e][1])}return this}if(1===arguments.length&&"string"==i){for(n=(t=t.split(/\s+/)).length,e=0;e<n;++e)if(r=t[e]){var o="-"==r[0]?-1:1;-1===o&&(r=r.substring(1)),h(this.options,r,o)}return this}if(s.isObject(t)){var a=s.keys(t);for(e=0;e<a.length;++e)r=a[e],h(this.options,r,t[r]);return this}if("undefined"!=typeof Map&&t instanceof Map)return p(this.options,t),this;throw new TypeError("Invalid sort() argument. Must be a string, object, or array.")};
/*!
 * @ignore
 */
var l={1:1,"-1":-1,asc:1,ascending:1,desc:-1,descending:-1};function h(t,e,n){if(Array.isArray(t.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var r;if(n&&n.$meta)(r=t.sort||(t.sort={}))[e]={$meta:n.$meta};else{r=t.sort||(t.sort={});var i=String(n||1).toLowerCase();if(!(i=l[i]))throw new TypeError("Invalid sort value: { "+e+": "+n+" }");r[e]=i}}function f(t,e,n){if(t.sort=t.sort||[],!Array.isArray(t.sort))throw new TypeError("Can't mix sort syntaxes. Use either array or object:\n- `.sort([['field', 1], ['test', -1]])`\n- `.sort({ field: 1, test: -1 })`");var r=String(n||1).toLowerCase();if(!(r=l[r]))throw new TypeError("Invalid sort value: [ "+e+", "+n+" ]");t.sort.push([e,r])}function p(t,e){if(t.sort=t.sort||new Map,!(t.sort instanceof Map))throw new TypeError("Can't mix sort syntaxes. Use either array or object or map consistently");e.forEach((function(e,n){var r=String(e||1).toLowerCase();if(!(r=l[r]))throw new TypeError("Invalid sort value: < "+n+": "+e+" >");t.sort.set(n,r)}))}
/*!
 * limit, skip, maxScan, batchSize, comment
 *
 * Sets these associated options.
 *
 *     query.comment('feed query');
 */
/*!
 * Internal helper for update, updateMany, updateOne
 */
function d(t,e,n,r,i,o,u){return t.op=e,c.canMerge(n)&&t.merge(n),r&&t._mergeUpdate(r),s.isObject(i)&&t.setOptions(i),o||u?!t._update||!t.options.overwrite&&0===s.keys(t._update).length?(u&&s.soon(u.bind(null,null,0)),t):(i=t._optionsForExec(),u||(i.safe=!1),n=t._conditions,r=t._updateForExec(),a("update",t._collection.collectionName,n,r,i),u=t._wrapCallback(e,u,{conditions:n,doc:r,options:i}),t._collection[e](n,r,i,s.tick(u)),t):t}["limit","skip","maxScan","batchSize","comment"].forEach((function(t){c.prototype[t]=function(e){return this._validate(t),this.options[t]=e,this}})),c.prototype.maxTime=c.prototype.maxTimeMS=function(t){return this._validate("maxTime"),this.options.maxTimeMS=t,this},c.prototype.snapshot=function(){return this._validate("snapshot"),this.options.snapshot=!arguments.length||!!arguments[0],this},c.prototype.hint=function(){if(0===arguments.length)return this;this._validate("hint");var t=arguments[0];if(s.isObject(t)){var e=this.options.hint||(this.options.hint={});for(var n in t)e[n]=t[n];return this}if("string"==typeof t)return this.options.hint=t,this;throw new TypeError("Invalid hint. "+t)},c.prototype.j=function(t){return this.options.j=t,this},c.prototype.slaveOk=function(t){return this.options.slaveOk=!arguments.length||!!t,this},c.prototype.read=c.prototype.setReadPreference=function(t){return arguments.length>1&&!c.prototype.read.deprecationWarningIssued&&(console.error("Deprecation warning: 'tags' argument is not supported anymore in Query.read() method. Please use mongodb.ReadPreference object instead."),c.prototype.read.deprecationWarningIssued=!0),this.options.readPreference=s.readPref(t),this},c.prototype.readConcern=c.prototype.r=function(t){return this.options.readConcern=s.readConcern(t),this},c.prototype.tailable=function(){return this._validate("tailable"),this.options.tailable=!arguments.length||!!arguments[0],this},c.prototype.writeConcern=c.prototype.w=function(t){return"object"==typeof t?(void 0!==t.j&&(this.options.j=t.j),void 0!==t.w&&(this.options.w=t.w),void 0!==t.wtimeout&&(this.options.wtimeout=t.wtimeout)):this.options.w="m"===t?"majority":t,this},c.prototype.wtimeout=c.prototype.wTimeout=function(t){return this.options.wtimeout=t,this},c.prototype.merge=function(t){if(!t)return this;if(!c.canMerge(t))throw new TypeError("Invalid argument. Expected instanceof mquery or plain object");return t instanceof c?(t._conditions&&s.merge(this._conditions,t._conditions),t._fields&&(this._fields||(this._fields={}),s.merge(this._fields,t._fields)),t.options&&(this.options||(this.options={}),s.merge(this.options,t.options)),t._update&&(this._update||(this._update={}),s.mergeClone(this._update,t._update)),t._distinct&&(this._distinct=t._distinct),this):(s.merge(this._conditions,t),this)},c.prototype.find=function(t,e){if(this.op="find","function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec(),a("find",this._collection.collectionName,n,r),e=this._wrapCallback("find",e,{conditions:n,options:r}),this._collection.find(n,r,s.tick(e)),this},c.prototype.cursor=function(t){if(this.op){if("find"!==this.op)throw new TypeError(".cursor only support .find method")}else this.find(t);var e=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),a("findCursor",this._collection.collectionName,e,n),this._collection.findCursor(e,n)},c.prototype.findOne=function(t,e){if(this.op="findOne","function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec(),a("findOne",this._collection.collectionName,n,r),e=this._wrapCallback("findOne",e,{conditions:n,options:r}),this._collection.findOne(n,r,s.tick(e)),this},c.prototype.count=function(t,e){if(this.op="count",this._validate(),"function"==typeof t?(e=t,t=void 0):c.canMerge(t)&&this.merge(t),!e)return this;var n=this._conditions,r=this._optionsForExec();return a("count",this._collection.collectionName,n,r),e=this._wrapCallback("count",e,{conditions:n,options:r}),this._collection.count(n,r,s.tick(e)),this},c.prototype.distinct=function(t,e,n){if(this.op="distinct",this._validate(),!n){switch(typeof e){case"function":n=e,"string"==typeof t&&(e=t,t=void 0);break;case"undefined":case"string":break;default:throw new TypeError("Invalid `field` argument. Must be string or function")}switch(typeof t){case"function":n=t,t=e=void 0;break;case"string":e=t,t=void 0}}if("string"==typeof e&&(this._distinct=e),c.canMerge(t)&&this.merge(t),!n)return this;if(!this._distinct)throw new Error("No value for `distinct` has been declared");var r=this._conditions,i=this._optionsForExec();return a("distinct",this._collection.collectionName,r,i),n=this._wrapCallback("distinct",n,{conditions:r,options:i}),this._collection.distinct(this._distinct,r,i,s.tick(n)),this},c.prototype.update=function(t,e,n,r){var i;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":i=t,t=void 0;break;default:e=t,t=n=void 0}}return d(this,"update",t,e,n,i,r)},c.prototype.updateMany=function(t,e,n,r){var i;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":i=t,t=void 0;break;default:e=t,t=n=void 0}}return d(this,"updateMany",t,e,n,i,r)},c.prototype.updateOne=function(t,e,n,r){var i;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":i=t,t=void 0;break;default:e=t,t=n=void 0}}return d(this,"updateOne",t,e,n,i,r)},c.prototype.replaceOne=function(t,e,n,r){var i;switch(arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0);break;case 1:switch(typeof t){case"function":r=t,t=n=e=void 0;break;case"boolean":i=t,t=void 0;break;default:e=t,t=n=void 0}}return this.setOptions({overwrite:!0}),d(this,"replaceOne",t,e,n,i,r)},c.prototype.remove=function(t,e){var n;if(this.op="remove","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1);var i=this._conditions;return a("remove",this._collection.collectionName,i,r),e=this._wrapCallback("remove",e,{conditions:i,options:r}),this._collection.remove(i,r,s.tick(e)),this},c.prototype.deleteOne=function(t,e){var n;if(this.op="deleteOne","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1),delete r.justOne;var i=this._conditions;return a("deleteOne",this._collection.collectionName,i,r),e=this._wrapCallback("deleteOne",e,{conditions:i,options:r}),this._collection.deleteOne(i,r,s.tick(e)),this},c.prototype.deleteMany=function(t,e){var n;if(this.op="deleteMany","function"==typeof t?(e=t,t=void 0):c.canMerge(t)?this.merge(t):!0===t&&(n=t,t=void 0),!n&&!e)return this;var r=this._optionsForExec();e||(r.safe=!1),delete r.justOne;var i=this._conditions;return a("deleteOne",this._collection.collectionName,i,r),e=this._wrapCallback("deleteOne",e,{conditions:i,options:r}),this._collection.deleteMany(i,r,s.tick(e)),this},c.prototype.findOneAndUpdate=function(t,e,n,r){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:"function"==typeof n&&(r=n,n={});break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0),n=void 0;break;case 1:"function"==typeof t?(r=t,t=n=e=void 0):(e=t,t=n=void 0)}return c.canMerge(t)&&this.merge(t),e&&this._mergeUpdate(e),n&&this.setOptions(n),r?this._findAndModify("update",r):this},c.prototype.findOneAndRemove=c.prototype.findOneAndDelete=function(t,e,n){return this.op="findOneAndRemove",this._validate(),"function"==typeof e?(n=e,e=void 0):"function"==typeof t&&(n=t,t=void 0),c.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?this._findAndModify("remove",n):this},c.prototype._findAndModify=function(t,e){i.equal("function",typeof e);var n,r=this._optionsForExec();if("remove"==t)r.remove=!0;else if("new"in r||(r.new=!0),"upsert"in r||(r.upsert=!1),!(n=this._updateForExec())){if(!r.upsert)return this.findOne(e);n={$set:{}}}null!=this._fieldsForExec()&&(this.$useProjection?r.projection=this._fieldsForExec():r.fields=this._fieldsForExec());var o=this._conditions;return a("findAndModify",this._collection.collectionName,o,n,r),e=this._wrapCallback("findAndModify",e,{conditions:o,doc:n,options:r}),this._collection.findAndModify(o,n,r,s.tick(e)),this},c.prototype._wrapCallback=function(t,e,n){var r=this._traceFunction||c.traceFunction;if(r){n.collectionName=this._collection.collectionName;var i=r&&r.call(null,t,n,this),o=(new Date).getTime();return function(t,n){if(i){var r=(new Date).getTime()-o;i.call(null,t,n,r)}e&&e.apply(null,arguments)}}return e},c.prototype.setTraceFunction=function(t){return this._traceFunction=t,this},c.prototype.exec=function(t,e){switch(typeof t){case"function":e=t,t=null;break;case"string":this.op=t}i.ok(this.op,"Missing query type: (find, update, etc)"),"update"!=this.op&&"remove"!=this.op||e||(e=!0);var n=this;if("function"!=typeof e)return new c.Promise((function(t,e){n[n.op]((function(n,r){n?e(n):t(r),t=e=null}))}));this[this.op](e)},c.prototype.thunk=function(){var t=this;return function(e){t.exec(e)}},c.prototype.then=function(t,e){var n=this;return new c.Promise((function(t,e){n.exec((function(n,r){n?e(n):t(r),t=e=null}))})).then(t,e)},c.prototype.stream=function(t){if("find"!=this.op)throw new Error("stream() is only available for find");var e=this._conditions,n=this._optionsForExec();return this.$useProjection?n.projection=this._fieldsForExec():n.fields=this._fieldsForExec(),a("stream",this._collection.collectionName,e,n,t),this._collection.findStream(e,n,t)},c.prototype.selected=function(){return!!(this._fields&&Object.keys(this._fields).length>0)},c.prototype.selectedInclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(0===t.length)return!1;for(var e=0;e<t.length;++e){var n=t[e];if(0===this._fields[n])return!1;if(this._fields[n]&&"object"==typeof this._fields[n]&&this._fields[n].$meta)return!1}return!0},c.prototype.selectedExclusively=function(){if(!this._fields)return!1;var t=Object.keys(this._fields);if(0===t.length)return!1;for(var e=0;e<t.length;++e){var n=t[e];if(0===this._fields[n])return!0}return!1},c.prototype._mergeUpdate=function(t){this._update||(this._update={}),t instanceof c?t._update&&s.mergeClone(this._update,t._update):s.mergeClone(this._update,t)},c.prototype._optionsForExec=function(){return s.clone(this.options)},c.prototype._fieldsForExec=function(){return s.clone(this._fields)},c.prototype._updateForExec=function(){for(var t=s.clone(this._update),e=s.keys(t),n=e.length,r={};n--;){var i=e[n];this.options.overwrite?r[i]=t[i]:"$"!==i[0]?(r.$set||(t.$set?r.$set=t.$set:r.$set={}),r.$set[i]=t[i],e.splice(n,1),~e.indexOf("$set")||e.push("$set")):"$set"===i&&r.$set||(r[i]=t[i])}return this._compiledUpdate=r,r},c.prototype._ensurePath=function(t){if(!this._path)throw new Error(t+"() must be used after where() when called with these arguments")},
/*!
 * Permissions
 */
c.permissions=n(355),c._isPermitted=function(t,e){var n=c.permissions[e];return!n||!0!==n[t]},c.prototype._validate=function(t){var e,n;if(void 0===t){if("function"!=typeof(n=c.permissions[this.op]))return!0;e=n(this)}else c._isPermitted(t,this.op)||(e=t);if(e)throw new Error(e+" cannot be used with "+this.op)},c.canMerge=function(t){return t instanceof c||s.isObject(t)},c.setGlobalTraceFunction=function(t){c.traceFunction=t},
/*!
 * Exports.
 */
c.utils=s,c.env=n(197),c.Collection=n(356),c.BaseCollection=n(109),c.Promise=n(358),t.exports=c},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17),i=n(6);class o extends r{
/*!
   * OverwriteModel Error constructor.
   */
constructor(t,e,n,o){let s;const a=r.messages;s=null!=a.DocumentNotFoundError?"function"==typeof a.DocumentNotFoundError?a.DocumentNotFoundError(t,e):a.DocumentNotFoundError:'No document found for query "'+i.inspect(t)+'" on model "'+e+'"',super(s),this.result=o,this.numAffected=n,this.filter=t,this.query=t}}Object.defineProperty(o.prototype,"name",{value:"DocumentNotFoundError"}),
/*!
 * exports
 */
t.exports=o},function(t,e,n){"use strict";const r=n(137);
/*!
 * ignore
 */t.exports=function(t){const e=null!=this?this.path:null;return r(t,e)}},function(t,e,n){"use strict";const r=n(31);
/*!
 * Given a value, cast it to a boolean, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {CastError} if `value` is not one of the allowed values
 * @api private
 */t.exports=function(e,n){if(t.exports.convertToTrue.has(e))return!0;if(t.exports.convertToFalse.has(e))return!1;if(null==e)return e;throw new r("boolean",e,n)},t.exports.convertToTrue=new Set([!0,"true",1,"1","yes"]),t.exports.convertToFalse=new Set([!1,"false",0,"0","no"])},function(t,e,n){"use strict";function r(t,e){this.path=e,this.getters=[],this.setters=[],this.options=Object.assign({},t)}r.prototype._applyDefaultGetters=function(){if(this.getters.length>0||this.setters.length>0)return;const t="$"+this.path;this.getters.push((function(){return this[t]})),this.setters.push((function(e){this[t]=e}))},
/*!
 * ignore
 */
r.prototype.clone=function(){const t=new r(this.options,this.path);return t.getters=[].concat(this.getters),t.setters=[].concat(this.setters),t},r.prototype.get=function(t){return this.getters.push(t),this},r.prototype.set=function(t){return this.setters.push(t),this},r.prototype.applyGetters=function(t,e){let n=t;for(let t=this.getters.length-1;t>=0;t--)n=this.getters[t].call(e,n,this,e);return n},r.prototype.applySetters=function(t,e){let n=t;for(let t=this.setters.length-1;t>=0;t--)n=this.setters[t].call(e,n,this,e);return n},
/*!
 * exports
 */
t.exports=r},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * Apply query middleware
 *
 * @param {Query} query constructor
 * @param {Model} model
 */
function r(t,e){const n={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0},i=e.hooks.filter(t=>{const e=function(t){const e={};t.hasOwnProperty("query")&&(e.query=t.query);t.hasOwnProperty("document")&&(e.document=t.document);return e}(t);return"updateOne"===t.name?null==e.query||!!e.query:"deleteOne"===t.name?!!e.query||0===Object.keys(e).length:"validate"!==t.name&&"remove"!==t.name||!!e.query});t.prototype._execUpdate=i.createWrapper("update",t.prototype._execUpdate,null,n),t.prototype.__distinct=i.createWrapper("distinct",t.prototype.__distinct,null,n),t.prototype.validate=i.createWrapper("validate",t.prototype.validate,null,n),r.middlewareFunctions.filter(t=>"update"!==t&&"distinct"!==t&&"validate"!==t).forEach(e=>{t.prototype[`_${e}`]=i.createWrapper(e,t.prototype[`_${e}`],null,n)})}t.exports=r,
/*!
 * ignore
 */
r.middlewareFunctions=["count","countDocuments","deleteMany","deleteOne","distinct","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndRemove","findOneAndReplace","findOneAndUpdate","remove","replaceOne","update","updateMany","updateOne","validate"]},function(t,e,n){"use strict";const r=n(78),i=n(24);
/*!
 * Register hooks for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
function o(t,e,n){const s={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0,contextParameter:!0},a=(n=n||{}).decorateDoc?t:t.prototype;t.$appliedHooks=!0;for(const t of Object.keys(e.paths)){const r=e.paths[t];let i=null;if(r.$isSingleNested)i=r.caster;else{if(!r.$isMongooseDocumentArray)continue;i=r.Constructor}if(!i.$appliedHooks&&(o(i,r.schema,n),null!=i.discriminators)){const t=Object.keys(i.discriminators);for(const e of t)o(i.discriminators[e],i.discriminators[e].schema,n)}}const c=e.s.hooks.filter(t=>"updateOne"===t.name||"deleteOne"===t.name?!!t.document:"remove"!==t.name||(null==t.document||!!t.document)).filter(t=>!e.methods[t.name]||!t.fn[r.builtInMiddleware]);t._middleware=c,a.$__originalValidate=a.$__originalValidate||a.$__validate;for(const t of["save","validate","remove","deleteOne"]){const e="validate"===t?"$__originalValidate":`$__${t}`,n=c.createWrapper(t,a[e],null,s);a[`$__${t}`]=n}a.$__init=c.createWrapperSync("init",a.$__init,null,s);const u=Object.keys(e.methods),l=Object.assign({},s,{checkForPromise:!0});for(const e of u){if(!c.hasHooks(e))continue;const n=a[e];a[e]=function(){const n=Array.prototype.slice.call(arguments),r=n.slice(-1).pop(),o="function"==typeof r?n.slice(0,n.length-1):n;return i(r,t=>this[`$__${e}`].apply(this,o.concat([t])),t.events)},a[`$__${e}`]=c.createWrapper(e,n,null,l)}}
/*!
 * ignore
 */
t.exports=o,
/*!
 * ignore
 */
o.middlewareFunctions=["deleteOne","save","validate","remove","updateOne","init"]},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(136),i=n(205),o=n(28),s=n(402),a=n(25),c=a.CastError,u=n(77),l=n(403),h=n(80),f=n(11),p=n(142),d=n(6),m=n(12),y=n(112).castToNumber,g=n(217),v=n(39);let b,_;const w=Symbol("mongoose#isNestedArray");function S(t,e,r,i){_||(_=n(143).Embedded);let o,s,c="type";if(i&&i.typeKey&&(c=i.typeKey),this.schemaOptions=i,e){let r={};m.isPOJO(e)&&(e[c]?(r=m.clone(e),delete r[c],e=e[c]):e=u),e===Object&&(e=u);const i="string"==typeof e?e:m.getFunctionName(e),o=n(111),s=o.hasOwnProperty(i)?o[i]:e;this.casterConstructor=s,this.casterConstructor instanceof S&&(this.casterConstructor[w]=!0),"function"!=typeof s||s.$isArraySubdocument||s.$isSchemaMap?this.caster=s:this.caster=new s(null,r),this.$embeddedSchemaType=this.caster,this.caster instanceof _||(this.caster.path=t)}if(this.$isMongooseArray=!0,a.call(this,t,r,"Array"),null!=this.defaultValue&&(o=this.defaultValue,s="function"==typeof o),!("defaultValue"in this)||void 0!==this.defaultValue){const t=function(){let t=[];return s?t=o.call(this):null!=o&&(t=t.concat(o)),t};t.$runBeforeSetters=!0,this.default(t)}}S.schemaName="Array",S.options={castNonArrays:!0},S.defaultOptions={},S.set=a.set,
/*!
 * Inherits from SchemaType.
 */
S.prototype=Object.create(a.prototype),S.prototype.constructor=S,S.prototype.OptionsConstructor=s,
/*!
 * ignore
 */
S._checkRequired=a.prototype.checkRequired,S.checkRequired=a.checkRequired,S.prototype.checkRequired=function(t,e){if(a._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():S.checkRequired())(t)},S.prototype.enum=function(){let t=this;for(;;){const e=f(t,"caster.instance");if("Array"!==e){if("String"!==e&&"Number"!==e)throw new Error("`enum` can only be set on an array of strings or numbers , not "+e);break}t=t.caster}return t.caster.enum.apply(t.caster,arguments),this},S.prototype.applyGetters=function(t,e){return this.caster.options&&this.caster.options.ref?t:a.prototype.applyGetters.call(this,t,e)},S.prototype._applySetters=function(t,e,n,r){if(this.casterConstructor instanceof S&&S.options.castNonArrays&&!this[w]){let e=0,n=this;for(;null!=n&&n instanceof S&&!n.$isMongooseDocumentArray;)++e,n=n.casterConstructor;if(null!=t&&t.length>0){const n=l(t);if(n.min===n.max&&n.max<e&&n.containsNonArrayItem)for(let r=n.max;r<e;++r)t=[t]}}return a.prototype._applySetters.call(this,t,e,n,r)},S.prototype.cast=function(t,e,r,i,s){let a,l;if(b||(b=n(143).Array),Array.isArray(t)){if(!t.length&&e){const t=e.schema.indexedPaths(),n=this.path;for(a=0,l=t.length;a<l;++a){const e=t[a][0][n];if("2dsphere"===e||"2d"===e)return}const r=this.path.endsWith(".coordinates")?this.path.substr(0,this.path.lastIndexOf(".")):null;if(null!=r)for(a=0,l=t.length;a<l;++a){if("2dsphere"===t[a][0][r])return}}if(t&&t.isMongooseArray?t&&t.isMongooseArray&&(t=new b(t,this.path,e)):t=new b(t,this.path,e),null!=e&&null!=e.$__&&e.populated(this.path))return t;if(this.caster&&this.casterConstructor!==u)try{for(a=0,l=t.length;a<l;a++){if("Number"===this.caster.instance&&void 0===t[a])throw new o("Mongoose number arrays disallow storing undefined");const n={};null!=s&&null!=s.arrayPath?n.arrayPath=s.arrayPath+"."+a:null!=this.caster._arrayPath&&(n.arrayPath=this.caster._arrayPath.slice(0,-2)+"."+a),t[a]=this.caster.cast(t[a],e,r,void 0,n)}}catch(e){throw new c("["+e.kind+"]",d.inspect(t),this.path,e,this)}return t}if(r||S.options.castNonArrays)return e&&r&&e.markModified(this.path),this.cast([t],e,r);throw new c("Array",d.inspect(t),this.path,null,this)},
/*!
 * Ignore
 */
S.prototype.discriminator=function(t,e){let n=this;for(;n.$isMongooseArray&&!n.$isMongooseDocumentArray;)if(n=n.casterConstructor,null==n||"function"==typeof n)throw new o("You can only add an embedded discriminator on a document array, "+this.path+" is a plain array");return n.discriminator(t,e)},
/*!
 * ignore
 */
S.prototype.clone=function(){const t=Object.assign({},this.options),e=new this.constructor(this.path,this.caster,t,this.schemaOptions);return e.validators=this.validators.slice(),void 0!==this.requiredValidator&&(e.requiredValidator=this.requiredValidator),e},S.prototype.castForQuery=function(t,e){let n,r;if(2===arguments.length){if(n=this.$conditionalHandlers[t],!n)throw new Error("Can't use "+t+" with Array.");r=n.call(this,e)}else{r=t;let e=this.casterConstructor;if(r&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if("string"==typeof r[e.schema.options.discriminatorKey]&&e.discriminators[r[e.schema.options.discriminatorKey]])e=e.discriminators[r[e.schema.options.discriminatorKey]];else{const t=v(e,r[e.schema.options.discriminatorKey]);t&&(e=t)}const n=this.casterConstructor.prototype;let i=n&&(n.castForQuery||n.cast);!i&&e.castForQuery&&(i=e.castForQuery);const o=this.caster;Array.isArray(r)?(this.setters.reverse().forEach(t=>{r=t.call(this,r,this)}),r=r.map((function(t){return m.isObject(t)&&t.$elemMatch?t:i?t=i.call(o,t):null!=t?t=new e(t):t}))):i?r=i.call(o,r):null!=r&&(r=new e(r))}return r};const O=S.prototype.$conditionalHandlers={};O.$all=function(t){return Array.isArray(t)||(t=[t]),t=t.map((function(t){if(m.isObject(t)){const e={};return e[this.path]=t,h(this.casterConstructor.schema,e)[this.path]}return t}),this),this.castForQuery(t)},O.$options=String,O.$elemMatch=function(t){const e=Object.keys(t),n=e.length;for(let r=0;r<n;++r){const n=e[r],i=t[n];p(n)&&null!=i&&(t[n]=this.castForQuery(n,i))}const r=f(this,"casterConstructor.schema.options.discriminatorKey"),i=f(this,"casterConstructor.schema.discriminators",{});return null!=r&&null!=t[r]&&null!=i[t[r]]?h(i[t[r]],t):h(this.casterConstructor.schema,t)},O.$geoIntersects=g.cast$geoIntersects,O.$or=O.$and=function(t){if(!Array.isArray(t))throw new TypeError("conditional $or/$and require array");const e=[];for(const n of t)e.push(h(this.casterConstructor.schema,n));return e},O.$near=O.$nearSphere=g.cast$near,O.$within=O.$geoWithin=g.cast$within,O.$size=O.$minDistance=O.$maxDistance=y,O.$exists=r,O.$type=i,O.$eq=O.$gt=O.$gte=O.$lt=O.$lte=O.$ne=O.$regex=S.prototype.castForQuery,O.$nin=a.prototype.$conditionalHandlers.$nin,O.$in=a.prototype.$conditionalHandlers.$in,
/*!
 * Module exports.
 */
t.exports=S},function(t,e,n){"use strict";const r=new Set(["$ref","$id","$db"]);t.exports=function(t){return t.startsWith("$")&&!r.has(t)}},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.Array=n(218),e.Buffer=n(144),e.Document=e.Embedded=n(81),e.DocumentArray=n(52),e.Decimal128=n(63),e.ObjectId=n(42),e.Map=n(223),e.Subdocument=n(225)},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(33).get().Binary,i=n(12),o=n(29).Buffer;function s(t,e,n){const r=arguments.length;let a,u,l,h,f;return a=0===r||null===arguments[0]||void 0===arguments[0]?0:t,Array.isArray(e)?(l=e[0],h=e[1]):u=e,f="number"==typeof a||a instanceof Number?o.alloc(a):o.from(a,u,n),i.decorate(f,s.mixin),f.isMongooseBuffer=!0,f[s.pathSymbol]=l,f[c]=h,f._subtype=0,f}const a=Symbol.for("mongoose#Buffer#_path"),c=Symbol.for("mongoose#Buffer#_parent");s.pathSymbol=a,
/*!
 * Inherit from Buffer.
 */
s.mixin={_subtype:void 0,_markModified:function(){const t=this[c];return t&&t.markModified(this[s.pathSymbol]),this},write:function(){const t=o.prototype.write.apply(this,arguments);return t>0&&this._markModified(),t},copy:function(t){const e=o.prototype.copy.apply(this,arguments);return t&&t.isMongooseBuffer&&t._markModified(),e}},
/*!
 * Compile other Buffer methods marking this buffer as modified.
 */
"writeUInt8 writeUInt16 writeUInt32 writeInt8 writeInt16 writeInt32 writeFloat writeDouble fill utf8Write binaryWrite asciiWrite set writeUInt16LE writeUInt16BE writeUInt32LE writeUInt32BE writeInt16LE writeInt16BE writeInt32LE writeInt32BE writeFloatLE writeFloatBE writeDoubleLE writeDoubleBE".split(" ").forEach((function(t){o.prototype[t]&&(s.mixin[t]=function(){const e=o.prototype[t].apply(this,arguments);return this._markModified(),e})})),s.mixin.toObject=function(t){const e="number"==typeof t?t:this._subtype||0;return new r(o.from(this),e)},s.mixin.toBSON=function(){return new r(this,this._subtype||0)},s.mixin.equals=function(t){if(!o.isBuffer(t))return!1;if(this.length!==t.length)return!1;for(let e=0;e<this.length;++e)if(this[e]!==t[e])return!1;return!0},s.mixin.subtype=function(t){if("number"!=typeof t)throw new TypeError("Invalid subtype. Expected a number");this._subtype!==t&&this._markModified(),this._subtype=t},
/*!
 * Module exports.
 */
s.Binary=r,t.exports=s},function(t,e,n){"use strict";const r=n(146).defineKey,i=n(11),o=n(12),s={toJSON:!0,toObject:!0,_id:!0,id:!0};
/*!
 * ignore
 */
t.exports=function(t,e,n,a,c){if(!n||!n.instanceOfSchema)throw new Error("You must pass a valid discriminator Schema");if(t.schema.discriminatorMapping&&!t.schema.discriminatorMapping.isRoot)throw new Error('Discriminator "'+e+'" can only be a discriminator of the root model');if(c){const e=i(t.base,"options.applyPluginsToDiscriminators",!1);t.base._applyPlugins(n,{skipTopLevel:!e})}const u=t.schema.options.discriminatorKey,l=t.schema.path(u);if(null!=l)o.hasUserDefinedProperty(l.options,"select")||(l.options.select=!0),l.options.$skipDiscriminatorCheck=!0;else{const e={};e[u]={default:void 0,select:!0,$skipDiscriminatorCheck:!0},e[u][t.schema.options.typeKey]=String,t.schema.add(e),r(u,null,t.prototype,null,[u],t.schema.options)}if(n.path(u)&&!0!==n.path(u).options.$skipDiscriminatorCheck)throw new Error('Discriminator "'+e+'" cannot have field with name "'+u+'"');let h=e;if("string"==typeof a&&a.length&&(h=a),function(e,n){e._baseSchema=n,n.paths._id&&n.paths._id.options&&!n.paths._id.options.auto&&e.remove("_id");const r=Object.keys(n.paths),i=[];for(const t of r){if(e.nested[t]&&i.push(t),-1===t.indexOf("."))continue;const n=t.split(".");let r="";for(const o of n)r+=(r.length?".":"")+o,(e.paths[r]||e.singleNestedPaths[r])&&i.push(t)}o.merge(e,n,{omit:{discriminators:!0,base:!0},omitNested:i.reduce((t,e)=>(t["tree."+e]=!0,t),{})});for(const t of i)delete e.paths[t];e.childSchemas.forEach(t=>{t.model.prototype.$__setSchema(t.schema)});const a={};a[u]={default:h,select:!0,set:function(t){if(t===h)return h;throw new Error("Can't set discriminator key \""+u+'"')},$skipDiscriminatorCheck:!0},a[u][e.options.typeKey]=l?l.instance:String,e.add(a),e.discriminatorMapping={key:u,value:h,isRoot:!1},n.options.collection&&(e.options.collection=n.options.collection);const c=e.options.toJSON,f=e.options.toObject,p=e.options._id,d=e.options.id,m=Object.keys(e.options);e.options.discriminatorKey=n.options.discriminatorKey;for(const t of m)if(!s[t]){if("pluralization"===t&&1==e.options[t]&&null==n.options[t])continue;if(!o.deepEqual(e.options[t],n.options[t]))throw new Error("Can't customize discriminator option "+t+" (can only modify "+Object.keys(s).join(", ")+")")}e.options=o.clone(n.options),c&&(e.options.toJSON=c),f&&(e.options.toObject=f),void 0!==p&&(e.options._id=p),e.options.id=d,e.s.hooks=t.schema.s.hooks.merge(e.s.hooks),e.plugins=Array.prototype.slice.call(n.plugins),e.callQueue=n.callQueue.concat(e.callQueue),delete e._requiredpaths}(n,t.schema),t.discriminators||(t.discriminators={}),t.schema.discriminatorMapping||(t.schema.discriminatorMapping={key:u,value:null,isRoot:!0}),t.schema.discriminators||(t.schema.discriminators={}),t.schema.discriminators[e]=n,t.discriminators[e])throw new Error('Discriminator with name "'+e+'" already exists');return n}},function(t,e,n){"use strict";const r=n(8).documentSchemaSymbol,i=n(11),o=n(12);let s;const a=n(8).getSymbol,c=n(8).scopeSymbol;
/*!
 * Compiles schemas.
 */
function u(t,e,r,i){s=s||n(22);const a=Object.keys(t),c=a.length;let u,h;for(let n=0;n<c;++n){h=a[n],u=t[h],l(h,o.isPOJO(u)&&Object.keys(u).length&&(!u[i.typeKey]||"type"===i.typeKey&&u.type.type)?u:null,e,r,a,i)}}
/*!
 * Defines the accessor named prop on the incoming prototype.
 */function l(t,e,l,h,f,p){s=s||n(22);const d=(h?h+".":"")+t;h=h||"",e?Object.defineProperty(l,t,{enumerable:!0,configurable:!0,get:function(){const t=this;if(this.$__.getters||(this.$__.getters={}),!this.$__.getters[d]){const n=Object.create(s.prototype,function(t){const e={};return Object.getOwnPropertyNames(t).forEach((function(n){e[n]=Object.getOwnPropertyDescriptor(t,n),e[n].get?delete e[n]:e[n].enumerable=-1===["isNew","$__","errors","_doc","$locals","$op","__parentArray","__index","$isDocumentArrayElement"].indexOf(n)})),e}(this));h||(n.$__[c]=this),n.$__.nestedPath=d,Object.defineProperty(n,"schema",{enumerable:!1,configurable:!0,writable:!1,value:l.schema}),Object.defineProperty(n,r,{enumerable:!1,configurable:!0,writable:!1,value:l.schema}),Object.defineProperty(n,"toObject",{enumerable:!1,configurable:!0,writable:!1,value:function(){return o.clone(t.get(d,null,{virtuals:i(this,"schema.options.toObject.virtuals",null)}))}}),Object.defineProperty(n,"toJSON",{enumerable:!1,configurable:!0,writable:!1,value:function(){return t.get(d,null,{virtuals:i(t,"schema.options.toJSON.virtuals",null)})}}),Object.defineProperty(n,"$__isNested",{enumerable:!1,configurable:!0,writable:!1,value:!0});const a=Object.freeze({minimize:!0,virtuals:!1,getters:!1,transform:!1});Object.defineProperty(n,"$isEmpty",{enumerable:!1,configurable:!0,writable:!1,value:function(){return 0===Object.keys(this.get(d,null,a)||{}).length}}),u(e,n,d,p),this.$__.getters[d]=n}return this.$__.getters[d]},set:function(t){t instanceof s&&(t=t.toObject({transform:!1})),(this.$__[c]||this).$set(d,t)}}):Object.defineProperty(l,t,{enumerable:!0,configurable:!0,get:function(){return this[a].call(this.$__[c]||this,d)},set:function(t){this.$set.call(this.$__[c]||this,d,t)}})}
/*!
 * exports
 */
e.compile=u,e.defineKey=l},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(31),i=n(135),o=n(208),s=n(28),a=n(207),c=n(425),u=n(33).get().ReadPreference,l=n(229),h=n(230),f=n(80),p=n(427),d=n(232),m=n(433),y=n(11),g=n(24),v=n(39),b=n(434),_=n(113),w=n(435),S=n(134),O=n(233),E=n(436),T=n(234),C=n(106),I=n(437),A=n(6),k=n(12),x=n(438);function N(t,e,n,r){this._mongooseOptions||(this._mongooseOptions={}),e=e||{},this._transforms=[],this._hooks=new o,this._executionCount=0;const i=Object.keys(e);for(const t of i)this._mongooseOptions[t]=e[t];r&&(this.mongooseCollection=r),n&&(this.model=n,this.schema=n.schema),this.model&&this.model._mapreduce&&this.lean(),S.call(this,this.mongooseCollection,e),t&&this.find(t),this.options=this.options||{},this.$useProjection=!0;const s=y(this,"schema.options.collation",null);null!=s&&(this.options.collation=s)}
/*!
 * inherit mquery
 */N.prototype=new S,N.prototype.constructor=N,N.base=S.prototype,N.use$geoWithin=S.use$geoWithin,N.prototype.toConstructor=function(){const t=this.model,e=this.mongooseCollection,n=function(i,o){if(!(this instanceof n))return new n(i,o);this._mongooseOptions=k.clone(r._mongooseOptions),N.call(this,i,o||null,t,e)};A.inherits(n,t.Query);const r=n.prototype;r.options={};const i=Object.assign({},this.options);return null!=i.sort&&(r.sort(i.sort),delete i.sort),r.setOptions(i),r.op=this.op,r._conditions=k.clone(this._conditions),r._fields=k.clone(this._fields),r._update=k.clone(this._update,{flattenDecimals:!1}),r._path=this._path,r._distinct=this._distinct,r._collection=this._collection,r._mongooseOptions=this._mongooseOptions,n},N.prototype.slice=function(){if(0===arguments.length)return this;let t,e;if(this._validate("slice"),1===arguments.length){const n=arguments[0];if("object"==typeof n&&!Array.isArray(n)){const t=Object.keys(n),e=t.length;for(let r=0;r<e;++r)this.slice(t[r],n[t[r]]);return this}this._ensurePath("slice"),t=this._path,e=arguments[0]}else 2===arguments.length?"number"==typeof arguments[0]?(this._ensurePath("slice"),t=this._path,e=C(arguments)):(t=arguments[0],e=arguments[1]):3===arguments.length&&(t=arguments[0],e=C(arguments,1));const n={};return n[t]={$slice:e},this.select(n),this},N.prototype.mod=function(){let t,e;1===arguments.length?(this._ensurePath("mod"),t=arguments[0],e=this._path):2!==arguments.length||Array.isArray(arguments[1])?3===arguments.length?(t=C(arguments,1),e=arguments[0]):(t=arguments[1],e=arguments[0]):(this._ensurePath("mod"),t=C(arguments),e=this._path);const n=this._conditions[e]||(this._conditions[e]={});return n.$mod=t,this},N.prototype.projection=function(t){return 0===arguments.length||(this._fields={},this._userProvidedFields={},this.select(t)),this._fields},N.prototype.select=function(){let t,e=arguments[0];if(!e)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");this._validate("select");const n=this._fields||(this._fields={}),r=this._userProvidedFields||(this._userProvidedFields={});if(e=O(e),k.isObject(e)){const i=Object.keys(e);for(t=0;t<i.length;++t)n[i[t]]=e[i[t]],r[i[t]]=e[i[t]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},N.prototype.read=function(t,e){const n=new u(t,e);return this.options.readPreference=n,this},N.prototype.session=function(t){return null==t&&delete this.options.session,this.options.session=t,this},N.prototype.w=function(t){return null==t&&delete this.options.w,this.options.w=t,this},N.prototype.j=function(t){return null==t&&delete this.options.j,this.options.j=t,this},N.prototype.wtimeout=function(t){return null==t&&delete this.options.wtimeout,this.options.wtimeout=t,this},N.prototype.getOptions=function(){return this.options},N.prototype.setOptions=function(t,e){if(e)return this._mongooseOptions=t&&k.clone(t)||{},this.options=t||{},"populate"in t&&this.populate(this._mongooseOptions),this;if(null==t)return this;if("object"!=typeof t)throw new Error('Options must be an object, got "'+t+'"');if(Array.isArray(t.populate)){const e=t.populate;delete t.populate;const n=e.length;for(let t=0;t<n;++t)this.populate(e[t])}return"useFindAndModify"in t&&(this._mongooseOptions.useFindAndModify=t.useFindAndModify,delete t.useFindAndModify),"omitUndefined"in t&&(this._mongooseOptions.omitUndefined=t.omitUndefined,delete t.omitUndefined),"setDefaultsOnInsert"in t&&(this._mongooseOptions.setDefaultsOnInsert=t.setDefaultsOnInsert,delete t.setDefaultsOnInsert),N.base.setOptions.call(this,t)},N.prototype.explain=function(t){return 0===arguments.length?(this.options.explain=!0,this):(this.options.explain=t,this)},N.prototype.maxTimeMS=function(t){return this.options.maxTimeMS=t,this},N.prototype.getFilter=function(){return this._conditions},N.prototype.getQuery=function(){return this._conditions},N.prototype.setQuery=function(t){this._conditions=t},N.prototype.getUpdate=function(){return this._update},N.prototype.setUpdate=function(t){this._update=t},N.prototype._fieldsForExec=function(){return k.clone(this._fields)},N.prototype._updateForExec=function(){const t=k.clone(this._update,{transform:!1,depopulate:!0}),e=Object.keys(t);let n=e.length;const r={};for(;n--;){const i=e[n];this.options.overwrite?r[i]=t[i]:"$"!==i[0]?(r.$set||(t.$set?r.$set=t.$set:r.$set={}),r.$set[i]=t[i],e.splice(n,1),~e.indexOf("$set")||e.push("$set")):"$set"===i&&r.$set||(r[i]=t[i])}return r},N.prototype._optionsForExec=function(t){const e=k.clone(this.options);if(delete e.populate,!(t=t||this.model))return e;const n=y(t,"schema.options.safe",null);"safe"in e||null==n||P(e,n),h(t.schema,e);const r=y(t,"schema.options.read");return!("readPreference"in e)&&r&&(e.readPreference=r),void 0!==e.upsert&&(e.upsert=!!e.upsert),e};
/*!
 * ignore
 */
const P=A.deprecate((function(t,e){t.safe=e}),"Mongoose: the `safe` option is deprecated. Use write concerns instead: http://bit.ly/mongoose-w");
/*!
 * ignore
 */
function j(t){try{p(t)}catch(e){t.error(e)}}
/*!
 * hydrates a document
 *
 * @param {Model} model
 * @param {Document} doc
 * @param {Object} res 3rd parameter to callback
 * @param {Object} fields
 * @param {Query} self
 * @param {Array} [pop] array of paths used in population
 * @param {Function} callback
 */
function R(t,e,n,r,i,o,s,a){const c=s?{populated:s}:void 0;if(r.rawResult&&null==e)return l(null),null;const u=_.createModel(t,e,i,o);try{u.init(e,c,l)}catch(t){l(t)}function l(t){return t?process.nextTick(()=>a(t)):r.rawResult?(e&&u?(u.$session(r.session),n.value=u):n.value=null,process.nextTick(()=>a(null,n))):(u.$session(r.session),void process.nextTick(()=>a(null,u)))}}
/*!
 * If the model is a discriminator type and not root, then add the key & value to the criteria.
 */function M(t){if(!t||!t.model||!t.model.schema)return;const e=t.model.schema;e&&e.discriminatorMapping&&!e.discriminatorMapping.isRoot&&(t._conditions[e.discriminatorMapping.key]=e.discriminatorMapping.value)}
/*!
 * Support the `new` option as an alternative to `returnOriginal` for backwards
 * compat.
 */
function D(t){"new"in t&&(t.returnOriginal=!t.new,delete t.new)}
/*!
 * Thunk around findOneAndRemove()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
/*!
 * Get options from query opts, falling back to the base mongoose object.
 */
function $(t,e,n){const r=t._optionsForExec(t.model);return e in r?r[e]:e in t.model.base.options?t.model.base.options[e]:n}
/*!
 * Override mquery.prototype._findAndModify to provide casting etc.
 *
 * @param {String} type - either "remove" or "update"
 * @param {Function} callback
 * @api private
 */
/*!
 * ignore
 */
function L(t,e,n,r){return n.rawResult?r(null,e):r(null,t)}
/*!
 * ignore
 */N.prototype.lean=function(t){return this._mongooseOptions.lean=!arguments.length||t,this},N.prototype.mongooseOptions=function(){return this._mongooseOptions},N.prototype.set=function(t,e){if("object"==typeof t){const e=Object.keys(t);for(const n of e)this.set(n,t[n]);return this}return this._update=this._update||{},this._update.$set=this._update.$set||{},this._update.$set[t]=e,this},N.prototype.get=function(t){const e=this._update;if(null==e)return;const n=e.$set;return null==n||k.hasUserDefinedProperty(e,t)?e[t]:k.hasUserDefinedProperty(n,t)?n[t]:void 0},N.prototype.error=function(t){return 0===arguments.length?this._error:(this._error=t,this)},
/*!
 * ignore
 */
N.prototype._unsetCastError=function(){if(null==this._error||this._error instanceof r)return this.error(null)},N.prototype.mongooseOptions=function(t){return arguments.length>0&&(this._mongooseOptions=t),this._mongooseOptions},
/*!
 * ignore
 */
N.prototype._castConditions=function(){try{this.cast(this.model),this._unsetCastError()}catch(t){this.error(t)}},N.prototype._find=x((function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;t=W(this,t),this._applyPaths(),this._fields=this._castFields(this._fields);const e=this._fieldsForExec(),n=this._mongooseOptions,r=this,i=r._userProvidedFields||{};l(this.options,this.model);const o=Object.assign({},{session:y(this,"options.session",null)}),s=this._optionsForExec();s.projection=this._fieldsForExec();const a=this._conditions;return this._collection.find(a,s,(s,a)=>{if(s)return t(s);if(0===a.length)return t(null,a);if(this.options.explain)return t(null,a);if(!n.populate)return n.lean?t(null,a):m(r.model,a,e,i,o,t);const c=_.preparePopulationOptionsMQ(r,n);o.populated=c,r.model.populate(a,c,(function(s,a){return s?t(s):n.lean?t(null,a):m(r.model,a,e,i,o,t)}))}),null})),N.prototype.find=function(t,e){return this.op="find","function"==typeof t&&(e=t,t={}),t=k.toObject(t),S.canMerge(t)?(this.merge(t),M(this)):null!=t&&this.error(new a(t,"filter","find")),e?(this.exec(e),this):N.base.find.call(this)},N.prototype.merge=function(t){if(!t)return this;const e={overwrite:!0};return t instanceof N?(t._conditions&&k.merge(this._conditions,t._conditions,e),t._fields&&(this._fields||(this._fields={}),k.merge(this._fields,t._fields,e)),t.options&&(this.options||(this.options={}),k.merge(this.options,t.options,e)),t._update&&(this._update||(this._update={}),k.mergeClone(this._update,t._update)),t._distinct&&(this._distinct=t._distinct),k.merge(this._mongooseOptions,t._mongooseOptions),this):(k.merge(this._conditions,t,e),this)},N.prototype.collation=function(t){return null==this.options&&(this.options={}),this.options.collation=t,this},N.prototype._completeOne=function(t,e,n){if(!t&&!this.options.rawResult)return n(null,null);const r=this.model,i=k.clone(this._fields),o=this._userProvidedFields||{},s=this._mongooseOptions,a=this.options;if(a.explain)return n(null,t);if(!s.populate)return s.lean?L(t,e,a,n):R(r,t,e,a,i,o,null,n);const c=_.preparePopulationOptionsMQ(this,this._mongooseOptions);r.populate(t,c,(t,u)=>t?n(t):s.lean?L(u,e,a,n):R(r,u,e,a,i,o,c,n))},N.prototype._findOne=x((function(t){if(this._castConditions(),this.error())return t(this.error()),null;this._applyPaths(),this._fields=this._castFields(this._fields),l(this.options,this.model),N.base.findOne.call(this,{},(e,n)=>{if(e)return t(e),null;this._completeOne(n,null,W(this,t))})})),N.prototype.findOne=function(t,e,n,r){return this.op="findOne","function"==typeof t?(r=t,t=null,e=null,n=null):"function"==typeof e?(r=e,n=null,e=null):"function"==typeof n&&(r=n,n=null),t=k.toObject(t),n&&this.setOptions(n),e&&this.select(e),S.canMerge(t)?(this.merge(t),M(this)):null!=t&&this.error(new a(t,"filter","findOne")),r?(this.exec(r),this):N.base.findOne.call(this)},N.prototype._count=x((function(t){try{this.cast(this.model)}catch(t){this.error(t)}if(this.error())return t(this.error());const e=this._conditions,n=this._optionsForExec();this._collection.count(e,n,k.tick(t))})),N.prototype._countDocuments=x((function(t){try{this.cast(this.model)}catch(t){this.error(t)}if(this.error())return t(this.error());const e=this._conditions,n=this._optionsForExec();this._collection.collection.countDocuments(e,n,k.tick(t))})),N.prototype._estimatedDocumentCount=x((function(t){if(this.error())return t(this.error());const e=this._optionsForExec();this._collection.collection.estimatedDocumentCount(e,k.tick(t))})),N.prototype.count=function(t,e){return this.op="count","function"==typeof t&&(e=t,t=void 0),t=k.toObject(t),S.canMerge(t)&&this.merge(t),e?(this.exec(e),this):this},N.prototype.estimatedDocumentCount=function(t,e){return this.op="estimatedDocumentCount","function"==typeof t&&(e=t,t=void 0),"object"==typeof t&&null!=t&&this.setOptions(t),e?(this.exec(e),this):this},N.prototype.countDocuments=function(t,e){return this.op="countDocuments","function"==typeof t&&(e=t,t=void 0),t=k.toObject(t),S.canMerge(t)&&this.merge(t),e?(this.exec(e),this):this},N.prototype.__distinct=x((function(t){if(this._castConditions(),this.error())return t(this.error()),null;const e=this._optionsForExec();this._collection.collection.distinct(this._distinct,this._conditions,e,t)})),N.prototype.distinct=function(t,e,n){return this.op="distinct",n||("function"==typeof e?(n=e,e=void 0):"function"==typeof t&&(n=t,t=void 0,e=void 0)),e=k.toObject(e),S.canMerge(e)?(this.merge(e),M(this)):null!=e&&this.error(new a(e,"filter","distinct")),null!=t&&(this._distinct=t),null!=n&&this.exec(n),this},N.prototype.sort=function(t){if(arguments.length>1)throw new Error("sort() only takes 1 Argument");return N.base.sort.call(this,t)},N.prototype.remove=function(t,e){return this.op="remove","function"==typeof t&&(e=t,t=null),t=k.toObject(t),S.canMerge(t)?(this.merge(t),M(this)):null!=t&&this.error(new a(t,"filter","remove")),e?(this.exec(e),this):N.base.remove.call(this)},
/*!
 * ignore
 */
N.prototype._remove=x((function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=W(this,t),N.base.remove.call(this,_.handleDeleteWriteOpResult(t)))})),N.prototype.deleteOne=function(t,e,n){return this.op="deleteOne","function"==typeof t?(n=t,t=null,e=null):"function"==typeof e?(n=e,e=null):this.setOptions(e),t=k.toObject(t),S.canMerge(t)?(this.merge(t),M(this)):null!=t&&this.error(new a(t,"filter","deleteOne")),n?(this.exec.call(this,n),this):N.base.deleteOne.call(this)},
/*!
 * Internal thunk for `deleteOne()`
 */
N.prototype._deleteOne=x((function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=W(this,t),N.base.deleteOne.call(this,_.handleDeleteWriteOpResult(t)))})),N.prototype.deleteMany=function(t,e,n){return this.op="deleteMany","function"==typeof t?(n=t,t=null,e=null):"function"==typeof e?(n=e,e=null):this.setOptions(e),t=k.toObject(t),S.canMerge(t)?(this.merge(t),M(this)):null!=t&&this.error(new a(t,"filter","deleteMany")),n?(this.exec.call(this,n),this):N.base.deleteMany.call(this)},
/*!
 * Internal thunk around `deleteMany()`
 */
N.prototype._deleteMany=x((function(t){return this._castConditions(),null!=this.error()?(t(this.error()),this):(t=W(this,t),N.base.deleteMany.call(this,_.handleDeleteWriteOpResult(t)))})),N.prototype.findOneAndUpdate=function(t,e,n,r){switch(this.op="findOneAndUpdate",this._validate(),arguments.length){case 3:"function"==typeof n&&(r=n,n={});break;case 2:"function"==typeof e&&(r=e,e=t,t=void 0),n=void 0;break;case 1:"function"==typeof t?(r=t,t=n=e=void 0):(e=t,t=n=void 0)}return S.canMerge(t)&&this.merge(t),e&&this._mergeUpdate(e),n&&((n=k.clone(n)).projection&&(this.select(n.projection),delete n.projection),n.fields&&(this.select(n.fields),delete n.fields),this.setOptions(n)),r?(this.exec(r),this):this},
/*!
 * Thunk around findOneAndUpdate()
 *
 * @param {Function} [callback]
 * @api private
 */
N.prototype._findOneAndUpdate=x((function(t){if(null!=this.error())return t(this.error());this._findAndModify("update",t)})),N.prototype.findOneAndRemove=function(t,e,n){switch(this.op="findOneAndRemove",this._validate(),arguments.length){case 2:"function"==typeof e&&(n=e,e={});break;case 1:"function"==typeof t&&(n=t,t=void 0,e=void 0)}return S.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?(this.exec(n),this):this},N.prototype.findOneAndDelete=function(t,e,n){switch(this.op="findOneAndDelete",this._validate(),arguments.length){case 2:"function"==typeof e&&(n=e,e={});break;case 1:"function"==typeof t&&(n=t,t=void 0,e=void 0)}return S.canMerge(t)&&this.merge(t),e&&this.setOptions(e),n?(this.exec(n),this):this},
/*!
 * Thunk around findOneAndDelete()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
N.prototype._findOneAndDelete=x((function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;const e=this._conditions,n=this._optionsForExec();let r=null;if(null!=this._fields&&(n.projection=this._castFields(k.clone(this._fields)),r=n.projection,r instanceof Error))return t(r),null;this._collection.collection.findOneAndDelete(e,n,W(this,(e,n)=>{if(e)return t(e);const r=n.value;return this._completeOne(r,n,t)}))})),N.prototype.findOneAndReplace=function(t,e,n,r){switch(this.op="findOneAndReplace",this._validate(),arguments.length){case 3:"function"==typeof n&&(r=n,n=void 0);break;case 2:"function"==typeof e&&(r=e,e=void 0);break;case 1:"function"==typeof t&&(r=t,t=void 0,e=void 0,n=void 0)}if(S.canMerge(t)&&this.merge(t),null!=e){if(b(e))throw new Error("The replacement document must not contain atomic operators.");this._mergeUpdate(e)}return n&&this.setOptions(n),r?(this.exec(r),this):this},
/*!
 * Thunk around findOneAndReplace()
 *
 * @param {Function} [callback]
 * @return {Query} this
 * @api private
 */
N.prototype._findOneAndReplace=x((function(t){if(this._castConditions(),null!=this.error())return t(this.error()),null;const e=this._conditions,n=this._optionsForExec();D(n);let r=null,i=new this.model(this._update,null,!0);if(this._update=i,this._applyPaths(),null!=this._fields&&(n.projection=this._castFields(k.clone(this._fields)),r=n.projection,r instanceof Error))return t(r),null;i.validate(r=>{if(null!=r)return t(r);i.toBSON&&(i=i.toBSON()),this._collection.collection.findOneAndReplace(e,i,n,W(this,(e,n)=>{if(e)return t(e);const r=n.value;return this._completeOne(r,n,t)}))})})),N.prototype._findOneAndRemove=x((function(t){null==this.error()?this._findAndModify("remove",t):t(this.error())})),N.prototype._findAndModify=function(t,e){if("function"!=typeof e)throw new Error("Expected callback in _findAndModify");const n=this.model,r=n.schema,i=this;let o;const s=
/*!
 * castQuery
 * @api private
 */
function(t){try{return t.cast(t.model)}catch(t){return t}}
/*!
 * castDoc
 * @api private
 */(this);if(s instanceof Error)return e(s);j(this);const a=this._optionsForExec(n);"strict"in a&&(this._mongooseOptions.strict=a.strict);const c=this.options.overwrite&&!b(this._update);if(c&&(this._update=new this.model(this._update,null,!0)),"remove"===t)a.remove=!0;else if("new"in a||"returnOriginal"in a||(a.new=!1),"upsert"in a||(a.upsert=!1),(a.upsert||a.new)&&(a.remove=!1),!c){this._update=z(this,a.overwrite);const t=Object.assign({},a,{setDefaultsOnInsert:this._mongooseOptions.setDefaultsOnInsert});if(this._update=T(this._conditions,r,this._update,t),this._update&&0!==Object.keys(this._update).length){if(this._update instanceof Error)return e(this._update);this._update.$set&&0===Object.keys(this._update.$set).length&&delete this._update.$set}else{if(!a.upsert)return this.findOne(e),this;{const t=k.clone(s);delete t._id,this._update={$set:t}}}}this._applyPaths();const u=this._mongooseOptions;if(this._fields&&(o=k.clone(this._fields),a.projection=this._castFields(o),a.projection instanceof Error))return e(a.projection);a.sort&&
/*!
 * The mongodb driver 1.3.23 only supports the nested array sort
 * syntax. We must convert it or sorting findAndModify will not work.
 */
function(t){if(Array.isArray(t.sort))return;if(!k.isObject(t.sort))return;const e=[];for(const n in t.sort)k.object.hasOwnProperty(t.sort,n)&&e.push([n,t.sort[n]]);t.sort=e}
/*!
 * ignore
 */(a);const l=function(t,n,r){if(t)return e(t);i._completeOne(n,r,e)};let h=!0;const f=$(this,"runValidators",!1),p=i.model&&i.model.base,d=y(n,"collection.conn",{});if("useFindAndModify"in p.options&&(h=p.get("useFindAndModify")),"useFindAndModify"in d.config&&(h=d.config.useFindAndModify),"useFindAndModify"in u&&(h=u.useFindAndModify),!1===h){const n=i._collection.collection;if(D(a),"remove"===t)return n.findOneAndDelete(s,a,W(i,(function(t,e){return l(t,e?e.value:e,e)}))),this;const r=c?"findOneAndReplace":"findOneAndUpdate";return f?this.validate(this._update,a,c,t=>{if(t)return e(t);this._update&&this._update.toBSON&&(this._update=this._update.toBSON()),n[r](s,this._update,a,W(i,(function(t,e){return l(t,e?e.value:e,e)})))}):(this._update&&this._update.toBSON&&(this._update=this._update.toBSON()),n[r](s,this._update,a,W(i,(function(t,e){return l(t,e?e.value:e,e)})))),this}return f?this.validate(this._update,a,c,(function(t){if(t)return e(t);F.call(i,s,i._update,a,l)})):F.call(i,s,i._update,a,l),this};const F=A.deprecate((function(t,e,n,r){e&&e.toBSON&&(e=e.toBSON());const i=this._collection,o=null!=n&&Array.isArray(n.sort)?n.sort:[],s=W(this,(function(t,e){return r(t,e?e.value:e,e)}));i.collection._findAndModify(t,o,e,n,s)}),"Mongoose: `findOneAndUpdate()` and `findOneAndDelete()` without the `useFindAndModify` option set to false are deprecated. See: https://mongoosejs.com/docs/deprecations.html#findandmodify");
/*!
 * Override mquery.prototype._mergeUpdate to handle mongoose objects in
 * updates.
 *
 * @param {Object} doc
 * @api private
 */function B(t,e){if(this._castConditions(),j(this),null!=this.error())return e(this.error()),null;const n=e=W(this,e);e=function(t,e){n(t,e?e.result:{ok:0,n:0,nModified:0})};const r=this._conditions,i=this._optionsForExec(this.model);++this._executionCount,this._update=k.clone(this._update,i);const o=this.options.overwrite&&!b(this._update);if(o){if("updateOne"===t||"updateMany"===t)return e(new s("The MongoDB server disallows overwriting documents using `"+t+"`. See: https://mongoosejs.com/docs/deprecations.html#update"));this._update=new this.model(this._update,null,!0)}else{if(this._update=z(this,i.overwrite),this._update instanceof Error)return e(this._update),null;if(null==this._update||0===Object.keys(this._update).length)return e(null,0),null;const t=Object.assign({},i,{setDefaultsOnInsert:this._mongooseOptions.setDefaultsOnInsert});this._update=T(this._conditions,this.model.schema,this._update,t)}return $(this,"runValidators",!1)?(this.validate(this._update,i,o,n=>{if(n)return e(n);this._update.toBSON&&(this._update=this._update.toBSON()),this._collection[t](r,this._update,i,e)}),null):(this._update.toBSON&&(this._update=this._update.toBSON()),this._collection[t](r,this._update,i,e),null)}
/*!
 * Mongoose calls this function internally to validate the query if
 * `runValidators` is set
 *
 * @param {Object} castedDoc the update, after casting
 * @param {Object} options the options from `_optionsForExec()`
 * @param {Function} callback
 * @api private
 */
/*!
 * Internal helper for update, updateMany, updateOne, replaceOne
 */
function U(t,e,n,r,i,o){return t.op=e,n=k.toObject(n),r=r||{},null!=i&&"strict"in i&&(t._mongooseOptions.strict=i.strict),n instanceof N||null==n||"[object Object]"===n.toString()?t.merge(n):t.error(new a(n,"filter",e)),k.isObject(i)&&t.setOptions(i),t._mergeUpdate(r),o?(t.exec(o),t):N.base[e].call(t,n,void 0,i,o)}
/*!
 * Get the error to throw for `orFail()`
 */
function V(t,e){return"function"==typeof t&&(t=t.call(e)),null==t&&(t=new i(e.getQuery(),e.model.modelName)),t}
/*!
 * ignore
 */
function q(t,e){return e instanceof r?(t.copy(e),t):e}
/*!
 * ignore
 */function W(t,e){return function(n,r){if(null!=n)return e(n);for(const i of t._transforms)try{r=i(r)}catch(n){return e(n)}return e(null,r)}}function z(t,e){try{return t._castUpdate(t._update,e)}catch(t){return t}}
/*!
 * ignore
 */
function H(t,e,n){for(const r of e)t.push(n+r.path),Array.isArray(r.populate)&&H(t,r.populate,n+r.path+".")}N.prototype._mergeUpdate=function(t){if(null!=t&&("object"!=typeof t||0!==Object.keys(t).length))if(this._update||(this._update=Array.isArray(t)?[]:{}),t instanceof N){if(Array.isArray(this._update))throw new Error("Cannot mix array and object updates");t._update&&k.mergeClone(this._update,t._update)}else if(Array.isArray(t)){if(!Array.isArray(this._update))throw new Error("Cannot mix array and object updates");this._update=this._update.concat(t)}else{if(Array.isArray(this._update))throw new Error("Cannot mix array and object updates");k.mergeClone(this._update,t)}},N.prototype.validate=function(t,e,n,r){return g(r,r=>{try{n?t.validate(r):I(this,this.model.schema,t,e,r)}catch(t){process.nextTick((function(){r(t)}))}})},
/*!
 * Internal thunk for .update()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
N.prototype._execUpdate=x((function(t){return B.call(this,"update",t)})),
/*!
 * Internal thunk for .updateMany()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
N.prototype._updateMany=x((function(t){return B.call(this,"updateMany",t)})),
/*!
 * Internal thunk for .updateOne()
 *
 * @param {Function} callback
 * @see Model.update #model_Model.update
 * @api private
 */
N.prototype._updateOne=x((function(t){return B.call(this,"updateOne",t)})),
/*!
 * Internal thunk for .replaceOne()
 *
 * @param {Function} callback
 * @see Model.replaceOne #model_Model.replaceOne
 * @api private
 */
N.prototype._replaceOne=x((function(t){return B.call(this,"replaceOne",t)})),N.prototype.update=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),U(this,"update",t,e,n,r)},N.prototype.updateMany=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),U(this,"updateMany",t,e,n,r)},N.prototype.updateOne=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),U(this,"updateOne",t,e,n,r)},N.prototype.replaceOne=function(t,e,n,r){return"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=t,t={},n=null):"function"==typeof t?(r=t,t=void 0,e=void 0,n=void 0):"object"!=typeof t||e||n||r||(e=t,t=void 0,n=void 0,r=void 0),this.setOptions({overwrite:!0}),U(this,"replaceOne",t,e,n,r)},N.prototype.map=function(t){return this._transforms.push(t),this},N.prototype.orFail=function(t){return this.map(e=>{switch(this.op){case"find":if(0===e.length)throw V(t,this);break;case"findOne":if(null==e)throw V(t,this);break;case"update":case"updateMany":case"updateOne":if(0===y(e,"nModified"))throw V(t,this);break;case"findOneAndDelete":if(0===y(e,"lastErrorObject.n"))throw V(t,this);break;case"findOneAndUpdate":case"findOneAndReplace":if(!1===y(e,"lastErrorObject.updatedExisting"))throw V(t,this);break;case"deleteMany":case"deleteOne":case"remove":if(0===e.n)throw V(t,this)}return e}),this},N.prototype.exec=function(t,e){const n=this,i=new r;return"function"==typeof t?(e=t,t=null):"string"==typeof t&&(this.op=t),e=this.model.$handleCallbackError(e),g(e,t=>{t=this.model.$wrapCallback(t),n.op?this._hooks.execPre("exec",this,[],e=>{if(null!=e)return t(q(i,e));let n="_"+this.op;"update"===this.op?n="_execUpdate":"distinct"===this.op&&(n="__distinct"),this[n].call(this,(e,n)=>{if(e)return t(q(i,e));this._hooks.execPost("exec",this,[],{},e=>{if(e)return t(q(i,e));t(null,n)})})}):t()},this.model.events)},N.prototype.then=function(t,e){return this.exec().then(t,e)},N.prototype.catch=function(t){return this.exec().then(null,t)},
/*!
 * ignore
 */
N.prototype._pre=function(t){return this._hooks.pre("exec",t),this},
/*!
 * ignore
 */
N.prototype._post=function(t){return this._hooks.post("exec",t),this},
/*!
 * Casts obj for an update command.
 *
 * @param {Object} obj
 * @return {Object} obj after casting its values
 * @api private
 */
N.prototype._castUpdate=function(t,e){let n;n="strict"in this._mongooseOptions?this._mongooseOptions.strict:!this.schema||!this.schema.options||this.schema.options.strict;let r,i,o=!1;"omitUndefined"in this._mongooseOptions&&(o=this._mongooseOptions.omitUndefined),"useNestedStrict"in this.options&&(r=this.options.useNestedStrict),"upsert"in this.options&&(i=this.options.upsert);let s=this.schema;const a=this._conditions;if(null!=s&&k.hasUserDefinedProperty(a,s.options.discriminatorKey)&&"object"!=typeof a[s.options.discriminatorKey]&&null!=s.discriminators){const t=a[s.options.discriminatorKey],e=v(this.model,t);s=s.discriminators[t]||e&&e.schema||s}return d(s,t,{overwrite:e,strict:n,omitUndefined:o,useNestedStrict:r,upsert:i},this,this._conditions)},N.prototype.populate=function(){if(!Array.from(arguments).some(Boolean))return this;const t=k.populate.apply(null,arguments);if(null!=this.options){const e=this.options.readConcern,n=this.options.readPreference;for(const r of t)null!=e&&null==y(r,"options.readConcern")&&(r.options=r.options||{},r.options.readConcern=e),null!=n&&null==y(r,"options.readPreference")&&(r.options=r.options||{},r.options.readPreference=n)}const e=this._mongooseOptions;if(null!=e.lean){const n=e.lean;for(const e of t)null==y(e,"options.lean")&&(e.options=e.options||{},e.options.lean=n)}k.isObject(e.populate)||(e.populate={});const n=e.populate;for(const e of t){const t=e.path;n[t]&&n[t].populate&&e.populate&&(e.populate=n[t].populate.concat(e.populate)),n[e.path]=e}return this},N.prototype.getPopulatedPaths=function(){const t=this._mongooseOptions.populate||{},e=Object.keys(t);for(const n of Object.keys(t)){const r=t[n];Array.isArray(r.populate)&&H(e,r.populate,n+".")}return e},N.prototype.cast=function(t,e){e||(e=this._conditions);const n=(t=t||this.model).schema.options.discriminatorKey;null!=e&&e.hasOwnProperty(n)&&(t=v(t,e[n])||t);try{return f(t.schema,e,{upsert:this.options&&this.options.upsert,strict:this.options&&"strict"in this.options?this.options.strict:y(t,"schema.options.strict",null),strictQuery:this.options&&this.options.strictQuery||y(t,"schema.options.strictQuery",null)},this)}catch(e){throw"function"==typeof e.setModel&&e.setModel(t),e}},N.prototype._castFields=function(t){let e,n,r,i,o,s;if(t)for(r=Object.keys(t),n=[],s=r.length;s--;)i=r[s],t[i].$elemMatch&&(e||(e={}),e[i]=t[i],n.push(i));if(e){try{o=this.cast(this.model,e)}catch(t){return t}for(s=n.length;s--;)i=n[s],t[i]=o[i]}return t},N.prototype._applyPaths=function(){this._fields=this._fields||{},_.applyPaths(this._fields,this.model.schema);let t=!0;"selectPopulatedPaths"in this.model.base.options&&(t=this.model.base.options.selectPopulatedPaths),"selectPopulatedPaths"in this.model.schema.options&&(t=this.model.schema.options.selectPopulatedPaths),t&&E(this)},N.prototype.cursor=function(t){this._applyPaths(),this._fields=this._castFields(this._fields),this.setOptions({projection:this._fieldsForExec()}),t&&this.setOptions(t);const e=Object.assign({},this._optionsForExec(),{projection:this.projection()});try{this.cast(this.model)}catch(t){return new c(this,e)._markError(t)}return new c(this,e)},N.prototype.maxscan=N.base.maxScan,N.prototype.tailable=function(t,e){if(t&&"Object"===t.constructor.name&&(e=t,t=!0),void 0===t&&(t=!0),e&&"object"==typeof e)for(const t in e)this.options[t]="awaitdata"===t?!!e[t]:e[t];return N.base.tailable.call(this,t)},
/*!
 * Overwriting mquery is needed to support a couple different near() forms found in older
 * versions of mongoose
 * near([1,1])
 * near(1,1)
 * near(field, [1,2])
 * near(field, 1, 2)
 * In addition to all of the normal forms supported by mquery
 */
N.prototype.near=function(){const t=[],e=this._mongooseOptions.nearSphere;if(1===arguments.length)if(Array.isArray(arguments[0]))t.push({center:arguments[0],spherical:e});else if("string"==typeof arguments[0])t.push(arguments[0]);else{if(!k.isObject(arguments[0]))throw new TypeError("invalid argument");"boolean"!=typeof arguments[0].spherical&&(arguments[0].spherical=e),t.push(arguments[0])}else if(2===arguments.length)if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t.push({center:[arguments[0],arguments[1]],spherical:e});else if("string"==typeof arguments[0]&&Array.isArray(arguments[1]))t.push(arguments[0]),t.push({center:arguments[1],spherical:e});else{if("string"!=typeof arguments[0]||!k.isObject(arguments[1]))throw new TypeError("invalid argument");t.push(arguments[0]),"boolean"!=typeof arguments[1].spherical&&(arguments[1].spherical=e),t.push(arguments[1])}else{if(3!==arguments.length)throw new TypeError("invalid argument");if("string"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2])throw new TypeError("invalid argument");t.push(arguments[0]),t.push({center:[arguments[1],arguments[2]],spherical:e})}return N.base.near.apply(this,t)},N.prototype.nearSphere=function(){return this._mongooseOptions.nearSphere=!0,this.near.apply(this,arguments),this},null!=Symbol.asyncIterator&&(N.prototype[Symbol.asyncIterator]=function(){return this.cursor().transformNull().map(t=>null==t?{done:!0}:{value:t,done:!1})})
/*!
 * this is needed to support the mongoose syntax of:
 * box(field, { ll : [x,y], ur : [x2,y2] })
 * box({ ll : [x,y], ur : [x2,y2] })
 */,N.prototype.box=function(t,e){return!Array.isArray(t)&&k.isObject(t)&&(e=t.ur,t=t.ll),N.base.box.call(this,t,e)},N.prototype.center=N.base.circle,N.prototype.centerSphere=function(){arguments[0]&&"Object"===arguments[0].constructor.name&&(arguments[0].spherical=!0),arguments[1]&&"Object"===arguments[1].constructor.name&&(arguments[1].spherical=!0),N.base.circle.apply(this,arguments)},N.prototype.selectedInclusively=function(){return w(this._fields)},N.prototype.selectedExclusively=function(){if(!this._fields)return!1;const t=Object.keys(this._fields);for(const e of t)if("_id"!==e&&(0===this._fields[e]||!1===this._fields[e]))return!0;return!1},
/*!
 * Export
 */
t.exports=N},function(t,e,n){"use strict";t.exports=function t(e){return this instanceof t?(this.val=e,this):new t(e)}},function(t,e,n){"use strict";t.exports=function(t,e,n){if(0===t.length)return n();let r=t.length,i=null;for(const o of t)e(o,(function(t){if(null==i)return null!=t?(i=t,n(i)):--r<=0?n():void 0}))}},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("url")},function(t,e,n){const r=n(54),i=n(84);function o(t){console.log(`[dotenv][DEBUG] ${t}`)}const s=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,a=/\\n/g,c=/\n|\r|\r\n/;function u(t,e){const n=Boolean(e&&e.debug),r={};return t.toString().split(c).forEach((function(t,e){const i=t.match(s);if(null!=i){const t=i[1];let e=i[2]||"";const n=e.length-1,o='"'===e[0]&&'"'===e[n];"'"===e[0]&&"'"===e[n]||o?(e=e.substring(1,n),o&&(e=e.replace(a,"\n"))):e=e.trim(),r[t]=e}else n&&o(`did not match key and value when parsing line ${e+1}: ${t}`)})),r}t.exports.config=function(t){let e=i.resolve(process.cwd(),".env"),n="utf8",s=!1;t&&(null!=t.path&&(e=t.path),null!=t.encoding&&(n=t.encoding),null!=t.debug&&(s=!0));try{const t=u(r.readFileSync(e,{encoding:n}),{debug:s});return Object.keys(t).forEach((function(e){Object.prototype.hasOwnProperty.call(process.env,e)?s&&o(`"${e}" is already defined in \`process.env\` and will not be overwritten`):process.env[e]=t[e]})),{parsed:t}}catch(t){return{error:t}}},t.exports.parse=u},function(t,e,n){var r=n(253),i=n(71),o=n(90),s=n(94),a=n(91),c=n(85),u=n(118),l=n(55),h=n(117),f=n(93),p=n(92),d=n(87),m=n(88),y=n(89),g=n(86);r.BSON_INT32_MAX=2147483647,r.BSON_INT32_MIN=-2147483648,r.BSON_INT64_MAX=Math.pow(2,63)-1,r.BSON_INT64_MIN=-Math.pow(2,63),r.JS_INT_MAX=9007199254740992,r.JS_INT_MIN=-9007199254740992,r.Binary=i,r.Code=o,r.DBRef=s,r.Decimal128=a,r.Double=c,r.Int32=u,r.Long=l,r.Map=h,r.MaxKey=f,r.MinKey=p,r.ObjectId=d,r.ObjectID=d,r.BSONRegExp=m,r.Symbol=y,r.Timestamp=g,t.exports=r},function(t,e,n){"use strict";const r=n(13).EventEmitter,i=n(53),o=n(23).debugOptions,s=n(14).parseHeader,a=n(41).decompress,c=n(37).Response,u=n(56).BinMsg,l=n(5).MongoNetworkError,h=n(5).MongoError,f=n(34),p=n(14).opcodes.OP_COMPRESSED,d=n(14).opcodes.OP_MSG,m=n(14).MESSAGE_HEADER_SIZE,y=n(29).Buffer;let g=0;const v=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"];let b=void 0,_=!1,w={};function S(t){delete w[t],b&&b.deleteConnection(t)}function O(t,e){const n=s(e);if(n.opCode!==p){const r=n.opCode===d?u:c;return void t.emit("message",new r(t.bson,e,n,e.slice(m),t.responseOptions),t)}n.fromCompressed=!0;let r=m;n.opCode=e.readInt32LE(r),r+=4,n.length=e.readInt32LE(r),r+=4;const i=e[r];r++,a(i,e.slice(r),(r,i)=>{if(r)return void t.emit("error",r);if(i.length!==n.length)return void t.emit("error",new h("Decompressing a compressed message from the server failed. The message is corrupt."));const o=n.opCode===d?u:c;t.emit("message",new o(t.bson,e,n,i,t.responseOptions),t)})}t.exports=class extends r{constructor(t,e){if(super(),!(e=e||{}).bson)throw new TypeError("must pass in valid bson parser");this.id=g++,this.options=e,this.logger=f("Connection",e),this.bson=e.bson,this.tag=e.tag,this.maxBsonMessageSize=e.maxBsonMessageSize||67108864,this.port=e.port||27017,this.host=e.host||"localhost",this.socketTimeout="number"==typeof e.socketTimeout?e.socketTimeout:36e4,this.keepAlive="boolean"!=typeof e.keepAlive||e.keepAlive,this.keepAliveInitialDelay="number"==typeof e.keepAliveInitialDelay?e.keepAliveInitialDelay:3e5,this.connectionTimeout="number"==typeof e.connectionTimeout?e.connectionTimeout:3e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.logger.isDebug()&&this.logger.debug(`creating connection ${this.id} with options [${JSON.stringify(o(v,e))}]`),this.responseOptions={promoteLongs:"boolean"!=typeof e.promoteLongs||e.promoteLongs,promoteValues:"boolean"!=typeof e.promoteValues||e.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers&&e.promoteBuffers},this.flushing=!1,this.queue=[],this.writeStream=null,this.destroyed=!1,this.timedOut=!1;const n=i.createHash("sha1");var r,s,a;n.update(this.address),this.hashedName=n.digest("hex"),this.workItems=[],this.socket=t,this.socket.once("error",(r=this,function(t){_&&S(r.id),r.logger.isDebug()&&r.logger.debug(`connection ${r.id} for [${r.address}] errored out with [${JSON.stringify(t)}]`),r.emit("error",new l(t),r)})),this.socket.once("timeout",function(t){return function(){_&&S(t.id),t.logger.isDebug()&&t.logger.debug(`connection ${t.id} for [${t.address}] timed out`),t.timedOut=!0,t.emit("timeout",new l(`connection ${t.id} to ${t.address} timed out`),t)}}(this)),this.socket.once("close",function(t){return function(e){_&&S(t.id),t.logger.isDebug()&&t.logger.debug(`connection ${t.id} with for [${t.address}] closed`),e||t.emit("close",new l(`connection ${t.id} to ${t.address} closed`),t)}}(this)),this.socket.on("data",function(t){return function(e){for(;e.length>0;)if(t.bytesRead>0&&t.sizeOfMessage>0){const n=t.sizeOfMessage-t.bytesRead;if(n>e.length)e.copy(t.buffer,t.bytesRead),t.bytesRead=t.bytesRead+e.length,e=y.alloc(0);else{e.copy(t.buffer,t.bytesRead,0,n),e=e.slice(n);const r=t.buffer;t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,O(t,r)}}else if(null!=t.stubBuffer&&t.stubBuffer.length>0)if(t.stubBuffer.length+e.length>4){const n=y.alloc(t.stubBuffer.length+e.length);t.stubBuffer.copy(n,0),e.copy(n,t.stubBuffer.length),e=n,t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null}else{const n=y.alloc(t.stubBuffer.length+e.length);t.stubBuffer.copy(n,0),e.copy(n,t.stubBuffer.length),e=y.alloc(0)}else if(e.length>4){const n=e[0]|e[1]<<8|e[2]<<16|e[3]<<24;if(n<0||n>t.maxBsonMessageSize){const e={err:"socketHandler",trace:"",bin:t.buffer,parseState:{sizeOfMessage:n,bytesRead:t.bytesRead,stubBuffer:t.stubBuffer}};return void t.emit("parseError",e,t)}if(n>4&&n<t.maxBsonMessageSize&&n>e.length)t.buffer=y.alloc(n),e.copy(t.buffer,0),t.bytesRead=e.length,t.sizeOfMessage=n,t.stubBuffer=null,e=y.alloc(0);else if(n>4&&n<t.maxBsonMessageSize&&n===e.length){const n=e;t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=y.alloc(0),O(t,n)}else if(n<=4||n>t.maxBsonMessageSize){const r={err:"socketHandler",trace:null,bin:e,parseState:{sizeOfMessage:n,bytesRead:0,buffer:null,stubBuffer:null}};t.emit("parseError",r,t),t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=y.alloc(0)}else{const r=e.slice(0,n);t.buffer=null,t.sizeOfMessage=0,t.bytesRead=0,t.stubBuffer=null,e=e.slice(n),O(t,r)}}else t.stubBuffer=y.alloc(e.length),e.copy(t.stubBuffer,0),e=y.alloc(0)}}(this)),_&&(s=this.id,a=this,w[s]=a,b&&b.addConnection(s,a))}setSocketTimeout(t){this.socket&&this.socket.setTimeout(t)}resetSocketTimeout(){this.socket&&this.socket.setTimeout(this.socketTimeout)}static enableConnectionAccounting(t){t&&(b=t),_=!0,w={}}static disableConnectionAccounting(){_=!1,b=void 0}static connections(){return w}get address(){return`${this.host}:${this.port}`}unref(){null!=this.socket?this.socket.unref():this.once("connect",()=>this.socket.unref())}flush(t){for(;this.workItems.length>0;){const e=this.workItems.shift();e.cb&&e.cb(t)}}destroy(t,e){if("function"==typeof t&&(e=t,t={}),t=Object.assign({force:!1},t),_&&S(this.id),null!=this.socket)return t.force||this.timedOut?(this.socket.destroy(),this.destroyed=!0,void("function"==typeof e&&e(null,null))):void this.socket.end(t=>{this.destroyed=!0,"function"==typeof e&&e(t,null)});this.destroyed=!0}write(t){if(this.logger.isDebug())if(Array.isArray(t))for(let e=0;e<t.length;e++)this.logger.debug(`writing buffer [${t[e].toString("hex")}] to ${this.address}`);else this.logger.debug(`writing buffer [${t.toString("hex")}] to ${this.address}`);if(!1===this.socket.destroyed){if(!Array.isArray(t))return this.socket.write(t,"binary"),!0;for(let e=0;e<t.length;e++)this.socket.write(t[e],"binary");return!0}return!1}toString(){return""+this.id}toJSON(){return{id:this.id,host:this.host,port:this.port}}isConnected(){return!this.destroyed&&(!this.socket.destroyed&&this.socket.writable)}}},function(t,e,n){"use strict";const r=n(27).ServerType,i=n(95).ServerDescription,o=n(157),s=n(27).TopologyType,a=o.MIN_SUPPORTED_SERVER_VERSION,c=o.MAX_SUPPORTED_SERVER_VERSION,u=o.MIN_SUPPORTED_WIRE_VERSION,l=o.MAX_SUPPORTED_WIRE_VERSION;class h{constructor(t,e,n,i,o,h,f){f=f||{},this.type=t||s.Unknown,this.setName=n||null,this.maxSetVersion=i||null,this.maxElectionId=o||null,this.servers=e||new Map,this.stale=!1,this.compatible=!0,this.compatibilityError=null,this.logicalSessionTimeoutMinutes=null,this.heartbeatFrequencyMS=f.heartbeatFrequencyMS||0,this.localThresholdMS=f.localThresholdMS||0,this.commonWireVersion=h||null,Object.defineProperty(this,"options",{value:f,enumberable:!1});for(const t of this.servers.values())if(t.type!==r.Unknown&&(t.minWireVersion>l&&(this.compatible=!1,this.compatibilityError=`Server at ${t.address} requires wire version ${t.minWireVersion}, but this version of the driver only supports up to ${l} (MongoDB ${c})`),t.maxWireVersion<u)){this.compatible=!1,this.compatibilityError=`Server at ${t.address} reports wire version ${t.maxWireVersion}, but this version of the driver requires at least ${u} (MongoDB ${a}).`;break}const p=Array.from(this.servers.values()).filter(t=>t.isReadable);this.logicalSessionTimeoutMinutes=p.reduce((t,e)=>null==e.logicalSessionTimeoutMinutes?null:null==t?e.logicalSessionTimeoutMinutes:Math.min(t,e.logicalSessionTimeoutMinutes),null)}updateFromSrvPollingEvent(t){const e=t.addresses(),n=new Map(this.servers);for(const t of this.servers)e.has(t[0])?e.delete(t[0]):n.delete(t[0]);if(n.size===this.servers.size&&0===e.size)return this;for(const t of e)n.set(t,new i(t));return new h(this.type,n,this.setName,this.maxSetVersion,this.maxElectionId,this.commonWireVersion,this.options,null)}update(t){const e=t.address;let n=this.type,o=this.setName,a=this.maxSetVersion,c=this.maxElectionId,u=this.commonWireVersion;const l=t.type;let d=new Map(this.servers);if(0!==t.maxWireVersion&&(u=null==u?t.maxWireVersion:Math.min(u,t.maxWireVersion)),d.set(e,t),n===s.Single)return new h(s.Single,d,o,a,c,u,this.options);if(n===s.Unknown&&(l===r.Standalone?d.delete(e):n=function(t){return t===r.Mongos?s.Sharded:t===r.RSPrimary?s.ReplicaSetWithPrimary:s.ReplicaSetNoPrimary}(l)),n===s.Sharded&&-1===[r.Mongos,r.Unknown].indexOf(l)&&d.delete(e),n===s.ReplicaSetNoPrimary)if([r.Standalone,r.Mongos].indexOf(l)>=0&&d.delete(e),l===r.RSPrimary){const e=f(d,o,t,a,c);n=e[0],o=e[1],a=e[2],c=e[3]}else if([r.RSSecondary,r.RSArbiter,r.RSOther].indexOf(l)>=0){const e=function(t,e,n){let r=s.ReplicaSetNoPrimary;if((e=e||n.setName)!==n.setName)return t.delete(n.address),[r,e];n.allHosts.forEach(e=>{t.has(e)||t.set(e,new i(e))}),n.me&&n.address!==n.me&&t.delete(n.address);return[r,e]}(d,o,t);n=e[0],o=e[1]}if(n===s.ReplicaSetWithPrimary)if([r.Standalone,r.Mongos].indexOf(l)>=0)d.delete(e),n=p(d);else if(l===r.RSPrimary){const e=f(d,o,t,a,c);n=e[0],o=e[1],a=e[2],c=e[3]}else n=[r.RSSecondary,r.RSArbiter,r.RSOther].indexOf(l)>=0?function(t,e,n){if(null==e)throw new TypeError("setName is required");(e!==n.setName||n.me&&n.address!==n.me)&&t.delete(n.address);return p(t)}(d,o,t):p(d);return new h(n,d,o,a,c,u,this.options)}get error(){const t=Array.from(this.servers.values()).filter(t=>t.error);if(t.length>0)return t[0].error}get hasKnownServers(){return Array.from(this.servers.values()).some(t=>t.type!==r.Unknown)}get hasDataBearingServers(){return Array.from(this.servers.values()).some(t=>t.isDataBearing)}hasServer(t){return this.servers.has(t)}}function f(t,e,n,o,s){if((e=e||n.setName)!==n.setName)return t.delete(n.address),[p(t),e,o,s];const a=n.electionId?n.electionId:null;if(n.setVersion&&a){if(o&&s&&(o>n.setVersion||function(t,e){if(null==t)return-1;if(null==e)return 1;if(t.id instanceof Buffer&&e.id instanceof Buffer){const n=t.id,r=e.id;return n.compare(r)}const n=t.toString(),r=e.toString();return n.localeCompare(r)}(s,a)>0))return t.set(n.address,new i(n.address)),[p(t),e,o,s];s=n.electionId}null!=n.setVersion&&(null==o||n.setVersion>o)&&(o=n.setVersion);for(const e of t.keys()){const o=t.get(e);if(o.type===r.RSPrimary&&o.address!==n.address){t.set(e,new i(o.address));break}}n.allHosts.forEach(e=>{t.has(e)||t.set(e,new i(e))});const c=Array.from(t.keys()),u=n.allHosts;return c.filter(t=>-1===u.indexOf(t)).forEach(e=>{t.delete(e)}),[p(t),e,o,s]}function p(t){for(const e of t.keys())if(t.get(e).type===r.RSPrimary)return s.ReplicaSetWithPrimary;return s.ReplicaSetNoPrimary}t.exports={TopologyDescription:h}},function(t,e,n){"use strict";e.asyncIterator=function(){const t=this;return{next:function(){return Promise.resolve().then(()=>t.next()).then(e=>e?{value:e,done:!1}:t.close().then(()=>({value:e,done:!0})))}}}},function(t,e,n){"use strict";t.exports={MIN_SUPPORTED_SERVER_VERSION:"2.6",MAX_SUPPORTED_SERVER_VERSION:"4.2",MIN_SUPPORTED_WIRE_VERSION:2,MAX_SUPPORTED_WIRE_VERSION:8}},function(t,e,n){"use strict";var r=function(t,e,n){this.result=t,this.connection=e,this.message=n};r.prototype.toJSON=function(){let t=Object.assign({},this,this.result);return delete t.message,t},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.exports=r},function(t,e,n){"use strict";const r=n(56).Msg,i=n(37).KillCursor,o=n(37).GetMore,s=n(0).calculateDurationInMs,a=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),c=t=>Object.keys(t)[0],u=t=>t.ns,l=t=>t.ns.split(".")[0],h=t=>t.ns.split(".")[1],f=t=>t.options?`${t.options.host}:${t.options.port}`:t.address,p=(t,e)=>a.has(t)?{}:e,d={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},m={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},y=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],g=t=>{if(t instanceof o)return{getMore:t.cursorId,collection:h(t),batchSize:t.numberToReturn};if(t instanceof i)return{killCursors:h(t),cursors:t.cursorIds};if(t instanceof r)return t.command;if(t.query&&t.query.$query){let e;return"admin.$cmd"===t.ns?e=Object.assign({},t.query.$query):(e={find:h(t)},Object.keys(d).forEach(n=>{void 0!==t.query[n]&&(e[d[n]]=t.query[n])})),Object.keys(m).forEach(n=>{void 0!==t[n]&&(e[m[n]]=t[n])}),y.forEach(n=>{t[n]&&(e[n]=t[n])}),void 0!==t.pre32Limit&&(e.limit=t.pre32Limit),t.query.$explain?{explain:e}:e}return t.query?t.query:t},v=(t,e)=>t instanceof o?{ok:1,cursor:{id:e.message.cursorId,ns:u(t),nextBatch:e.message.documents}}:t instanceof i?{ok:1,cursorsUnknown:t.cursorIds}:t.query&&void 0!==t.query.$query?{ok:1,cursor:{id:e.message.cursorId,ns:u(t),firstBatch:e.message.documents}}:e&&e.result?e.result:e,b=t=>{if((t=>t.s&&t.queue)(t))return{connectionId:f(t)};const e=t;return{address:e.address,connectionId:e.id}};t.exports={CommandStartedEvent:class{constructor(t,e){const n=g(e),r=c(n),i=b(t);a.has(r)&&(this.commandObj={},this.commandObj[r]=!0),Object.assign(this,i,{requestId:e.requestId,databaseName:l(e),commandName:r,command:n})}},CommandSucceededEvent:class{constructor(t,e,n,r){const i=g(e),o=c(i),a=b(t);Object.assign(this,a,{requestId:e.requestId,commandName:o,duration:s(r),reply:p(o,v(e,n))})}},CommandFailedEvent:class{constructor(t,e,n,r){const i=g(e),o=c(i),a=b(t);Object.assign(this,a,{requestId:e.requestId,commandName:o,duration:s(r),failure:p(o,n)})}}}},function(t,e,n){"use strict";const r=n(161),i=n(162),o=n(163),s=n(164),a=n(267),c=n(96).ScramSHA1,u=n(96).ScramSHA256;t.exports={defaultAuthProviders:function(t){return{mongocr:new r(t),x509:new i(t),plain:new o(t),gssapi:new s(t),sspi:new a(t),"scram-sha-1":new c(t),"scram-sha-256":new u(t)}}}},function(t,e,n){"use strict";const r=n(53),i=n(57).AuthProvider;t.exports=class extends i{_authenticateSingleConnection(t,e,n,i){const o=n.username,s=n.password,a=n.source;t(e,`${a}.$cmd`,{getnonce:1},(n,c)=>{let u=null,l=null;if(null==n){u=c.nonce;let t=r.createHash("md5");t.update(o+":mongo:"+s,"utf8");const e=t.digest("hex");t=r.createHash("md5"),t.update(u+o+e,"utf8"),l=t.digest("hex")}t(e,`${a}.$cmd`,{authenticate:1,user:o,nonce:u,key:l},i)})}}},function(t,e,n){"use strict";const r=n(57).AuthProvider;t.exports=class extends r{_authenticateSingleConnection(t,e,n,r){const i=n.username,o={authenticate:1,mechanism:"MONGODB-X509"};i&&(o.user=i),t(e,"$external.$cmd",o,r)}}},function(t,e,n){"use strict";const r=n(23).retrieveBSON,i=n(57).AuthProvider,o=r().Binary;t.exports=class extends i{_authenticateSingleConnection(t,e,n,r){const i=n.username,s=n.password;t(e,"$external.$cmd",{saslStart:1,mechanism:"PLAIN",payload:new o(`\0${i}\0${s}`),autoAuthorize:1},r)}}},function(t,e,n){"use strict";const r=n(57).AuthProvider,i=n(9).retrieveKerberos;let o;var s=function(t,e,n,r,i,o,s,c,u,l,h){var f=new e(u.host,u.port,s,l);f.init(r,i,(function(e){if(e)return h(e,!1);f.transition("",(function(e,s){if(e)return h(e,!1);a(t,f,s,n,r,i,o,c,u,h)}))}))},a=function(t,e,n,r,i,o,s,a,u,l){a(u,"$external.$cmd",{saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1},(n,h)=>{if(n)return l(n,!1);e.transition(h.payload,(function(n,f){if(n)return l(n,!1);c(t,e,f,h,r,i,o,s,a,u,l)}))})},c=function(t,e,n,r,i,o,s,a,c,l,h){var f={saslContinue:1,conversationId:r.conversationId,payload:n};c(l,"$external.$cmd",f,(n,r)=>{if(n)return h(n,!1);e.transition(r.payload,(function(n,f){if(n)return h(n,!1);u(t,e,f,r,i,o,s,a,c,l,h)}))})},u=function(t,e,n,r,i,o,s,a,c,u,l){c(u,"$external.$cmd",{saslContinue:1,conversationId:r.conversationId,payload:n},(t,n)=>{if(t)return l(t,!1);e.transition(null,(function(t){if(t)return l(t,null);l(null,n)}))})};t.exports=class extends r{_authenticateSingleConnection(t,e,n,r){const i=n.source,a=n.username,c=n.password,u=n.mechanismProperties,l=u.gssapiservicename||u.gssapiServiceName||"mongodb";s(this,o.processes.MongoAuthProcess,i,a,c,i,l,t,e,u,r)}auth(t,e,n,r){if(null==o)try{o=i()}catch(t){return r(t,null)}super.auth(t,e,n,r)}}},function(t,e,n){"use strict";const r=n(272);t.exports={insert:function(t,e,n,i,o){r(t,"insert","documents",e,n,i,o)},update:function(t,e,n,i,o){r(t,"update","updates",e,n,i,o)},remove:function(t,e,n,i,o){r(t,"delete","deletes",e,n,i,o)},killCursors:n(273),getMore:n(274),query:n(275),command:n(72)}},function(t,e,n){"use strict";t.exports={ServerDescriptionChangedEvent:class{constructor(t,e,n,r){Object.assign(this,{topologyId:t,address:e,previousDescription:n,newDescription:r})}},ServerOpeningEvent:class{constructor(t,e){Object.assign(this,{topologyId:t,address:e})}},ServerClosedEvent:class{constructor(t,e){Object.assign(this,{topologyId:t,address:e})}},TopologyDescriptionChangedEvent:class{constructor(t,e,n){Object.assign(this,{topologyId:t,previousDescription:e,newDescription:n})}},TopologyOpeningEvent:class{constructor(t){Object.assign(this,{topologyId:t})}},TopologyClosedEvent:class{constructor(t){Object.assign(this,{topologyId:t})}},ServerHeartbeatStartedEvent:class{constructor(t){Object.assign(this,{connectionId:t})}},ServerHeartbeatSucceededEvent:class{constructor(t,e,n){Object.assign(this,{connectionId:n,duration:t,reply:e})}},ServerHeartbeatFailedEvent:class{constructor(t,e,n){Object.assign(this,{connectionId:n,duration:t,failure:e})}}}},function(t,e,n){"use strict";const r=n(13),i=n(282),o=n(5).MongoError,s=n(5).MongoNetworkError,a=n(5).MongoWriteConcernError,c=n(158),u=n(291).StreamDescription,l=n(165),h=n(159),f=n(47).updateSessionFromResponse,p=n(9).uuidV4,d=n(0).now,m=n(0).calculateDurationInMs,y=Symbol("stream"),g=Symbol("queue"),v=Symbol("messageStream"),b=Symbol("generation"),_=Symbol("lastUseTime"),w=Symbol("clusterTime"),S=Symbol("description"),O=Symbol("ismaster"),E=Symbol("autoEncrypter");function T(t){const e={description:t.description,clusterTime:t[w],s:{bson:t.bson,pool:{write:C.bind(t),isConnected:()=>!0}}};return t[E]&&(e.autoEncrypter=t[E]),e}function C(t,e,n){"function"==typeof e&&(n=e),e=e||{};const r={requestId:t.requestId,cb:n,session:e.session,fullResult:"boolean"==typeof e.fullResult&&e.fullResult,noResponse:"boolean"==typeof e.noResponse&&e.noResponse,documentsReturnedIn:e.documentsReturnedIn,command:!!e.command,promoteLongs:"boolean"!=typeof e.promoteLongs||e.promoteLongs,promoteValues:"boolean"!=typeof e.promoteValues||e.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers&&e.promoteBuffers,raw:"boolean"==typeof e.raw&&e.raw};this[S]&&this[S].compressor&&(r.agreedCompressor=this[S].compressor,this[S].zlibCompressionLevel&&(r.zlibCompressionLevel=this[S].zlibCompressionLevel)),"number"==typeof e.socketTimeout&&(r.socketTimeoutOverride=!0,this[y].setTimeout(e.socketTimeout)),this.monitorCommands&&(this.emit("commandStarted",new h.CommandStartedEvent(this,t)),r.started=d(),r.cb=(e,i)=>{e?this.emit("commandFailed",new h.CommandFailedEvent(this,t,e,r.started)):i&&i.result&&(0===i.result.ok||i.result.$err)?this.emit("commandFailed",new h.CommandFailedEvent(this,t,i.result,r.started)):this.emit("commandSucceeded",new h.CommandSucceededEvent(this,t,i,r.started)),"function"==typeof n&&n(e,i)}),r.noResponse||this[g].set(r.requestId,r);try{this[v].writeCommand(t,r)}catch(t){if(!r.noResponse)return this[g].delete(r.requestId),void r.cb(t)}r.noResponse&&r.cb()}t.exports={Connection:class extends r{constructor(t,e){var n;super(e),this.id=e.id,this.address=function(t){if("function"==typeof t.address)return`${t.remoteAddress}:${t.remotePort}`;return p().toString("hex")}(t),this.bson=e.bson,this.socketTimeout="number"==typeof e.socketTimeout?e.socketTimeout:36e4,this.monitorCommands="boolean"==typeof e.monitorCommands&&e.monitorCommands,this.closed=!1,this.destroyed=!1,this[S]=new u(this.address,e),this[b]=e.generation,this[_]=d(),e.autoEncrypter&&(this[E]=e.autoEncrypter),this[g]=new Map,this[v]=new i(e),this[v].on("message",(n=this,function(t){if(n.emit("message",t),!n[g].has(t.responseTo))return;const e=n[g].get(t.responseTo);n[g].delete(t.responseTo),t.moreToCome&&n[g].set(t.requestId,e);const r=e.cb;e.socketTimeoutOverride&&n[y].setTimeout(n.socketTimeout);try{t.parse(e)}catch(t){return void r(new o(t))}if(t.documents[0]){const i=t.documents[0],s=e.session;if(s&&f(s,i),i.$clusterTime&&(n[w]=i.$clusterTime,n.emit("clusterTimeReceived",i.$clusterTime)),e.command){if(i.writeConcernError)return void r(new a(i.writeConcernError,i));if(0===i.ok||i.$err||i.errmsg||i.code)return void r(new o(i))}}r(void 0,new c(e.fullResult?t:t.documents[0],n,t))})),this[y]=t,t.on("error",()=>{}),t.on("close",()=>{this.closed||(this.closed=!0,this[g].forEach(t=>t.cb(new s(`connection ${this.id} to ${this.address} closed`))),this[g].clear(),this.emit("close"))}),t.on("timeout",()=>{this.closed||(t.destroy(),this.closed=!0,this[g].forEach(t=>t.cb(new s(`connection ${this.id} to ${this.address} timed out`))),this[g].clear(),this.emit("close"))}),t.pipe(this[v]),this[v].pipe(t)}get description(){return this[S]}get ismaster(){return this[O]}set ismaster(t){this[S].receiveResponse(t),this[O]=t}get generation(){return this[b]||0}get idleTime(){return m(this[_])}get clusterTime(){return this[w]}get stream(){return this[y]}markAvailable(){this[_]=d()}destroy(t,e){return"function"==typeof t&&(e=t,t={}),t=Object.assign({force:!1},t),null==this[y]||this.destroyed?(this.destroyed=!0,void("function"==typeof e&&e())):t.force?(this[y].destroy(),this.destroyed=!0,void("function"==typeof e&&e())):void this[y].end(t=>{this.destroyed=!0,"function"==typeof e&&e(t)})}command(t,e,n,r){l.command(T(this),t,e,n,r)}query(t,e,n,r,i){l.query(T(this),t,e,n,r,i)}getMore(t,e,n,r,i){l.getMore(T(this),t,e,n,r,i)}killCursors(t,e,n){l.killCursors(T(this),t,e,n)}insert(t,e,n,r){l.insert(T(this),t,e,n,r)}update(t,e,n,r){l.update(T(this),t,e,n,r)}remove(t,e,n,r){l.remove(T(this),t,e,n,r)}}}},function(t,e,n){"use strict";var r=n(98);t.exports=v;var i,o=n(285);v.ReadableState=g;n(13).EventEmitter;var s=function(t,e){return t.listeners(e).length},a=n(169),c=n(124).Buffer,u=global.Uint8Array||function(){};var l=Object.create(n(74));l.inherits=n(75);var h=n(6),f=void 0;f=h&&h.debuglog?h.debuglog("stream"):function(){};var p,d=n(287),m=n(170);l.inherits(v,a);var y=["error","close","destroy","pause","resume"];function g(t,e){t=t||{};var r=e instanceof(i=i||n(59));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var o=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=n(172).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function v(t){if(i=i||n(59),!(this instanceof v))return new v(t);this._readableState=new g(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function b(t,e,n,r,i){var o,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,S(t)}(t,s)):(i||(o=function(t,e){var n;r=e,c.isBuffer(r)||r instanceof u||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(s,e)),o?t.emit("error",o):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function(t){return c.from(t)}(e)),r?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):_(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(e=s.decoder.write(e),s.objectMode||0!==e.length?_(t,s,e,!1):E(t,s)):_(t,s,e,!1))):r||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function _(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&S(t)),E(t,e)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(t,e){this.push(null),e(t)},v.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=c.from(t,e),e=""),n=!0),b(this,t,e,!1,n)},v.prototype.unshift=function(t){return b(this,t,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(t){return p||(p=n(172).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};function w(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(O,t):O(t))}function O(t){f("emit readable"),t.emit("readable"),A(t)}function E(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(T,t,e))}function T(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function C(t){f("readable nexttick read 0"),t.read(0)}function I(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),A(t),e.flowing&&!e.reading&&t.read(0)}function A(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function k(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var r;t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,r=1,i=n.data;t-=i.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0===(t-=s)){s===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++r}return e.length-=r,i}(t,e):function(t,e){var n=c.allocUnsafe(t),r=e.head,i=1;r.data.copy(n),t-=r.data.length;for(;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,s),0===(t-=s)){s===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++i}return e.length-=i,n}(t,e);return r}(t,e.buffer,e.decoder),n);var n}function x(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(N,e,t))}function N(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function P(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}v.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?x(this):S(this),null;if(0===(t=w(t,e))&&e.ended)return 0===e.length&&x(this),null;var r,i=e.needReadable;return f("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",i=!0),e.ended||e.reading?f("reading or ended",i=!1):i&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=w(n,e))),null===(r=t>0?k(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&x(this)),null!==r&&this.emit("data",r),r},v.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(t,e){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=t;break;case 1:i.pipes=[i.pipes,t];break;default:i.pipes.push(t)}i.pipesCount+=1,f("pipe count=%d opts=%j",i.pipesCount,e);var a=(!e||!1!==e.end)&&t!==process.stdout&&t!==process.stderr?u:v;function c(e,r){f("onunpipe"),e===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),t.removeListener("close",y),t.removeListener("finish",g),t.removeListener("drain",l),t.removeListener("error",m),t.removeListener("unpipe",c),n.removeListener("end",u),n.removeListener("end",v),n.removeListener("data",d),h=!0,!i.awaitDrain||t._writableState&&!t._writableState.needDrain||l())}function u(){f("onend"),t.end()}i.endEmitted?r.nextTick(a):n.once("end",a),t.on("unpipe",c);var l=function(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,A(t))}}(n);t.on("drain",l);var h=!1;var p=!1;function d(e){f("ondata"),p=!1,!1!==t.write(e)||p||((1===i.pipesCount&&i.pipes===t||i.pipesCount>1&&-1!==P(i.pipes,t))&&!h&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function m(e){f("onerror",e),v(),t.removeListener("error",m),0===s(t,"error")&&t.emit("error",e)}function y(){t.removeListener("finish",g),v()}function g(){f("onfinish"),t.removeListener("close",y),v()}function v(){f("unpipe"),n.unpipe(t)}return n.on("data",d),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",m),t.once("close",y),t.once("finish",g),t.emit("pipe",n),i.flowing||(f("pipe resume"),n.resume()),t},v.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n)),this;if(!t){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=P(e.pipes,t);return-1===s||(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n)),this},v.prototype.on=function(t,e){var n=a.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&S(this):r.nextTick(C,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(I,t,e))}(this,t)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(t){var e=this,n=this._readableState,r=!1;for(var i in t.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(i){(f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(e.push(i)||(r=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<y.length;o++)t.on(y[o],this.emit.bind(this,y[o]));return this._read=function(e){f("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=k},function(t,e,n){t.exports=n(26)},function(t,e,n){"use strict";var r=n(98);function i(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?(r.nextTick(i,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){"use strict";var r=n(98);function i(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var r=t.entry;t.entry=null;for(;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=y;var o,s=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:r.nextTick;y.WritableState=m;var a=Object.create(n(74));a.inherits=n(75);var c={deprecate:n(288)},u=n(169),l=n(124).Buffer,h=global.Uint8Array||function(){};var f,p=n(170);function d(){}function m(t,e){o=o||n(59),t=t||{};var a=e instanceof o;this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var c=t.highWaterMark,u=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:a&&(u||0===u)?u:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===t.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,i=n.sync,o=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,i,o){--e.pendingcb,n?(r.nextTick(o,i),r.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit("error",i)):(o(i),t._writableState.errorEmitted=!0,t.emit("error",i),S(t,e))}(t,n,i,e,o);else{var a=_(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||b(t,n),i?s(v,t,n,a,o):v(t,n,a,o)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function y(t){if(o=o||n(59),!(f.call(y,this)||this instanceof o))return new y(t);this._writableState=new m(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),u.call(this)}function g(t,e,n,r,i,o,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function v(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),S(t,e)}function b(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,o=new Array(r),s=e.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)o[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;o.allBuffers=c,g(t,e,!0,e.length,o,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new i(e),e.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,h=n.callback;if(g(t,e,!1,e.objectMode?1:u.length,u,l,h),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function _(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function w(t,e){t._final((function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),S(t,e)}))}function S(t,e){var n=_(e);return n&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,r.nextTick(w,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}a.inherits(y,u),m.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(m.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(t){return!!f.call(this,t)||this===y&&(t&&t._writableState instanceof m)}})):f=function(t){return t instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(t,e,n){var i,o=this._writableState,s=!1,a=!o.objectMode&&(i=t,l.isBuffer(i)||i instanceof h);return a&&!l.isBuffer(t)&&(t=function(t){return l.from(t)}(t)),"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=o.defaultEncoding),"function"!=typeof n&&(n=d),o.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),r.nextTick(e,n)}(this,n):(a||function(t,e,n,i){var o=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),r.nextTick(i,s),o=!1),o}(this,o,t,n))&&(o.pendingcb++,s=function(t,e,n,r,i,o){if(!n){var s=function(t,e,n){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=l.from(e,n));return e}(e,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=e.objectMode?1:r.length;e.length+=a;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else g(t,e,!1,a,r,i,o);return c}(this,o,a,t,e,n)),s},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},y.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(t,e,n){var i=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(t,e,n){e.ending=!0,S(t,e),n&&(e.finished?r.nextTick(n):t.once("finish",n));e.ended=!0,t.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),y.prototype.destroy=p.destroy,y.prototype._undestroy=p.undestroy,y.prototype._destroy=function(t,e){this.end(),e(t)}},function(t,e,n){"use strict";var r=n(289).Buffer,i=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(r.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=c,this.end=u,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=l,this.end=h,e=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function u(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function l(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function h(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},o.prototype.text=function(t,e){var n=function(t,e,n){var r=e.length-1;if(r<n)return 0;var i=s(e[r]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=s(e[r]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=s(e[r]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){"use strict";t.exports=s;var r=n(59),i=Object.create(n(74));function o(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(t){if(!(this instanceof s))return new s(t);r.call(this,t),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,n){c(t,e,n)})):c(this,null,null)}function c(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=n(75),i.inherits(s,r),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var n=this;r.prototype._destroy.call(this,t,(function(t){e(t),n.emit("close")}))}},function(t,e,n){"use strict";const r=n(3).MongoNetworkError,i=new Set([6,7,89,91,189,262,9001,10107,11600,11602,13435,13436,63,150,13388,234,133]);t.exports={GET_MORE_RESUMABLE_CODES:i,isResumableError:function(t,e){return t instanceof r||(e>=9?t.hasErrorLabel("ResumableChangeStreamError"):i.has(t.code))}}},function(t,e,n){"use strict";const r=n(0).applyRetryableWrites,i=n(0).applyWriteConcern,o=n(3).MongoError,s=n(4).OperationBase;t.exports=class extends s{constructor(t,e,n){super(n),this.collection=t,this.operations=e}execute(t){const e=this.collection,n=this.operations;let s=this.options;e.s.options.ignoreUndefined&&(s=Object.assign({},s),s.ignoreUndefined=e.s.options.ignoreUndefined);const a=!0===s.ordered||null==s.ordered?e.initializeOrderedBulkOp(s):e.initializeUnorderedBulkOp(s);let c=!1;try{for(let t=0;t<n.length;t++){const e=Object.keys(n[t])[0];n[t][e].collation&&(c=!0),a.raw(n[t])}}catch(e){return t(e,null)}let u=Object.assign({},s);u=r(u,e.s.db),u=i(u,{db:e.s.db,collection:e},s);const l=u.writeConcern?u.writeConcern:{},h=e.s.topology.capabilities();if(c&&h&&!h.commandsTakeCollation)return t(new o("server/primary/mongos does not support collation"));a.execute(l,u,(e,n)=>{if(!n&&e)return t(e,null);n.insertedCount=n.nInserted,n.matchedCount=n.nMatched,n.modifiedCount=n.nModified||0,n.deletedCount=n.nRemoved,n.upsertedCount=n.getUpsertedIds().length,n.upsertedIds={},n.insertedIds={},n.n=n.insertedCount;const r=n.getInsertedIds();for(let t=0;t<r.length;t++)n.insertedIds[r[t].index]=r[t]._id;const i=n.getUpsertedIds();for(let t=0;t<i.length;t++)n.upsertedIds[i[t].index]=i[t]._id;t(null,n)})}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(30),o=n(4).defineAspects,s=n(0).handleCallback,a=n(3).MongoError,c=n(0).parseIndexOptions,u=new Set(["name","key","writeConcern","w","wtimeout","j","fsync","readPreference","session"]);class l extends i{constructor(t,e,n,r){super(t,r);const i=c(n),o={name:"string"==typeof r.name?r.name:i.name,key:i.fieldHash};this.name=e,this.fieldOrSpec=n,this.indexes=o}_buildCommand(){const t=this.options,e=this.name,n=this.indexes;for(let e in t)u.has(e)||(n[e]=t[e]);return{createIndexes:e,indexes:[n]}}execute(t){const e=this.db,n=this.options,r=this.indexes,i=e.s.topology.capabilities();if(n.collation&&i&&!i.commandsTakeCollation){const e=new a("server/primary/mongos does not support collation");return e.code=67,t(e)}if(n.writeConcern&&"function"!=typeof t)throw a.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});super.execute((e,n)=>s(t,e,null==e?r.name:n))}}o(l,r.WRITE_OPERATION),t.exports=l},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(30),s=n(0).applyWriteConcern,a=n(0).handleCallback;class c extends o{constructor(t,e,n){super(t.s.db,n,t),this.collection=t,this.indexName=e}_buildCommand(){const t=this.collection,e=this.indexName,n=this.options;let r={dropIndexes:t.collectionName,index:e};return r=s(r,{db:t.s.db,collection:t},n),r}execute(t){super.execute((e,n)=>{if("function"==typeof t)return e?a(t,e,null):void a(t,null,n)})}}i(c,r.WRITE_OPERATION),t.exports=c},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).indexInformation;t.exports=class extends r{constructor(t,e,n){super(n),this.db=t,this.name=e}execute(t){const e=this.db,n=this.name,r=this.options;i(e,n,r,t)}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).handleCallback,o=n(3).MongoError;t.exports=class extends r{constructor(t,e){super(e),this.collection=t}execute(t){const e=this.collection,n=this.options;e.s.db.listCollections({name:e.collectionName},n).toArray((n,r)=>n?i(t,n):0===r.length?i(t,o.create({message:`collection ${e.namespace} not found`,driver:!0})):void i(t,n,r[0].options||null))}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(30),o=n(4).defineAspects,s=n(53),a=n(0).handleCallback,c=n(0).toError;class u extends i{constructor(t,e,n,r){super(t,r),this.username=e,this.password=n}_buildCommand(){const t=this.db,e=this.username,n=this.password,r=this.options;let i=Array.isArray(r.roles)?r.roles:[];0===i.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6"),"admin"!==t.databaseName.toLowerCase()&&"admin"!==r.dbName||Array.isArray(r.roles)?Array.isArray(r.roles)||(i=["dbOwner"]):i=["root"];const o=t.s.topology.lastIsMaster().maxWireVersion>=7;let a=n;if(!o){const t=s.createHash("md5");t.update(e+":mongo:"+n),a=t.digest("hex")}const c={createUser:e,customData:r.customData||{},roles:i,digestPassword:o};return"string"==typeof n&&(c.pwd=a),c}execute(t){if(null!=this.options.digestPassword)return t(c("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));super.execute((e,n)=>a(t,e,e?null:n))}}o(u,r.WRITE_OPERATION),t.exports=u},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).handleCallback,o=n(3).MongoError,s=n(0).MongoDBNamespace;t.exports=class extends r{constructor(t,e,n){super(n),this.db=t,this.selector=e}execute(t){const e=this.db,n=this.selector,r=this.options,a=new s("admin","$cmd");e.s.topology.command(a,n,r,(n,r)=>e.serverConfig&&e.serverConfig.isDestroyed()?t(new o("topology was destroyed")):n?i(t,n):void i(t,null,r.result))}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(30),o=n(4).defineAspects,s=n(0).handleCallback,a=n(46);class c extends i{constructor(t,e,n){const r={},i=a.fromOptions(n);null!=i&&(r.writeConcern=i),n.dbName&&(r.dbName=n.dbName),"number"==typeof n.maxTimeMS&&(r.maxTimeMS=n.maxTimeMS),super(t,r),this.username=e}_buildCommand(){return{dropUser:this.username}}execute(t){super.execute((e,n)=>{if(e)return s(t,e,null);s(t,e,!!n.ok)})}}o(c,r.WRITE_OPERATION),t.exports=c},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).applyWriteConcern,o=n(0).checkCollectionName,s=n(20).executeDbAdminCommand,a=n(0).handleCallback,c=n(132).loadCollection,u=n(0).toError;t.exports=class extends r{constructor(t,e,n){super(n),this.collection=t,this.newName=e}execute(t){const e=this.collection,n=this.newName,r=this.options;let l=c();o(n);const h={renameCollection:e.namespace,to:e.s.namespace.withCollection(n).toString(),dropTarget:"boolean"==typeof r.dropTarget&&r.dropTarget};i(h,{db:e.s.db,collection:e},r),s(e.s.db.admin().s.db,h,r,(r,i)=>{if(r)return a(t,r,null);if(i.errmsg)return a(t,u(i),null);try{return a(t,null,new l(e.s.db,e.s.topology,e.s.namespace.db,n,e.s.pkFactory,e.s.options))}catch(r){return a(t,u(r),null)}})}}},function(t,e,n){"use strict";const r=n(0).applyWriteConcern,i=n(180),o=n(181),s=n(182),a=n(328),c=n(329),u=n(73);function l(t,e,n){if(!(this instanceof l))return new l(t,e);this.s={db:t,topology:e,promiseLibrary:n}}l.prototype.command=function(t,e,n){const r=Array.prototype.slice.call(arguments,1);n="function"==typeof r[r.length-1]?r.pop():void 0,e=r.length?r.shift():{};const i=new o(this.s.db,t,e);return u(this.s.db.s.topology,i,n)},l.prototype.buildInfo=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new o(this.s.db,{buildinfo:1},t);return u(this.s.db.s.topology,n,e)},l.prototype.serverInfo=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new o(this.s.db,{buildinfo:1},t);return u(this.s.db.s.topology,n,e)},l.prototype.serverStatus=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new o(this.s.db,{serverStatus:1},t);return u(this.s.db.s.topology,n,e)},l.prototype.ping=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new o(this.s.db,{ping:1},t);return u(this.s.db.s.topology,n,e)},l.prototype.addUser=function(t,e,n,o){const s=Array.prototype.slice.call(arguments,2);o="function"==typeof s[s.length-1]?s.pop():void 0,"string"==typeof t&&null!=e&&"object"==typeof e&&(n=e,e=null),n=s.length?s.shift():{},n=Object.assign({},n),(n=r(n,{db:this.s.db})).dbName="admin";const a=new i(this.s.db,t,e,n);return u(this.s.db.s.topology,a,o)},l.prototype.removeUser=function(t,e,n){const i=Array.prototype.slice.call(arguments,1);n="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():{},e=Object.assign({},e),(e=r(e,{db:this.s.db})).dbName="admin";const o=new s(this.s.db,t,e);return u(this.s.db.s.topology,o,n)},l.prototype.validateCollection=function(t,e,n){"function"==typeof e&&(n=e,e={});const r=new a(this,t,e=e||{});return u(this.s.db.s.topology,r,n)},l.prototype.listDatabases=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},u(this.s.db.s.topology,new c(this.s.db,t),e)},l.prototype.replSetGetStatus=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};const n=new o(this.s.db,{replSetGetStatus:1},t);return u(this.s.db.s.topology,n,e)},t.exports=l},function(t,e,n){"use strict";const r=n(3).Topology,i=n(48).ServerCapabilities,o=n(38),s=n(0).translateOptions;t.exports=class extends r{constructor(t,e){e=e||{};let n=Object.assign({},{cursorFactory:o,reconnect:!1,emitError:"boolean"!=typeof e.emitError||e.emitError,maxPoolSize:"number"==typeof e.maxPoolSize?e.maxPoolSize:"number"==typeof e.poolSize?e.poolSize:10,minPoolSize:"number"==typeof e.minPoolSize?e.minPoolSize:"number"==typeof e.minSize?e.minSize:0,monitorCommands:"boolean"==typeof e.monitorCommands&&e.monitorCommands});n=s(n,e);var r=e.socketOptions&&Object.keys(e.socketOptions).length>0?e.socketOptions:e;n=s(n,r),super(t,n)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.lastIsMaster()?null:(this.s.sCapabilities=new i(this.lastIsMaster()),this.s.sCapabilities)}command(t,e,n,r){super.command(t.toString(),e,n,r)}insert(t,e,n,r){super.insert(t.toString(),e,n,r)}update(t,e,n,r){super.update(t.toString(),e,n,r)}remove(t,e,n,r){super.remove(t.toString(),e,n,r)}}},function(t,e,n){"use strict";const r=n(6).deprecate,i=n(3).Logger,o=n(3).MongoCredentials,s=n(3).MongoError,a=n(187),c=n(185),u=n(3).parseConnectionString,l=n(58),h=n(3).ReadPreference,f=n(188),p=n(104),d=n(3).Sessions.ServerSessionPool,m=n(0).emitDeprecationWarning,y=n(54),g=n(23).retrieveBSON(),v=n(99).CMAP_EVENT_NAMES;let b;const _=r(n(335),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),w={DEFAULT:"default","MONGODB-CR":"mongocr",PLAIN:"plain","MONGODB-X509":"x509","SCRAM-SHA-1":"scram-sha-1","SCRAM-SHA-256":"scram-sha-256"},S=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],O=new Set(["DEFAULT","MONGODB-CR","PLAIN","MONGODB-X509","SCRAM-SHA-1","SCRAM-SHA-256","GSSAPI"]),E=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","retryReads","useNewUrlParser","useUnifiedTopology","serverSelectionTimeoutMS","useRecoveryToken","autoEncryption","driverInfo","tls","tlsInsecure","tlsinsecure","tlsAllowInvalidCertificates","tlsAllowInvalidHostnames","tlsCAFile","tlsCertificateFile","tlsCertificateKeyFile","tlsCertificateKeyFilePassword","minHeartbeatFrequencyMS","heartbeatFrequencyMS","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"],T=["native_parser"],C=["server","replset","replSet","mongos","db"];const I=E.reduce((t,e)=>(t[e.toLowerCase()]=e,t),{});function A(t,e){e.on("authenticated",P(t,"authenticated")),e.on("error",P(t,"error")),e.on("timeout",P(t,"timeout")),e.on("close",P(t,"close")),e.on("parseError",P(t,"parseError")),e.once("open",P(t,"open")),e.once("fullsetup",P(t,"fullsetup")),e.once("all",P(t,"all")),e.on("reconnect",P(t,"reconnect"))}function k(t,e){t.topology=e,e instanceof c||(e.s.sessionPool=new d(e.s.coreTopology))}function x(t,e){let r=(b||(b=n(100)),b);const i=[];return t instanceof r&&S.forEach(n=>{e.on(n,(e,r)=>{"open"===n?i.push({event:n,object1:t}):i.push({event:n,object1:e,object2:r})})}),i}const N=r(()=>{},"current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.");function P(t,e){const n=new Set(["all","fullsetup","open","reconnect"]);return(r,i)=>{if(n.has(e))return t.emit(e,t);t.emit(e,r,i)}}const j=new Set(["reconnect","reconnectFailed","attemptReconnect","joined","left","ping","ha","all","fullsetup","open"]);function R(t,e,r,i){r.promiseLibrary=t.s.promiseLibrary;const o={};"unified"===e&&(o.createServers=!1);const u=U(r,o);if(null!=r.autoEncryption){let e;try{!function(){var t=new Error("Cannot find module 'mongodb-client-encryption'");throw t.code="MODULE_NOT_FOUND",t}()}catch(t){return void i(new s("Auto-encryption requested, but the module is not installed. Please add `mongodb-client-encryption` as a dependency of your project"))}try{let t=n(!function(){var t=new Error("Cannot find module 'mongodb-client-encryption'");throw t.code="MODULE_NOT_FOUND",t}());"function"!=typeof t.extension&&i(new s("loaded version of `mongodb-client-encryption` does not have property `extension`. Please make sure you are loading the correct version of `mongodb-client-encryption`")),e=t.extension(n(40)).AutoEncrypter}catch(t){return void i(t)}const o=Object.assign({bson:r.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp])},r.autoEncryption);r.autoEncrypter=new e(t,o)}let l;"mongos"===e?l=new a(u,r):"replicaset"===e?l=new f(u,r):"unified"===e&&(l=new c(r.servers,r),function(t){t.on("newListener",t=>{j.has(t)&&m(`The \`${t}\` event is no longer supported by the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")})}(t)),A(t,l),F(t,l),k(t,l),r.autoEncrypter?r.autoEncrypter.init(t=>{t?i(t):l.connect(r,t=>{if(t)return l.close(!0),void i(t);i(void 0,l)})}):l.connect(r,t=>{if(t)return l.close(!0),i(t);i(void 0,l)})}function M(t,e){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],r=["readconcern","compression","autoencryption"];for(const i in e)-1!==r.indexOf(i.toLowerCase())?t[i]=e[i]:-1!==n.indexOf(i.toLowerCase())?t=L(t,e[i],!1):!e[i]||"object"!=typeof e[i]||Buffer.isBuffer(e[i])||Array.isArray(e[i])?t[i]=e[i]:t=L(t,e[i],!0);return t}function D(t,e,n,r){const i=(r=Object.assign({},r)).authSource||r.authdb||r.dbName,a=r.authMechanism||"DEFAULT",c=a.toUpperCase();if(!O.has(c))throw s.create({message:`authentication mechanism ${a} not supported', options.authMechanism`,driver:!0});return new o("GSSAPI"===c?{mechanism:"win32"===process.platform?"sspi":"gssapi",mechanismProperties:r,source:i,username:e,password:n}:{mechanism:w[c],source:i,username:e,password:n})}function $(t){return L(M({},t),t,!1)}function L(t,e,n){for(const r in e)e[r]&&"object"==typeof e[r]&&n?t=L(t,e[r],n):t[r]=e[r];return t}function F(t,e){["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha"].concat(v).forEach(n=>{e.on(n,(e,r)=>{t.emit(n,e,r)})})}function B(t){let e=Object.assign({servers:t.hosts},t.options);for(let t in e){const n=I[t];n&&(e[n]=e[t])}const n=t.auth&&t.auth.username,r=t.options&&t.options.authMechanism;return(n||r)&&(e.auth=Object.assign({},t.auth),e.auth.db&&(e.authSource=e.authSource||e.auth.db),e.auth.username&&(e.auth.user=e.auth.username)),t.defaultDatabase&&(e.dbName=t.defaultDatabase),e.maxPoolSize&&(e.poolSize=e.maxPoolSize),e.readConcernLevel&&(e.readConcern=new l(e.readConcernLevel)),e.wTimeoutMS&&(e.wtimeout=e.wTimeoutMS),t.srvHost&&(e.srvHost=t.srvHost),e}function U(t,e){if(e=Object.assign({},{createServers:!0},e),"string"!=typeof t.readPreference&&"string"!=typeof t.read_preference||(t.readPreference=new h(t.readPreference||t.read_preference)),t.readPreference&&(t.readPreferenceTags||t.read_preference_tags)&&(t.readPreference.tags=t.readPreferenceTags||t.read_preference_tags),t.maxStalenessSeconds&&(t.readPreference.maxStalenessSeconds=t.maxStalenessSeconds),null==t.socketTimeoutMS&&(t.socketTimeoutMS=36e4),null==t.connectTimeoutMS&&(t.connectTimeoutMS=1e4),e.createServers)return t.servers.map(e=>e.domain_socket?new p(e.domain_socket,27017,t):new p(e.host,e.port,t))}t.exports={validOptions:function(t){const e=E.concat(C);for(const n in t)if(-1===T.indexOf(n)){if(-1===e.indexOf(n)){if(t.validateOptions)return new s(`option ${n} is not supported`);console.warn(`the options [${n}] is not supported`)}-1!==C.indexOf(n)&&console.warn("the server/replset/mongos/db options are deprecated, "+`all their options are supported at the top level of the options object [${E}]`)}},connect:function(t,e,n,r){if(n=Object.assign({},n),null==r)throw new Error("no callback function provided");let o=!1;const c=i("MongoClient",n);if(e instanceof p||e instanceof f||e instanceof a)return function(t,e,n,r){k(t,e),A(t,e),F(t,e);let i=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(i.readPreference=new h(n.readPreference||n.read_preference));if((i.user||i.password||i.authMechanism)&&!i.credentials)try{i.credentials=D(t,i.user,i.password,i)}catch(t){return r(t,e)}return e.connect(i,r)}(t,e,n,m);const l=!1!==n.useNewUrlParser,d=l?B:$;function m(e,n){const i="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(e&&"no mongos proxies found in seed list"===e.message)return c.isWarn()&&c.warn(i),r(new s(i));o&&t.emit("authenticated",null,!0),r(e,n)}(l?u:_)(e,n,(e,i)=>{if(e)return r(e);const s=d(i),a=M(s,n);if(null==a.socketTimeoutMS&&(a.socketTimeoutMS=36e4),null==a.connectTimeoutMS&&(a.connectTimeoutMS=1e4),null==a.retryWrites&&(a.retryWrites=!0),null==a.useRecoveryToken&&(a.useRecoveryToken=!0),null==a.readPreference&&(a.readPreference="primary"),a.db_options&&a.db_options.auth&&delete a.db_options.auth,null!=a.journal&&(a.j=a.journal,a.journal=void 0),function(t){null!=t.tls&&["sslCA","sslKey","sslCert"].forEach(e=>{t[e]&&(t[e]=y.readFileSync(t[e]))})}(a),t.s.options=a,0===s.servers.length)return r(new Error("connection string must contain at least one seed host"));if(a.auth&&!a.credentials)try{o=!0,a.credentials=D(t,a.auth.user,a.auth.password,a)}catch(e){return r(e)}return a.useUnifiedTopology?R(t,"unified",a,m):(N(),a.replicaSet||a.rs_name?R(t,"replicaset",a,m):s.servers.length>1?R(t,"mongos",a,m):function(t,e,n){e.promiseLibrary=t.s.promiseLibrary;const r=U(e)[0],i=x(t,r);r.connect(e,(o,s)=>{if(o)return r.close(!0),n(o);!function(t){S.forEach(e=>t.removeAllListeners(e))}(r),F(t,r),A(t,r);const a=s.lastIsMaster();if(k(t,s),a&&"isdbgrid"===a.msg)return s.close(),R(t,"mongos",e,n);!function(t,e){for(let n=0;n<e.length;n++)t.emit(e[n].event,e[n].object1,e[n].object2)}(t,i),n(o,s)})}(t,a,m))})}}},function(t,e,n){"use strict";const r=n(48).TopologyBase,i=n(3).MongoError,o=n(3).Mongos,s=n(38),a=n(104),c=n(48).Store,u=n(0).MAX_JS_INT,l=n(0).translateOptions,h=n(0).filterOptions,f=n(0).mergeOptions;var p=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class d extends r{constructor(t,e){super();e=h(e=e||{},p);for(var n=0;n<t.length;n++)if(!(t[n]instanceof a))throw i.create({message:"all seed list instances must be of the Server type",driver:!0});var r={force:!1,bufferMaxEntries:"number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:u},d=e.store||new c(this,r),m=t.map((function(t){return{host:t.host,port:t.port}})),y="boolean"!=typeof e.auto_reconnect||e.auto_reconnect;y="boolean"==typeof e.autoReconnect?e.autoReconnect:y;var g=f({},{disconnectHandler:d,cursorFactory:s,reconnect:y,emitError:"boolean"!=typeof e.emitError||e.emitError,size:"number"==typeof e.poolSize?e.poolSize:5,monitorCommands:"boolean"==typeof e.monitorCommands&&e.monitorCommands});g=l(g,e);var v=e.socketOptions&&Object.keys(e.socketOptions).length>0?e.socketOptions:e;g=l(g,v),this.s={coreTopology:new o(m,g),sCapabilities:null,debug:g.debug,storeOptions:r,clonedOptions:g,store:d,options:e,sessionPool:null,sessions:new Set,promiseLibrary:e.promiseLibrary||Promise}}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t={}),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(){return function(t){["timeout","error","close"].forEach((function(t){n.removeListener(t,r)})),n.s.coreTopology.removeListener("connect",r),n.close(!0);try{e(t)}catch(t){process.nextTick((function(){throw t}))}}},i=function(t){return function(e){"error"!==t&&n.emit(t,e)}},o=function(t){return function(e,r){n.emit(t,e,r)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(t){n.s.coreTopology.removeAllListeners(t)})),n.s.coreTopology.on("serverDescriptionChanged",o("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",o("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",o("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",o("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",o("serverOpening")),n.s.coreTopology.on("serverClosed",o("serverClosed")),n.s.coreTopology.on("topologyOpening",o("topologyOpening")),n.s.coreTopology.on("topologyClosed",o("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",o("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",o("commandStarted")),n.s.coreTopology.on("commandSucceeded",o("commandSucceeded")),n.s.coreTopology.on("commandFailed",o("commandFailed")),n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.s.coreTopology.once("connect",(function(){["timeout","error","close","fullsetup"].forEach((function(t){n.s.coreTopology.removeAllListeners(t)})),n.s.coreTopology.on("timeout",i("timeout")),n.s.coreTopology.on("error",i("error")),n.s.coreTopology.on("close",i("close")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n)})),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick((function(){throw t}))}})),n.s.coreTopology.on("joined",o("joined")),n.s.coreTopology.on("left",o("left")),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect"),n.s.store.execute()})),n.s.coreTopology.connect(t)}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),t.exports=d},function(t,e,n){"use strict";const r=n(104),i=n(38),o=n(3).MongoError,s=n(48).TopologyBase,a=n(48).Store,c=n(3).ReplSet,u=n(0).MAX_JS_INT,l=n(0).translateOptions,h=n(0).filterOptions,f=n(0).mergeOptions;var p=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class d extends s{constructor(t,e){super();var n=this;e=h(e=e||{},p);for(var s=0;s<t.length;s++)if(!(t[s]instanceof r))throw o.create({message:"all seed list instances must be of the Server type",driver:!0});var d={force:!1,bufferMaxEntries:"number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:u},m=e.store||new a(n,d),y=t.map((function(t){return{host:t.host,port:t.port}})),g=f({},{disconnectHandler:m,cursorFactory:i,reconnect:!1,emitError:"boolean"!=typeof e.emitError||e.emitError,size:"number"==typeof e.poolSize?e.poolSize:5,monitorCommands:"boolean"==typeof e.monitorCommands&&e.monitorCommands});g=l(g,e);var v=e.socketOptions&&Object.keys(e.socketOptions).length>0?e.socketOptions:e;g=l(g,v);var b=new c(y,g);b.on("reconnect",(function(){n.emit("reconnect"),m.execute()})),this.s={coreTopology:b,sCapabilities:null,tag:e.tag,storeOptions:d,clonedOptions:g,store:m,options:e,sessionPool:null,sessions:new Set,promiseLibrary:e.promiseLibrary||Promise},g.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return b}})}connect(t,e){var n=this;"function"==typeof t&&(e=t,t={}),null==t&&(t={}),"function"!=typeof e&&(e=null),t=Object.assign({},this.s.clonedOptions,t),n.s.options=t,n.s.storeOptions.bufferMaxEntries="number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:-1;var r=function(t){return function(e){"error"!==t&&n.emit(t,e)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach((function(t){n.s.coreTopology.removeAllListeners(t)}));var i,o=function(t){return function(e,r){n.emit(t,e,r)}};n.s.coreTopology.on("joined",(i="joined",function(t,e){n.emit(i,t,e.lastIsMaster(),e)})),n.s.coreTopology.on("left",o("left")),n.s.coreTopology.on("ping",o("ping")),n.s.coreTopology.on("ha",(function(t,e){n.emit("ha",t,e),"start"===t?n.emit("ha_connect",t,e):"end"===t&&n.emit("ha_ismaster",t,e)})),n.s.coreTopology.on("serverDescriptionChanged",o("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",o("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",o("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",o("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",o("serverOpening")),n.s.coreTopology.on("serverClosed",o("serverClosed")),n.s.coreTopology.on("topologyOpening",o("topologyOpening")),n.s.coreTopology.on("topologyClosed",o("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",o("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",o("commandStarted")),n.s.coreTopology.on("commandSucceeded",o("commandSucceeded")),n.s.coreTopology.on("commandFailed",o("commandFailed")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n,n)})),n.s.coreTopology.on("all",(function(){n.emit("all",null,n)}));var s=function(){return function(t){["timeout","error","close"].forEach((function(t){n.s.coreTopology.removeListener(t,s)})),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{e(t)}catch(t){n.s.coreTopology.isConnected()||process.nextTick((function(){throw t}))}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",(function(){n.s.coreTopology.once("timeout",r("timeout")),n.s.coreTopology.once("error",r("error")),n.s.coreTopology.once("close",r("close")),n.emit("open",null,n);try{e(null,n)}catch(t){process.nextTick((function(){throw t}))}})),n.s.coreTopology.connect(t)}close(t,e){["timeout","error","close","joined","left"].forEach(t=>this.removeAllListeners(t)),super.close(t,e)}}Object.defineProperty(d.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),t.exports=d},function(t,e,n){"use strict";var r=n(3).BSON.Binary,i=n(3).BSON.ObjectID,o=n(29).Buffer,s=function(t,e,n){if(!(this instanceof s))return new s(t,e);this.file=t;var a=null==e?{}:e;if(this.writeConcern=n||{w:1},this.objectId=null==a._id?new i:a._id,this.chunkNumber=null==a.n?0:a.n,this.data=new r,"string"==typeof a.data){var c=o.alloc(a.data.length);c.write(a.data,0,a.data.length,"binary"),this.data=new r(c)}else if(Array.isArray(a.data)){c=o.alloc(a.data.length);var u=a.data.join("");c.write(u,0,u.length,"binary"),this.data=new r(c)}else if(a.data&&"Binary"===a.data._bsontype)this.data=a.data;else if(!o.isBuffer(a.data)&&null!=a.data)throw Error("Illegal chunk format");this.internalPosition=0};s.prototype.write=function(t,e){return this.data.write(t,this.internalPosition,t.length,"binary"),this.internalPosition=this.data.length(),null!=e?e(null,this):this},s.prototype.read=function(t){if(t=null==t||0===t?this.length():t,this.length()-this.internalPosition+1>=t){var e=this.data.read(this.internalPosition,t);return this.internalPosition=this.internalPosition+t,e}return""},s.prototype.readSlice=function(t){if(this.length()-this.internalPosition>=t){var e=null;return null!=this.data.buffer?e=this.data.buffer.slice(this.internalPosition,this.internalPosition+t):(e=o.alloc(t),t=this.data.readInto(e,this.internalPosition)),this.internalPosition=this.internalPosition+t,e}return null},s.prototype.eof=function(){return this.internalPosition===this.length()},s.prototype.getc=function(){return this.read(1)},s.prototype.rewind=function(){this.internalPosition=0,this.data=new r},s.prototype.save=function(t,e){var n=this;"function"==typeof t&&(e=t,t={}),n.file.chunkCollection((function(r,i){if(r)return e(r);var o={upsert:!0};for(var s in t)o[s]=t[s];for(s in n.writeConcern)o[s]=n.writeConcern[s];n.data.length()>0?n.buildMongoObject((function(t){var r={forceServerObjectId:!0};for(var s in n.writeConcern)r[s]=n.writeConcern[s];i.replaceOne({_id:n.objectId},t,o,(function(t){e(t,n)}))})):e(null,n)}))},s.prototype.buildMongoObject=function(t){var e={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(e._id=this.objectId),t(e)},s.prototype.length=function(){return this.data.length()},Object.defineProperty(s.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(t){this.internalPosition=t}}),s.DEFAULT_CHUNK_SIZE=261120,t.exports=s},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(191),i=n(28),o=n(40).Collection,s=n(11),a=n(106),c=n(26),u=n(6);function l(t,e){this.collection=null,this.Promise=e.Promise||Promise,this._closed=!1,r.apply(this,arguments)}
/*!
 * Inherit from abstract Collection.
 */l.prototype.__proto__=r.prototype,l.prototype.onOpen=function(){const t=this;return t.opts.capped.size?!1===t.opts.autoCreate?(t.collection=t.conn.db.collection(t.name),t.collection):t.conn.db.collection(t.name,(function(n,r){if(n)return e(n);t.conn.db.listCollections({name:t.name}).toArray((function(n,i){if(n)return e(n);const o=i[0];if(!!o)if(o.options&&o.options.capped)e(null,r);else{const r="A non-capped collection exists with the name: "+t.name+"\n\n To use this collection as a capped collection, please first convert it.\n http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-Convertingacollectiontocapped";e(n=new Error(r))}else{const n=Object.assign({},t.opts.capped);n.capped=!0,t.conn.db.createCollection(t.name,n,e)}}))})):(e(null,t.conn.db.collection(t.name)),t.collection);function e(e,n){e?t.conn.emit("error",e):(t.collection=n,r.prototype.onOpen.call(t))}},l.prototype.onClose=function(t){r.prototype.onClose.call(this,t)};
/*!
 * ignore
 */
const h={watch:!0};
/*!
 * Copy the collection methods and make them subject to queues
 */function f(t){l.prototype[t]=function(){const e=this.collection,n=Array.from(arguments),r=this,o=s(r,"conn.base.options.debug"),u=arguments[arguments.length-1];if(this.conn.$wasForceClosed){const t=new i("Connection was force closed");if(n.length>0&&"function"==typeof n[n.length-1])return void n[n.length-1](t);throw t}if(this._shouldBufferCommands()&&this.buffer){if(h[t])throw new Error("Collection method "+t+" is synchronous");return"function"==typeof u?void this.addQueue(t,n):(this.conn.emit("buffer",{method:t,args:n}),new this.Promise((e,r)=>{this.addQueue(t,[].concat(n).concat([(t,n)=>{if(null!=t)return r(t);e(n)}]))}))}o&&("function"==typeof o?o.apply(r,[r.name,t].concat(a(n,0,n.length-1))):o instanceof c.Writable?this.$printToStream(r.name,t,n,o):this.$print(r.name,t,n,void 0===o.color||o.color));try{if(null==e)throw new i("Cannot call `"+this.name+"."+t+"()` before initial connection is complete if `bufferCommands = false`. Make sure you `await mongoose.connect()` if you have `bufferCommands = false`.");return e[t].apply(e,n)}catch(t){if(!(n.length>0&&"function"==typeof n[n.length-1]))throw t;n[n.length-1](t)}}}for(const t of Object.keys(o.prototype)){void 0===Object.getOwnPropertyDescriptor(o.prototype,t).get&&("function"==typeof o.prototype[t]&&f(t))}
/*!
 * Debug print helper
 */
function p(t){const e={inspect:function(){return t}};return u.inspect.custom&&(e[u.inspect.custom]=e.inspect),e}function d(t){return g(t,!0)}function m(t,e){t[e]=p('ObjectId("'+t[e].toHexString()+'")')}function y(t,e){t[e]=p('new Date("'+t[e].toUTCString()+'")')}function g(t,e,r){if(t&&"function"==typeof t.toBSON&&(t=t.toBSON()),null==t)return t;let i=n(49)(t,{transform:!1});if("Binary"===i.constructor.name)i="BinData("+i.sub_type+', "'+i.toString("base64")+'")';else if("ObjectID"===i.constructor.name)i=p('ObjectId("'+i.toHexString()+'")');else if("Date"===i.constructor.name)i=p('new Date("'+i.toUTCString()+'")');else if("Object"===i.constructor.name){const t=Object.keys(i),e=t.length;let n;for(let r=0;r<e;++r)if(n=t[r],i[n]){let t;if("function"==typeof i[n].toBSON)try{i[n]=i[n].toBSON()}catch(e){t=e}if("Binary"===i[n].constructor.name)i[n]="BinData("+i[n].sub_type+', "'+i[n].buffer.toString("base64")+'")';else if("Object"===i[n].constructor.name)i[n]=g(i[n],!0);else if("ObjectID"===i[n].constructor.name)m(i,n);else if("Date"===i[n].constructor.name)y(i,n);else if("ClientSession"===i[n].constructor.name)i[n]=p('ClientSession("'+s(i[n],"id.id.buffer","").toString("hex")+'")');else if(Array.isArray(i[n]))i[n]=i[n].map(d);else if(null!=t)throw t}}return e?i:u.inspect(i,!1,10,r).replace(/\n/g,"").replace(/\s{2,}/g," ")}l.prototype.$print=function(t,e,n,r){const i=r?"[0;36mMongoose:[0m ":"Mongoose: ",o=[t,e].join("."),s=[];for(let t=n.length-1;t>=0;--t)(this.$format(n[t])||s.length)&&s.unshift(this.$format(n[t],r));const a="("+s.join(", ")+")";console.info(i+o+a)},l.prototype.$printToStream=function(t,e,n,r){const i=[t,e].join("."),o=[];for(let t=n.length-1;t>=0;--t)(this.$format(n[t])||o.length)&&o.unshift(this.$format(n[t]));const s="("+o.join(", ")+")";r.write(i+s,"utf8")},l.prototype.$format=function(t,e){const n=typeof t;return"function"===n||"undefined"===n?"":g(t,!1,e)},l.prototype.getIndexes=l.prototype.indexInformation,
/*!
 * Module exports.
 */
t.exports=l},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(13).EventEmitter,i=n(105),o=n(62);function s(t,e,n){void 0===n&&(n={}),void 0===n.capped&&(n.capped={}),"number"==typeof n.capped&&(n.capped={size:n.capped}),this.opts=n,this.name=t,this.collectionName=t,this.conn=e,this.queue=[],this.buffer=!0,this.emitter=new r,i.connected===this.conn.readyState&&this.onOpen()}s.prototype.name,s.prototype.collectionName,s.prototype.conn,s.prototype.onOpen=function(){this.buffer=!1,o(()=>this.doQueue())},s.prototype.onClose=function(t){this._shouldBufferCommands()&&!t&&(this.buffer=!0)},s.prototype.addQueue=function(t,e){return this.queue.push([t,e]),this},s.prototype.doQueue=function(){for(const t of this.queue)"function"==typeof t[0]?t[0].apply(this,t[1]):this[t[0]].apply(this,t[1]);this.queue=[];const t=this;return process.nextTick((function(){t.emitter.emit("queue")})),this},s.prototype.ensureIndex=function(){throw new Error("Collection#ensureIndex unimplemented by driver")},s.prototype.createIndex=function(){throw new Error("Collection#ensureIndex unimplemented by driver")},s.prototype.findAndModify=function(){throw new Error("Collection#findAndModify unimplemented by driver")},s.prototype.findOneAndUpdate=function(){throw new Error("Collection#findOneAndUpdate unimplemented by driver")},s.prototype.findOneAndDelete=function(){throw new Error("Collection#findOneAndDelete unimplemented by driver")},s.prototype.findOneAndReplace=function(){throw new Error("Collection#findOneAndReplace unimplemented by driver")},s.prototype.findOne=function(){throw new Error("Collection#findOne unimplemented by driver")},s.prototype.find=function(){throw new Error("Collection#find unimplemented by driver")},s.prototype.insert=function(){throw new Error("Collection#insert unimplemented by driver")},s.prototype.insertOne=function(){throw new Error("Collection#insertOne unimplemented by driver")},s.prototype.insertMany=function(){throw new Error("Collection#insertMany unimplemented by driver")},s.prototype.save=function(){throw new Error("Collection#save unimplemented by driver")},s.prototype.update=function(){throw new Error("Collection#update unimplemented by driver")},s.prototype.getIndexes=function(){throw new Error("Collection#getIndexes unimplemented by driver")},s.prototype.mapReduce=function(){throw new Error("Collection#mapReduce unimplemented by driver")},s.prototype.watch=function(){throw new Error("Collection#watch unimplemented by driver")},
/*!
 * ignore
 */
s.prototype._shouldBufferCommands=function(){const t=this.conn,e=this.opts;return null!=e.bufferCommands?e.bufferCommands:e&&null!=e.schemaUserProvidedOptions&&null!=e.schemaUserProvidedOptions.bufferCommands?e.schemaUserProvidedOptions.bufferCommands:null!=t.config.bufferCommands?t.config.bufferCommands:null==t.base||null==t.base.get("bufferCommands")||t.base.get("bufferCommands")},
/*!
 * Module exports.
 */
t.exports=s},function(t,e){const n=Object.prototype.toString;t.exports=function(t){if("object"!=typeof(e=t)||"[object RegExp]"!=n.call(e))throw new TypeError("Not a RegExp");var e;const r=[];t.global&&r.push("g"),t.multiline&&r.push("m"),t.ignoreCase&&r.push("i"),t.dotAll&&r.push("s"),t.unicode&&r.push("u"),t.sticky&&r.push("y");const i=new RegExp(t.source,r.join(""));return"number"==typeof t.lastIndex&&(i.lastIndex=t.lastIndex),i}},function(t,e,n){"use strict";t.exports=function(t){return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1]}},function(t,e,n){"use strict";const r=n(11);
/*!
 * Get the bson type, if it exists
 */t.exports=function(t,e){return r(t,"_bsontype",void 0)===e}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */var r=n(347).Buffer,i=n(192),o=e.clone=function t(n,r){if(null==n)return n;if(Array.isArray(n))return e.cloneArray(n,r);if(n.constructor){if(/ObjectI[dD]$/.test(n.constructor.name))return"function"==typeof n.clone?n.clone():new n.constructor(n.id);if("ReadPreference"===n.constructor.name)return new n.constructor(n.mode,t(n.tags,r));if("Binary"==n._bsontype&&n.buffer&&n.value)return"function"==typeof n.clone?n.clone():new n.constructor(n.value(!0),n.sub_type);if("Date"===n.constructor.name||"Function"===n.constructor.name)return new n.constructor(+n);if("RegExp"===n.constructor.name)return i(n);if("Buffer"===n.constructor.name)return e.cloneBuffer(n)}return a(n)?e.cloneObject(n,r):n.valueOf?n.valueOf():void 0};
/*!
 * ignore
 */
e.cloneObject=function(t,e){var n,r,i,s=e&&e.minimize,a={};for(i in t)r=o(t[i],e),s&&void 0===r||(n||(n=!0),a[i]=r);return s?n&&a:a},e.cloneArray=function(t,e){for(var n=[],r=0,i=t.length;r<i;r++)n.push(o(t[r],e));return n},e.tick=function(t){if("function"==typeof t)return function(){var e=arguments;c((function(){t.apply(this,e)}))}},e.merge=function t(n,r){for(var i,o=Object.keys(r),s=o.length;s--;)void 0===n[i=o[s]]?n[i]=r[i]:e.isObject(r[i])?t(n[i],r[i]):n[i]=r[i]},e.mergeClone=function t(n,r){for(var i,s=Object.keys(r),a=s.length;a--;)void 0===n[i=s[a]]?n[i]=o(r[i]):e.isObject(r[i])?t(n[i],r[i]):n[i]=o(r[i])},e.readPref=function(t){switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest"}return t},e.readConcern=function(t){if("string"==typeof t){switch(t){case"l":t="local";break;case"a":t="available";break;case"m":t="majority";break;case"lz":t="linearizable";break;case"s":t="snapshot"}t={level:t}}return t};var s=Object.prototype.toString;e.toString=function(t){return s.call(t)};var a=e.isObject=function(t){return"[object Object]"==e.toString(t)};e.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"==e.toString(t)},e.keys=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},e.create="function"==typeof Object.create?Object.create:function(t){if(arguments.length>1)throw new Error("Adding properties is not supported");function e(){}return e.prototype=t,new e},e.inherits=function(t,n){t.prototype=e.create(n.prototype),t.prototype.constructor=t};var c=e.soon="function"==typeof setImmediate?setImmediate:process.nextTick;e.cloneBuffer=function(t){var e=r.alloc(t.length);return t.copy(e,0,0,t.length),e},e.isArgumentsObject=function(t){return"[object Arguments]"===Object.prototype.toString.call(t)}},function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,i=+new Date,o=i-(n||i);t.diff=o,t.prev=n,t.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=e.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(t,o),s.splice(c,1),c--}return n})),e.formatArgs.call(t,s);var u=r.log||e.log||console.log.bind(console);u.apply(t,s)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=i,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(350),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e,n){"use strict";e.isNode="undefined"!=typeof process&&"object"==typeof t&&"object"==typeof global&&"function"==typeof Buffer&&process.argv,e.isMongo=!e.isNode&&"function"==typeof printjson&&"function"==typeof ObjectId&&"function"==typeof rs&&"function"==typeof sh,e.isBrowser=!e.isNode&&!e.isMongo&&"undefined"!=typeof window,e.type=e.isNode?"node":e.isMongo?"mongo":e.isBrowser?"browser":"unknown"},function(t,e,n){"use strict";t.exports=function(t){var e=n(15),r=n(67).keys,i=e.tryCatch,o=e.errorObj;return function(n,s,a){return function(c){var u=a._boundValue();t:for(var l=0;l<n.length;++l){var h=n[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(c instanceof h)return i(s).call(u,c)}else if("function"==typeof h){var f=i(h).call(u,c);if(f===o)return f;if(f)return i(s).call(u,c)}else if(e.isObject(c)){for(var p=r(h),d=0;d<p.length;++d){var m=p[d];if(h[m]!=c[m])continue t}return i(s).call(u,c)}}return t}}}},function(t,e,n){"use strict";var r=n(15),i=r.maybeWrapAsError,o=n(43).OperationalError,s=n(67);var a=/^(?:name|message|stack|cause)$/;function c(t){var e;if(function(t){return t instanceof Error&&s.getPrototypeOf(t)===Error.prototype}(t)){(e=new o(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=s.keys(t),i=0;i<n.length;++i){var c=n[i];a.test(c)||(e[c]=t[c])}return e}return r.markAsOriginatingFromRejection(t),t}t.exports=function(t,e){return function(n,r){if(null!==t){if(n){var o=c(i(n));t._attachExtraTrace(o),t._reject(o)}else if(e){for(var s=arguments.length,a=new Array(Math.max(s-1,0)),u=1;u<s;++u)a[u-1]=arguments[u];t._fulfill(a)}else t._fulfill(r);t=null}}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t){let e=t.message;e||(e=r.messages.general.default);const n=o(e,t);super(n),t=Object.assign({},t,{message:n}),this.properties=t,this.kind=t.type,this.path=t.path,this.value=t.value,this.reason=t.reason}
/*!
   * toString helper
   * TODO remove? This defaults to `${this.name}: ${this.message}`
   */toString(){return this.message}}
/*!
 * Formats error messages
 */
function o(t,e){if("function"==typeof t)return t(e);const n=Object.keys(e);for(const r of n)"message"!==r&&(t=t.replace("{"+r.toUpperCase()+"}",e[r]));return t}
/*!
 * exports
 */Object.defineProperty(i.prototype,"name",{value:"ValidatorError"}),
/*!
 * The object used to define this validator. Not enumerable to hide
 * it from `require('util').inspect()` output re: gh-3925
 */
Object.defineProperty(i.prototype,"properties",{enumerable:!1,writable:!0,value:null}),i.prototype.formatMessage=o,t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t,e,n){const r=n.join(", ");super('No matching document found for id "'+t._id+'" version '+e+' modifiedPaths "'+r+'"'),this.version=e,this.modifiedPaths=n}}Object.defineProperty(i.prototype,"name",{value:"VersionError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t){super("Can't save() the same doc multiple times in parallel. Document: "+t._id)}}Object.defineProperty(i.prototype,"name",{value:"ParallelSaveError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{
/*!
   * OverwriteModel Error constructor.
   * @param {String} name
   */
constructor(t){super("Cannot overwrite `"+t+"` model once compiled.")}}Object.defineProperty(i.prototype,"name",{value:"OverwriteModelError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{
/*!
   * DivergentArrayError constructor.
   * @param {Array<String>} paths
   */
constructor(t){super("For your own good, using `document.save()` to update an array which was selected using an $elemMatch projection OR populated using skip, limit, query conditions, or exclusion of the _id field when the operation results in a $pop or $set of the entire array is not supported. The following path(s) would have been modified unsafely:\n  "+t.join("\n  ")+"\nUse Model.update() to update these arrays instead.")}}Object.defineProperty(i.prototype,"name",{value:"DivergentArrayError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){if("number"!=typeof t&&"string"!=typeof t)throw new Error("$type parameter must be number or string");return t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t,e){super("Tried to set nested object field `"+t+`\` to ${Array.isArray(e)?"array":"primitive value"} \``+e+"` and strict mode is set to throw."),this.path=t}}Object.defineProperty(i.prototype,"name",{value:"ObjectExpectedError"}),t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{constructor(t,e,n){super('Parameter "'+e+'" to '+n+"() must be an object, got "+t.toString())}}Object.defineProperty(i.prototype,"name",{value:"ObjectParameterError"}),t.exports=i},function(t,e,n){"use strict";function r(){this._pres=new Map,this._posts=new Map}function i(t,e,n,r,i,o,s){if(o.useErrorHandlers){var a={error:e};return t.execPost(n,r,i,a,(function(t){return"function"==typeof s&&s(t)}))}return"function"==typeof s?s(e):void 0}function o(t,e,n){return t.has(e)?t.get(e):n}function s(t,e,n,r){let i;try{i=t.apply(e,n)}catch(t){return r(t)}a(i)&&i.then(()=>r(),t=>r(t))}function a(t){return null!=t&&"function"==typeof t.then}function c(t){var e=!1,n=this;return function(){if(!e)return e=!0,process.nextTick(()=>t.apply(n,arguments))}}r.prototype.execPre=function(t,e,n,r){3===arguments.length&&(r=n,n=[]);var i=o(this._pres,t,[]),u=i.length,l=i.numAsync||0,h=0,f=l,p=!1,d=n;if(!u)return process.nextTick((function(){r(null)}));var m=function(){if(!(h>=u)){var t=i[h];if(t.isAsync){var n=[c(y),c((function(t){if(t){if(p)return;return p=!0,r(t)}if(0==--f&&h>=u)return r(null)}))];s(t.fn,e,n,n[0])}else if(t.fn.length>0){n=[c(y)];for(var o=arguments.length>=2?arguments:[null].concat(d),l=1;l<o.length;++l)n.push(o[l]);s(t.fn,e,n,n[0])}else{let n=null,i=null;try{i=t.fn.call(e)}catch(t){n=t}if(a(i))i.then(()=>y(),t=>y(t));else{if(++h>=u)return f>0?void 0:process.nextTick((function(){r(n)}));m(n)}}}};function y(t){if(t){if(p)return;return p=!0,r(t)}if(++h>=u)return f>0?void 0:r(null);m.apply(e,arguments)}m.apply(null,[null].concat(n))},r.prototype.execPreSync=function(t,e,n){for(var r=o(this._pres,t,[]),i=r.length,s=0;s<i;++s)r[s].fn.apply(e,n||[])},r.prototype.execPost=function(t,e,n,r,i){arguments.length<5&&(i=r,r=null);var u=o(this._posts,t,[]),l=u.length,h=0,f=null;if(r&&r.error&&(f=r.error),!l)return process.nextTick((function(){i.apply(null,[f].concat(n))}));var p=function(){for(var t=u[h].fn,r=0,o=n.length,d=[],m=0;m<o;++m)r+=n[m]&&n[m]._kareemIgnore?0:1,n[m]&&n[m]._kareemIgnore||d.push(n[m]);if(f)if(t.length===r+2){var y=c((function(t){if(t&&(f=t),++h>=l)return i.call(null,f);p()}));s(t,e,[f].concat(d).concat([y]),y)}else{if(++h>=l)return i.call(null,f);p()}else{const o=c((function(t){return t?(f=t,p()):++h>=l?i.apply(null,[null].concat(n)):void p()}));if(t.length===r+2)return++h>=l?i.apply(null,[null].concat(n)):p();if(t.length===r+1)s(t,e,d.concat([o]),o);else{let r,s;try{s=t.apply(e,d)}catch(t){r=t,f=t}if(a(s))return s.then(()=>o(),t=>o(t));if(++h>=l)return i.apply(null,[r].concat(n));p(r)}}};p()},r.prototype.execPostSync=function(t,e,n){const r=o(this._posts,t,[]),i=r.length;for(let t=0;t<i;++t)r[t].fn.apply(e,n||[])},r.prototype.createWrapperSync=function(t,e){var n=this;return function(){n.execPreSync(t,this,arguments);var r=e.apply(this,arguments);return n.execPostSync(t,this,[r]),r}},r.prototype.wrap=function(t,e,n,r,o){const s=r.length>0?r[r.length-1]:null,a=("function"==typeof s&&r.slice(0,r.length-1),this),c=(o=o||{}).checkForPromise;this.execPre(t,n,r,(function(u){if(u){const e=o.numCallbackParams||0,r=o.contextParameter?[n]:[];for(var l=r.length;l<e;++l)r.push(null);return i(a,u,t,n,r,o,s)}const h="function"==typeof s?r.length-1:r.length,f=e.length,p=e.apply(n,r.slice(0,h).concat(d));if(c){if(null!=p&&"function"==typeof p.then)return p.then(t=>d(null,t),t=>d(t));if(f<h+1)return d(null,p)}function d(){const e=Array.prototype.slice.call(arguments,1);if(o.nullResultByDefault&&0===e.length&&e.push(null),arguments[0])return i(a,arguments[0],t,n,e,o,s);a.execPost(t,n,e,(function(){return arguments[0]?"function"==typeof s?s(arguments[0]):void 0:"function"==typeof s?s.apply(n,arguments):void 0}))}}))},r.prototype.filter=function(t){const e=this.clone(),n=Array.from(e._pres.keys());for(const r of n){const n=this._pres.get(r).map(t=>Object.assign({},t,{name:r})).filter(t);0!==n.length?(n.numAsync=n.filter(t=>t.isAsync).length,e._pres.set(r,n)):e._pres.delete(r)}const r=Array.from(e._posts.keys());for(const n of r){const r=this._posts.get(n).map(t=>Object.assign({},t,{name:n})).filter(t);0!==r.length?e._posts.set(n,r):e._posts.delete(n)}return e},r.prototype.hasHooks=function(t){return this._pres.has(t)||this._posts.has(t)},r.prototype.createWrapper=function(t,e,n,r){var i=this;return this.hasHooks(t)?function(){var o=n||this,s=Array.prototype.slice.call(arguments);i.wrap(t,e,o,s,r)}:function(){process.nextTick(()=>e.apply(this,arguments))}},r.prototype.pre=function(t,e,n,r,i){let s={};"object"==typeof e&&null!=e?(s=e,e=s.isAsync):"boolean"!=typeof arguments[1]&&(r=n,n=e,e=!1);const a=o(this._pres,t,[]);if(this._pres.set(t,a),e&&(a.numAsync=a.numAsync||0,++a.numAsync),"function"!=typeof n)throw new Error('pre() requires a function, got "'+typeof n+'"');return i?a.unshift(Object.assign({},s,{fn:n,isAsync:e})):a.push(Object.assign({},s,{fn:n,isAsync:e})),this},r.prototype.post=function(t,e,n,r){const i=o(this._posts,t,[]);if("function"==typeof e&&(r=!!n,n=e,e={}),"function"!=typeof n)throw new Error('post() requires a function, got "'+typeof n+'"');return r?i.unshift(Object.assign({},e,{fn:n})):i.push(Object.assign({},e,{fn:n})),this._posts.set(t,i),this},r.prototype.clone=function(){const t=new r;for(let e of this._pres.keys()){const n=this._pres.get(e).slice();n.numAsync=this._pres.get(e).numAsync,t._pres.set(e,n)}for(let e of this._posts.keys())t._posts.set(e,this._posts.get(e).slice());return t},r.prototype.merge=function(t,e){var n=(e=1===arguments.length||e)?this.clone():this;for(let e of t._pres.keys()){const r=o(n._pres,e,[]),i=t._pres.get(e).filter(t=>-1===r.map(t=>t.fn).indexOf(t.fn)),s=r.concat(i);s.numAsync=r.numAsync||0,s.numAsync+=i.filter(t=>t.isAsync).length,n._pres.set(e,s)}for(let e of t._posts.keys()){const r=o(n._posts,e,[]),i=t._posts.get(e).filter(t=>-1===r.indexOf(t));n._posts.set(e,r.concat(i))}return n},t.exports=r},function(t,e,n){"use strict";t.exports=function(t){const e={_id:{auto:!0}};e._id[t.options.typeKey]="ObjectId",t.add(e)}},function(t,e,n){"use strict";const r=n(110),i=n(211);
/*!
 * ignore
 */
function o(t,e,n){if(null==e)return;const r=Object.keys(e);if(r.length&&r[0].startsWith("$")){if(e.$push)for(const r of Object.keys(e.$push)){const o=n.path(r);if(e.$push[r]&&o&&o.$isMongooseDocumentArray&&o.schema.options.timestamps){const n=o.schema.options.timestamps,s=i(n,"createdAt"),a=i(n,"updatedAt");e.$push[r].$each?e.$push[r].$each.forEach((function(e){null!=a&&(e[a]=t),null!=s&&(e[s]=t)})):(null!=a&&(e.$push[r][a]=t),null!=s&&(e.$push[r][s]=t))}}if(null!=e.$set){const r=Object.keys(e.$set);for(const i of r)s(n,i,e.$set,t)}}else{const r=Object.keys(e).filter(t=>!t.startsWith("$"));for(const i of r)s(n,i,e,t)}}function s(t,e,n,s){const a=r(e),c=t.path(a);if(!c)return;const u=[],l=a.split(".");for(let n=l.length-1;n>0;--n){const r=t.path(l.slice(0,n).join("."));null!=r&&(r.$isMongooseDocumentArray||r.$isSingleNested)&&u.push({parentPath:e.split(".").slice(0,n).join("."),parentSchemaType:r})}if(Array.isArray(n[e])&&c.$isMongooseDocumentArray)!function(t,e,n){const r=e.schema.options.timestamps;if(!r)return;const s=t.length,a=i(r,"createdAt"),c=i(r,"updatedAt");for(let r=0;r<s;++r)null!=c&&(t[r][c]=n),null!=a&&(t[r][a]=n),o(n,t[r],e.schema)}(n[e],c,s);else if(n[e]&&c.$isSingleNested)!function(t,e,n){const r=e.schema.options.timestamps;if(!r)return;const s=i(r,"createdAt"),a=i(r,"updatedAt");null!=a&&(t[a]=n),null!=s&&(t[s]=n),o(n,t,e.schema)}(n[e],c,s);else if(u.length>0)for(const t of u){const r=t.parentPath,o=t.parentSchemaType,a=o.schema.options.timestamps,c=i(a,"updatedAt");if(a&&null!=c)if(o.$isSingleNested)n[r+"."+c]=s;else if(o.$isMongooseDocumentArray){let t=e.substr(r.length+1);if(/^\d+$/.test(t)){n[r+"."+t][c]=s;continue}const i=t.indexOf(".");t=-1!==i?t.substr(0,i):t,n[r+"."+t+"."+c]=s}}else if(null!=c.schema&&c.schema!=t&&n[e]){const t=c.schema.options.timestamps,r=i(t,"createdAt"),o=i(t,"updatedAt");if(!t)return;null!=o&&(n[e][o]=s),null!=r&&(n[e][r]=s)}}t.exports=o},function(t,e,n){"use strict";t.exports=
/*!
 * ignore
 */
function(t,e){if(null==t)return null;if("boolean"==typeof t)return e;if("boolean"==typeof t[e])return t[e]?e:null;if(!(e in t))return e;return t[e]}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(11);t.exports=
/*!
 * ignore
 */
function(t,e,n,i,o){const s=i;let a=s;const c=r(o,"overwrite",!1),u=r(o,"timestamps",!0);if(!u||null==s)return i;const l=null!=u&&!1===u.createdAt,h=null!=u&&!1===u.updatedAt;if(c)return i&&i.$set&&(i=i.$set,s.$set={},a=s.$set),h||!n||i[n]||(a[n]=t),l||!e||i[e]||(a[e]=t),s;if(i=i||{},Array.isArray(s))return s.push({$set:{updatedAt:t}}),s;if(s.$set=s.$set||{},!h&&n&&(!i.$currentDate||!i.$currentDate[n])){let e=!1;if(-1!==n.indexOf(".")){const r=n.split(".");for(let n=1;n<r.length;++n){const o=r.slice(-n).join("."),s=r.slice(0,-n).join(".");if(null!=i[s]){i[s][o]=t,e=!0;break}if(i.$set&&i.$set[s]){i.$set[s][o]=t,e=!0;break}}}e||(s.$set[n]=t),s.hasOwnProperty(n)&&delete s[n]}if(!l&&e){i[e]&&delete i[e],i.$set&&i.$set[e]&&delete i.$set[e];let n=!1;if(-1!==e.indexOf(".")){const r=e.split(".");for(let e=1;e<r.length;++e){const o=r.slice(-e).join("."),s=r.slice(0,-e).join(".");if(null!=i[s]){i[s][o]=t,n=!0;break}if(i.$set&&i.$set[s]){i.$set[s][o]=t,n=!0;break}}}n||(s.$setOnInsert=s.$setOnInsert||{},s.$setOnInsert[e]=t)}0===Object.keys(s.$set).length&&delete s.$set;return s}},function(t,e,n){"use strict";const r=n(31);
/*!
 * Given a value, cast it to a string, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {string|null|undefined}
 * @throws {CastError}
 * @api private
 */t.exports=function(t,e){if(null==t)return t;if(t._id&&"string"==typeof t._id)return t._id;if(t.toString&&t.toString!==Object.prototype.toString&&!Array.isArray(t))return t.toString();throw new r("string",t,e)}},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(17),i=n(399),o=n(25),s=n(215),a=n(216),c=n(12),u=n(8).populateModelSymbol,l=o.CastError;let h;function f(t,e){o.call(this,t,e,"Number")}
/*!
 * ignore
 */
function p(t){return this.cast(t)}f.get=o.get,f.set=o.set,
/*!
 * ignore
 */
f._cast=s,f.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if("number"!=typeof t)throw new Error;return t}),this._cast=t),this._cast},f.schemaName="Number",f.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
f.prototype=Object.create(o.prototype),f.prototype.constructor=f,f.prototype.OptionsConstructor=i,
/*!
 * ignore
 */
f._checkRequired=t=>"number"==typeof t||t instanceof Number,f.checkRequired=o.checkRequired,f.prototype.checkRequired=function(t,e){if(o._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():f.checkRequired())(t)},f.prototype.min=function(t,e){if(this.minValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.minValidator}),this)),null!=t){let n=e||r.messages.Number.min;n=n.replace(/{MIN}/,t),this.validators.push({validator:this.minValidator=function(e){return null==e||e>=t},message:n,type:"min",min:t})}return this},f.prototype.max=function(t,e){if(this.maxValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.maxValidator}),this)),null!=t){let n=e||r.messages.Number.max;n=n.replace(/{MAX}/,t),this.validators.push({validator:this.maxValidator=function(e){return null==e||e<=t},message:n,type:"max",max:t})}return this},f.prototype.enum=function(t,e){return this.enumValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.enumValidator}),this)),Array.isArray(t)||(t=Array.prototype.slice.call(arguments),e=r.messages.Number.enum),e=null==e?r.messages.Number.enum:e,this.enumValidator=e=>null==e||-1!==t.indexOf(e),this.validators.push({validator:this.enumValidator,message:e,type:"enum",enumValues:t}),this},f.prototype.cast=function(t,e,r){if(o._isRef(this,t,e,r)){if(null==t)return t;if(h||(h=n(22)),t instanceof h)return t.$__.wasPopulated=!0,t;if("number"==typeof t)return t;if(Buffer.isBuffer(t)||!c.isObject(t))throw new l("Number",t,this.path,null,this);const r=e.$__fullPath(this.path),i=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options[u])(t);return i.$__.wasPopulated=!0,i}const i=t&&void 0!==t._id?t._id:t,s="function"==typeof this.constructor.cast?this.constructor.cast():f.cast();try{return s(i)}catch(t){throw new l("Number",i,this.path,t,this)}},f.prototype.$conditionalHandlers=c.options(o.prototype.$conditionalHandlers,{$bitsAllClear:a,$bitsAnyClear:a,$bitsAllSet:a,$bitsAnySet:a,$gt:p,$gte:p,$lt:p,$lte:p,$mod:function(t){const e=this;return Array.isArray(t)?t.map((function(t){return e.cast(t)})):[this.cast(t)]}}),f.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(n=this.$conditionalHandlers[t],!n)throw new l("number",e,this.path,null,this);return n.call(this,e)}return e=this._castForQuery(t)},
/*!
 * Module exports.
 */
t.exports=f},function(t,e,n){"use strict";const r=n(66);
/*!
 * Given a value, cast it to a number, or throw a `CastError` if the value
 * cannot be casted. `null` and `undefined` are considered valid.
 *
 * @param {Any} value
 * @param {String} [path] optional the path to set on the CastError
 * @return {Boolean|null|undefined}
 * @throws {Error} if `value` is not one of the allowed values
 * @api private
 */t.exports=function(t){return null==t?t:""===t?null:("string"!=typeof t&&"boolean"!=typeof t||(t=Number(t)),r.ok(!isNaN(t)),t instanceof Number?t.valueOf():"number"==typeof t?t:Array.isArray(t)||"function"!=typeof t.valueOf?t.toString&&!Array.isArray(t)&&t.toString()==Number(t)?Number(t):void r.ok(!1):Number(t.valueOf()))}},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(31);
/*!
 * ignore
 */
/*!
 * ignore
 */
function i(t,e){const n=Number(e);if(isNaN(n))throw new r("number",e,t);return n}t.exports=function(t){const e=this;return Array.isArray(t)?t.map((function(t){return i(e.path,t)})):Buffer.isBuffer(t)?t:i(e.path,t)}},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(112).castArraysOfNumbers,i=n(112).castToNumber;function o(t,e){switch(t.$geometry.type){case"Polygon":case"LineString":case"Point":r(t.$geometry.coordinates,e)}return s(e,t),t}function s(t,e){e.$maxDistance&&(e.$maxDistance=i.call(t,e.$maxDistance)),e.$minDistance&&(e.$minDistance=i.call(t,e.$minDistance))}
/*!
 * ignore
 */
e.cast$geoIntersects=function(t){if(!t.$geometry)return;return o(t,this),t},e.cast$near=function(t){const e=n(141);if(Array.isArray(t))return r(t,this),t;if(s(this,t),t&&t.$geometry)return o(t,this);if(!Array.isArray(t))throw new TypeError("$near must be either an array or an object with a $geometry property");return e.prototype.castForQuery.call(this,t)},e.cast$within=function(t){if(s(this,t),t.$box||t.$polygon){const e=t.$box?"$box":"$polygon";t[e].forEach(t=>{if(!Array.isArray(t)){throw new TypeError("Invalid $within $box argument. Expected an array, received "+t)}t.forEach((e,n)=>{t[n]=i.call(this,e)})})}else if(t.$center||t.$centerSphere){const e=t.$center?"$center":"$centerSphere";t[e].forEach((n,r)=>{Array.isArray(n)?n.forEach((t,e)=>{n[e]=i.call(this,t)}):t[e][r]=i.call(this,n)})}else t.$geometry&&o(t,this);return t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(219),i=n(22),o=n(8).arrayAtomicsSymbol,s=n(8).arrayParentSymbol,a=n(8).arrayPathSymbol,c=n(8).arraySchemaSymbol,u=Array.prototype.push;
/*!
 * Module exports.
 */
t.exports=function(t,e,n){const l=new r;if(l[o]={},Array.isArray(t)){const e=t.length;for(let n=0;n<e;++n)u.call(l,t[n]);l[o]=t[o]||{}}return l[a]=e,l[c]=void 0,n&&n instanceof i&&(l[s]=n,l[c]=n.schema.path(e)),l}},function(t,e,n){"use strict";const r=n(22),i=n(81),o=n(28),s=n(42),a=n(221),c=n(11),u=n(51).internalToObjectOptions,l=n(12),h=n(6),f=n(8).arrayAtomicsSymbol,p=n(8).arrayParentSymbol,d=n(8).arrayPathSymbol,m=n(8).arraySchemaSymbol,y=n(8).populateModelSymbol,g=Symbol("mongoose#Array#sliced"),v=Array.prototype.push,b=Symbol("mongoose#MongooseCoreArray#validators");
/*!
 * ignore
 */
class _ extends Array{get isMongooseArray(){return!0}get validators(){return this[b]}set validators(t){this[b]=t}$__getAtomics(){const t=[],e=Object.keys(this[f]);let n=e.length;const r=Object.assign({},u,{_isNested:!0});if(0===n)return t[0]=["$set",this.toObject(r)],t;for(;n--;){const i=e[n];let o=this[f][i];l.isMongooseObject(o)?o=o.toObject(r):Array.isArray(o)?o=this.toObject.call(o,r):null!=o&&Array.isArray(o.$each)?o.$each=this.toObject.call(o.$each,r):null!=o&&"function"==typeof o.valueOf&&(o=o.valueOf()),"$addToSet"===i&&(o={$each:o}),t.push([i,o])}return t}
/*!
   * ignore
   */$atomics(){return this[f]}
/*!
   * ignore
   */$parent(){return this[p]}
/*!
   * ignore
   */$path(){return this[d]}$shift(){if(this._registerAtomic("$pop",-1),this._markModified(),!this._shifted)return this._shifted=!0,[].shift.call(this)}$pop(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)}
/*!
   * ignore
   */$schema(){return this[m]}_cast(t){let e,n=!1;if(this[p]&&(n=this[p].populated(this[d],!0)),n&&null!=t){return e=n.options[y],(Buffer.isBuffer(t)||t instanceof s||!l.isObject(t))&&(t={_id:t}),t.schema&&t.schema.discriminatorMapping&&void 0!==t.schema.discriminatorMapping.key||(t=new e(t)),this[m].caster.applySetters(t,this[p],!0)}return this[m].caster.applySetters(t,this[p],!1)}_mapCast(t,e){return this._cast(t,this.length+e)}_markModified(t,e){const n=this[p];let r;if(n){if(r=this[d],arguments.length&&(r=null!=e?r+"."+this.indexOf(t)+"."+e:r+"."+t),null!=r&&r.endsWith(".$"))return this;n.markModified(r,arguments.length>0?t:n)}return this}_registerAtomic(t,e){if(this[g])return;if("$set"===t)return this[f]={$set:e},a(this[p],this[d]),this._markModified(),this;const n=this[f];if("$pop"===t&&!("$pop"in n)){const t=this;this[p].once("save",(function(){t._popped=t._shifted=null}))}if(this[f].$set||Object.keys(n).length&&!(t in n))return this[f]={$set:this},this;let r;if("$pullAll"===t||"$addToSet"===t)n[t]||(n[t]=[]),n[t]=n[t].concat(e);else if("$pullDocs"===t){const t=n.$pull||(n.$pull={});e[0]instanceof i?(r=t.$or||(t.$or=[]),Array.prototype.push.apply(r,e.map((function(t){return t.toObject({transform:!1,virtuals:!1})})))):(r=t._id||(t._id={$in:[]}),r.$in=r.$in.concat(e))}else"$push"===t?(n.$push=n.$push||{$each:[]},null!=e&&l.hasUserDefinedProperty(e,"$each")?n.$push=e:n.$push.$each=n.$push.$each.concat(e)):n[t]=e;return this}addToSet(){w(this,arguments);let t=[].map.call(arguments,this._mapCast,this);t=this[m].applySetters(t,this[p]);const e=[];let n="";return t[0]instanceof i?n="doc":t[0]instanceof Date&&(n="date"),t.forEach((function(t){let r;const i=+t;switch(n){case"doc":r=this.some((function(e){return e.equals(t)}));break;case"date":r=this.some((function(t){return+t===i}));break;default:r=~this.indexOf(t)}r||([].push.call(this,t),this._registerAtomic("$addToSet",t),this._markModified(),[].push.call(e,t))}),this),e}hasAtomics(){return l.isPOJO(this[f])?Object.keys(this[f]).length:0}includes(t,e){return-1!==this.indexOf(t,e)}indexOf(t,e){t instanceof s&&(t=t.toString()),e=null==e?0:e;const n=this.length;for(let r=e;r<n;++r)if(t==this[r])return r;return-1}inspect(){return JSON.stringify(this)}nonAtomicPush(){const t=[].map.call(arguments,this._mapCast,this),e=[].push.apply(this,t);return this._registerAtomic("$set",this),this._markModified(),e}pop(){const t=[].pop.call(this);return this._registerAtomic("$set",this),this._markModified(),t}pull(){const t=[].map.call(arguments,this._cast,this),e=this[p].get(this[d]);let n,o=e.length;for(;o--;)if(n=e[o],n instanceof r){t.some((function(t){return n.equals(t)}))&&[].splice.call(e,o,1)}else~e.indexOf.call(t,n)&&[].splice.call(e,o,1);return t[0]instanceof i?this._registerAtomic("$pullDocs",t.map((function(t){return t._id||t}))):this._registerAtomic("$pullAll",t),this._markModified(),a(this[p],this[d])>0&&this._registerAtomic("$set",this),this}push(){let t=arguments,e=t;const n=null!=t[0]&&l.hasUserDefinedProperty(t[0],"$each");if(n&&(e=t[0],t=t[0].$each),null==this[m])return v.apply(this,t);w(this,t);const r=this[p];let i;t=[].map.call(t,this._mapCast,this),t=this[m].applySetters(t,r,void 0,void 0,{skipDocumentArrayCast:!0});const s=this[f];if(n){if(e.$each=t,c(s,"$push.$each.length",0)>0&&s.$push.$position!=s.$position)throw new o("Cannot call `Array#push()` multiple times with different `$position`");null!=e.$position?([].splice.apply(this,[e.$position,0].concat(t)),i=this.length):i=[].push.apply(this,t)}else{if(c(s,"$push.$each.length",0)>0&&null!=s.$push.$position)throw new o("Cannot call `Array#push()` multiple times with different `$position`");e=t,i=[].push.apply(this,t)}return this._registerAtomic("$push",e),this._markModified(),i}remove(){return this.pull.apply(this,arguments)}set(t,e){const n=this._cast(e,t);return this[t]=n,this._markModified(t),this}shift(){const t=[].shift.call(this);return this._registerAtomic("$set",this),this._markModified(),t}sort(){const t=[].sort.apply(this,arguments);return this._registerAtomic("$set",this),t}splice(){let t;if(w(this,Array.prototype.slice.call(arguments,2)),arguments.length){let e;if(null==this[m])e=arguments;else{e=[];for(let t=0;t<arguments.length;++t)e[t]=t<2?arguments[t]:this._cast(arguments[t],arguments[0]+(t-2))}t=[].splice.apply(this,e),this._registerAtomic("$set",this)}return t}
/*!
   * ignore
   */slice(){const t=super.slice.apply(this,arguments);return t[p]=this[p],t[m]=this[m],t[f]=this[f],t[g]=!0,t}
/*!
   * ignore
   */toBSON(){return this.toObject(u)}toObject(t){return t&&t.depopulate?((t=l.clone(t))._isNested=!0,this.map((function(e){return e instanceof r?e.toObject(t):e}))):this.slice()}unshift(){let t;return w(this,arguments),null==this[m]?t=arguments:(t=[].map.call(arguments,this._cast,this),t=this[m].applySetters(t,this[p])),[].unshift.apply(this,t),this._registerAtomic("$set",this),this._markModified(),this.length}}
/*!
 * ignore
 */
function w(t,e){const n=null==t?null:c(t[m],"caster.options.ref",null);0===t.length&&e.length>0&&
/*!
 * ignore
 */
function(t,e){if(!e)return!1;for(const n of t){if(null==n)return!1;const t=n.constructor;if(!(n instanceof r)||t.modelName!==e&&t.baseModelName!==e)return!1}return!0}(e,n)&&t[p].populated(t[d],[],{[y]:e[0].constructor})}h.inspect.custom&&(_.prototype[h.inspect.custom]=_.prototype.inspect),t.exports=_},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(22),i=n(405);let o=!1;t.exports=function(){return o?i:r},
/*!
 * ignore
 */
t.exports.setBrowser=function(t){o=t}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t,e,n){const r=(n=n||{}).skipDocArrays;let i=0;if(!t)return i;for(const n of Object.keys(t.$__.activePaths.states.modify)){if(r){const e=t.schema.path(n);if(e&&e.$isMongooseDocumentArray)continue}n.startsWith(e+".")&&(delete t.$__.activePaths.states.modify[n],++i)}return i}},function(t,e,n){"use strict";const r=n(33).get().ObjectId,i=n(66);t.exports=function(t){if(null==t)return t;if(t instanceof r)return t;if(t._id){if(t._id instanceof r)return t._id;if(t._id.toString instanceof Function)return new r(t._id.toString())}if(t.toString instanceof Function)return new r(t.toString());i.ok(!1)}},function(t,e,n){"use strict";const r=n(77),i=n(12).deepEqual,o=n(11),s=n(224),a=n(6),c=n(133),u=n(8).populateModelSymbol;
/*!
 * ignore
 */
class l extends Map{constructor(t,e,n,i){null!=t&&"Object"===t.constructor.name&&(t=Object.keys(t).reduce((e,n)=>e.concat([[n,t[n]]]),[])),super(t),this.$__parent=null!=n&&null!=n.$__?n:null,this.$__path=e,this.$__schemaType=null==i?new r(e):i,this.$__runDeferred()}$init(t,e){h(t),super.set(t,e),null!=e&&e.$isSingleNested&&(e.$basePath=this.$__path+"."+t)}$__set(t,e){super.set(t,e)}get(t,e){return!1===(e=e||{}).getters?super.get(t):this.$__schemaType.applyGetters(super.get(t),this.$__parent)}set(t,e){if(h(t),e=s(e),null==this.$__schemaType)return this.$__deferred=this.$__deferred||[],void this.$__deferred.push({key:t,value:e});const n=this.$__path+"."+t,r=null!=this.$__parent&&this.$__parent.$__?this.$__parent.populated(n)||this.$__parent.populated(this.$__path):null,o=this.get(t);if(null!=r)null==e.$__&&(e=new r.options[u](e)),e.$__.wasPopulated=!0;else try{e=this.$__schemaType.applySetters(e,this.$__parent,!1,this.get(t))}catch(t){if(null!=this.$__parent&&null!=this.$__parent.$__)return void this.$__parent.invalidate(n,t);throw t}super.set(t,e),null!=e&&e.$isSingleNested&&(e.$basePath=this.$__path+"."+t);const a=this.$__parent;null==a||null==a.$__||i(e,o)||a.markModified(this.$__path+"."+t)}delete(t){this.set(t,void 0),super.delete(t)}toBSON(){return new Map(this)}toObject(t){if(o(t,"flattenMaps")){const t={},e=this.keys();for(const n of e)t[n]=this.get(n);return t}return new Map(this)}toJSON(){const t={},e=this.keys();for(const n of e)t[n]=this.get(n);return t}inspect(){return new Map(this)}$__runDeferred(){if(this.$__deferred){for(const t of this.$__deferred)this.set(t.key,t.value);this.$__deferred=null}}}
/*!
 * Since maps are stored as objects under the hood, keys must be strings
 * and can't contain any invalid characters
 */
function h(t){const e=typeof t;if("string"!==e)throw new TypeError(`Mongoose maps only support string keys, got ${e}`);if(t.startsWith("$"))throw new Error(`Mongoose maps do not support keys that start with "$", got "${t}"`);if(t.includes("."))throw new Error(`Mongoose maps do not support keys that contain ".", got "${t}"`);if(c.has(t))throw new Error(`Mongoose maps do not support reserved key name "${t}"`)}a.inspect.custom&&Object.defineProperty(l.prototype,a.inspect.custom,{enumerable:!1,writable:!1,configurable:!1,value:l.prototype.inspect}),Object.defineProperty(l.prototype,"$__set",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(l.prototype,"$__parent",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(l.prototype,"$__path",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(l.prototype,"$__schemaType",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(l.prototype,"$isMongooseMap",{enumerable:!1,writable:!1,configurable:!1,value:!0}),Object.defineProperty(l.prototype,"$__deferredCalls",{enumerable:!1,writable:!1,configurable:!1,value:!0}),t.exports=l},function(t,e,n){"use strict";const r=n(12);t.exports=function(t){return r.isPOJO(t)&&null!=t.$__&&null!=t._doc?t._doc:t}},function(t,e,n){"use strict";const r=n(22),i=n(62),o=n(51).internalToObjectOptions,s=n(24),a=n(8).documentArrayParent;function c(t,e,n,i,o){this.$isSingleNested=!0;const s=null!=o&&o.priorDoc;let a=null;if(s&&(this._doc=Object.assign({},o.priorDoc._doc),delete this._doc[this.schema.options.discriminatorKey],a=Object.keys(o.priorDoc._doc||{}).filter(t=>t!==this.schema.options.discriminatorKey)),null!=n&&(o=Object.assign({},o,{isNew:n.isNew})),r.call(this,t,e,i,o),s){for(const t of a)if(!this.$__.activePaths.states.modify[t]&&!this.$__.activePaths.states.default[t]&&!this.$__.$setCalled.has(t)){const e=this.schema.path(t),n=null==e?void 0:e.getDefault(this);void 0===n?delete this._doc[t]:(this._doc[t]=n,this.$__.activePaths.default(t))}delete o.priorDoc}}t.exports=c,c.prototype=Object.create(r.prototype),c.prototype.toBSON=function(){return this.toObject(o)},c.prototype.save=function(t,e){return"function"==typeof t&&(e=t,t={}),(t=t||{}).suppressWarning||console.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),s(e,t=>{this.$__save(t)})},c.prototype.$__save=function(t){return i(()=>t(null,this))},c.prototype.$isValid=function(t){return this.$parent&&this.$basePath?this.$parent.$isValid([this.$basePath,t].join(".")):r.prototype.$isValid.call(this,t)},c.prototype.markModified=function(t){if(r.prototype.markModified.call(this,t),this.$parent&&this.$basePath){if(this.$parent.isDirectModified(this.$basePath))return;this.$parent.markModified([this.$basePath,t].join("."),this)}},c.prototype.isModified=function(t,e){return this.$parent&&this.$basePath?((Array.isArray(t)||"string"==typeof t)&&(t=(t=Array.isArray(t)?t:t.split(" ")).map(t=>[this.$basePath,t].join("."))),this.$parent.isModified(t,e)):r.prototype.isModified.call(this,t,e)},c.prototype.$markValid=function(t){r.prototype.$markValid.call(this,t),this.$parent&&this.$basePath&&this.$parent.$markValid([this.$basePath,t].join("."))},
/*!
 * ignore
 */
c.prototype.invalidate=function(t,e,n){if(e!==this.ownerDocument().$__.validationError&&r.prototype.invalidate.call(this,t,e,n),this.$parent&&this.$basePath)this.$parent.invalidate([this.$basePath,t].join("."),e,n);else if("cast"===e.kind||"CastError"===e.name)throw e;return this.ownerDocument().$__.validationError},
/*!
 * ignore
 */
c.prototype.$ignore=function(t){r.prototype.$ignore.call(this,t),this.$parent&&this.$basePath&&this.$parent.$ignore([this.$basePath,t].join("."))},c.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this.$parent;if(!t)return this;for(;t.$parent||t[a];)t=t.$parent||t[a];return this.$__.ownerDocument=t,this.$__.ownerDocument},c.prototype.parent=function(){return this.$parent},
/*!
 * no-op for hooks
 */
c.prototype.$__remove=function(t){return t(null,this)},c.prototype.remove=function(t,e){"function"==typeof t&&(e=t,t=null),
/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {Subdocument} sub
 * @api private
 */
function(t){let e=t.ownerDocument();function n(){e.removeListener("save",n),e.removeListener("remove",n),t.emit("remove",t),t.constructor.emit("remove",t),e=t=null}e.on("save",n),e.on("remove",n)}(this),t&&t.noop||this.$parent.set(this.$basePath,null),"function"==typeof e&&e(null)},
/*!
 * ignore
 */
c.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')}},function(t,e,n){"use strict";const r=n(209);t.exports=function(t,e){return null==e||null==e._id||(t=t.clone(),e._id?t.paths._id||(r(t),t.options._id=!0):(t.remove("_id"),t.options._id=!1)),t}},function(t,e,n){"use strict";const r=n(39);
/*!
 * Find the correct constructor, taking into account discriminators
 */t.exports=function(t,e){const n=t.schema.options.discriminatorKey;if(null!=e&&t.discriminators&&null!=e[n])if(t.discriminators[e[n]])t=t.discriminators[e[n]];else{const i=r(t,e[n]);i&&(t=i)}return t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(24);t.exports=function(t,e,n,i){const o=n.parallel||1,s=function(){const t=[];let e=null,n=0;return function(i){if(0===t.length&&null==e)return e=n++,i(r);t.push(i)};function r(){if(e=null,t.length>0){e=n++,t.shift()(r)}}}();return r(i,n=>{!function(n){let r=!1,i=0,a=0,c=null;for(let t=0;t<o;++t)s(u);function u(o){if(r||c)return o();t((function(t,l){return r||null!=c?o():null!=t?(c=t,n(t),o()):null==l?(r=!0,i<=0&&n(null),o()):(++i,process.nextTick(()=>o()),void function(t,n,r){const i=e(t,n);i&&"function"==typeof i.then?i.then((function(){r(null)}),(function(t){r(t||new Error("`eachAsync()` promise rejected without error"))})):r(null)}(l,a++,(function(t){return--i,null!=t?(c=t,n(t)):r&&i<=0?n(null):void setTimeout(()=>s(u),0)})))}))}}(n)})}},function(t,e,n){"use strict";const r=n(12);t.exports=function(t,e){r.hasUserDefinedProperty(t,"maxTimeMS")||(r.hasUserDefinedProperty(e.db.options,"maxTimeMS")?t.maxTimeMS=e.db.options.maxTimeMS:r.hasUserDefinedProperty(e.base.options,"maxTimeMS")&&(t.maxTimeMS=e.base.options.maxTimeMS))}},function(t,e,n){"use strict";const r=n(11);t.exports=function(t,e){const n=r(t,"options.writeConcern",{});"w"in e||null==n.w||(e.w=n.w),"j"in e||null==n.j||(e.j=n.j),"wtimeout"in e||null==n.wtimeout||(e.wtimeout=n.wtimeout)}},function(t,e,n){"use strict";const r=n(82).modifiedPaths;t.exports=function(t){const e=Object.keys(t),n={},i={};for(const o of e)o.startsWith("$")?r(t[o],"",n):i[o]=t[o];return r(i,"",n),n}},function(t,e,n){"use strict";const r=n(31),i=n(28),o=n(68),s=n(50),a=n(215),c=n(80),u=n(430),l=n(431),h=n(432),f=n(78).schemaMixedSymbol,p=n(12);
/*!
 * ignore
 */
function d(t,e){if("$unset"===t){if(!Array.isArray(e)||e.find(t=>"string"!=typeof t))throw new i("Invalid $unset in pipeline, must be an array of strings");return e}if("$project"===t){if(null==e||"object"!=typeof e)throw new i("Invalid $project in pipeline, must be an object");return e}if("$addFields"===t||"$set"===t){if(null==e||"object"!=typeof e)throw new i("Invalid "+t+" in pipeline, must be an object");return e}if("$replaceRoot"===t||"$replaceWith"===t){if(null==e||"object"!=typeof e)throw new i("Invalid "+t+" in pipeline, must be an object");return e}throw new i('Invalid update pipeline operator: "'+t+'"')}
/*!
 * Walk each path of obj and cast its values
 * according to its schema.
 *
 * @param {Schema} schema
 * @param {Object} obj - part of a query
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {Object} options
 * @param {Boolean|String} [options.strict]
 * @param {Boolean} [options.omitUndefined]
 * @param {Query} context
 * @param {String} pref - path prefix (internal only)
 * @return {Bool} true if this path has keys to update
 * @api private
 */function m(t,e,n,r,i,s,h){const f=r.strict,d=h?h+".":"",g=Object.keys(e);let v,_,S,O,E=g.length,T=!1,C=null;for(O=void 0===r.useNestedStrict?t.options.useNestedStrict:r.useNestedStrict;E--;)if(_=g[E],S=e[_],"$pull"!==n||(v=t._getSchema(d+_),null==v||null==v.schema))if(S&&"Object"===S.constructor.name){if(v=t._getSchema(d+_),l(v,f,e,_,d+_,i))continue;if(v&&v.caster&&n in b)if("$each"in S){T=!0;try{e[_]={$each:w(v,S.$each,n,_,i,d+_)}}catch(t){C=y(t,i,_,C)}null!=S.$slice&&(e[_].$slice=0|S.$slice),S.$sort&&(e[_].$sort=S.$sort),null!=S.$position&&(e[_].$position=a(S.$position))}else{if(null!=v&&v.$isSingleNested){let n=f;!1!==O&&v.schema.options.hasOwnProperty("strict")?n=v.schema.options.strict:!1===O&&(n=t.options.strict);try{e[_]=v.castForQuery(S,i,{strict:n})}catch(t){C=y(t,i,_,C)}}else try{e[_]=w(v,S,n,_,i,d+_)}catch(t){C=y(t,i,_,C)}if(r.omitUndefined&&void 0===e[_]){delete e[_];continue}T=!0}else if("$currentDate"===n||n in b&&v){try{e[_]=w(v,S,n,_,i,d+_)}catch(t){C=y(t,i,_,C)}if(r.omitUndefined&&void 0===e[_]){delete e[_];continue}T=!0}else{const a=d+_,c=t._getPathType(a);let u=f;if(O&&c&&c.schema&&"strict"in c.schema.options&&(u=c.schema.options.strict),"undefined"===c.pathType){if("throw"===u)throw new o(a);if(u){delete e[_];continue}}T|=m(t,S,n,r,i,s,d+_)||p.isObject(S)&&0===Object.keys(S).length}}else{const a="$each"===_||"$or"===_||"$and"===_||"$in"===_?h:d+_;if(v=t._getSchema(a),"$setOnInsert"!==n&&l(v,f,e,_,d+_,i))continue;let c=t._getPathType(a);if(null==v){const n=u(t,e,s,a);null!=n.schematype&&(v=n.schematype,c=n.type)}let p=f;if(O&&c&&c.schema&&"strict"in c.schema.options&&(p=c.schema.options.strict),p&&!v&&!/real|nested/.test(c.pathType)){if("throw"===p&&null==t.virtuals[a])throw new o(d+_);delete e[_]}else{if("$rename"===n){T=!0;continue}try{e[_]=w(v,S,n,_,i,d+_)}catch(t){C=y(t,i,_,C)}if(!Array.isArray(e[_])||"$addToSet"!==n&&"$push"!==n||"$each"===_||v&&v.caster&&!v.caster.$isMongooseArray&&(e[_]={$each:e[_]}),r.omitUndefined&&void 0===e[_]){delete e[_];continue}T=!0}}else e[_]=c(v.schema,e[_],r,i),T=!0;if(null!=C)throw C;return T}
/*!
 * ignore
 */function y(t,e,n,r){if("object"!=typeof e||!e.options.multipleCastError)throw t;return(r=r||new s).addError(n,t),r}
/*!
 * These operators should be cast to numbers instead
 * of their path schema type.
 */
/*!
 * Casts an update op based on the given schema
 *
 * @param {Schema} schema
 * @param {Object} obj
 * @param {Object} options
 * @param {Boolean} [options.overwrite] defaults to false
 * @param {Boolean|String} [options.strict] defaults to true
 * @param {Query} context passed to setters
 * @return {Boolean} true iff the update is non-empty
 */
t.exports=function(t,e,n,r,i){if(null==e)return;if(n=n||{},Array.isArray(e)){const t=e.length;for(let n=0;n<t;++n){const t=Object.keys(e[n]);for(const r of t)e[n][r]=d(r,e[n][r])}return e}n.upsert&&h(t,e,r);const o=Object.keys(e);let s=o.length;const a={};let c,u=!1;const l=n.overwrite;for(i=i||{};s--;){const t=o[s];"$"===t[0]||l?"$set"===t&&a.$set||(a[t]=e[t]):(a.$set||(e.$set?a.$set=e.$set:a.$set={}),a.$set[t]=e[t],o.splice(s,1),~o.indexOf("$set")||o.push("$set"))}for(s=o.length;s--;){const e=o[s];if(c=a[e],u=u||e.startsWith("$"),!c||"object"!=typeof c||Buffer.isBuffer(c)||l&&!u){if(!l||!a||"object"!=typeof a){throw new Error("Invalid atomic update value for "+e+". Expected an object, received "+typeof c)}m(t,a,"$set",n,r,i)}else m(t,c,e,n,r,i);e.startsWith("$")&&p.isEmptyObject(c)&&delete a[e]}return a};const g={$pop:1,$inc:1},v={$unset:1},b={$push:1,$addToSet:1,$set:1,$setOnInsert:1},_={$set:1,$setOnInsert:1};
/*!
 * These ops require no casting because the RHS doesn't do anything.
 */
/*!
 * Casts `val` according to `schema` and atomic `op`.
 *
 * @param {SchemaType} schema
 * @param {Object} val
 * @param {String} op - the atomic operator ($pull, $set, etc)
 * @param {String} $conditional
 * @param {Query} context
 * @api private
 */
function w(t,e,n,i,o,s){if(!t){if(n in g)try{return a(e)}catch(t){throw new r("number",e,s)}return e}if(t.caster&&n in b&&(p.isObject(e)||Array.isArray(e))&&!_[n]){let n=0,r=t;for(;r.$isMongooseArray;)++n,r=r.caster;let i=0,s=e;for(;Array.isArray(s);)++i,s=s[0];const a=n-i;for(;i<n;)e=[e],++i;let c=t.applySetters(Array.isArray(e)?e:[e],o);for(let t=0;t<a;++t)c=c[0];return c}if(n in v)return e;if(n in g){if(null==e)throw new r("number",e,t.path);if("$inc"===n)return t.castForQueryWrapper({val:e,context:o});try{return a(e)}catch(n){throw new r("number",e,t.path)}}return"$currentDate"===n?"object"==typeof e?{$type:e.$type}:Boolean(e):/^\$/.test(i)?t.castForQueryWrapper({$conditional:i,val:e,context:o}):_[n]?t.castForQueryWrapper({val:e,context:o,$skipQueryCastForUpdate:null!=e&&t.$isMongooseArray&&null!=t.$fullPath&&!t.$fullPath.match(/\d+$/),$applySetters:null!=t[f]}):t.castForQueryWrapper({val:e,context:o})}},function(t,e,n){"use strict";t.exports=function(t,e){if("string"===typeof t&&(t=t.split(/\s+/)),!Array.isArray(t)&&"[object Arguments]"!==Object.prototype.toString.call(t))return t;const n=t.length,r={};for(let i=0;i<n;++i){let n=t[i];if(!n)continue;const o="-"==n[0]?0:1;e||0!==o||(n=n.substring(1)),r[n]=o}return r}},function(t,e,n){"use strict";const r=n(82).modifiedPaths,i=n(11);function o(t,e){if(t[e])return!0;const n=e.split(".");let r=n[0];for(let e=1;e<n.length;++e){if(t[r])return!0;r+="."+n[e]}return!1}t.exports=function(t,e,n,s){const a=Object.keys(n||{}),c={},u={},l=a.length,h={};let f=!1;if(!(s=s||{}).upsert||!s.setDefaultsOnInsert)return n;for(let t=0;t<l;++t)a[t].startsWith("$")&&(r(n[a[t]],"",h),f=!0);f||r(n,"",h);const p=Object.keys(t),d=p.length;for(let e=0;e<d;++e){const n=p[e],r=t[n];if(r&&"object"==typeof r){const t=Object.keys(r),e=t.length;let n=!1;for(let r=0;r<e;++r)if(t[r].startsWith("$")){n=!0;break}if(n)continue}c[n]=!0,h[n]=!0}return s&&s.overwrite&&!f||e.eachPath((function(t,e){const r=e.path.endsWith(".$*")||-1!==e.path.indexOf(".$*.");if(e.$isSingleNested&&!r)e.schema.eachPath((function(e,r){if("_id"===e&&r.auto)return;const i=r.getDefault(null,!0);o(h,t+"."+e)||void 0===i||((n=n||{}).$setOnInsert=n.$setOnInsert||{},n.$setOnInsert[t+"."+e]=i,u[t+"."+e]=i)}));else{const r=e.getDefault(null,!0);o(h,t)||void 0===r||((n=n||{}).$setOnInsert=n.$setOnInsert||{},null==i(n,t)&&(n.$setOnInsert[t]=r),u[t]=r)}})),n}},function(t,e,n){"use strict";
/*!
 * Module dependencies
 */const r=n(440),i=n(147),o=n(229),s=n(24),a=n(6),c=n(12),u=i.prototype.read,l=i.prototype.readConcern;function h(t){this._pipeline=[],this._model=void 0,this.options={},1===arguments.length&&a.isArray(t)&&this.append.apply(this,t)}
/*!
 * Helpers
 */
function f(t){if("object"!=typeof t)return!1;const e=Object.keys(t);return 1===e.length&&e.some(t=>"$"===t[0])}
/*!
 * Adds the appropriate `$match` pipeline step to the top of an aggregate's
 * pipeline, should it's model is a non-root discriminator type. This is
 * analogous to the `prepareDiscriminatorCriteria` function in `lib/query.js`.
 *
 * @param {Aggregate} aggregate Aggregate to prepare
 */function p(t){const e=t._model.schema,n=e&&e.discriminatorMapping;if(n&&!n.isRoot){const e=t._pipeline,r=n.key,i=n.value;if(e[0]&&e[0].$match&&!e[0].$match[r])e[0].$match[r]=i;else if(e[0]&&e[0].$geoNear)e[0].$geoNear.query=e[0].$geoNear.query||{},e[0].$geoNear.query[r]=i;else{const e={};e[r]=i,t._pipeline.unshift({$match:e})}}}
/*!
 * Exports
 */h.prototype.options,h.prototype.model=function(t){return 0===arguments.length?this._model:(this._model=t,null!=t.schema&&(null==this.options.readPreference&&null!=t.schema.options.read&&(this.options.readPreference=t.schema.options.read),null==this.options.collation&&null!=t.schema.options.collation&&(this.options.collation=t.schema.options.collation)),this)},h.prototype.append=function(){const t=1===arguments.length&&a.isArray(arguments[0])?arguments[0]:c.args(arguments);if(!t.every(f))throw new Error("Arguments must be aggregate pipeline operators");return this._pipeline=this._pipeline.concat(t),this},h.prototype.addFields=function(t){const e={};if("object"!=typeof t||a.isArray(t))throw new Error("Invalid addFields() argument. Must be an object");return Object.keys(t).forEach((function(n){e[n]=t[n]})),this.append({$addFields:e})},h.prototype.project=function(t){const e={};if("object"!=typeof t||a.isArray(t)){if(1!==arguments.length||"string"!=typeof t)throw new Error("Invalid project() argument. Must be string or object");t.split(/\s+/).forEach((function(t){if(!t)return;const n="-"===t[0]?0:1;0===n&&(t=t.substring(1)),e[t]=n}))}else Object.keys(t).forEach((function(n){e[n]=t[n]}));return this.append({$project:e})},h.prototype.near=function(t){const e={};return e.$geoNear=t,this.append(e)},
/*!
 * define methods
 */
"group match skip limit out".split(" ").forEach((function(t){h.prototype[t]=function(e){const n={};return n["$"+t]=e,this.append(n)}})),h.prototype.unwind=function(){const t=c.args(arguments),e=[];for(const n of t)if(n&&"object"==typeof n)e.push({$unwind:n});else{if("string"!=typeof n)throw new Error('Invalid arg "'+n+'" to unwind(), must be string or object');e.push({$unwind:n&&n.startsWith("$")?n:"$"+n})}return this.append.apply(this,e)},h.prototype.replaceRoot=function(t){let e;return e="string"==typeof t?t.startsWith("$")?t:"$"+t:t,this.append({$replaceRoot:{newRoot:e}})},h.prototype.count=function(t){return this.append({$count:t})},h.prototype.sortByCount=function(t){if(t&&"object"==typeof t)return this.append({$sortByCount:t});if("string"==typeof t)return this.append({$sortByCount:t&&t.startsWith("$")?t:"$"+t});throw new TypeError('Invalid arg "'+t+'" to sortByCount(), must be string or object')},h.prototype.lookup=function(t){return this.append({$lookup:t})},h.prototype.graphLookup=function(t){const e={};if(t){if(!c.isObject(t))throw new TypeError("Invalid graphLookup() argument. Must be an object.");c.mergeClone(e,t);const n=e.startWith;n&&"string"==typeof n&&(e.startWith=e.startWith.startsWith("$")?e.startWith:"$"+e.startWith)}return this.append({$graphLookup:e})},h.prototype.sample=function(t){return this.append({$sample:{size:t}})},h.prototype.sort=function(t){const e={};if("Object"===t.constructor.name){const n=["desc","descending",-1];Object.keys(t).forEach((function(r){t[r]instanceof Object&&t[r].$meta?e[r]=t[r]:e[r]=-1===n.indexOf(t[r])?1:-1}))}else{if(1!==arguments.length||"string"!=typeof t)throw new TypeError("Invalid sort() argument. Must be a string or object.");t.split(/\s+/).forEach((function(t){if(!t)return;const n="-"===t[0]?-1:1;-1===n&&(t=t.substring(1)),e[t]=n}))}return this.append({$sort:e})},h.prototype.read=function(t,e){return this.options||(this.options={}),u.call(this,t,e),this},h.prototype.readConcern=function(t){return this.options||(this.options={}),l.call(this,t),this},h.prototype.redact=function(t,e,n){if(3===arguments.length){if("string"==typeof e&&!e.startsWith("$$")||"string"==typeof n&&!n.startsWith("$$"))throw new Error("If thenExpr or elseExpr is string, it must start with $$. e.g. $$DESCEND, $$PRUNE, $$KEEP");t={$cond:{if:t,then:e,else:n}}}else if(1!==arguments.length)throw new TypeError("Invalid arguments");return this.append({$redact:t})},h.prototype.explain=function(t){const e=this._model;return s(t,t=>{if(!this._pipeline.length){const e=new Error("Aggregate has empty pipeline");return t(e)}p(this),e.hooks.execPre("aggregate",this,n=>{if(n){const r={error:n};return e.hooks.execPost("aggregate",this,[null],r,e=>{t(e)})}this.options.explain=!0,e.collection.aggregate(this._pipeline,this.options||{}).explain((n,r)=>{const i={error:n};return e.hooks.execPost("aggregate",this,[r],i,e=>e?t(e):t(null,r))})})},e.events)},h.prototype.allowDiskUse=function(t){return this.options.allowDiskUse=t,this},h.prototype.hint=function(t){return this.options.hint=t,this},h.prototype.session=function(t){return null==t?delete this.options.session:this.options.session=t,this},h.prototype.option=function(t){for(const e in t)this.options[e]=t[e];return this},h.prototype.cursor=function(t){return this.options||(this.options={}),this.options.cursor=t||{},this},h.prototype.addCursorFlag=a.deprecate((function(t,e){return this.options||(this.options={}),this.options[t]=e,this}),"Mongoose: `Aggregate#addCursorFlag()` is deprecated, use `option()` instead"),h.prototype.collation=function(t){return this.options||(this.options={}),this.options.collation=t,this},h.prototype.facet=function(t){return this.append({$facet:t})},h.prototype.pipeline=function(){return this._pipeline},h.prototype.exec=function(t){if(!this._model)throw new Error("Aggregate not bound to any Model");const e=this._model,n=this._model.collection;return o(this.options,e),this.options&&this.options.cursor?new r(this):s(t,t=>{p(this),e.hooks.execPre("aggregate",this,r=>{if(r){const n={error:r};return e.hooks.execPost("aggregate",this,[null],n,e=>{t(e)})}if(!this._pipeline.length)return t(new Error("Aggregate has empty pipeline"));const i=c.clone(this.options||{});n.aggregate(this._pipeline,i,(n,r)=>{if(n){const r={error:n};return e.hooks.execPost("aggregate",this,[null],r,e=>t(e||null))}r.toArray((n,r)=>{const i={error:n};e.hooks.execPost("aggregate",this,[r],i,(e,n)=>{if(e)return t(e);t(null,n)})})})})},e.events)},h.prototype.then=function(t,e){return this.exec().then(t,e)},h.prototype.catch=function(t){return this.exec().then(null,t)},null!=Symbol.asyncIterator&&(h.prototype[Symbol.asyncIterator]=function(){return this.cursor({useMongooseAggCursor:!0}).exec().transformNull().map(t=>null==t?{done:!0}:{value:t,done:!1})}),h._prepareDiscriminatorPipeline=p,t.exports=h},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(13).EventEmitter;
/*!
 * ignore
 */
/*!
 * ignore
 */
t.exports=class extends r{constructor(t,e,n){super(),this.driverChangeStream=null,this.closed=!1,this.pipeline=e,this.options=n,t((t,e)=>{null==t?(this.driverChangeStream=e,this._bindEvents(),this.emit("ready")):this.emit("error",t)})}_bindEvents(){this.driverChangeStream.on("close",()=>{this.closed=!0}),["close","change","end","error"].forEach(t=>{this.driverChangeStream.on(t,e=>this.emit(t,e))})}_queue(t){this.once("ready",()=>t())}close(){this.closed=!0,this.driverChangeStream&&this.driverChangeStream.close()}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(28),i=n(443),o=n(444);class s extends r{assimilateError(t){const e=t.reason,n=o(e)&&i(e)&&-1===t.message.indexOf("bad auth");this.message=n?"Could not connect to any servers in your MongoDB Atlas cluster. One common reason is that you're trying to access the database from an IP that isn't whitelisted. Make sure your current IP address is on your Atlas cluster's IP whitelist: https://docs.atlas.mongodb.com/security-whitelist/":t.message;for(const e in t)"name"!==e&&(this[e]=t[e]);return this}}Object.defineProperty(s.prototype,"name",{value:"MongooseServerSelectionError"}),t.exports=s},function(t,e,n){"use strict";t.exports=
/*!
 * ignore
 */
function t(e,n){if(e.virtuals[n])return{virtual:e.virtuals[n],path:void 0};const r=n.split(".");let i="",o="";for(let s=0;s<r.length;++s)if(i+=(i.length>0?".":"")+r[s],e.virtuals[i]){if(s===r.length-1)return{virtual:e.virtuals[i],path:o}}else if(!e.nested[i]){if(!e.paths[i]||!e.paths[i].schema){if(e.discriminators)for(const r of Object.keys(e.discriminators)){const i=t(e.discriminators[r],n);if(i)return i}return null}{e=e.paths[i].schema;const n=r.slice(s+1).join(".");if(e.virtuals[n]){if(s===r.length-2)return{virtual:e.virtuals[n],nestedSchemaPath:[o,i].filter(t=>!!t).join(".")};continue}if(s+1<r.length&&e.discriminators)for(const r of Object.keys(e.discriminators)){const s=t(e.discriminators[r],n);if(null!=s){const t=[o,i,s.nestedSchemaPath].filter(t=>!!t).join(".");return{virtual:s.virtual,nestedSchemaPath:t}}}o+=(o.length>0?".":"")+i,i=""}}}},function(t,e,n){"use strict";t.exports=function t(e,n,r,i){if(e[i])return;if(e[i]=!0,!r||!r.skipTopLevel)for(const t of n)e.plugin(t[0],t[1]);if(delete(r=Object.assign({},r)).skipTopLevel,!1!==r.applyPluginsToChildSchemas)for(const o of Object.keys(e.paths)){const s=e.paths[o];null!=s.schema&&(t(s.schema,n,r,i),s.caster.prototype.$__setSchema(s.schema))}const o=e.discriminators;if(null==o)return;const s=r.applyPluginsToDiscriminators,a=Object.keys(o);for(const e of a){t(o[e],n,{skipTopLevel:!s},i)}}},function(t){t.exports=JSON.parse('{"name":"mongoose","description":"Mongoose MongoDB ODM","version":"5.9.26","author":"Guillermo Rauch <guillermo@learnboost.com>","keywords":["mongodb","document","model","schema","database","odm","data","datastore","query","nosql","orm","db"],"license":"MIT","dependencies":{"bson":"^1.1.4","kareem":"2.3.1","mongodb":"3.5.9","mongoose-legacy-pluralize":"1.0.2","mpath":"0.7.0","mquery":"3.2.2","ms":"2.1.2","regexp-clone":"1.0.0","safe-buffer":"5.2.1","sliced":"1.0.1","sift":"7.0.1"},"devDependencies":{"@babel/core":"7.10.5","@babel/preset-env":"7.10.4","acquit":"1.x","acquit-ignore":"0.1.x","acquit-require":"0.1.x","async":"2.6.2","babel-loader":"8.1.0","benchmark":"2.1.4","bluebird":"3.5.5","chalk":"2.4.2","cheerio":"1.0.0-rc.2","co":"4.6.0","dox":"0.3.1","eslint":"7.1.0","eslint-plugin-mocha-no-only":"1.1.0","highlight.js":"9.1.0","lodash.isequal":"4.5.0","lodash.isequalwith":"4.4.0","marked":"0.6.2","mocha":"5.x","moment":"2.x","mongodb-topology-manager":"1.0.11","mongoose-long":"0.2.1","node-static":"0.7.11","object-sizeof":"1.3.0","pug":"2.0.3","q":"1.5.1","semver":"5.5.0","uuid":"2.0.3","uuid-parse":"1.0.0","validator":"10.8.0","webpack":"4.44.0"},"directories":{"lib":"./lib/mongoose"},"scripts":{"lint":"eslint .","build-browser":"node build-browser.js","prepublishOnly":"npm run build-browser","release":"git pull && git push origin master --tags && npm publish","release-legacy":"git pull origin 4.x && git push origin 4.x --tags && npm publish --tag legacy","test":"mocha --exit","test-cov":"nyc --reporter=html --reporter=text npm test"},"main":"./index.js","engines":{"node":">=4.0.0"},"bugs":{"url":"https://github.com/Automattic/mongoose/issues/new"},"repository":{"type":"git","url":"git://github.com/Automattic/mongoose.git"},"homepage":"https://mongoosejs.com","browser":"./dist/browser.umd.js","mocha":{"extension":["test.js"],"watch-files":["test/**/*.js"]},"eslintConfig":{"extends":["eslint:recommended"],"plugins":["mocha-no-only"],"parserOptions":{"ecmaVersion":2015},"env":{"node":true,"es6":true},"rules":{"comma-style":"error","indent":["error",2,{"SwitchCase":1,"VariableDeclarator":2}],"keyword-spacing":"error","no-whitespace-before-property":"error","no-buffer-constructor":"warn","no-console":"off","no-multi-spaces":"error","no-constant-condition":"off","func-call-spacing":"error","no-trailing-spaces":"error","no-undef":"error","no-unneeded-ternary":"error","no-const-assign":"error","no-useless-rename":"error","no-dupe-keys":"error","space-in-parens":["error","never"],"spaced-comment":["error","always",{"block":{"markers":["!"],"balanced":true}}],"key-spacing":["error",{"beforeColon":false,"afterColon":true}],"comma-spacing":["error",{"before":false,"after":true}],"array-bracket-spacing":1,"arrow-spacing":["error",{"before":true,"after":true}],"object-curly-spacing":["error","always"],"comma-dangle":["error","never"],"no-unreachable":"error","quotes":["error","single"],"quote-props":["error","as-needed"],"semi":"error","no-extra-semi":"error","semi-spacing":"error","no-spaced-func":"error","no-throw-literal":"error","space-before-blocks":"error","space-before-function-paren":["error","never"],"space-infix-ops":"error","space-unary-ops":"error","no-var":"warn","prefer-const":"warn","strict":["error","global"],"no-restricted-globals":["error",{"name":"context","message":"Don\'t use Mocha\'s global context"}],"no-prototype-builtins":"off","mocha-no-only/mocha-no-only":["error"]}},"funding":{"type":"opencollective","url":"https://opencollective.com/mongoose"}}')},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(236),i=n(13).EventEmitter,o=n(79),s=n(33).get().Collection,a=n(105),c=n(17),u=n(108),l=n(237),h=n(239),f=n(24),p=n(11),d=n(62),m=n(40),y=n(240),g=n(12),v=n(3).parseConnectionString;let b=0;
/*!
 * A list of authentication mechanisms that don't require a password for authentication.
 * This is used by the authMechanismDoesNotRequirePassword method.
 *
 * @api private
 */const _=["MONGODB-X509"];function w(t){this.base=t,this.collections={},this.models={},this.config={autoIndex:!0},this.replica=!1,this.options=null,this.otherDbs=[],this.relatedDbs={},this.states=a,this._readyState=a.disconnected,this._closeCalled=!1,this._hasOpened=!1,this.plugins=[],this.id=b++}
/*!
 * Inherit from EventEmitter
 */
/*!
 * ignore
 */
function S(t){return function(){const e=arguments.length>0?arguments[arguments.length-1]:null,n="function"==typeof e?Array.prototype.slice.call(arguments,0,arguments.length-1):Array.prototype.slice.call(arguments),r=new c("Connection "+this.id+" was disconnected when calling `"+t.name+"`");return f(e,e=>{d(()=>{this.readyState===a.connecting?this.once("open",(function(){t.apply(this,n.concat([e]))})):this.readyState===a.disconnected&&null==this.db?e(r):t.apply(this,n.concat([e]))})})}}w.prototype.__proto__=i.prototype,Object.defineProperty(w.prototype,"readyState",{get:function(){return this._readyState},set:function(t){if(!(t in a))throw new Error("Invalid connection state: "+t);if(this._readyState!==t){this._readyState=t;for(const e of this.otherDbs)e.readyState=t;for(const e in this.relatedDbs)this.relatedDbs[e].readyState=t;a.connected===t&&(this._hasOpened=!0),this.emit(a[t])}}}),w.prototype.get=function(t){return p(this.options,t)},w.prototype.set=function(t,e){return this.options=this.options||{},this.options[t]=e,e},w.prototype.collections,w.prototype.name,w.prototype.models,w.prototype.id,Object.defineProperty(w.prototype,"plugins",{configurable:!1,enumerable:!0,writable:!0}),Object.defineProperty(w.prototype,"host",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(w.prototype,"port",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(w.prototype,"user",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(w.prototype,"pass",{configurable:!0,enumerable:!0,writable:!0}),w.prototype.db,w.prototype.config,w.prototype.createCollection=S((function(t,e,n){"function"==typeof e&&(n=e,e={}),this.db.createCollection(t,e,n)})),w.prototype.startSession=S((function(t,e){"function"==typeof t&&(e=t,t=null),e(null,this.client.startSession(t))})),w.prototype.dropCollection=S((function(t,e){this.db.dropCollection(t,e)})),w.prototype.dropDatabase=S((function(t){for(const t of Object.keys(this.models))delete this.models[t].$init;this.db.dropDatabase(t)})),w.prototype.error=function(t,e){return e?(e(t),null):(this.listeners("error").length>0&&this.emit("error",t),Promise.reject(t))},w.prototype.onOpen=function(){this.readyState=a.connected;for(const t in this.collections)g.object.hasOwnProperty(this.collections,t)&&this.collections[t].onOpen();this.emit("open")},w.prototype.openUri=function(t,e,n){if(this.readyState=a.connecting,this._closeCalled=!1,"function"==typeof e&&(n=e,e=null),-1!==["string","number"].indexOf(typeof e))throw new c("Mongoose 5.x no longer supports `mongoose.connect(host, dbname, port)` or `mongoose.createConnection(host, dbname, port)`. See http://mongoosejs.com/docs/connections.html for supported connection syntax");if("string"!=typeof t)throw new c("The `uri` parameter to `openUri()` must be a "+`string, got "${typeof t}". Make sure the first parameter to `+"`mongoose.connect()` or `mongoose.createConnection()` is a string.");if(null!=n&&"function"!=typeof n)throw new c('3rd parameter to `mongoose.connect()` or `mongoose.createConnection()` must be a function, got "'+typeof n+'"');const r=u.get(),i=this;if(e){const t=(e=g.clone(e)).config&&null!=e.config.autoIndex?e.config.autoIndex:e.autoIndex;null!=t&&(this.config.autoIndex=!1!==t,delete e.config,delete e.autoIndex),"autoCreate"in e&&(this.config.autoCreate=!!e.autoCreate,delete e.autoCreate),"useCreateIndex"in e&&(this.config.useCreateIndex=!!e.useCreateIndex,delete e.useCreateIndex),"useFindAndModify"in e&&(this.config.useFindAndModify=!!e.useFindAndModify,delete e.useFindAndModify),(e.user||e.pass)&&(e.auth=e.auth||{},e.auth.user=e.user,e.auth.password=e.pass,this.user=e.user,this.pass=e.pass),delete e.user,delete e.pass,null!=e.bufferCommands&&(null==e.bufferMaxEntries&&(e.bufferMaxEntries=0),this.config.bufferCommands=e.bufferCommands,delete e.bufferCommands),null!=e.useMongoClient&&O(e)}else e={};this._connectionOptions=e;const o=e.dbName;null!=o&&(this.$dbName=o),delete e.dbName,"promiseLibrary"in e||(e.promiseLibrary=u.get()),"useNewUrlParser"in e||("useNewUrlParser"in this.base.options?e.useNewUrlParser=this.base.options.useNewUrlParser:e.useNewUrlParser=!1),g.hasUserDefinedProperty(e,"useUnifiedTopology")||(g.hasUserDefinedProperty(this.base.options,"useUnifiedTopology")?e.useUnifiedTopology=this.base.options.useUnifiedTopology:e.useUnifiedTopology=!1),g.hasUserDefinedProperty(e,"driverInfo")||(e.driverInfo={name:"Mongoose",version:y.version});const s=new r((n,r)=>{v(t,e,(t,e)=>{if(t)return r(t);o?this.name=o:e.defaultDatabase?this.name=e.defaultDatabase:this.name=p(e,"auth.db",null),this.host=p(e,"hosts.0.host","localhost"),this.port=p(e,"hosts.0.port",27017),this.user=this.user||p(e,"auth.username"),this.pass=this.pass||p(e,"auth.password"),n()})}),h=()=>{i.readyState!==a.connected&&(i.readyState=a.connected,i.emit("reconnect"),i.emit("reconnected"))},f=new r((n,r)=>{const s=new m.MongoClient(t,e);i.client=s,s.connect((function(t){if(t)return i.readyState=a.disconnected,r(t);const c=null!=o?s.db(o):s.db();i.db=c;const u=p(c,"s.topology.s.description.type","");if(e.useUnifiedTopology)if("Single"===u){const t=Array.from(c.s.topology.s.servers.values())[0];t.s.topology.on("serverHeartbeatSucceeded",()=>{h()}),t.s.pool.on("reconnect",()=>{h()}),s.on("serverDescriptionChanged",t=>{"Standalone"===t.newDescription.type?h():i.readyState=a.disconnected})}else u.startsWith("ReplicaSet")&&(s.on("topologyDescriptionChanged",t=>{const e=t.newDescription,n=Array.from(t.newDescription.servers.values()),r="ReplicaSetNoPrimary"===e.type&&n.reduce((t,e)=>t||"Unknown"===e.type,!1);i.readyState===a.connected&&r?i.readyState=a.disconnected:i.readyState!==a.disconnected||r||h()}),c.on("close",(function(){"ReplicaSetWithPrimary"!==p(c,"s.topology.s.description.type","")&&(i.readyState=a.disconnected)})));c.on("reconnect",(function(){h()})),c.s.topology.on("reconnectFailed",(function(){i.emit("reconnectFailed")})),e.useUnifiedTopology||c.s.topology.on("left",(function(t){i.emit("left",t)})),c.s.topology.on("joined",(function(t){i.emit("joined",t)})),c.s.topology.on("fullsetup",(function(t){i.emit("fullsetup",t)})),null!=p(c,"s.topology.s.coreTopology.s.pool")&&c.s.topology.s.coreTopology.s.pool.on("attemptReconnect",(function(){i.emit("attemptReconnect")})),e.useUnifiedTopology&&u.startsWith("ReplicaSet")||c.on("close",(function(){i.readyState=a.disconnected})),e.useUnifiedTopology||s.on("left",(function(){i.readyState===a.connected&&"ReplicaSetNoPrimary"===p(c,"s.topology.s.coreTopology.s.replicaSetState.topologyType")&&(i.readyState=a.disconnected)})),c.on("timeout",(function(){i.emit("timeout")})),delete i.then,delete i.catch,i.readyState=a.connected;for(const t in i.collections)g.object.hasOwnProperty(i.collections,t)&&i.collections[t].onOpen();n(i),i.emit("open")}))}),d=new l;return this.$initialConnection=r.all([f,s]).then(t=>t[0]).catch(t=>{throw null!=t&&"MongoServerSelectionError"===t.name&&(t=d.assimilateError(t)),this.listeners("error").length>0&&process.nextTick(()=>this.emit("error",t)),t}),this.then=function(t,e){return this.$initialConnection.then(t,e)},this.catch=function(t){return this.$initialConnection.catch(t)},null!=n&&(this.$initialConnection=this.$initialConnection.then(()=>n(null,this),t=>n(t))),this};
/*!
 * ignore
 */
const O=function(t){console.warn("WARNING: The `useMongoClient` option is no longer necessary in mongoose 5.x, please remove it.");const e=(new Error).stack;console.warn(e.substr(e.indexOf("\n")+1)),delete t.useMongoClient};w.prototype.close=function(t,e){return"function"==typeof t&&(e=t,t=!1),this.$wasForceClosed=!!t,f(e,e=>{this._close(t,e)})},w.prototype._close=function(t,e){const n=this;switch(this._closeCalled=!0,this.readyState){case a.disconnected:e();break;case a.connected:this.readyState=a.disconnecting,this.doClose(t,(function(r){if(r)return e(r);n.onClose(t),e(null)}));break;case a.connecting:this.once("open",(function(){n.close(e)}));break;case a.disconnecting:this.once("close",(function(){e()}))}return this},w.prototype.onClose=function(t){this.readyState=a.disconnected;for(const e in this.collections)g.object.hasOwnProperty(this.collections,e)&&this.collections[e].onClose(t);this.emit("close",t)},w.prototype.collection=function(t,e){return(e=e?g.clone(e):{}).$wasForceClosed=this.$wasForceClosed,t in this.collections||(this.collections[t]=new s(t,this,e)),this.collections[t]},w.prototype.plugin=function(t,e){return this.plugins.push([t,e]),this},w.prototype.model=function(t,e,n){if(!(this instanceof w))throw new c("`connection.model()` should not be run with `new`. If you are doing `new db.model(foo)(bar)`, use `db.model(foo)(bar)` instead");let r;if("function"==typeof t&&(r=t,t=r.name),"string"==typeof e&&(n=e,e=!1),g.isObject(e)&&!e.instanceOfSchema&&(e=new o(e)),e&&!e.instanceOfSchema)throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");if(this.models[t]&&!n){if(e&&e.instanceOfSchema&&e!==this.models[t].schema)throw new c.OverwriteModelError(t);return this.models[t]}const i={cache:!1,connection:this};let s;if(e&&e.instanceOfSchema)return h(e,this.plugins,null,"$connectionPluginsApplied"),s=this.base.model(r||t,e,n,i),this.models[t]||(this.models[t]=s),s.init((function(){})),s;if(this.models[t]&&n){return s=this.models[t],e=s.prototype.schema,s.__subclass(this,e,n)}if(s=this.base.models[t],!s)throw new c.MissingSchemaError(t);return this!==s.prototype.db||n&&n!==s.collection.name?(this.models[t]=s.__subclass(this,e,n),this.models[t]):(this.models[t]||(this.models[t]=s),s)},w.prototype.deleteModel=function(t){if("string"==typeof t){const e=this.model(t);if(null==e)return this;const n=e.collection.name;delete this.models[t],delete this.collections[n],delete this.base.modelSchemas[t]}else{if(!(t instanceof RegExp))throw new Error('First parameter to `deleteModel()` must be a string or regexp, got "'+t+'"');{const e=t,n=this.modelNames();for(const t of n)e.test(t)&&this.deleteModel(t)}}return this},w.prototype.watch=function(t,e){const n=new c("Connection "+this.id+" was disconnected when calling `watch()`");return new r(r=>{d(()=>{if(this.readyState===a.connecting)this.once("open",(function(){const n=this.db.watch(t,e);r(null,n)}));else if(this.readyState===a.disconnected&&null==this.db)r(n);else{const n=this.db.watch(t,e);r(null,n)}})},t,e)},w.prototype.modelNames=function(){return Object.keys(this.models)},w.prototype.shouldAuthenticate=function(){return null!=this.user&&(null!=this.pass||this.authMechanismDoesNotRequirePassword())},w.prototype.authMechanismDoesNotRequirePassword=function(){return!this.options||!this.options.auth||_.indexOf(this.options.auth.authMechanism)>=0},w.prototype.optionsProvideAuthenticationData=function(t){return t&&t.user&&(t.pass||this.authMechanismDoesNotRequirePassword())},
/*!
 * Module exports.
 */
w.STATES=a,t.exports=w},function(t,e,n){const r=n(116);r.connect(process.env.dbURL,{useCreateIndex:!0,useNewUrlParser:!0,useUnifiedTopology:!0}),r.set("useFindAndModify",!1)},,function(t,e,n){const r=n(116);n(152).config(),n(242),n(245);const i=new(0,r.Schema)({email:{type:String,unique:!0},name:String,username:{type:String,unique:!0},videos:String,uploadedVideos:{type:[r.Schema.Types.ObjectId],ref:"video"},subscriptions:{type:[r.Schema.Types.ObjectId],ref:"user"},likes:{type:[r.Schema.Types.ObjectId],ref:"video"},dislikes:{type:[r.Schema.Types.ObjectId],ref:"video"},subscribers:Number,imageUrl:String}),o=r.model("user",i);t.exports=o},function(t,e,n){const r=n(116);n(152).config(),n(242),n(244);const i=new(0,r.Schema)({title:String,description:String,tags:[String],likes:Number,dislikes:Number,length:Number,uploadDate:Date,views:Number,uploadingUser:{type:r.Schema.Types.ObjectId,ref:"user"}}),o=r.model("video",i);t.exports=o},function(t,e){t.exports={routerConfig:t=>{const{GET:e,PUT:n,POST:r,PATCH:i,DELETE:o}=t;return(t,s,a)=>{switch(t.httpMethod){case"GET":e&&e(t,s,a);break;case"POST":r&&r(t,s,a);break;case"PUT":n&&n(t,s,a);break;case"PATCH":i&&i(t,s,a);break;case"DELETE":o&&o(t,s,a)}}}}},function(t,e){t.exports=require("querystring")},function(t,e){var n=1e3,r=6e4,i=60*r,o=24*i;function s(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=o)return s(t,e,o,"day");if(e>=i)return s(t,e,i,"hour");if(e>=r)return s(t,e,r,"minute");if(e>=n)return s(t,e,n,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=o)return Math.round(t/o)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=r)return Math.round(t/r)+"m";if(e>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */if(global.MONGOOSE_DRIVER_PATH){const t="The `MONGOOSE_DRIVER_PATH` global property is deprecated. Use `mongoose.driver.set()` instead.";n(6).deprecate((function(){n(33).set(n(250)(global.MONGOOSE_DRIVER_PATH))}),t)()}else n(33).set(n(251));const r=n(22),i=n(79),o=n(25),s=n(111),a=n(138),c=n(105),u=n(424),l=n(143),h=n(147),f=n(439),p=n(239),d=n(11),m=n(24),y=n(462),g=n(12),v=n(240),b=n(80),_=n(463),w=n(464),S=n(465),O=n(235),E=n(108),T=n(466),C=Symbol.for("mongoose:default");function I(t){if(this.connections=[],this.models={},this.modelSchemas={},this.options=Object.assign({pluralization:!0},t),this.createConnection().models=this.models,this.options.pluralization&&(this._pluralize=y),t&&t[C])for(const t of["Schema","model"])this[t]=I.prototype[t];else{const t=this;this.Schema=function(){return this.base=t,i.apply(this,arguments)},this.Schema.prototype=Object.create(i.prototype),Object.assign(this.Schema,i),this.Schema.base=this,this.Schema.Types=Object.assign({},i.Types)}this.Schema.prototype.base=this,Object.defineProperty(this,"plugins",{configurable:!1,enumerable:!0,writable:!1,value:[[w,{deduplicate:!0}],[S,{deduplicate:!0}],[T,{deduplicate:!0}],[_,{deduplicate:!0}]]})}n(467),I.prototype.cast=b,I.prototype.STATES=c,I.prototype.driver=n(33),I.prototype.set=function(t,e){const n=this instanceof I?this:N;if(-1===u.indexOf(t))throw new Error(`\`${t}\` is an invalid option.`);return 1===arguments.length?n.options[t]:(n.options[t]=e,"objectIdGetter"===t&&(e?Object.defineProperty(N.Types.ObjectId.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}):delete N.Types.ObjectId.prototype._id),n)},I.prototype.get=I.prototype.set,I.prototype.createConnection=function(t,e,n){const r=this instanceof I?this:N,i=new k(r);return"function"==typeof e&&(n=e,e=null),r.connections.push(i),arguments.length>0?i.openUri(t,e,n):i},I.prototype.connect=function(t,e,n){const r=this instanceof I?this:N;return r.connection.openUri(t,e,n).then(()=>r)},I.prototype.disconnect=function(t){const e=this instanceof I?this:N;return m(t,t=>{let n=e.connections.length;if(n<=0)return t(null);e.connections.forEach(e=>{e.close((function(e){if(e)return t(e);--n||t(null)}))})})},I.prototype.startSession=function(){const t=this instanceof I?this:N;return t.connection.startSession.apply(t.connection,arguments)},I.prototype.pluralize=function(t){const e=this instanceof I?this:N;return arguments.length>0&&(e._pluralize=t),e._pluralize},I.prototype.model=function(t,e,n,r){const o=this instanceof I?this:N;let s,a;if("function"==typeof t&&(s=t,t=s.name,!(s.prototype instanceof f)))throw new o.Error("The provided class "+t+" must extend Model");if("string"==typeof e&&(n=e,e=!1),g.isObject(e)&&!e.instanceOfSchema&&(e=new i(e)),e&&!e.instanceOfSchema)throw new Error("The 2nd parameter to `mongoose.model()` should be a schema or a POJO");if("boolean"==typeof n&&(r=n,n=null),r&&g.isObject(r)?(a=r,r=!0):a={},!o.modelSchemas[t]){if(!e)throw new N.Error.MissingSchemaError(t);o.modelSchemas[t]=e}const c=e;let u;if(e&&(o.get("cloneSchemas")&&(e=e.clone()),o._applyPlugins(e)),o.models[t]&&!1!==a.cache){if(c&&c.instanceOfSchema&&c!==o.models[t].schema)throw new o.Error.OverwriteModelError(t);return n&&n!==o.models[t].collection.name?(s=o.models[t],e=s.prototype.schema,u=s.__subclass(o.connection,e,n),u):o.models[t]}if(!e&&!(e=this.modelSchemas[t]))throw new N.Error.MissingSchemaError(t);"pluralization"in e.options||(e.options.pluralization=o.options.pluralization),n||(n=e.get("collection")||g.toCollectionName(t,o.pluralize()));const l=a.connection||o.connection;return s=o.Model.compile(s||t,e,n,l,o),r||s.init((function(){})),!1===a.cache?s:(o.models[t]=s,o.models[t])},I.prototype.deleteModel=function(t){const e=this instanceof I?this:N;return e.connection.deleteModel(t),e},I.prototype.modelNames=function(){const t=this instanceof I?this:N;return Object.keys(t.models)},I.prototype._applyPlugins=function(t,e){const n=this instanceof I?this:N;(e=e||{}).applyPluginsToDiscriminators=d(n,"options.applyPluginsToDiscriminators",!1),e.applyPluginsToChildSchemas=d(n,"options.applyPluginsToChildSchemas",!0),p(t,n.plugins,e,"$globalPluginsApplied")},I.prototype.plugin=function(t,e){const n=this instanceof I?this:N;return n.plugins.push([t,e]),n},I.prototype.__defineGetter__("connection",(function(){return this.connections[0]})),I.prototype.__defineSetter__("connection",(function(t){t instanceof k&&(this.connections[0]=t,this.models=t.models)})),I.prototype.connections;
/*!
 * Driver dependent APIs
 */
const A=global.MONGOOSE_DRIVER_PATH||"./drivers/node-mongodb-native",k=n(468)(A+"/connection"),x=n(470)(A+"/collection");
/*!
 * Connection
 */I.prototype.Aggregate=O,I.prototype.Collection=x,I.prototype.Connection=k,I.prototype.version=v.version,I.prototype.Mongoose=I,I.prototype.Schema=i,I.prototype.SchemaType=o,I.prototype.SchemaTypes=i.Types,I.prototype.VirtualType=a,I.prototype.Types=l,I.prototype.Query=h,Object.defineProperty(I.prototype,"Promise",{get:function(){return E.get()},set:function(t){E.set(t)}}),I.prototype.PromiseProvider=E,I.prototype.Model=f,I.prototype.Document=r,I.prototype.DocumentProvider=n(220),I.prototype.ObjectId=s.ObjectId,I.prototype.isValidObjectId=function(t){if(null==t)return!0;const e=(this||N).driver.get().ObjectId;if(t instanceof e)return!0;if(null!=t._id){if(t._id instanceof e)return!0;if(t._id.toString instanceof Function)return"string"==typeof(t=t._id.toString())&&(12===t.length||24===t.length)}return t.toString instanceof Function&&(t=t.toString()),"string"==typeof t&&(12===t.length||24===t.length)},I.prototype.Decimal128=s.Decimal128,I.prototype.Mixed=s.Mixed,I.prototype.Date=s.Date,I.prototype.Number=s.Number,I.prototype.Error=n(17),I.prototype.now=function(){return new Date},I.prototype.CastError=n(31),I.prototype.SchemaTypeOptions=n(32),I.prototype.mongo=n(40),I.prototype.mquery=n(134);
/*!
 * The exports object is an instance of Mongoose.
 *
 * @api public
 */
const N=t.exports=new I({[C]:!0})},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=250},function(t,e,n){"use strict";
/*!
 * Module exports.
 */e.Binary=n(252),e.Collection=n(190),e.Decimal128=n(340),e.ObjectId=n(341),e.ReadPreference=n(342)},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(40).Binary;t.exports=r},function(t,e,n){"use strict";var r=n(117),i=n(55),o=n(85),s=n(86),a=n(87),c=n(88),u=n(89),l=n(118),h=n(90),f=n(91),p=n(92),d=n(93),m=n(94),y=n(71),g=n(254),v=n(255),b=n(257),_=n(45),w=_.allocBuffer(17825792),S=function(){};S.prototype.serialize=function(t,e){var n="boolean"==typeof(e=e||{}).checkKeys&&e.checkKeys,r="boolean"==typeof e.serializeFunctions&&e.serializeFunctions,i="boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined,o="number"==typeof e.minInternalBufferSize?e.minInternalBufferSize:17825792;w.length<o&&(w=_.allocBuffer(o));var s=v(w,t,n,0,0,r,i,[]),a=_.allocBuffer(s);return w.copy(a,0,0,a.length),a},S.prototype.serializeWithBufferAndIndex=function(t,e,n){var r="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,i="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,o="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0;return v(e,t,r,s||0,0,i,o)-1},S.prototype.deserialize=function(t,e){return g(t,e)},S.prototype.calculateObjectSize=function(t,e){var n="boolean"==typeof(e=e||{}).serializeFunctions&&e.serializeFunctions,r="boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined;return b(t,n,r)},S.prototype.deserializeStream=function(t,e,n,r,i,o){o=null!=o?o:{};for(var s=e,a=0;a<n;a++){var c=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24;o.index=s,r[i+a]=this.deserialize(t,o),s+=c}return s},S.BSON_INT32_MAX=2147483647,S.BSON_INT32_MIN=-2147483648,S.BSON_INT64_MAX=Math.pow(2,63)-1,S.BSON_INT64_MIN=-Math.pow(2,63),S.JS_INT_MAX=9007199254740992,S.JS_INT_MIN=-9007199254740992,S.BSON_DATA_NUMBER=1,S.BSON_DATA_STRING=2,S.BSON_DATA_OBJECT=3,S.BSON_DATA_ARRAY=4,S.BSON_DATA_BINARY=5,S.BSON_DATA_OID=7,S.BSON_DATA_BOOLEAN=8,S.BSON_DATA_DATE=9,S.BSON_DATA_NULL=10,S.BSON_DATA_REGEXP=11,S.BSON_DATA_CODE=13,S.BSON_DATA_SYMBOL=14,S.BSON_DATA_CODE_W_SCOPE=15,S.BSON_DATA_INT=16,S.BSON_DATA_TIMESTAMP=17,S.BSON_DATA_LONG=18,S.BSON_DATA_MIN_KEY=255,S.BSON_DATA_MAX_KEY=127,S.BSON_BINARY_SUBTYPE_DEFAULT=0,S.BSON_BINARY_SUBTYPE_FUNCTION=1,S.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,S.BSON_BINARY_SUBTYPE_UUID=3,S.BSON_BINARY_SUBTYPE_MD5=4,S.BSON_BINARY_SUBTYPE_USER_DEFINED=128,t.exports=S,t.exports.Code=h,t.exports.Map=r,t.exports.Symbol=u,t.exports.BSON=S,t.exports.DBRef=m,t.exports.Binary=y,t.exports.ObjectID=a,t.exports.Long=i,t.exports.Timestamp=s,t.exports.Double=o,t.exports.Int32=l,t.exports.MinKey=p,t.exports.MaxKey=d,t.exports.BSONRegExp=c,t.exports.Decimal128=f},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(55).Long,Double=__webpack_require__(85).Double,Timestamp=__webpack_require__(86).Timestamp,ObjectID=__webpack_require__(87).ObjectID,Symbol=__webpack_require__(89).Symbol,Code=__webpack_require__(90).Code,MinKey=__webpack_require__(92).MinKey,MaxKey=__webpack_require__(93).MaxKey,Decimal128=__webpack_require__(91),Int32=__webpack_require__(118),DBRef=__webpack_require__(94).DBRef,BSONRegExp=__webpack_require__(88).BSONRegExp,Binary=__webpack_require__(71).Binary,utils=__webpack_require__(45),deserialize=function(t,e,n){var r=(e=null==e?{}:e)&&e.index?e.index:0,i=t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24;if(i<5||t.length<i||i+r>t.length)throw new Error("corrupt bson message");if(0!==t[r+i-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(t,r,e,n)},deserializeObject=function(t,e,n,r){var i=null!=n.evalFunctions&&n.evalFunctions,o=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!s)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,u=null!=n.raw&&n.raw,l="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,h=null!=n.promoteBuffers&&n.promoteBuffers,f=null==n.promoteLongs||n.promoteLongs,p=null==n.promoteValues||n.promoteValues,d=e;if(t.length<5)throw new Error("corrupt bson message < 5 bytes long");var m=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(m<5||m>t.length)throw new Error("corrupt bson message");for(var y=r?[]:{},g=0;;){var v=t[e++];if(0===v)break;for(var b=e;0!==t[b]&&b<t.length;)b++;if(b>=t.length)throw new Error("Bad BSON Document: illegal CString");var _=r?g++:t.toString("utf8",e,b);if(e=b+1,v===BSON.BSON_DATA_STRING){var w=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(w<=0||w>t.length-e||0!==t[e+w-1])throw new Error("bad string length in bson");y[_]=t.toString("utf8",e,e+w-1),e+=w}else if(v===BSON.BSON_DATA_OID){var S=utils.allocBuffer(12);t.copy(S,0,e,e+12),y[_]=new ObjectID(S),e+=12}else if(v===BSON.BSON_DATA_INT&&!1===p)y[_]=new Int32(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24);else if(v===BSON.BSON_DATA_INT)y[_]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;else if(v===BSON.BSON_DATA_NUMBER&&!1===p)y[_]=new Double(t.readDoubleLE(e)),e+=8;else if(v===BSON.BSON_DATA_NUMBER)y[_]=t.readDoubleLE(e),e+=8;else if(v===BSON.BSON_DATA_DATE){var O=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,E=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;y[_]=new Date(new Long(O,E).toNumber())}else if(v===BSON.BSON_DATA_BOOLEAN){if(0!==t[e]&&1!==t[e])throw new Error("illegal boolean type value");y[_]=1===t[e++]}else if(v===BSON.BSON_DATA_OBJECT){var T=e,C=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;if(C<=0||C>t.length-e)throw new Error("bad embedded document length in bson");y[_]=u?t.slice(e,e+C):deserializeObject(t,T,n,!1),e+=C}else if(v===BSON.BSON_DATA_ARRAY){T=e;var I=n,A=e+(C=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24);if(c&&c[_]){for(var k in I={},n)I[k]=n[k];I.raw=!0}if(y[_]=deserializeObject(t,T,I,!0),0!==t[(e+=C)-1])throw new Error("invalid array terminator byte");if(e!==A)throw new Error("corrupted array bson")}else if(v===BSON.BSON_DATA_UNDEFINED)y[_]=void 0;else if(v===BSON.BSON_DATA_NULL)y[_]=null;else if(v===BSON.BSON_DATA_LONG){O=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,E=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;var x=new Long(O,E);y[_]=f&&!0===p&&x.lessThanOrEqual(JS_INT_MAX_LONG)&&x.greaterThanOrEqual(JS_INT_MIN_LONG)?x.toNumber():x}else if(v===BSON.BSON_DATA_DECIMAL128){var N=utils.allocBuffer(16);t.copy(N,0,e,e+16),e+=16;var P=new Decimal128(N);y[_]=P.toObject?P.toObject():P}else if(v===BSON.BSON_DATA_BINARY){var j=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,R=j,M=t[e++];if(j<0)throw new Error("Negative binary type element size found");if(j>t.length)throw new Error("Binary type size larger than document size");if(null!=t.slice){if(M===Binary.SUBTYPE_BYTE_ARRAY){if((j=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}y[_]=h&&p?t.slice(e,e+j):new Binary(t.slice(e,e+j),M)}else{var D="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(j)):new Array(j);if(M===Binary.SUBTYPE_BYTE_ARRAY){if((j=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(b=0;b<j;b++)D[b]=t[e+b];y[_]=h&&p?D:new Binary(D,M)}e+=j}else if(v===BSON.BSON_DATA_REGEXP&&!1===l){for(b=e;0!==t[b]&&b<t.length;)b++;if(b>=t.length)throw new Error("Bad BSON Document: illegal CString");var $=t.toString("utf8",e,b);for(b=e=b+1;0!==t[b]&&b<t.length;)b++;if(b>=t.length)throw new Error("Bad BSON Document: illegal CString");var L=t.toString("utf8",e,b);e=b+1;var F=new Array(L.length);for(b=0;b<L.length;b++)switch(L[b]){case"m":F[b]="m";break;case"s":F[b]="g";break;case"i":F[b]="i"}y[_]=new RegExp($,F.join(""))}else if(v===BSON.BSON_DATA_REGEXP&&!0===l){for(b=e;0!==t[b]&&b<t.length;)b++;if(b>=t.length)throw new Error("Bad BSON Document: illegal CString");for($=t.toString("utf8",e,b),b=e=b+1;0!==t[b]&&b<t.length;)b++;if(b>=t.length)throw new Error("Bad BSON Document: illegal CString");L=t.toString("utf8",e,b),e=b+1,y[_]=new BSONRegExp($,L)}else if(v===BSON.BSON_DATA_SYMBOL){if((w=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||w>t.length-e||0!==t[e+w-1])throw new Error("bad string length in bson");y[_]=new Symbol(t.toString("utf8",e,e+w-1)),e+=w}else if(v===BSON.BSON_DATA_TIMESTAMP)O=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,E=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,y[_]=new Timestamp(O,E);else if(v===BSON.BSON_DATA_MIN_KEY)y[_]=new MinKey;else if(v===BSON.BSON_DATA_MAX_KEY)y[_]=new MaxKey;else if(v===BSON.BSON_DATA_CODE){if((w=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||w>t.length-e||0!==t[e+w-1])throw new Error("bad string length in bson");var B=t.toString("utf8",e,e+w-1);if(i)if(o){var U=s?a(B):B;y[_]=isolateEvalWithHash(functionCache,U,B,y)}else y[_]=isolateEval(B);else y[_]=new Code(B);e+=w}else if(v===BSON.BSON_DATA_CODE_W_SCOPE){var V=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(V<13)throw new Error("code_w_scope total size shorter minimum expected length");if((w=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||w>t.length-e||0!==t[e+w-1])throw new Error("bad string length in bson");B=t.toString("utf8",e,e+w-1),T=e+=w,C=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;var q=deserializeObject(t,T,n,!1);if(e+=C,V<8+C+w)throw new Error("code_w_scope total size is to short, truncating scope");if(V>8+C+w)throw new Error("code_w_scope total size is to long, clips outer document");i?(o?(U=s?a(B):B,y[_]=isolateEvalWithHash(functionCache,U,B,y)):y[_]=isolateEval(B),y[_].scope=q):y[_]=new Code(B,q)}else{if(v!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+v.toString(16)+' for fieldname "'+_+'", are you using the latest BSON parser');if((w=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||w>t.length-e||0!==t[e+w-1])throw new Error("bad string length in bson");var W=t.toString("utf8",e,e+w-1);e+=w;var z=utils.allocBuffer(12);t.copy(z,0,e,e+12),S=new ObjectID(z),e+=12;var H=W.split("."),K=H.shift(),G=H.join(".");y[_]=new DBRef(G,S,K)}}if(m!==e-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=y.$id&&(y=new DBRef(y.$ref,y.$id,y.$db)),y},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(t,e,n){"use strict";var r=n(256).writeIEEE754,i=n(55).Long,o=n(117),s=n(71).Binary,a=n(45).normalizedFunctionString,c=/\x00/,u=["$db","$ref","$id","$clusterTime"],l=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)},h=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},f=function(t,e,n,r,i){t[r++]=j.BSON_DATA_STRING;var o=i?t.write(e,r,"ascii"):t.write(e,r,"utf8");t[(r=r+o+1)-1]=0;var s=t.write(n,r+4,"utf8");return t[r+3]=s+1>>24&255,t[r+2]=s+1>>16&255,t[r+1]=s+1>>8&255,t[r]=s+1&255,r=r+4+s,t[r++]=0,r},p=function(t,e,n,o,s){if(Math.floor(n)===n&&n>=j.JS_INT_MIN&&n<=j.JS_INT_MAX)if(n>=j.BSON_INT32_MIN&&n<=j.BSON_INT32_MAX){t[o++]=j.BSON_DATA_INT;var a=s?t.write(e,o,"ascii"):t.write(e,o,"utf8");o+=a,t[o++]=0,t[o++]=255&n,t[o++]=n>>8&255,t[o++]=n>>16&255,t[o++]=n>>24&255}else if(n>=j.JS_INT_MIN&&n<=j.JS_INT_MAX)t[o++]=j.BSON_DATA_NUMBER,o+=a=s?t.write(e,o,"ascii"):t.write(e,o,"utf8"),t[o++]=0,r(t,n,o,"little",52,8),o+=8;else{t[o++]=j.BSON_DATA_LONG,o+=a=s?t.write(e,o,"ascii"):t.write(e,o,"utf8"),t[o++]=0;var c=i.fromNumber(n),u=c.getLowBits(),l=c.getHighBits();t[o++]=255&u,t[o++]=u>>8&255,t[o++]=u>>16&255,t[o++]=u>>24&255,t[o++]=255&l,t[o++]=l>>8&255,t[o++]=l>>16&255,t[o++]=l>>24&255}else t[o++]=j.BSON_DATA_NUMBER,o+=a=s?t.write(e,o,"ascii"):t.write(e,o,"utf8"),t[o++]=0,r(t,n,o,"little",52,8),o+=8;return o},d=function(t,e,n,r,i){return t[r++]=j.BSON_DATA_NULL,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,r},m=function(t,e,n,r,i){return t[r++]=j.BSON_DATA_BOOLEAN,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,t[r++]=n?1:0,r},y=function(t,e,n,r,o){t[r++]=j.BSON_DATA_DATE,r+=o?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var s=i.fromNumber(n.getTime()),a=s.getLowBits(),c=s.getHighBits();return t[r++]=255&a,t[r++]=a>>8&255,t[r++]=a>>16&255,t[r++]=a>>24&255,t[r++]=255&c,t[r++]=c>>8&255,t[r++]=c>>16&255,t[r++]=c>>24&255,r},g=function(t,e,n,r,i){if(t[r++]=j.BSON_DATA_REGEXP,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,n.source&&null!=n.source.match(c))throw Error("value "+n.source+" must not contain null bytes");return r+=t.write(n.source,r,"utf8"),t[r++]=0,n.global&&(t[r++]=115),n.ignoreCase&&(t[r++]=105),n.multiline&&(t[r++]=109),t[r++]=0,r},v=function(t,e,n,r,i){if(t[r++]=j.BSON_DATA_REGEXP,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,null!=n.pattern.match(c))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=t.write(n.pattern,r,"utf8"),t[r++]=0,r+=t.write(n.options.split("").sort().join(""),r,"utf8"),t[r++]=0,r},b=function(t,e,n,r,i){return null===n?t[r++]=j.BSON_DATA_NULL:"MinKey"===n._bsontype?t[r++]=j.BSON_DATA_MIN_KEY:t[r++]=j.BSON_DATA_MAX_KEY,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,r},_=function(t,e,n,r,i){if(t[r++]=j.BSON_DATA_OID,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,"string"==typeof n.id)t.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(t,r,0,12)}return r+12},w=function(t,e,n,r,i){t[r++]=j.BSON_DATA_BINARY,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var o=n.length;return t[r++]=255&o,t[r++]=o>>8&255,t[r++]=o>>16&255,t[r++]=o>>24&255,t[r++]=j.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(t,r,0,o),r+=o},S=function(t,e,n,r,i,o,s,a,c,u){for(var l=0;l<u.length;l++)if(u[l]===n)throw new Error("cyclic dependency detected");u.push(n),t[r++]=Array.isArray(n)?j.BSON_DATA_ARRAY:j.BSON_DATA_OBJECT,r+=c?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var h=P(t,n,i,r,o+1,s,a,u);return u.pop(),h},O=function(t,e,n,r,i){return t[r++]=j.BSON_DATA_DECIMAL128,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,n.bytes.copy(t,r,0,16),r+16},E=function(t,e,n,r,i){t[r++]="Long"===n._bsontype?j.BSON_DATA_LONG:j.BSON_DATA_TIMESTAMP,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var o=n.getLowBits(),s=n.getHighBits();return t[r++]=255&o,t[r++]=o>>8&255,t[r++]=o>>16&255,t[r++]=o>>24&255,t[r++]=255&s,t[r++]=s>>8&255,t[r++]=s>>16&255,t[r++]=s>>24&255,r},T=function(t,e,n,r,i){return t[r++]=j.BSON_DATA_INT,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,t[r++]=255&n,t[r++]=n>>8&255,t[r++]=n>>16&255,t[r++]=n>>24&255,r},C=function(t,e,n,i,o){return t[i++]=j.BSON_DATA_NUMBER,i+=o?t.write(e,i,"ascii"):t.write(e,i,"utf8"),t[i++]=0,r(t,n,i,"little",52,8),i+=8},I=function(t,e,n,r,i,o,s){t[r++]=j.BSON_DATA_CODE,r+=s?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var c=a(n),u=t.write(c,r+4,"utf8")+1;return t[r]=255&u,t[r+1]=u>>8&255,t[r+2]=u>>16&255,t[r+3]=u>>24&255,r=r+4+u-1,t[r++]=0,r},A=function(t,e,n,r,i,o,s,a,c){if(n.scope&&"object"==typeof n.scope){t[r++]=j.BSON_DATA_CODE_W_SCOPE;var u=c?t.write(e,r,"ascii"):t.write(e,r,"utf8");r+=u,t[r++]=0;var l=r,h="string"==typeof n.code?n.code:n.code.toString();r+=4;var f=t.write(h,r+4,"utf8")+1;t[r]=255&f,t[r+1]=f>>8&255,t[r+2]=f>>16&255,t[r+3]=f>>24&255,t[r+4+f-1]=0,r=r+f+4;var p=P(t,n.scope,i,r,o+1,s,a);r=p-1;var d=p-l;t[l++]=255&d,t[l++]=d>>8&255,t[l++]=d>>16&255,t[l++]=d>>24&255,t[r++]=0}else{t[r++]=j.BSON_DATA_CODE,r+=u=c?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0,h=n.code.toString();var m=t.write(h,r+4,"utf8")+1;t[r]=255&m,t[r+1]=m>>8&255,t[r+2]=m>>16&255,t[r+3]=m>>24&255,r=r+4+m-1,t[r++]=0}return r},k=function(t,e,n,r,i){t[r++]=j.BSON_DATA_BINARY,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var o=n.value(!0),a=n.position;return n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a+=4),t[r++]=255&a,t[r++]=a>>8&255,t[r++]=a>>16&255,t[r++]=a>>24&255,t[r++]=n.sub_type,n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a-=4,t[r++]=255&a,t[r++]=a>>8&255,t[r++]=a>>16&255,t[r++]=a>>24&255),o.copy(t,r,0,n.position),r+=n.position},x=function(t,e,n,r,i){t[r++]=j.BSON_DATA_SYMBOL,r+=i?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var o=t.write(n.value,r+4,"utf8")+1;return t[r]=255&o,t[r+1]=o>>8&255,t[r+2]=o>>16&255,t[r+3]=o>>24&255,r=r+4+o-1,t[r++]=0,r},N=function(t,e,n,r,i,o,s){t[r++]=j.BSON_DATA_OBJECT,r+=s?t.write(e,r,"ascii"):t.write(e,r,"utf8"),t[r++]=0;var a,c=r,u=(a=null!=n.db?P(t,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,r,i+1,o):P(t,{$ref:n.namespace,$id:n.oid},!1,r,i+1,o))-c;return t[c++]=255&u,t[c++]=u>>8&255,t[c++]=u>>16&255,t[c++]=u>>24&255,a},P=function(t,e,n,r,i,s,a,P){r=r||0,(P=P||[]).push(e);var j=r+4;if(Array.isArray(e))for(var R=0;R<e.length;R++){var M=""+R,D=e[R];if(D&&D.toBSON){if("function"!=typeof D.toBSON)throw new Error("toBSON is not a function");D=D.toBSON()}var $=typeof D;if("string"===$)j=f(t,M,D,j,!0);else if("number"===$)j=p(t,M,D,j,!0);else if("boolean"===$)j=m(t,M,D,j,!0);else if(D instanceof Date||l(D))j=y(t,M,D,j,!0);else if(void 0===D)j=d(t,M,0,j,!0);else if(null===D)j=d(t,M,0,j,!0);else if("ObjectID"===D._bsontype||"ObjectId"===D._bsontype)j=_(t,M,D,j,!0);else if(Buffer.isBuffer(D))j=w(t,M,D,j,!0);else if(D instanceof RegExp||h(D))j=g(t,M,D,j,!0);else if("object"===$&&null==D._bsontype)j=S(t,M,D,j,n,i,s,a,!0,P);else if("object"===$&&"Decimal128"===D._bsontype)j=O(t,M,D,j,!0);else if("Long"===D._bsontype||"Timestamp"===D._bsontype)j=E(t,M,D,j,!0);else if("Double"===D._bsontype)j=C(t,M,D,j,!0);else if("function"==typeof D&&s)j=I(t,M,D,j,0,0,s);else if("Code"===D._bsontype)j=A(t,M,D,j,n,i,s,a,!0);else if("Binary"===D._bsontype)j=k(t,M,D,j,!0);else if("Symbol"===D._bsontype)j=x(t,M,D,j,!0);else if("DBRef"===D._bsontype)j=N(t,M,D,j,i,s,!0);else if("BSONRegExp"===D._bsontype)j=v(t,M,D,j,!0);else if("Int32"===D._bsontype)j=T(t,M,D,j,!0);else if("MinKey"===D._bsontype||"MaxKey"===D._bsontype)j=b(t,M,D,j,!0);else if(void 0!==D._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+D._bsontype)}else if(e instanceof o)for(var L=e.entries(),F=!1;!F;){var B=L.next();if(!(F=B.done)){if(M=B.value[0],$=typeof(D=B.value[1]),"string"==typeof M&&-1===u.indexOf(M)){if(null!=M.match(c))throw Error("key "+M+" must not contain null bytes");if(n){if("$"===M[0])throw Error("key "+M+" must not start with '$'");if(~M.indexOf("."))throw Error("key "+M+" must not contain '.'")}}if("string"===$)j=f(t,M,D,j);else if("number"===$)j=p(t,M,D,j);else if("boolean"===$)j=m(t,M,D,j);else if(D instanceof Date||l(D))j=y(t,M,D,j);else if(null===D||void 0===D&&!1===a)j=d(t,M,0,j);else if("ObjectID"===D._bsontype||"ObjectId"===D._bsontype)j=_(t,M,D,j);else if(Buffer.isBuffer(D))j=w(t,M,D,j);else if(D instanceof RegExp||h(D))j=g(t,M,D,j);else if("object"===$&&null==D._bsontype)j=S(t,M,D,j,n,i,s,a,!1,P);else if("object"===$&&"Decimal128"===D._bsontype)j=O(t,M,D,j);else if("Long"===D._bsontype||"Timestamp"===D._bsontype)j=E(t,M,D,j);else if("Double"===D._bsontype)j=C(t,M,D,j);else if("Code"===D._bsontype)j=A(t,M,D,j,n,i,s,a);else if("function"==typeof D&&s)j=I(t,M,D,j,0,0,s);else if("Binary"===D._bsontype)j=k(t,M,D,j);else if("Symbol"===D._bsontype)j=x(t,M,D,j);else if("DBRef"===D._bsontype)j=N(t,M,D,j,i,s);else if("BSONRegExp"===D._bsontype)j=v(t,M,D,j);else if("Int32"===D._bsontype)j=T(t,M,D,j);else if("MinKey"===D._bsontype||"MaxKey"===D._bsontype)j=b(t,M,D,j);else if(void 0!==D._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+D._bsontype)}}else{if(e.toBSON){if("function"!=typeof e.toBSON)throw new Error("toBSON is not a function");if(null!=(e=e.toBSON())&&"object"!=typeof e)throw new Error("toBSON function did not return an object")}for(M in e){if((D=e[M])&&D.toBSON){if("function"!=typeof D.toBSON)throw new Error("toBSON is not a function");D=D.toBSON()}if($=typeof D,"string"==typeof M&&-1===u.indexOf(M)){if(null!=M.match(c))throw Error("key "+M+" must not contain null bytes");if(n){if("$"===M[0])throw Error("key "+M+" must not start with '$'");if(~M.indexOf("."))throw Error("key "+M+" must not contain '.'")}}if("string"===$)j=f(t,M,D,j);else if("number"===$)j=p(t,M,D,j);else if("boolean"===$)j=m(t,M,D,j);else if(D instanceof Date||l(D))j=y(t,M,D,j);else if(void 0===D)!1===a&&(j=d(t,M,0,j));else if(null===D)j=d(t,M,0,j);else if("ObjectID"===D._bsontype||"ObjectId"===D._bsontype)j=_(t,M,D,j);else if(Buffer.isBuffer(D))j=w(t,M,D,j);else if(D instanceof RegExp||h(D))j=g(t,M,D,j);else if("object"===$&&null==D._bsontype)j=S(t,M,D,j,n,i,s,a,!1,P);else if("object"===$&&"Decimal128"===D._bsontype)j=O(t,M,D,j);else if("Long"===D._bsontype||"Timestamp"===D._bsontype)j=E(t,M,D,j);else if("Double"===D._bsontype)j=C(t,M,D,j);else if("Code"===D._bsontype)j=A(t,M,D,j,n,i,s,a);else if("function"==typeof D&&s)j=I(t,M,D,j,0,0,s);else if("Binary"===D._bsontype)j=k(t,M,D,j);else if("Symbol"===D._bsontype)j=x(t,M,D,j);else if("DBRef"===D._bsontype)j=N(t,M,D,j,i,s);else if("BSONRegExp"===D._bsontype)j=v(t,M,D,j);else if("Int32"===D._bsontype)j=T(t,M,D,j);else if("MinKey"===D._bsontype||"MaxKey"===D._bsontype)j=b(t,M,D,j);else if(void 0!==D._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+D._bsontype)}}P.pop(),t[j++]=0;var U=j-r;return t[r++]=255&U,t[r++]=U>>8&255,t[r++]=U>>16&255,t[r++]=U>>24&255,j},j={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};j.BSON_INT64_MAX=Math.pow(2,63)-1,j.BSON_INT64_MIN=-Math.pow(2,63),j.JS_INT_MAX=9007199254740992,j.JS_INT_MIN=-9007199254740992,t.exports=P},function(t,e){e.readIEEE754=function(t,e,n,r,i){var o,s,a="big"===n,c=8*i-r-1,u=(1<<c)-1,l=u>>1,h=-7,f=a?0:i-1,p=a?1:-1,d=t[e+f];for(f+=p,o=d&(1<<-h)-1,d>>=-h,h+=c;h>0;o=256*o+t[e+f],f+=p,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+f],f+=p,h-=8);if(0===o)o=1-l;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=l}return(d?-1:1)*s*Math.pow(2,o-r)},e.writeIEEE754=function(t,e,n,r,i,o){var s,a,c,u="big"===r,l=8*o-i-1,h=(1<<l)-1,f=h>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=u?o-1:0,m=u?-1:1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+f>=1?p/c:p*Math.pow(2,1-f))*c>=2&&(s++,c/=2),s+f>=h?(a=0,s=h):s+f>=1?(a=(e*c-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[n+d]=255&a,d+=m,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;t[n+d]=255&s,d+=m,s/=256,l-=8);t[n+d-m]|=128*y}},function(t,e,n){"use strict";var r=n(55).Long,i=n(85).Double,o=n(86).Timestamp,s=n(87).ObjectID,a=n(89).Symbol,c=n(88).BSONRegExp,u=n(90).Code,l=n(91),h=n(92).MinKey,f=n(93).MaxKey,p=n(94).DBRef,d=n(71).Binary,m=n(45).normalizedFunctionString,y=function(t,e,n){var r=5;if(Array.isArray(t))for(var i=0;i<t.length;i++)r+=g(i.toString(),t[i],e,!0,n);else for(var o in t.toBSON&&(t=t.toBSON()),t)r+=g(o,t[o],e,!1,n);return r};function g(t,e,n,g,b){switch(e&&e.toBSON&&(e=e.toBSON()),typeof e){case"string":return 1+Buffer.byteLength(t,"utf8")+1+4+Buffer.byteLength(e,"utf8")+1;case"number":return Math.floor(e)===e&&e>=v.JS_INT_MIN&&e<=v.JS_INT_MAX&&e>=v.BSON_INT32_MIN&&e<=v.BSON_INT32_MAX?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+5:(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;case"undefined":return g||!b?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1:0;case"boolean":return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+2;case"object":if(null==e||e instanceof h||e instanceof f||"MinKey"===e._bsontype||"MaxKey"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1;if(e instanceof s||"ObjectID"===e._bsontype||"ObjectId"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+13;if(e instanceof Date||"object"==typeof(w=e)&&"[object Date]"===Object.prototype.toString.call(w))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+6+e.length;if(e instanceof r||e instanceof i||e instanceof o||"Long"===e._bsontype||"Double"===e._bsontype||"Timestamp"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+9;if(e instanceof l||"Decimal128"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+17;if(e instanceof u||"Code"===e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+4+Buffer.byteLength(e.code.toString(),"utf8")+1+y(e.scope,n,b):(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+Buffer.byteLength(e.code.toString(),"utf8")+1;if(e instanceof d||"Binary"===e._bsontype)return e.sub_type===d.SUBTYPE_BYTE_ARRAY?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+(e.position+1+4+1+4):(null!=t?Buffer.byteLength(t,"utf8")+1:0)+(e.position+1+4+1);if(e instanceof a||"Symbol"===e._bsontype)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+Buffer.byteLength(e.value,"utf8")+4+1+1;if(e instanceof p||"DBRef"===e._bsontype){var _={$ref:e.namespace,$id:e.oid};return null!=e.db&&(_.$db=e.db),(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+y(_,n,b)}return e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:e instanceof c||"BSONRegExp"===e._bsontype?(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.pattern,"utf8")+1+Buffer.byteLength(e.options,"utf8")+1:(null!=t?Buffer.byteLength(t,"utf8")+1:0)+y(e,n,b)+1;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"===String.call(e))return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+Buffer.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(n&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+4+Buffer.byteLength(m(e),"utf8")+1+y(e.scope,n,b);if(n)return(null!=t?Buffer.byteLength(t,"utf8")+1:0)+1+4+Buffer.byteLength(m(e),"utf8")+1}var w;return 0}var v={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};t.exports=y},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";var r=n(84),i=n(260);t.exports=function(t,e){if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");t=r.resolve(t);var n=r.join(t,"noop.js");try{return i._resolveFilename(e,{id:n,filename:n,paths:i._nodeModulePaths(t)})}catch(t){return null}}},function(t,e){t.exports=require("module")},function(t,e){var n;e=t.exports=H,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var r=Number.MAX_SAFE_INTEGER||9007199254740991,i=e.re=[],o=e.src=[],s=0,a=s++;o[a]="0|[1-9]\\d*";var c=s++;o[c]="[0-9]+";var u=s++;o[u]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var l=s++;o[l]="("+o[a]+")\\.("+o[a]+")\\.("+o[a]+")";var h=s++;o[h]="("+o[c]+")\\.("+o[c]+")\\.("+o[c]+")";var f=s++;o[f]="(?:"+o[a]+"|"+o[u]+")";var p=s++;o[p]="(?:"+o[c]+"|"+o[u]+")";var d=s++;o[d]="(?:-("+o[f]+"(?:\\."+o[f]+")*))";var m=s++;o[m]="(?:-?("+o[p]+"(?:\\."+o[p]+")*))";var y=s++;o[y]="[0-9A-Za-z-]+";var g=s++;o[g]="(?:\\+("+o[y]+"(?:\\."+o[y]+")*))";var v=s++,b="v?"+o[l]+o[d]+"?"+o[g]+"?";o[v]="^"+b+"$";var _="[v=\\s]*"+o[h]+o[m]+"?"+o[g]+"?",w=s++;o[w]="^"+_+"$";var S=s++;o[S]="((?:<|>)?=?)";var O=s++;o[O]=o[c]+"|x|X|\\*";var E=s++;o[E]=o[a]+"|x|X|\\*";var T=s++;o[T]="[v=\\s]*("+o[E]+")(?:\\.("+o[E]+")(?:\\.("+o[E]+")(?:"+o[d]+")?"+o[g]+"?)?)?";var C=s++;o[C]="[v=\\s]*("+o[O]+")(?:\\.("+o[O]+")(?:\\.("+o[O]+")(?:"+o[m]+")?"+o[g]+"?)?)?";var I=s++;o[I]="^"+o[S]+"\\s*"+o[T]+"$";var A=s++;o[A]="^"+o[S]+"\\s*"+o[C]+"$";var k=s++;o[k]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var x=s++;o[x]="(?:~>?)";var N=s++;o[N]="(\\s*)"+o[x]+"\\s+",i[N]=new RegExp(o[N],"g");var P=s++;o[P]="^"+o[x]+o[T]+"$";var j=s++;o[j]="^"+o[x]+o[C]+"$";var R=s++;o[R]="(?:\\^)";var M=s++;o[M]="(\\s*)"+o[R]+"\\s+",i[M]=new RegExp(o[M],"g");var D=s++;o[D]="^"+o[R]+o[T]+"$";var $=s++;o[$]="^"+o[R]+o[C]+"$";var L=s++;o[L]="^"+o[S]+"\\s*("+_+")$|^$";var F=s++;o[F]="^"+o[S]+"\\s*("+b+")$|^$";var B=s++;o[B]="(\\s*)"+o[S]+"\\s*("+_+"|"+o[T]+")",i[B]=new RegExp(o[B],"g");var U=s++;o[U]="^\\s*("+o[T]+")\\s+-\\s+("+o[T]+")\\s*$";var V=s++;o[V]="^\\s*("+o[C]+")\\s+-\\s+("+o[C]+")\\s*$";var q=s++;o[q]="(<|>)?=?\\s*\\*";for(var W=0;W<35;W++)n(W,o[W]),i[W]||(i[W]=new RegExp(o[W]));function z(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof H)return t;if("string"!=typeof t)return null;if(t.length>256)return null;if(!(e.loose?i[w]:i[v]).test(t))return null;try{return new H(t,e)}catch(t){return null}}function H(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof H){if(t.loose===e.loose)return t;t=t.version}else if("string"!=typeof t)throw new TypeError("Invalid Version: "+t);if(t.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof H))return new H(t,e);n("SemVer",t,e),this.options=e,this.loose=!!e.loose;var o=t.trim().match(e.loose?i[w]:i[v]);if(!o)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+o[1],this.minor=+o[2],this.patch=+o[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");o[4]?this.prerelease=o[4].split(".").map((function(t){if(/^[0-9]+$/.test(t)){var e=+t;if(e>=0&&e<r)return e}return t})):this.prerelease=[],this.build=o[5]?o[5].split("."):[],this.format()}e.parse=z,e.valid=function(t,e){var n=z(t,e);return n?n.version:null},e.clean=function(t,e){var n=z(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null},e.SemVer=H,H.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},H.prototype.toString=function(){return this.version},H.prototype.compare=function(t){return n("SemVer.compare",this.version,this.options,t),t instanceof H||(t=new H(t,this.options)),this.compareMain(t)||this.comparePre(t)},H.prototype.compareMain=function(t){return t instanceof H||(t=new H(t,this.options)),G(this.major,t.major)||G(this.minor,t.minor)||G(this.patch,t.patch)},H.prototype.comparePre=function(t){if(t instanceof H||(t=new H(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],i=t.prerelease[e];if(n("prerelease compare",e,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return G(r,i)}while(++e)},H.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this},e.inc=function(t,e,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new H(t,n).inc(e,r).version}catch(t){return null}},e.diff=function(t,e){if(J(t,e))return null;var n=z(t),r=z(e),i="";if(n.prerelease.length||r.prerelease.length){i="pre";var o="prerelease"}for(var s in n)if(("major"===s||"minor"===s||"patch"===s)&&n[s]!==r[s])return i+s;return o},e.compareIdentifiers=G;var K=/^[0-9]+$/;function G(t,e){var n=K.test(t),r=K.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1}function Q(t,e,n){return new H(t,n).compare(new H(e,n))}function Y(t,e,n){return Q(t,e,n)>0}function X(t,e,n){return Q(t,e,n)<0}function J(t,e,n){return 0===Q(t,e,n)}function Z(t,e,n){return 0!==Q(t,e,n)}function tt(t,e,n){return Q(t,e,n)>=0}function et(t,e,n){return Q(t,e,n)<=0}function nt(t,e,n,r){switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return J(t,n,r);case"!=":return Z(t,n,r);case">":return Y(t,n,r);case">=":return tt(t,n,r);case"<":return X(t,n,r);case"<=":return et(t,n,r);default:throw new TypeError("Invalid operator: "+e)}}function rt(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof rt){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof rt))return new rt(t,e);n("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===it?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}e.rcompareIdentifiers=function(t,e){return G(e,t)},e.major=function(t,e){return new H(t,e).major},e.minor=function(t,e){return new H(t,e).minor},e.patch=function(t,e){return new H(t,e).patch},e.compare=Q,e.compareLoose=function(t,e){return Q(t,e,!0)},e.rcompare=function(t,e,n){return Q(e,t,n)},e.sort=function(t,n){return t.sort((function(t,r){return e.compare(t,r,n)}))},e.rsort=function(t,n){return t.sort((function(t,r){return e.rcompare(t,r,n)}))},e.gt=Y,e.lt=X,e.eq=J,e.neq=Z,e.gte=tt,e.lte=et,e.cmp=nt,e.Comparator=rt;var it={};function ot(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof ot)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new ot(t.raw,e);if(t instanceof rt)return new ot(t.value,e);if(!(this instanceof ot))return new ot(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((function(t){return this.parseRange(t.trim())}),this).filter((function(t){return t.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+t);this.format()}function st(t){return!t||"x"===t.toLowerCase()||"*"===t}function at(t,e,n,r,i,o,s,a,c,u,l,h,f){return((e=st(n)?"":st(r)?">="+n+".0.0":st(i)?">="+n+"."+r+".0":">="+e)+" "+(a=st(c)?"":st(u)?"<"+(+c+1)+".0.0":st(l)?"<"+c+"."+(+u+1)+".0":h?"<="+c+"."+u+"."+l+"-"+h:"<="+a)).trim()}function ct(t,e,r){for(var i=0;i<t.length;i++)if(!t[i].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(i=0;i<t.length;i++)if(n(t[i].semver),t[i].semver!==it&&t[i].semver.prerelease.length>0){var o=t[i].semver;if(o.major===e.major&&o.minor===e.minor&&o.patch===e.patch)return!0}return!1}return!0}function ut(t,e,n){try{e=new ot(e,n)}catch(t){return!1}return e.test(t)}function lt(t,e,n,r){var i,o,s,a,c;switch(t=new H(t,r),e=new ot(e,r),n){case">":i=Y,o=et,s=X,a=">",c=">=";break;case"<":i=X,o=tt,s=Y,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ut(t,e,r))return!1;for(var u=0;u<e.set.length;++u){var l=e.set[u],h=null,f=null;if(l.forEach((function(t){t.semver===it&&(t=new rt(">=0.0.0")),h=h||t,f=f||t,i(t.semver,h.semver,r)?h=t:s(t.semver,f.semver,r)&&(f=t)})),h.operator===a||h.operator===c)return!1;if((!f.operator||f.operator===a)&&o(t,f.semver))return!1;if(f.operator===c&&s(t,f.semver))return!1}return!0}rt.prototype.parse=function(t){var e=this.options.loose?i[L]:i[F],n=t.match(e);if(!n)throw new TypeError("Invalid comparator: "+t);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new H(n[2],this.options.loose):this.semver=it},rt.prototype.toString=function(){return this.value},rt.prototype.test=function(t){return n("Comparator.test",t,this.options.loose),this.semver===it||("string"==typeof t&&(t=new H(t,this.options)),nt(t,this.operator,this.semver,this.options))},rt.prototype.intersects=function(t,e){if(!(t instanceof rt))throw new TypeError("a Comparator is required");var n;if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return n=new ot(t.value,e),ut(this.value,n,e);if(""===t.operator)return n=new ot(this.value,e),ut(t.semver,n,e);var r=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),o=this.semver.version===t.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),a=nt(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),c=nt(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return r||i||o&&s||a||c},e.Range=ot,ot.prototype.format=function(){return this.range=this.set.map((function(t){return t.join(" ").trim()})).join("||").trim(),this.range},ot.prototype.toString=function(){return this.range},ot.prototype.parseRange=function(t){var e=this.options.loose;t=t.trim();var r=e?i[V]:i[U];t=t.replace(r,at),n("hyphen replace",t),t=t.replace(i[B],"$1$2$3"),n("comparator trim",t,i[B]),t=(t=(t=t.replace(i[N],"$1~")).replace(i[M],"$1^")).split(/\s+/).join(" ");var o=e?i[L]:i[F],s=t.split(" ").map((function(t){return function(t,e){return n("comp",t,e),t=function(t,e){return t.trim().split(/\s+/).map((function(t){return function(t,e){n("caret",t,e);var r=e.loose?i[$]:i[D];return t.replace(r,(function(e,r,i,o,s){var a;return n("caret",t,e,r,i,o,s),st(r)?a="":st(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":st(o)?a="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":s?(n("replaceCaret pr",s),a="0"===r?"0"===i?">="+r+"."+i+"."+o+"-"+s+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+"-"+s+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+"-"+s+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",a),a}))}(t,e)})).join(" ")}(t,e),n("caret",t),t=function(t,e){return t.trim().split(/\s+/).map((function(t){return function(t,e){var r=e.loose?i[j]:i[P];return t.replace(r,(function(e,r,i,o,s){var a;return n("tilde",t,e,r,i,o,s),st(r)?a="":st(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":st(o)?a=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":s?(n("replaceTilde pr",s),a=">="+r+"."+i+"."+o+"-"+s+" <"+r+"."+(+i+1)+".0"):a=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",a),a}))}(t,e)})).join(" ")}(t,e),n("tildes",t),t=function(t,e){return n("replaceXRanges",t,e),t.split(/\s+/).map((function(t){return function(t,e){t=t.trim();var r=e.loose?i[A]:i[I];return t.replace(r,(function(e,r,i,o,s,a){n("xRange",t,e,r,i,o,s,a);var c=st(i),u=c||st(o),l=u||st(s);return"="===r&&l&&(r=""),c?e=">"===r||"<"===r?"<0.0.0":"*":r&&l?(u&&(o=0),s=0,">"===r?(r=">=",u?(i=+i+1,o=0,s=0):(o=+o+1,s=0)):"<="===r&&(r="<",u?i=+i+1:o=+o+1),e=r+i+"."+o+"."+s):u?e=">="+i+".0.0 <"+(+i+1)+".0.0":l&&(e=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",e),e}))}(t,e)})).join(" ")}(t,e),n("xrange",t),t=function(t,e){return n("replaceStars",t,e),t.trim().replace(i[q],"")}(t,e),n("stars",t),t}(t,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter((function(t){return!!t.match(o)}))),s=s.map((function(t){return new rt(t,this.options)}),this)},ot.prototype.intersects=function(t,e){if(!(t instanceof ot))throw new TypeError("a Range is required");return this.set.some((function(n){return n.every((function(n){return t.set.some((function(t){return t.every((function(t){return n.intersects(t,e)}))}))}))}))},e.toComparators=function(t,e){return new ot(t,e).set.map((function(t){return t.map((function(t){return t.value})).join(" ").trim().split(" ")}))},ot.prototype.test=function(t){if(!t)return!1;"string"==typeof t&&(t=new H(t,this.options));for(var e=0;e<this.set.length;e++)if(ct(this.set[e],t,this.options))return!0;return!1},e.satisfies=ut,e.maxSatisfying=function(t,e,n){var r=null,i=null;try{var o=new ot(e,n)}catch(t){return null}return t.forEach((function(t){o.test(t)&&(r&&-1!==i.compare(t)||(i=new H(r=t,n)))})),r},e.minSatisfying=function(t,e,n){var r=null,i=null;try{var o=new ot(e,n)}catch(t){return null}return t.forEach((function(t){o.test(t)&&(r&&1!==i.compare(t)||(i=new H(r=t,n)))})),r},e.minVersion=function(t,e){t=new ot(t,e);var n=new H("0.0.0");if(t.test(n))return n;if(n=new H("0.0.0-0"),t.test(n))return n;n=null;for(var r=0;r<t.set.length;++r){t.set[r].forEach((function(t){var e=new H(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":n&&!Y(n,e)||(n=e);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+t.operator)}}))}if(n&&t.test(n))return n;return null},e.validRange=function(t,e){try{return new ot(t,e).range||"*"}catch(t){return null}},e.ltr=function(t,e,n){return lt(t,e,"<",n)},e.gtr=function(t,e,n){return lt(t,e,">",n)},e.outside=lt,e.prerelease=function(t,e){var n=z(t,e);return n&&n.prerelease.length?n.prerelease:null},e.intersects=function(t,e,n){return t=new ot(t,n),e=new ot(e,n),t.intersects(e)},e.coerce=function(t){if(t instanceof H)return t;if("string"!=typeof t)return null;var e=t.match(i[k]);if(null==e)return null;return z(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}},function(t){t.exports=JSON.parse('{"name":"mongodb","version":"3.5.9","description":"The official MongoDB driver for Node.js","main":"index.js","files":["index.js","lib"],"repository":{"type":"git","url":"git@github.com:mongodb/node-mongodb-native.git"},"keywords":["mongodb","driver","official"],"peerOptionalDependencies":{"kerberos":"^1.1.0","mongodb-client-encryption":"^1.0.0","mongodb-extjson":"^2.1.2","snappy":"^6.3.4","bson-ext":"^2.0.0"},"dependencies":{"bl":"^2.2.0","bson":"^1.1.4","denque":"^1.4.1","require_optional":"^1.0.1","safe-buffer":"^5.1.2"},"devDependencies":{"chai":"^4.1.1","chai-subset":"^1.6.0","chalk":"^2.4.2","co":"4.6.0","coveralls":"^2.11.6","eslint":"^4.5.0","eslint-plugin-prettier":"^2.2.0","istanbul":"^0.4.5","jsdoc":"3.5.5","lodash.camelcase":"^4.3.0","mocha":"5.2.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.1","prettier":"^1.19.1","semver":"^5.5.0","sinon":"^4.3.0","sinon-chai":"^3.2.0","snappy":"^6.3.4","standard-version":"^4.4.0","util.promisify":"^1.0.1","worker-farm":"^1.5.0","wtfnode":"^0.8.0","yargs":"^14.2.0"},"license":"Apache-2.0","engines":{"node":">=4"},"bugs":{"url":"https://github.com/mongodb/node-mongodb-native/issues"},"scripts":{"atlas":"node ./test/tools/atlas_connectivity_tests.js","test":"npm run lint && mocha --recursive test/functional test/unit test/core","test-nolint":"mocha --recursive test/functional test/unit test/core","coverage":"istanbul cover mongodb-test-runner -- -t 60000 test/core test/unit test/functional","lint":"eslint -v && eslint lib test","format":"prettier --print-width 100 --tab-width 2 --single-quote --write \'test/**/*.js\' \'lib/**/*.js\'","bench":"node test/benchmarks/driverBench/","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js","release":"standard-version -i HISTORY.md"},"homepage":"https://github.com/mongodb/node-mongodb-native","optionalDependencies":{"saslprep":"^1.0.0"}}')},function(t,e){t.exports=require("zlib")},function(t,e,n){"use strict";const r=n(6).inherits,i=n(13).EventEmitter,o=n(5).MongoError,s=n(5).MongoTimeoutError,a=n(5).MongoWriteConcernError,c=n(34),u=n(6).format,l=n(56).Msg,h=n(158),f=n(14).MESSAGE_HEADER_SIZE,p=n(14).COMPRESSION_DETAILS_SIZE,d=n(14).opcodes,m=n(41).compress,y=n(41).compressorIDs,g=n(41).uncompressibleCommands,v=n(159),b=n(29).Buffer,_=n(122),w=n(47).updateSessionFromResponse,S=n(9).eachAsync,O=n(9).makeStateMachine,E=n(0).now,T="destroying",C="destroyed",I=O({disconnected:["connecting","draining","disconnected"],connecting:["connecting","connected","draining","disconnected"],connected:["connected","disconnected","draining"],draining:["draining",T,C],[T]:[T,C],[C]:[C]}),A=new Set(["error","close","timeout","parseError","connect","message"]);var k=0,x=function(t,e){if(i.call(this),this.topology=t,this.s={state:"disconnected",cancellationToken:new i},this.s.cancellationToken.setMaxListeners(1/0),this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:36e4,keepAlive:!0,keepAliveInitialDelay:3e5,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passphrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1,legacyCompatMode:!0},e),this.id=k++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,this.reconnectError=null,!e.bson||e.bson&&("function"!=typeof e.bson.serialize||"function"!=typeof e.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=c("Pool",e),this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=0,this.executing=!1,this.queue=[],this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0;const n=this;this._messageHandler=function(t){return function(e,n){for(var r=null,i=0;i<n.workItems.length;i++)n.workItems[i].requestId===e.responseTo&&(r=n.workItems[i],n.workItems.splice(i,1));function s(t,e,n,r){if(!t.options.domainsEnabled)return process.nextTick((function(){return e(n,r)}));e(n,r)}if(r&&r.monitoring&&R(n,t.inUseConnections,t.availableConnections),t.numberOfConsecutiveTimeouts=0,r&&r.socketTimeout&&n.resetSocketTimeout(),t.logger.isDebug()&&t.logger.debug(u("message [%s] received from %s:%s",e.raw.toString("hex"),t.options.host,t.options.port)),t.executing||process.nextTick((function(){V(t)()})),r&&!r.immediateRelease){try{e.parse(r)}catch(e){return s(t,r.cb,new o(e))}if(e.documents[0]){const n=e.documents[0],i=r.session;i&&w(i,n),t.topology&&n.$clusterTime&&(t.topology.clusterTime=n.$clusterTime)}if(r.command&&e.documents[0]){const n=e.documents[0];if(n.writeConcernError){const e=new a(n.writeConcernError,n);return s(t,r.cb,e)}if(0===n.ok||n.$err||n.errmsg||n.code)return s(t,r.cb,new o(n))}e.hashedName=n.hashedName,s(t,r.cb,null,new h(r.fullResult?e:e.documents[0],n,e))}}}(this),this._connectionCloseHandler=function(t){P(n,"close",t,this)},this._connectionErrorHandler=function(t){P(n,"error",t,this)},this._connectionTimeoutHandler=function(t){P(n,"timeout",t,this)},this._connectionParseErrorHandler=function(t){P(n,"parseError",t,this)}};function N(t){t.inUseConnections=[],t.availableConnections=[],t.connectingConnections=0,t.executing=!1,t.numberOfConsecutiveTimeouts=0,t.connectionIndex=0,t.retriesLeft=t.options.reconnectTries,t.reconnectId=null}function P(t,e,n,r){if(r){if(r._connectionFailHandled)return;r._connectionFailHandled=!0,r.destroy(),F(t,r),r.flush(n)}if("timeout"===e&&(t.numberOfConsecutiveTimeouts=t.numberOfConsecutiveTimeouts+1,t.numberOfConsecutiveTimeouts>t.options.reconnectTries))return t.numberOfConsecutiveTimeouts=0,t.destroy(!0),t.emit("close",t);0===t.socketCount()&&(t.state!==C&&t.state!==T&&"draining"!==t.state&&t.options.reconnect&&I(t,"disconnected"),e="error"===e?"close":e,t.emit(e,n)),!t.reconnectId&&t.options.reconnect&&(t.reconnectError=n,t.reconnectId=setTimeout(j(t),t.options.reconnectInterval)),M(t)<t.minSize&&B(t)}function j(t,e){return function(){if(t.emit("attemptReconnect",t),t.state!==C&&t.state!==T){if(t.retriesLeft=t.retriesLeft-1,t.retriesLeft<=0){t.destroy();const n=new s(`failed to reconnect after ${t.options.reconnectTries} attempts with interval ${t.options.reconnectInterval} ms`,t.reconnectError);return t.emit("reconnectFailed",n),void("function"==typeof e&&e(n))}t.reconnectId=null,B(t,(n,r)=>{null==n&&(t.reconnectId=null,t.retriesLeft=t.options.reconnectTries,t.emit("reconnect",t)),"function"==typeof e&&e(n,r)})}else"function"==typeof e&&e(new o("Cannot create connection when pool is destroyed"))}}function R(t,e,n){var r=e.indexOf(t);-1!==r&&(e.splice(r,1),n.push(t))}function M(t){return t.availableConnections.length+t.inUseConnections.length+t.connectingConnections}function D(t,e,n,r){I(t,T),t.s.cancellationToken.emit("cancel"),S(e,(t,e)=>{for(const e of A)t.removeAllListeners(e);t.on("error",()=>{}),t.destroy(n,e)},e=>{e?"function"==typeof r&&r(e,null):(N(t),t.queue=[],I(t,C),"function"==typeof r&&r(null,null))})}function $(t,e,n){const r=e.toBin();if(!!!t.options.agreedCompressor||!function(t){const e=t instanceof l?t.command:t.query,n=Object.keys(e)[0];return!g.has(n)}(e))return n(null,r);const i=b.concat(r),o=i.slice(f),s=i.readInt32LE(12);m(t,o,(function(r,i){if(r)return n(r,null);const a=b.alloc(f);a.writeInt32LE(f+p+i.length,0),a.writeInt32LE(e.requestId,4),a.writeInt32LE(0,8),a.writeInt32LE(d.OP_COMPRESSED,12);const c=b.alloc(p);return c.writeInt32LE(s,0),c.writeInt32LE(o.length,4),c.writeUInt8(y[t.options.agreedCompressor],8),n(null,[a,c,i])}))}function L(t,e){for(var n=0;n<e.length;n++)if(e[n]===t)return e.splice(n,1),!0}function F(t,e){L(e,t.availableConnections)||L(e,t.inUseConnections)}function B(t,e){t.state!==C&&t.state!==T?(t.connectingConnections++,_(t.options,t.s.cancellationToken,(n,r)=>(t.connectingConnections--,n?(t.logger.isDebug()&&t.logger.debug(`connection attempt failed with error [${JSON.stringify(n)}]`),!t.reconnectId&&t.options.reconnect?"connecting"===t.state&&t.options.legacyCompatMode?void e(n):(t.reconnectError=n,void(t.reconnectId=setTimeout(j(t,e),t.options.reconnectInterval))):void("function"==typeof e&&e(n))):t.state===C||t.state===T?("function"==typeof e&&e(new o("Pool was destroyed after connection creation")),void r.destroy()):(r.on("error",t._connectionErrorHandler),r.on("close",t._connectionCloseHandler),r.on("timeout",t._connectionTimeoutHandler),r.on("parseError",t._connectionParseErrorHandler),r.on("message",t._messageHandler),t.availableConnections.push(r),"function"==typeof e&&e(null,r),void V(t)())))):"function"==typeof e&&e(new o("Cannot create connection when pool is destroyed"))}function U(t){for(var e=0;e<t.length;e++)if(t[e].monitoring){var n=t[e];t.splice(e,1),n.cb(new o({message:"no connection available for monitoring",driver:!0}))}}function V(t){return function(){if(t.state!==C&&!t.executing)if(t.executing=!0,t.connectingConnections>0)t.executing=!1;else{for(;;){const s=M(t);if(0===t.availableConnections.length){U(t.queue),s<t.options.size&&t.queue.length>0&&B(t);break}if(0===t.queue.length)break;var e=null;const a=t.availableConnections.filter(t=>0===t.workItems.length);if(!(e=0===a.length?t.availableConnections[t.connectionIndex++%t.availableConnections.length]:a[t.connectionIndex++%a.length]).isConnected()){F(t,e),U(t.queue);break}var n=t.queue.shift();if(n.monitoring){var r=!1;for(let n=0;n<t.availableConnections.length;n++)if(t.availableConnections[n].isConnected()&&0===t.availableConnections[n].workItems.length){r=!0,e=t.availableConnections[n];break}if(!r){t.queue.unshift(n),s<t.options.size&&t.queue.length>0&&B(t),setTimeout(()=>V(t)(),10);break}}if(s<t.options.size&&e.workItems.length>0){t.queue.unshift(n),B(t);break}var i=n.buffer;n.monitoring&&R(e,t.availableConnections,t.inUseConnections),n.noResponse||e.workItems.push(n),n.immediateRelease||"number"!=typeof n.socketTimeout||e.setSocketTimeout(n.socketTimeout);var o=!0;if(Array.isArray(i))for(let t=0;t<i.length;t++)o=e.write(i[t]);else o=e.write(i);if(n.noResponse&&"function"==typeof n.cb&&n.cb(null,null),!1===o){t.queue.unshift(n),F(t,e),U(t.queue);break}}t.executing=!1}}}r(x,i),Object.defineProperty(x.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(x.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(x.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(x.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),Object.defineProperty(x.prototype,"state",{enumerable:!0,get:function(){return this.s.state}}),x.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},x.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections)},x.prototype.get=function(){return this.allConnections()[0]},x.prototype.isConnected=function(){if(this.state===C||this.state===T)return!1;for(var t=this.availableConnections.concat(this.inUseConnections),e=0;e<t.length;e++)if(t[e].isConnected())return!0;return!1},x.prototype.isDestroyed=function(){return this.state===C||this.state===T},x.prototype.isDisconnected=function(){return"disconnected"===this.state},x.prototype.connect=function(t){if("disconnected"!==this.state)throw new o("connection in unlawful state "+this.state);I(this,"connecting"),B(this,(e,n)=>{if(e)return"function"==typeof t?(this.destroy(),void t(e)):("connecting"===this.state&&this.emit("error",e),void this.destroy());if(I(this,"connected"),this.minSize)for(let t=0;t<this.minSize;t++)B(this);"function"==typeof t?t(null,n):this.emit("connect",this,n)})},x.prototype.auth=function(t,e){"function"==typeof e&&e(null,null)},x.prototype.logout=function(t,e){"function"==typeof e&&e(null,null)},x.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).forEach((function(t){t.unref()}))},x.prototype.destroy=function(t,e){var n=this;if("function"==typeof t&&(e=t,t=!1),this.state!==C&&n.state!==T){if(I(this,"draining"),t){for(var r=n.availableConnections.concat(n.inUseConnections);n.queue.length>0;){var i=n.queue.shift();"function"==typeof i.cb&&i.cb(new o("Pool was force destroyed"))}return D(n,r,{force:!0},e)}this.reconnectId&&clearTimeout(this.reconnectId),function t(){if(n.state!==C&&n.state!==T)if(U(n.queue),0===n.queue.length){for(var r=n.availableConnections.concat(n.inUseConnections),i=0;i<r.length;i++)if(r[i].workItems.length>0)return setTimeout(t,1);D(n,r,{force:!1},e)}else V(n)(),setTimeout(t,1);else"function"==typeof e&&e()}()}else"function"==typeof e&&e(null,null)},x.prototype.reset=function(t){if("connected"!==this.s.state)return void("function"==typeof t&&t(new o("pool is not connected, reset aborted")));this.s.cancellationToken.emit("cancel");const e=this.availableConnections.concat(this.inUseConnections);S(e,(t,e)=>{for(const e of A)t.removeAllListeners(e);t.destroy({force:!0},e)},e=>{e&&"function"==typeof t?t(e,null):(N(this),B(this,()=>{"function"==typeof t&&t(null,null)}))})},x.prototype.write=function(t,e,n){var r=this;if("function"==typeof e&&(n=e),e=e||{},"function"!=typeof n&&!e.noResponse)throw new o("write method must provide a callback");if(this.state!==C&&this.state!==T)if("draining"!==this.state){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var i=n;n=process.domain.bind((function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=arguments[e];process.nextTick((function(){i.apply(null,t)}))}))}var s={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};s.promoteLongs="boolean"!=typeof e.promoteLongs||e.promoteLongs,s.promoteValues="boolean"!=typeof e.promoteValues||e.promoteValues,s.promoteBuffers="boolean"==typeof e.promoteBuffers&&e.promoteBuffers,s.raw="boolean"==typeof e.raw&&e.raw,s.immediateRelease="boolean"==typeof e.immediateRelease&&e.immediateRelease,s.documentsReturnedIn=e.documentsReturnedIn,s.command="boolean"==typeof e.command&&e.command,s.fullResult="boolean"==typeof e.fullResult&&e.fullResult,s.noResponse="boolean"==typeof e.noResponse&&e.noResponse,s.session=e.session||null,s.socketTimeout=e.socketTimeout,s.monitoring=e.monitoring,s.requestId=t.requestId,r.options.monitorCommands&&(this.emit("commandStarted",new v.CommandStartedEvent(this,t)),s.started=E(),s.cb=(e,i)=>{e?r.emit("commandFailed",new v.CommandFailedEvent(this,t,e,s.started)):i&&i.result&&(0===i.result.ok||i.result.$err)?r.emit("commandFailed",new v.CommandFailedEvent(this,t,i.result,s.started)):r.emit("commandSucceeded",new v.CommandSucceededEvent(this,t,i,s.started)),"function"==typeof n&&n(e,i)}),$(r,t,(t,n)=>{if(t)throw t;s.buffer=n,e.monitoring?r.queue.unshift(s):r.queue.push(s),r.executing||process.nextTick((function(){V(r)()}))})}else n(new o("pool is draining, new operations prohibited"));else n(new o("pool destroyed"))},x._execute=V,t.exports=x},function(t,e){t.exports=require("net")},function(t,e){t.exports=require("tls")},function(t,e,n){"use strict";const r=n(57).AuthProvider,i=n(9).retrieveKerberos;let o;t.exports=class extends r{_authenticateSingleConnection(t,e,n,r){const i=n.username,s=n.password,a=n.mechanismProperties,c=a.gssapiservicename||a.gssapiServiceName||"mongodb";!function(t,e,n,r,i,o,s,a,c){const u=new e(s.host,s.port,i,a);function l(t,e){o(s,"$external.$cmd",t,e)}u.init(n,r,t=>{if(t)return c(t,!1);u.transition("",(t,e)=>{if(t)return c(t,!1);l({saslStart:1,mechanism:"GSSAPI",payload:e,autoAuthorize:1},(t,e)=>{if(t)return c(t,!1);u.transition(e.payload,(t,n)=>{if(t)return c(t,!1);l({saslContinue:1,conversationId:e.conversationId,payload:n},(t,e)=>{if(t)return c(t,!1);u.transition(e.payload,(t,n)=>{if(t)return c(t,!1);l({saslContinue:1,conversationId:e.conversationId,payload:n},(t,e)=>{if(t)return c(t,!1);u.transition(null,t=>{if(t)return c(t,null);c(null,e)})})})})})})})})}(0,o.processes.MongoAuthProcess,i,s,c,t,e,a,r)}auth(t,e,n,r){if(null==o)try{o=i()}catch(t){return r(t,null)}super.auth(t,e,n,r)}}},function(t,e,n){"use strict";const{unassigned_code_points:r,commonly_mapped_to_nothing:i,non_ASCII_space_characters:o,prohibited_characters:s,bidirectional_r_al:a,bidirectional_l:c}=n(269);t.exports=function(t,e={}){if("string"!=typeof t)throw new TypeError("Expected string.");if(0===t.length)return"";const n=f(t).map(t=>u.get(t)?32:t).filter(t=>!l.get(t)),i=String.fromCodePoint.apply(null,n).normalize("NFKC"),o=f(i);if(o.some(t=>s.get(t)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==e.allowUnassigned){if(o.some(t=>r.get(t)))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const p=o.some(t=>a.get(t)),d=o.some(t=>c.get(t));if(p&&d)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const m=a.get(h((g=i,g[0]))),y=a.get(h((t=>t[t.length-1])(i)));var g;if(p&&(!m||!y))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return i};const u=o,l=i,h=t=>t.codePointAt(0);function f(t){const e=[],n=t.length;for(let r=0;r<n;r+=1){const i=t.charCodeAt(r);if(i>=55296&&i<=56319&&n>r+1){const n=t.charCodeAt(r+1);if(n>=56320&&n<=57343){e.push(1024*(i-55296)+n-56320+65536),r+=1;continue}}e.push(i)}return e}},function(t,e,n){"use strict";(function(e){const r=n(54),i=n(84),o=n(270),s=r.readFileSync(i.resolve(e,"../code-points.mem"));let a=0;function c(){const t=s.readUInt32BE(a);a+=4;const e=s.slice(a,a+t);return a+=t,o({buffer:e})}const u=c(),l=c(),h=c(),f=c(),p=c(),d=c();t.exports={unassigned_code_points:u,commonly_mapped_to_nothing:l,non_ASCII_space_characters:h,prohibited_characters:f,bidirectional_r_al:p,bidirectional_l:d}}).call(this,"/")},function(t,e,n){var r=n(271);function i(t){if(!(this instanceof i))return new i(t);if(t||(t={}),Buffer.isBuffer(t)&&(t={buffer:t}),this.pageOffset=t.pageOffset||0,this.pageSize=t.pageSize||1024,this.pages=t.pages||r(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,(e=this.pageSize)&e-1)throw new Error("The page size should be a power of two");var e;if(this._trackUpdates=!!t.trackUpdates,this._pageMask=this.pageSize-1,t.buffer){for(var n=0;n<t.buffer.length;n+=this.pageSize)this.pages.set(n/this.pageSize,t.buffer.slice(n,n+this.pageSize));this.byteLength=t.buffer.length,this.length=8*this.byteLength}}t.exports=i,i.prototype.get=function(t){var e=7&t,n=(t-e)/8;return!!(this.getByte(n)&128>>e)},i.prototype.getByte=function(t){var e=t&this._pageMask,n=(t-e)/this.pageSize,r=this.pages.get(n,!0);return r?r.buffer[e+this.pageOffset]:0},i.prototype.set=function(t,e){var n=7&t,r=(t-n)/8,i=this.getByte(r);return this.setByte(r,e?i|128>>n:i&(255^128>>n))},i.prototype.toBuffer=function(){for(var t=function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e}(this.pages.length*this.pageSize),e=0;e<this.pages.length;e++){var n=this.pages.get(e,!0),r=e*this.pageSize;n&&n.buffer.copy(t,r,this.pageOffset,this.pageOffset+this.pageSize)}return t},i.prototype.setByte=function(t,e){var n=t&this._pageMask,r=(t-n)/this.pageSize,i=this.pages.get(r,!1);return n+=this.pageOffset,i.buffer[n]!==e&&(i.buffer[n]=e,t>=this.byteLength&&(this.byteLength=t+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(i),!0)}},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=t||1024,this.deduplicate=e?e.deduplicate:null,this.zeros=this.deduplicate?r(this.deduplicate.length):null}function r(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e}function i(t,e){this.offset=t*e.length,this.buffer=e,this.updated=!1,this.deduplicate=0}t.exports=n,n.prototype.updated=function(t){for(;this.deduplicate&&t.buffer[t.deduplicate]===this.deduplicate[t.deduplicate];)if(t.deduplicate++,t.deduplicate===this.deduplicate.length){t.deduplicate=0,t.buffer.equals&&t.buffer.equals(this.deduplicate)&&(t.buffer=this.deduplicate);break}!t.updated&&this.updates&&(t.updated=!0,this.updates.push(t))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var t=this.updates.pop();return t.updated=!1,t},n.prototype._array=function(t,e){if(t>=this.maxPages){if(e)return;!function(t,e){for(;t.maxPages<e;){var n=t.pages;t.pages=new Array(32768),t.pages[0]=n,t.level++,t.maxPages*=32768}}(this,t)}var n,r;n=t,r=this.path,n=((n=(n-(r[0]=32767&n))/32768)-(r[1]=32767&n))/32768,r[3]=(n-(r[2]=32767&n))/32768&32767;for(var i=this.pages,o=this.level;o>0;o--){var s=this.path[o],a=i[s];if(!a){if(e)return;a=i[s]=new Array(32768)}i=a}return i},n.prototype.get=function(t,e){var n,o,s=this._array(t,e),a=this.path[0],c=s&&s[a];return c||e||(c=s[a]=new i(t,r(this.pageSize)),t>=this.length&&(this.length=t+1)),c&&c.buffer===this.deduplicate&&this.deduplicate&&!e&&(c.buffer=(n=c.buffer,o=Buffer.allocUnsafe?Buffer.allocUnsafe(n.length):new Buffer(n.length),n.copy(o),o),c.deduplicate=0),c},n.prototype.set=function(t,e){var n=this._array(t,!1),o=this.path[0];if(t>=this.length&&(this.length=t+1),!e||this.zeros&&e.equals&&e.equals(this.zeros))n[o]=void 0;else{this.deduplicate&&e.equals&&e.equals(this.deduplicate)&&(e=this.deduplicate);var s=n[o],a=function(t,e){if(t.length===e)return t;if(t.length>e)return t.slice(0,e);var n=r(e);return t.copy(n),n}(e,this.pageSize);s?s.buffer=a:n[o]=new i(t,a)}},n.prototype.toBuffer=function(){for(var t=new Array(this.length),e=r(this.pageSize),n=0;n<t.length;)for(var i=this._array(n,!0),o=0;o<32768&&n<t.length;o++)t[n++]=i&&i[o]?i[o].buffer:e;return Buffer.concat(t)}},function(t,e,n){"use strict";const r=n(5).MongoError,i=n(14).collectionNamespace,o=n(72);t.exports=function(t,e,n,s,a,c,u){if(0===a.length)throw new r(`${e} must contain at least one document`);"function"==typeof c&&(u=c,c={});const l="boolean"!=typeof(c=c||{}).ordered||c.ordered,h=c.writeConcern,f={};if(f[e]=i(s),f[n]=a,f.ordered=l,h&&Object.keys(h).length>0&&(f.writeConcern=h),c.collation)for(let t=0;t<f[n].length;t++)f[n][t].collation||(f[n][t].collation=c.collation);!0===c.bypassDocumentValidation&&(f.bypassDocumentValidation=c.bypassDocumentValidation);const p=Object.assign({checkKeys:"insert"===e,numberToReturn:1},c);o(t,s,f,p,u)}},function(t,e,n){"use strict";const r=n(37).KillCursor,i=n(5).MongoError,o=n(5).MongoNetworkError,s=n(14).collectionNamespace,a=n(9).maxWireVersion,c=n(72);t.exports=function(t,e,n,u){u="function"==typeof u?u:()=>{};const l=n.cursorId;if(a(t)<4){const i=t.s.bson,o=t.s.pool,s=new r(i,e,[l]),a={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(a.session=n.session),o&&o.isConnected())try{o.write(s,a,u)}catch(t){"function"==typeof u?u(t,null):console.warn(t)}return}const h={killCursors:s(e),cursors:[l]},f={};"object"==typeof n.session&&(f.session=n.session),c(t,e,h,f,(t,e)=>{if(t)return u(t);const n=e.message;return n.cursorNotFound?u(new o("cursor killed or timed out"),null):Array.isArray(n.documents)&&0!==n.documents.length?void u(null,n.documents[0]):u(new i(`invalid killCursors result returned for cursor id ${l}`))})}},function(t,e,n){"use strict";const r=n(37).GetMore,i=n(23).retrieveBSON,o=n(5).MongoError,s=n(5).MongoNetworkError,a=i().Long,c=n(14).collectionNamespace,u=n(9).maxWireVersion,l=n(14).applyCommonQueryOptions,h=n(72);t.exports=function(t,e,n,i,f,p){f=f||{};const d=u(t);function m(t,e){if(t)return p(t);const r=e.message;if(r.cursorNotFound)return p(new s("cursor killed or timed out"),null);if(d<4){const t="number"==typeof r.cursorId?a.fromNumber(r.cursorId):r.cursorId;return n.documents=r.documents,n.cursorId=t,void p(null,null,r.connection)}if(0===r.documents[0].ok)return p(new o(r.documents[0]));const i="number"==typeof r.documents[0].cursor.id?a.fromNumber(r.documents[0].cursor.id):r.documents[0].cursor.id;n.documents=r.documents[0].cursor.nextBatch,n.cursorId=i,p(null,r.documents[0],r.connection)}if(d<4){const o=t.s.bson,s=new r(o,e,n.cursorId,{numberToReturn:i}),a=l({},n);return void t.s.pool.write(s,a,m)}const y={getMore:n.cursorId instanceof a?n.cursorId:a.fromNumber(n.cursorId),collection:c(e),batchSize:Math.abs(i)};n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(y.maxTimeMS=n.cmd.maxAwaitTimeMS);const g=Object.assign({returnFieldSelector:null,documentsReturnedIn:"nextBatch"},f);n.session&&(g.session=n.session),h(t,e,y,g,m)}},function(t,e,n){"use strict";const r=n(37).Query,i=n(5).MongoError,o=n(14).getReadPreference,s=n(14).collectionNamespace,a=n(14).isSharded,c=n(9).maxWireVersion,u=n(14).applyCommonQueryOptions,l=n(72);t.exports=function(t,e,n,h,f,p){if(f=f||{},null!=h.cursorId)return p();if(null==n)return p(new i(`command ${JSON.stringify(n)} does not return a cursor`));if(c(t)<4){const s=function(t,e,n,s,c){c=c||{};const u=t.s.bson,l=o(n,c);s.batchSize=n.batchSize||s.batchSize;let h=0;h=s.limit<0||0!==s.limit&&s.limit<s.batchSize||s.limit>0&&0===s.batchSize?s.limit:s.batchSize;const f=s.skip||0,p={};a(t)&&l&&(p.$readPreference=l.toJSON());n.sort&&(p.$orderby=n.sort);n.hint&&(p.$hint=n.hint);n.snapshot&&(p.$snapshot=n.snapshot);void 0!==n.returnKey&&(p.$returnKey=n.returnKey);n.maxScan&&(p.$maxScan=n.maxScan);n.min&&(p.$min=n.min);n.max&&(p.$max=n.max);void 0!==n.showDiskLoc&&(p.$showDiskLoc=n.showDiskLoc);n.comment&&(p.$comment=n.comment);n.maxTimeMS&&(p.$maxTimeMS=n.maxTimeMS);n.explain&&(h=-Math.abs(n.limit||0),p.$explain=!0);if(p.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new i(`server find command does not support a readConcern level of ${n.readConcern.level}`);n.readConcern&&delete(n=Object.assign({},n)).readConcern;const d="boolean"==typeof c.serializeFunctions&&c.serializeFunctions,m="boolean"==typeof c.ignoreUndefined&&c.ignoreUndefined,y=new r(u,e,p,{numberToSkip:f,numberToReturn:h,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:d,ignoreUndefined:m});"boolean"==typeof n.tailable&&(y.tailable=n.tailable);"boolean"==typeof n.oplogReplay&&(y.oplogReplay=n.oplogReplay);"boolean"==typeof n.noCursorTimeout&&(y.noCursorTimeout=n.noCursorTimeout);"boolean"==typeof n.awaitData&&(y.awaitData=n.awaitData);"boolean"==typeof n.partial&&(y.partial=n.partial);return y.slaveOk=l.slaveOk(),y}(t,e,n,h,f),c=u({},h);return"string"==typeof s.documentsReturnedIn&&(c.documentsReturnedIn=s.documentsReturnedIn),void t.s.pool.write(s,c,p)}const d=o(n,f),m=function(t,e,n,r){r.batchSize=n.batchSize||r.batchSize;let i={find:s(e)};n.query&&(n.query.$query?i.filter=n.query.$query:i.filter=n.query);let o=n.sort;if(Array.isArray(o)){const t={};if(o.length>0&&!Array.isArray(o[0])){let e=o[1];"asc"===e?e=1:"desc"===e&&(e=-1),t[o[0]]=e}else for(let e=0;e<o.length;e++){let n=o[e][1];"asc"===n?n=1:"desc"===n&&(n=-1),t[o[e][0]]=n}o=t}n.sort&&(i.sort=o);n.fields&&(i.projection=n.fields);n.hint&&(i.hint=n.hint);n.skip&&(i.skip=n.skip);n.limit&&(i.limit=n.limit);n.limit<0&&(i.limit=Math.abs(n.limit),i.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(i.limit=Math.abs(n.batchSize)),i.singleBatch=!0),i.batchSize=Math.abs(n.batchSize));n.comment&&(i.comment=n.comment);n.maxScan&&(i.maxScan=n.maxScan);n.maxTimeMS&&(i.maxTimeMS=n.maxTimeMS);n.min&&(i.min=n.min);n.max&&(i.max=n.max);i.returnKey=!!n.returnKey&&n.returnKey,i.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(i.snapshot=n.snapshot);n.tailable&&(i.tailable=n.tailable);n.oplogReplay&&(i.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(i.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(i.awaitData=n.awaitData);n.awaitdata&&(i.awaitData=n.awaitdata);n.partial&&(i.partial=n.partial);n.collation&&(i.collation=n.collation);n.readConcern&&(i.readConcern=n.readConcern);n.explain&&(i={explain:i});return i}(0,e,n,h);n.virtual=!1;const y=Object.assign({documentsReturnedIn:"firstBatch",numberToReturn:1,slaveOk:d.slaveOk()},f);n.readPreference&&(y.readPreference=d),h.session&&(y.session=h.session),l(t,e,m,y,p)}},function(t,e,n){"use strict";const r=n(6).inherits,i=n(6).format,o=n(13).EventEmitter,s=n(19),a=n(35).CoreCursor,c=n(23).retrieveBSON,u=n(34),l=n(5).MongoError,h=n(121),f=n(277),p=n(16).Timeout,d=n(16).Interval,m=n(16).SessionMixins,y=n(16).isRetryableWritesSupported,g=n(9).relayEvents,v=n(5).isRetryableError,b=c(),_=n(16).getMMAPError,w=n(9).makeClientMetadata,S=n(0).now,O=n(0).calculateDurationInMs;var E="destroyed";function T(t,e){var n={disconnected:["connecting",E,"disconnected"],connecting:["connecting",E,"connected","disconnected"],connected:["connected","disconnected",E,"unreferenced"],unreferenced:["unreferenced",E],destroyed:[E]}[t.state];n&&-1!==n.indexOf(e)?t.state=e:t.s.logger.error(i("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",t.id,t.state,e,n))}var C=1,I=["connect","close","error","timeout","parseError"],A=function(t,e){var n=this;if(e=e||{},!Array.isArray(t))throw new l("seedlist must be an array");if(0===t.length)throw new l("seedlist must contain at least one entry");t.forEach((function(t){if("string"!=typeof t.host||"number"!=typeof t.port)throw new l("seedlist entry must contain a host and port")})),o.call(this),this.id=C++;var r=e.localThresholdMS||15;e.acceptableLatency&&(r=e.acceptableLatency);var s=u("ReplSet",e);this.s={options:Object.assign({metadata:w(e)},e),bson:e.bson||new b([b.Binary,b.Code,b.DBRef,b.Decimal128,b.Double,b.Int32,b.Long,b.Map,b.MaxKey,b.MinKey,b.ObjectId,b.BSONRegExp,b.Symbol,b.Timestamp]),Cursor:e.cursorFactory||a,logger:s,seedlist:t,replicaSetState:new f({id:this.id,setName:e.setName,acceptableLatency:r,heartbeatFrequencyMS:e.haInterval?e.haInterval:1e4,logger:s}),connectingServers:[],haInterval:e.haInterval?e.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:e.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof e.debug&&e.debug},this.s.replicaSetState.on("topologyDescriptionChanged",(function(t){n.emit("topologyDescriptionChanged",t)})),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(i("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval));["joined","left"].forEach((function(t){n.s.replicaSetState.on(t,(function(e,r){n.emit(t,e,r)}))})),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state="disconnected",this.haTimeoutId=null,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function k(t){t.s.replicaSetState.hasPrimaryAndSecondary()&&t.s.disconnectHandler?t.s.disconnectHandler.execute():t.s.replicaSetState.hasPrimary()&&t.s.disconnectHandler?t.s.disconnectHandler.execute({executePrimary:!0}):t.s.replicaSetState.hasSecondary()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute({executeSecondary:!0})}function x(t,e,n){if(0===e.length)return n();var r=e.length,i=null;function o(){0===(r-=1)&&n(i)}var s=function(t,e){return function(n){if(t.state===E||"unreferenced"===t.state)return this.destroy({force:!0}),o();if("connect"===e)if(t.s.replicaSetState.update(this)){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(t.ismaster=this.lastIsMaster());for(let t=0;t<I.length;t++)this.removeAllListeners(I[t]);this.on("error",R(t,"error")),this.on("close",R(t,"close")),this.on("timeout",R(t,"timeout")),this.on("parseError",R(t,"parseError")),N(this.lastIsMaster().me,t,{}),k(t)}else this.destroy({force:!0});else"error"===e&&(i=n);k(t),o()}};function a(e,n){setTimeout((function(){if(t.state===E||"unreferenced"===t.state)return;const n=t.s.connectingServers.findIndex(t=>t.name===e);if(n>=0){return t.s.connectingServers[n].destroy({force:!0}),t.s.connectingServers.splice(n,1),o()}var r=new h(Object.assign({},t.s.options,{host:e.split(":")[0],port:parseInt(e.split(":")[1],10),reconnect:!1,monitoring:!1,parent:t}));r.once("connect",s(t,"connect")),r.once("close",s(t,"close")),r.once("timeout",s(t,"timeout")),r.once("error",s(t,"error")),r.once("parseError",s(t,"parseError")),r.on("serverOpening",e=>t.emit("serverOpening",e)),r.on("serverDescriptionChanged",e=>t.emit("serverDescriptionChanged",e)),r.on("serverClosed",e=>t.emit("serverClosed",e)),g(r,t,["commandStarted","commandSucceeded","commandFailed"]),t.s.connectingServers.push(r),r.connect(t.s.connectOptions)}),n)}for(var c=0;c<e.length;c++)a(e[c],c)}r(A,o),Object.assign(A.prototype,m),Object.defineProperty(A.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(A.prototype,"parserType",{enumerable:!0,get:function(){return b.native?"c++":"js"}}),Object.defineProperty(A.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var N=function(t,e,n){if(!n.haInterval)for(var r=0;r<e.intervalIds.length;r++)if(e.intervalIds[r].__host===t)return;var i=n.haInterval?p:d,o=n.haInterval?n.haInterval:e.s.haInterval,s=new i((function(){if(e.state!==E&&"unreferenced"!==e.state){var n=e.s.replicaSetState.get(t);return n?function(t,e,n){var r=(new Date).getTime();D(t,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},(function(i,o){if(t.state===E||"unreferenced"===t.state)return e.destroy({force:!0}),n(i,o);var s=(new Date).getTime()-r;e.lastUpdateTime=S(),i?(D(t,"serverHeartbeatFailed",{durationMS:s,failure:i,connectionId:e.name}),t.s.replicaSetState.remove(e)):(e.ismaster=o.result,e.ismaster.lastWrite&&e.ismaster.lastWrite.lastWriteDate&&(e.lastWriteDate=e.ismaster.lastWrite.lastWriteDate.getTime()),-1===e.lastIsMasterMS?e.lastIsMasterMS=s:e.lastIsMasterMS&&(e.lastIsMasterMS=.2*s+.8*e.lastIsMasterMS),t.s.replicaSetState.update(e)&&e.lastIsMaster()&&e.lastIsMaster().ismaster&&(t.ismaster=e.lastIsMaster()),D(t,"serverHeartbeatSucceeded",{durationMS:s,reply:o.result,connectionId:e.name})),t.s.replicaSetState.updateServerMaxStaleness(e,t.s.haInterval),n(i,o)}))}(e,n,(function(t){t||(e.state!==E&&"unreferenced"!==e.state?(e.intervalIds=e.intervalIds.filter((function(t){return t.isRunning()})),i===p?"connecting"===e.state&&(e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed||e.s.replicaSetState.hasPrimary())&&(e.state="connected",process.nextTick((function(){e.emit("connect",e)})),P(e,{})):"disconnected"===e.state&&(e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed||e.s.replicaSetState.hasPrimary())&&(e.state="connected",k(e),process.nextTick((function(){e.emit("reconnect",e)}))),e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick((function(){e.emit("fullsetup",e),e.emit("all",e)})))):s.stop())})):void 0}s.stop()}),o);s.start(),s.__host=t,e.intervalIds.push(s)};function P(t,e){if(t.state!==E&&"unreferenced"!==t.state){e=e||{};var n=Object.keys(t.s.replicaSetState.set),r=e.haInterval?p:d,i=e.haInterval?e.haInterval:t.s.haInterval;if(r===p)return x(t,t.s.replicaSetState.unknownServers,(function(r){if(t.state!==E&&"unreferenced"!==t.state){if(!t.s.replicaSetState.hasPrimary()&&!t.s.options.secondaryOnlyConnectionAllowed)return r?t.emit("error",r):(t.emit("error",new l("no primary found in replicaset or invalid replica set name")),t.destroy({force:!0}));if(!t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed)return r?t.emit("error",r):(t.emit("error",new l("no secondary found in replicaset or invalid replica set name")),t.destroy({force:!0}));for(var i=0;i<n.length;i++)N(n[i],t,e)}}));for(var o=0;o<n.length;o++)N(n[o],t,e);var s=t.s.replicaSetState.hasPrimary()?i:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new p(function t(e){return function(){e.state!==E&&"unreferenced"!==e.state&&x(e,e.s.replicaSetState.unknownServers,(function(){var n=e.s.replicaSetState.hasPrimary()?i:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new p(t(e),n).start())}))}}(t),s).start())}}function j(t,e){for(var n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.name.toLowerCase())return!0;t.push(e)}function R(t,e){return function(){t.state!==E&&"unreferenced"!==t.state&&(t.s.logger.isDebug()&&t.s.logger.debug(i("handleEvent %s from server %s in replset with id %s",e,this.name,t.id)),t.s.replicaSetState.remove(this),t.state!==E&&"unreferenced"!==t.state&&((t.s.replicaSetState.hasPrimary()||t.s.replicaSetState.hasSecondary()||!t.s.options.secondaryOnlyConnectionAllowed)&&t.s.replicaSetState.hasPrimary()||T(t,"disconnected"),j(t.s.connectingServers,this)))}}function M(t,e){return function(){if(t.s.logger.isDebug()&&t.s.logger.debug(i("handleInitialConnectEvent %s from server %s in replset with id %s",e,this.name,t.id)),t.state===E||"unreferenced"===t.state)return this.destroy({force:!0});if("connect"===e){var n=t.s.replicaSetState.update(this);if(!0===n){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(t.ismaster=this.lastIsMaster()),t.s.logger.isDebug()&&t.s.logger.debug(i("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",e,this.name,t.id,JSON.stringify(t.s.replicaSetState.set)));for(let t=0;t<I.length;t++)this.removeAllListeners(I[t]);this.on("error",R(t,"error")),this.on("close",R(t,"close")),this.on("timeout",R(t,"timeout")),this.on("parseError",R(t,"parseError")),function(t){const e="connecting"===t.state,n=t.s.replicaSetState.hasPrimary(),r=t.s.replicaSetState.hasSecondary(),i=t.s.options.secondaryOnlyConnectionAllowed,o=t.s.connectOptions.readPreference&&t.s.connectOptions.readPreference.equals(s.secondary);return e&&(o&&r||!o&&n)||r&&i}(t)&&(t.state="connected",t.initialConnectState.connect=!0,process.nextTick((function(){t.emit("connect",t)})),P(t,{}))}else{if(n instanceof l)return this.destroy({force:!0}),t.destroy({force:!0}),t.emit("error",n);this.destroy({force:!0})}}else t.emit("failed",this),j(t.s.connectingServers,this),t.s.replicaSetState.remove(this);t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick((function(){t.emit("fullsetup",t),t.emit("all",t)})));for(var r=0;r<t.s.connectingServers.length;r++)t.s.connectingServers[r].equals(this)&&t.s.connectingServers.splice(r,1);0===t.s.connectingServers.length&&"connecting"===t.state&&P(t,{haInterval:1})}}function D(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}A.prototype.connect=function(t){var e=this;this.s.connectOptions=t||{},T(this,"connecting");var n=this.s.seedlist.map((function(n){return new h(Object.assign({},e.s.options,n,t,{reconnect:!1,monitoring:!1,parent:e}))}));if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return e.emit("error",new l(i("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));D(this,"topologyOpening",{topologyId:this.id}),function(t,e){t.s.connectingServers=t.s.connectingServers.concat(e);var n=0;function r(e,n){setTimeout((function(){t.s.replicaSetState.update(e)&&e.lastIsMaster()&&e.lastIsMaster().ismaster&&(t.ismaster=e.lastIsMaster()),e.once("close",M(t,"close")),e.once("timeout",M(t,"timeout")),e.once("parseError",M(t,"parseError")),e.once("error",M(t,"error")),e.once("connect",M(t,"connect")),e.on("serverOpening",e=>t.emit("serverOpening",e)),e.on("serverDescriptionChanged",e=>t.emit("serverDescriptionChanged",e)),e.on("serverClosed",e=>t.emit("serverClosed",e)),g(e,t,["commandStarted","commandSucceeded","commandFailed"]),e.connect(t.s.connectOptions)}),n)}for(;e.length>0;)r(e.shift(),n++)}(e,n)},A.prototype.auth=function(t,e){"function"==typeof e&&e(null,null)},A.prototype.destroy=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{};let n=this.s.connectingServers.length+1;const r=()=>{n--,n>0||(D(this,"topologyClosed",{topologyId:this.id}),T(this,E),"function"==typeof e&&e(null,null))};this.haTimeoutId&&clearTimeout(this.haTimeoutId);for(var i=0;i<this.intervalIds.length;i++)this.intervalIds[i].stop();this.intervalIds=[],0!==n?(this.s.replicaSetState.destroy(t,r),this.s.connectingServers.forEach((function(e){e.destroy(t,r)}))):r()},A.prototype.unref=function(){T(this,"unreferenced"),this.s.replicaSetState.allServers().forEach((function(t){t.unref()})),clearTimeout(this.haTimeoutId)},A.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},A.prototype.connections=function(){for(var t=this.s.replicaSetState.allServers(),e=[],n=0;n<t.length;n++)e=e.concat(t[n].connections());return e},A.prototype.isConnected=function(t){return(t=t||{}).readPreference&&t.readPreference.equals(s.secondary)?this.s.replicaSetState.hasSecondary():t.readPreference&&t.readPreference.equals(s.primary)?this.s.replicaSetState.hasPrimary():t.readPreference&&t.readPreference.equals(s.primaryPreferred)||t.readPreference&&t.readPreference.equals(s.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary()},A.prototype.isDestroyed=function(){return this.state===E};function $(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=t.self,o=t.op,s=t.ns,a=t.ops;if(r.state===E)return n(new l(i("topology was destroyed")));const c=!t.retrying&&!!e.retryWrites&&e.session&&y(r)&&!e.session.inTransaction();if(!r.s.replicaSetState.hasPrimary()){if(r.s.disconnectHandler)return r.s.disconnectHandler.add(o,s,a,e,n);if(!c)return n(new l("no primary server found"))}const u=(i,o)=>{if(!i)return n(null,o);if(!v(i))return i=_(i),n(i);if(c){return $(Object.assign({},t,{retrying:!0}),e,n)}return r.s.replicaSetState.primary&&(r.s.replicaSetState.primary.destroy(),r.s.replicaSetState.remove(r.s.replicaSetState.primary,{force:!0})),n(i)};n.operationId&&(u.operationId=n.operationId),c&&(e.session.incrementTransactionNumber(),e.willRetryWrite=c),r.s.replicaSetState.primary[o](s,a,e,u)}A.prototype.selectServer=function(t,e,n){let r,i;"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t),e=e||{},r=t instanceof s?t:e.readPreference||s.primary;const o=S(),a=()=>{if(O(o)>=1e4)return void(null!=i?n(i,null):n(new l("Server selection timed out")));const t=this.s.replicaSetState.pickServer(r);if(null!=t){if(!(t instanceof h))return i=t,void setTimeout(a,1e3);this.s.debug&&this.emit("pickedServer",e.readPreference,t),n(null,t)}else setTimeout(a,1e3)};a()},A.prototype.getServers=function(){return this.s.replicaSetState.allServers()},A.prototype.insert=function(t,e,n,r){$({self:this,op:"insert",ns:t,ops:e},n,r)},A.prototype.update=function(t,e,n,r){$({self:this,op:"update",ns:t,ops:e},n,r)},A.prototype.remove=function(t,e,n,r){$({self:this,op:"remove",ns:t,ops:e},n,r)};const L=["findAndModify","insert","update","delete"];A.prototype.command=function(t,e,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===E)return r(new l(i("topology was destroyed")));var o=n.readPreference?n.readPreference:s.primary;if("primary"===o.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if("secondary"===o.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if("primary"!==o.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);var a=this.s.replicaSetState.pickServer(o);if(!(a instanceof h))return r(a);if(this.s.debug&&this.emit("pickedServer",s.primary,a),null==a)return r(new l(i("no server found that matches the provided readPreference %s",o)));const c=!n.retrying&&!!n.retryWrites&&n.session&&y(this)&&!n.session.inTransaction()&&(u=e,L.some(t=>u[t]));var u;c&&(n.session.incrementTransactionNumber(),n.willRetryWrite=c),a.command(t,e,n,(i,o)=>{if(!i)return r(null,o);if(!v(i))return r(i);if(c){const i=Object.assign({},n,{retrying:!0});return this.command(t,e,i,r)}return this.s.replicaSetState.primary&&(this.s.replicaSetState.primary.destroy(),this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0})),r(i)})},A.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(r,t,e,n)},t.exports=A},function(t,e,n){"use strict";var r=n(6).inherits,i=n(6).format,o=n(16).diff,s=n(13).EventEmitter,a=n(34),c=n(19),u=n(5).MongoError,l=n(29).Buffer,h="ReplicaSetNoPrimary",f="ReplicaSetWithPrimary",p="Unknown",d="PossiblePrimary",m="RSPrimary",y="RSSecondary",g="RSArbiter",v="RSOther",b="RSGhost",_="Unknown",w=function(t){t=t||{},s.call(this),this.topologyType=h,this.setName=t.setName,this.set={},this.id=t.id,this.setName=t.setName,this.logger=t.logger||a("ReplSet",t),this.index=0,this.acceptableLatency=t.acceptableLatency||15,this.heartbeatFrequencyMS=t.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};r(w,s),w.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},w.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},w.prototype.hasPrimary=function(){return null!=this.primary},w.prototype.hasSecondary=function(){return this.secondaries.length>0},w.prototype.get=function(t){for(var e=this.allServers(),n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.toLowerCase())return e[n];return null},w.prototype.allServers=function(t){t=t||{};var e=this.primary?[this.primary]:[];return e=e.concat(this.secondaries),t.ignoreArbiters||(e=e.concat(this.arbiters)),e=e.concat(this.passives)},w.prototype.destroy=function(t,e){const n=this.secondaries.concat(this.arbiters).concat(this.passives).concat(this.ghosts);this.primary&&n.push(this.primary);let r=n.length;const i=()=>{r--,r>0||(this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,x(this),"function"==typeof e&&e(null,null))};0!==r?n.forEach(e=>e.destroy(t,i)):i()},w.prototype.remove=function(t,e){e=e||{};var n=t.name.toLowerCase(),r=this.primary?[this.primary]:[];r=(r=(r=r.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var i=0;i<r.length;i++)if(!e.force&&r[i].equals(t)&&r[i].isConnected&&r[i].isConnected())return;this.set[n]&&(this.set[n].type=_,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var o=null;this.primary&&this.primary.equals(t)&&(this.primary=null,this.topologyType=h,o="primary"),o=k(t,this.secondaries)?"secondary":o,o=k(t,this.arbiters)?"arbiter":o,o=k(t,this.passives)?"secondary":o,k(t,this.ghosts),k(t,this.unknownServers),this.unknownServers.push(n),o&&this.emit("left",o,t)};const S=t=>t.arbiterOnly&&t.setName;w.prototype.update=function(t){var e=t.lastIsMaster(),n=t.name.toLowerCase();if(e){var r=Array.isArray(e.hosts)?e.hosts:[];r=(r=(r=r.concat(Array.isArray(e.arbiters)?e.arbiters:[])).concat(Array.isArray(e.passives)?e.passives:[])).map((function(t){return t.toLowerCase()}));for(var o=0;o<r.length;o++)-1!==this.unknownServers.indexOf(r[o])||this.set[r[o]]&&this.set[r[o]].type!==_||this.unknownServers.push(r[o].toLowerCase()),this.set[r[o]]||(this.set[r[o]]={type:_,electionId:null,setName:null,setVersion:null})}if(!e&&!C(e,t,this.unknownServers))return this.set[n]={type:_,setVersion:null,electionId:null,setName:null},this.set[n].type=_,this.set[n].electionId=e?e.electionId:e,this.set[n].setName=e?e.setName:e,this.set[n].setVersion=e?e.setVersion:e,-1===this.unknownServers.indexOf(t.name)&&this.unknownServers.push(n),!1;if(void 0===e.logicalSessionTimeoutMinutes||S(e)||(void 0===this.logicalSessionTimeoutMinutes||null===e.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=e.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,e.logicalSessionTimeoutMinutes)),e&&"isdbgrid"===e.msg)return this.primary&&this.primary.name===n&&(this.primary=null,this.topologyType=h),!1;if(e.isreplicaset)return this.set[n]={type:b,setVersion:null,electionId:null,setName:e.setName},this.primary&&this.primary.name===n&&(this.primary=null),this.topologyType=this.primary?f:h,e.setName&&(this.setName=e.setName),!1;if(e.setName&&e.hidden||e.setName&&!e.ismaster&&!e.secondary&&!e.arbiterOnly&&!e.passive)return this.set[n]={type:v,setVersion:null,electionId:null,setName:e.setName},this.topologyType=this.primary?f:h,e.setName&&(this.setName=e.setName),!1;if(e&&e.ismaster&&!e.setName)return this.topologyType=this.primary?f:p,this.remove(t,{force:!0}),!1;if(e&&!e.ismaster&&!e.secondary&&!e.arbiterOnly)return this.remove(t,{force:!0}),!1;if(e.me&&e.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(i("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",t.name,e.me)),delete this.set[n],k(t,this.unknownServers),t.destroy({force:!0}),this.primary&&!this.primary.equals(t)?this.topologyType=f:this.topologyType=h,!this.primary&&e.primary&&(this.set[e.primary.toLowerCase()]={type:d,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&e.ismaster&&e.setName){var s=t.lastIsMaster().electionId;if(this.setName&&this.setName!==e.setName)return this.topologyType=h,new u(i("setName from ismaster does not match provided connection setName [%s] != [%s]",e.setName,this.setName));if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){var a=A(this.maxElectionId,s),c=t.lastIsMaster().setVersion;if(1===a)return this.topologyType=h,!1;if(0===a&&c&&c<this.maxSetVersion)return this.topologyType=h,!1;this.maxSetVersion=c,this.maxElectionId=s}return-1!==e.hosts.map((function(t){return t.toLowerCase()})).indexOf(n)?(this.primary=t,this.set[n]={type:m,setVersion:e.setVersion,electionId:e.electionId,setName:e.setName},this.topologyType=f,e.setName&&(this.setName=e.setName),k(t,this.unknownServers),k(t,this.secondaries),k(t,this.passives),this.emit("joined","primary",t)):this.topologyType=h,x(this),!0}if(e.ismaster&&e.setName){var l=this.set[this.primary.name.toLowerCase()].electionId,w=this.set[this.primary.name.toLowerCase()].setVersion,O=this.set[this.primary.name.toLowerCase()].setName;s=t.lastIsMaster().electionId,c=t.lastIsMaster().setVersion;var E=t.lastIsMaster().setName;if(this.primary.equals(t)&&O===E)return!1;if(O&&O!==E)return this.primary.equals(t)?this.topologyType=h:this.topologyType=f,!1;if(l&&s){if(1===(a=A(l,s)))return!1;if(0===a&&w>c)return!1}else if(!l&&s&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){if(1===(a=A(this.maxElectionId,s)))return!1;if(0===a&&w&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=s,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:_,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy({force:!0}),this.primary=t,this.set[n]={type:m,setVersion:e.setVersion,electionId:e.electionId,setName:e.setName},this.topologyType=f,e.setName&&(this.setName=e.setName),k(t,this.unknownServers),k(t,this.secondaries),k(t,this.passives),this.emit("joined","primary",t),x(this),!0}return!this.primary&&e.primary&&(this.set[e.primary.toLowerCase()]={type:d,setVersion:null,electionId:null,setName:null}),e.secondary&&e.setName&&!C(e,t,this.secondaries)&&this.setName&&this.setName===e.setName?(I(this,y,e,t,this.secondaries),this.topologyType=this.primary?f:h,e.setName&&(this.setName=e.setName),k(t,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(t.destroy({force:!0}),this.primary=null,this.emit("left","primary",t)),this.emit("joined","secondary",t),x(this),!0):S(e)&&!C(e,t,this.arbiters)&&this.setName&&this.setName===e.setName?(I(this,g,e,t,this.arbiters),this.topologyType=this.primary?f:h,e.setName&&(this.setName=e.setName),k(t,this.unknownServers),this.emit("joined","arbiter",t),x(this),!0):e.passive&&e.setName&&!C(e,t,this.passives)&&this.setName&&this.setName===e.setName?(I(this,y,e,t,this.passives),this.topologyType=this.primary?f:h,e.setName&&(this.setName=e.setName),k(t,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(t.destroy({force:!0}),this.primary=null,this.emit("left","primary",t)),this.emit("joined","secondary",t),x(this),!0):this.set[n]&&this.set[n].type===m?(this.emit("left","primary",this.primary),this.primary.destroy({force:!0}),this.primary=null,this.topologyType=h,!1):(this.topologyType=this.primary?f:h,!1)},w.prototype.updateServerMaxStaleness=function(t,e){for(var n=0,r=0;r<this.secondaries.length;r++)n=Math.max(n,this.secondaries[r].lastWriteDate);t.ismaster.maxWireVersion>=5&&t.ismaster.secondary&&this.hasPrimary()?t.staleness=t.lastUpdateTime-t.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+e:t.ismaster.maxWireVersion>=5&&t.ismaster.secondary&&(t.staleness=n-t.lastWriteDate+e)},w.prototype.updateSecondariesMaxStaleness=function(t){for(var e=0;e<this.secondaries.length;e++)this.updateServerMaxStaleness(this.secondaries[e],t)},w.prototype.pickServer=function(t){if("primary"===(t=t||c.primary).preference&&null!=t.maxStalenessSeconds)return new u("primary readPreference incompatible with maxStalenessSeconds");var e=this.primary?[this.primary]:[];if(e=e.concat(this.secondaries),null!=t.maxStalenessSeconds)for(var n=0;n<e.length;n++)if(e[n].ismaster.maxWireVersion<5)return new u("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===t.preference&&null==t.maxStalenessSeconds)return T(this,t);if("nearest"===t.preference&&null!=t.maxStalenessSeconds)return E(this,t);var r=this.secondaries;if(t.equals(c.secondary)&&0===r.length)return new u("no secondary server available");if(t.equals(c.secondaryPreferred)&&0===r.length&&null==this.primary)return new u("no secondary or primary server available");if(t.equals(c.primary)&&null==this.primary)return new u("no primary server available");if(t.equals(c.secondaryPreferred)||t.equals(c.secondary)){if(r.length>0&&null==t.maxStalenessSeconds){var i=T(this,t);if(i)return i}else if(r.length>0&&null!=t.maxStalenessSeconds&&(i=E(this,t)))return i;return t.equals(c.secondaryPreferred)?this.primary:null}if(t.equals(c.primaryPreferred)){if(i=null,this.primary)return this.primary;if(r.length>0&&null==t.maxStalenessSeconds?i=T(this,t):r.length>0&&null!=t.maxStalenessSeconds&&(i=E(this,t)),i)return i}return this.primary};var O=function(t,e){if(null==t.tags)return e;for(var n=[],r=Array.isArray(t.tags)?t.tags:[t.tags],i=0;i<r.length;i++)for(var o=r[i],s=0;s<e.length;s++){var a=e[s].lastIsMaster().tags||{},c=!0;for(var u in o)a[u]!==o[u]&&(c=!1);c&&n.push(e[s])}return n};function E(t,e){var n=[],r=1e3*e.maxStalenessSeconds;if(r<9e4)return new u("maxStalenessSeconds must be set to at least 90 seconds");t.primary&&"secondary"!==e.preference&&"secondaryPreferred"!==e.preference&&n.push(t.primary);for(var i=0;i<t.secondaries.length;i++)n.push(t.secondaries[i]);if(t.primary&&0===n.length&&"secondaryPreferred"!==e.preference&&n.push(t.primary),(n=(n=O(e,n)).filter((function(t){return t.staleness<=r}))).sort((function(t,e){return t.lastIsMasterMS-e.lastIsMasterMS})),0===n.length)return null;t.index=t.index%n.length;var o=n[t.index];return t.index=t.index+1,o}function T(t,e){var n=[];t.primary&&"secondary"!==e.preference&&"secondaryPreferred"!==e.preference&&n.push(t.primary);for(var r=0;r<t.secondaries.length;r++)n.push(t.secondaries[r]);0===n.length&&t.primary&&"secondaryPreferred"!==e.preference&&n.push(t.primary),(n=O(e,n)).sort((function(t,e){return t.lastIsMasterMS-e.lastIsMasterMS}));var i=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter((function(e){return e.lastIsMasterMS<=i+t.acceptableLatency}))).length)return null;t.index=t.index%n.length;var o=n[t.index];return t.index=t.index+1,o}function C(t,e,n){for(var r=0;r<n.length;r++)if(n[r]&&n[r].name&&n[r].name.toLowerCase()===e.name.toLowerCase())return!0;return!1}function I(t,e,n,r,i){var o=r.name.toLowerCase();t.set[o].type=e,t.set[o].electionId=n?n.electionId:n,t.set[o].setName=n?n.setName:n,t.set[o].setVersion=n?n.setVersion:n,i.push(r)}function A(t,e){var n=l.from(t.toHexString(),"hex"),r=l.from(e.toHexString(),"hex");if(n===r)return 0;if("function"==typeof l.compare)return l.compare(n,r);for(var i=n.length,o=r.length,s=Math.min(i,o),a=0;a<s&&n[a]===r[a];a++);return a!==s&&(i=n[a],o=r[a]),i<o?-1:o<i?1:0}function k(t,e){for(var n=0;n<e.length;n++){if(e[n].equals&&e[n].equals(t))return e.splice(n,1),!0;if("string"==typeof e[n]&&e[n].toLowerCase()===t.name.toLowerCase())return e.splice(n,1),!0}return!1}function x(t){if(t.listeners("topologyDescriptionChanged").length>0){var e="Unknown",n=t.setName;t.hasPrimaryAndSecondary()?e="ReplicaSetWithPrimary":!t.hasPrimary()&&t.hasSecondary()&&(e="ReplicaSetNoPrimary");var r={topologyType:e,setName:n,servers:[]};if(t.hasPrimary()){var i=t.primary.getDescription();i.type="RSPrimary",r.servers.push(i)}r.servers=r.servers.concat(t.secondaries.map((function(t){var e=t.getDescription();return e.type="RSSecondary",e}))),r.servers=r.servers.concat(t.arbiters.map((function(t){var e=t.getDescription();return e.type="RSArbiter",e}))),r.servers=r.servers.concat(t.passives.map((function(t){var e=t.getDescription();return e.type="RSSecondary",e})));var s=o(t.replicasetDescription,r),a={topologyId:t.id,previousDescription:t.replicasetDescription,newDescription:r,diff:s};t.emit("topologyDescriptionChanged",a),t.replicasetDescription=r}}t.exports=w},function(t,e,n){"use strict";const r=n(6).inherits,i=n(6).format,o=n(13).EventEmitter,s=n(35).CoreCursor,a=n(34),c=n(23).retrieveBSON,u=n(5).MongoError,l=n(121),h=n(16).diff,f=n(16).cloneOptions,p=n(16).SessionMixins,d=n(16).isRetryableWritesSupported,m=n(9).relayEvents,y=n(5).isRetryableError,g=c(),v=n(16).getMMAPError,b=n(9).makeClientMetadata;var _="destroying",w="destroyed";function S(t,e){var n={disconnected:["connecting",_,w,"disconnected"],connecting:["connecting",_,w,"connected","disconnected"],connected:["connected","disconnected",_,w,"unreferenced"],unreferenced:["unreferenced",_,w],destroyed:[w]}[t.state];n&&-1!==n.indexOf(e)?t.state=e:t.s.logger.error(i("Mongos with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",t.id,t.state,e,n))}var O=1,E=["connect","close","error","timeout","parseError"],T=function(t,e){e=e||{},this.id=O++,this.s={options:Object.assign({metadata:b(e)},e),bson:e.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp]),Cursor:e.cursorFactory||s,logger:a("Mongos",e),seedlist:t,haInterval:e.haInterval?e.haInterval:1e4,disconnectHandler:e.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof e.debug&&e.debug,localThresholdMS:e.localThresholdMS||15},this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(i("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.state="disconnected",this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,o.call(this)};function C(t,e,n){t.listeners(e).length>0&&t.emit(e,n)}r(T,o),Object.assign(T.prototype,p),Object.defineProperty(T.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(T.prototype,"parserType",{enumerable:!0,get:function(){return g.native?"c++":"js"}}),Object.defineProperty(T.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const I=["serverDescriptionChanged","error","close","timeout","parseError"];function A(t,e,n){e=e||{},I.forEach(e=>t.removeAllListeners(e)),t.destroy(e,n)}function k(t){return function(){t.state!==w&&t.state!==_&&(P(t.connectedProxies,t.disconnectedProxies,this),$(t),t.emit("left","mongos",this),t.emit("serverClosed",{topologyId:t.id,address:this.name}))}}function x(t,e){return function(){if(t.state===w)return $(t),P(t.connectingProxies,t.disconnectedProxies,this),this.destroy();if("connect"===e)if(t.ismaster=this.lastIsMaster(),"isdbgrid"===t.ismaster.msg){for(let e=0;e<t.connectedProxies.length;e++)if(t.connectedProxies[e].name===this.name)return P(t.connectingProxies,t.disconnectedProxies,this),$(t),this.destroy(),t.emit("failed",this);for(let t=0;t<E.length;t++)this.removeAllListeners(E[t]);this.on("error",k(t)),this.on("close",k(t)),this.on("timeout",k(t)),this.on("parseError",k(t)),P(t.connectingProxies,t.connectedProxies,this),t.emit("joined","mongos",this)}else{if(t.s.logger.isWarn()){var n="expected mongos proxy, but found replicaset member mongod for server %s";t.ismaster.hosts||(n="expected mongos proxy, but found standalone mongod for server %s"),t.s.logger.warn(i(n,this.name))}this.destroy(!0),j(t.connectingProxies,this),t.emit("left","server",this),t.emit("failed",this)}else P(t.connectingProxies,t.disconnectedProxies,this),t.emit("left","mongos",this),t.emit("failed",this);if($(t),0===t.connectingProxies.length){if(t.connectedProxies.length>0&&"connecting"===t.state)S(t,"connected"),t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t);else if(0===t.disconnectedProxies.length)return t.s.logger.isWarn()&&t.s.logger.warn(i("no mongos proxies found in seed list, did you mean to connect to a replicaset")),t.emit("error",new u("no mongos proxies found in seed list"));!function t(e,n){if(n=n||{},e.state===w||e.state===_||"unreferenced"===e.state)return;e.haTimeoutId=setTimeout((function(){if(e.state!==w&&e.state!==_&&"unreferenced"!==e.state){e.isConnected()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute();var r=e.connectedProxies.slice(0),i=r.length;if(0===r.length)return e.listeners("close").length>0&&"connecting"===e.state?e.emit("error",new u("no mongos proxy available")):e.emit("close",e),R(e,e.disconnectedProxies,(function(){e.state!==w&&e.state!==_&&"unreferenced"!==e.state&&("connecting"===e.state&&n.firstConnect?(e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e)):e.isConnected()?e.emit("reconnect",e):!e.isConnected()&&e.listeners("close").length>0&&e.emit("close",e),t(e))}));for(var o=0;o<r.length;o++)s(0,r[o],(function(){if(0===(i-=1)){if(e.state===w||e.state===_||"unreferenced"===e.state)return;R(e,e.disconnectedProxies,(function(){e.state!==w&&e.state!==_&&"unreferenced"!==e.state&&t(e)}))}}))}function s(t,n,r){var i=(new Date).getTime();C(e,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},(function(t,o){if(e.state===w||e.state===_||"unreferenced"===e.state)return P(e.connectedProxies,e.disconnectedProxies,n),n.destroy(),r(t,o);var s=(new Date).getTime()-i;t?(C(e,"serverHeartbeatFailed",{durationMS:s,failure:t,connectionId:n.name}),P(e.connectedProxies,e.disconnectedProxies,n)):(n.ismaster=o.result,n.lastIsMasterMS=s,C(e,"serverHeartbeatSucceeded",{durationMS:s,reply:o.result,connectionId:n.name})),r(t,o)}))}}),e.s.haInterval)}(t,{firstConnect:!0})}}}function N(t,e){const n=e&&e.transaction;if(n&&n.server){if(n.server.isConnected())return n.server;n.unpinServer()}for(var r=t.connectedProxies.slice(0),i=Number.MAX_VALUE,o=0;o<r.length;o++)r[o].lastIsMasterMS<i&&(i=r[o].lastIsMasterMS);let s;return 0===(r=r.filter((function(e){if(e.lastIsMasterMS<=i+t.s.localThresholdMS&&e.isConnected())return!0}))).length?s=t.connectedProxies[0]:(s=r[t.index%r.length],t.index=(t.index+1)%r.length),n&&n.isActive&&s&&s.isConnected()&&n.pinServer(s),s}function P(t,e,n){for(var r=0;r<t.length;r++)t[r].name===n.name&&t.splice(r,1);for(r=0;r<e.length;r++)e[r].name===n.name&&e.splice(r,1);e.push(n)}function j(t,e){for(var n=0;n<t.length;n++)t[n].name===e.name&&t.splice(n,1)}function R(t,e,n){var r=e.length,i=function(t,e){return function(){if(r-=1,t.state===w||t.state===_||"unreferenced"===t.state)return P(t.connectingProxies,t.disconnectedProxies,this),this.destroy();if("connect"===e){if(t.state===w||t.state===_||"unreferenced"===t.state)return P(t.connectingProxies,t.disconnectedProxies,this),this.destroy();for(var i=0;i<E.length;i++)this.removeAllListeners(E[i]);this.on("error",k(t)),this.on("close",k(t)),this.on("timeout",k(t)),this.on("parseError",k(t)),P(t.connectingProxies,t.connectedProxies,this),$(t),t.emit("joined","mongos",this)}else P(t.connectingProxies,t.disconnectedProxies,this),this.destroy();0===r&&n()}};if(0===r)return n();function o(e,n){setTimeout((function(){if(t.state!==w&&t.state!==_&&"unreferenced"!==t.state){var n=new l(Object.assign({},t.s.options,{host:e.name.split(":")[0],port:parseInt(e.name.split(":")[1],10),reconnect:!1,monitoring:!1,parent:t}));A(e,{force:!0}),j(t.disconnectedProxies,e),m(n,t,["serverDescriptionChanged"]),t.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:t.id,address:n.name}),n.once("connect",i(t,"connect")),n.once("close",i(t,"close")),n.once("timeout",i(t,"timeout")),n.once("error",i(t,"error")),n.once("parseError",i(t,"parseError")),m(n,t,["commandStarted","commandSucceeded","commandFailed"]),t.connectingProxies.push(n),n.connect(t.s.connectOptions)}}),n)}for(var s=0;s<e.length;s++)o(e[s],s)}function M(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=t.self,i=t.op,o=t.ns,s=t.ops;let a=N(r,e.session);if(!a)return n(new u("no mongos proxy available"));const c=!t.retrying&&!!e.retryWrites&&e.session&&d(r)&&!e.session.inTransaction(),l=(i,o)=>{if(!i)return n(null,o);if(!y(i)||!c)return i=v(i),n(i);if(a=N(r,e.session),!a)return n(i);return M(Object.assign({},t,{retrying:!0}),e,n)};n.operationId&&(l.operationId=n.operationId),c&&(e.session.incrementTransactionNumber(),e.willRetryWrite=c),a[i](o,s,e,l)}T.prototype.connect=function(t){var e=this;this.s.connectOptions=t||{},S(this,"connecting");var n=this.s.seedlist.map((function(n){const r=new l(Object.assign({},e.s.options,n,t,{reconnect:!1,monitoring:!1,parent:e}));return m(r,e,["serverDescriptionChanged"]),r}));C(this,"topologyOpening",{topologyId:this.id}),function(t,e){t.connectingProxies=t.connectingProxies.concat(e);var n=0;e.forEach(e=>function(e,n){setTimeout((function(){t.emit("serverOpening",{topologyId:t.id,address:e.name}),$(t),e.once("close",x(t,"close")),e.once("timeout",x(t,"timeout")),e.once("parseError",x(t,"parseError")),e.once("error",x(t,"error")),e.once("connect",x(t,"connect")),m(e,t,["commandStarted","commandSucceeded","commandFailed"]),e.connect(t.s.connectOptions)}),n)}(e,n++))}(e,n)},T.prototype.auth=function(t,e){"function"==typeof e&&e(null,null)},T.prototype.lastIsMaster=function(){return this.ismaster},T.prototype.unref=function(){S(this,"unreferenced"),this.connectedProxies.concat(this.connectingProxies).forEach((function(t){t.unref()})),clearTimeout(this.haTimeoutId)},T.prototype.destroy=function(t,e){"function"==typeof t&&(e=t,t={}),t=t||{},S(this,_),this.haTimeoutId&&clearTimeout(this.haTimeoutId);const n=this.connectedProxies.concat(this.connectingProxies);let r=n.length;const i=()=>{r--,r>0||($(this),C(this,"topologyClosed",{topologyId:this.id}),S(this,w),"function"==typeof e&&e(null,null))};0!==r?n.forEach(e=>{this.emit("serverClosed",{topologyId:this.id,address:e.name}),A(e,t,i),P(this.connectedProxies,this.disconnectedProxies,e)}):i()},T.prototype.isConnected=function(){return this.connectedProxies.length>0},T.prototype.isDestroyed=function(){return this.state===w},T.prototype.insert=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===w?r(new u(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void M({self:this,op:"insert",ns:t,ops:e},n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("insert",t,e,n,r)},T.prototype.update=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===w?r(new u(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void M({self:this,op:"update",ns:t,ops:e},n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("update",t,e,n,r)},T.prototype.remove=function(t,e,n,r){return"function"==typeof n&&(r=n,n=(n={})||{}),this.state===w?r(new u(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void M({self:this,op:"remove",ns:t,ops:e},n,r):r(new u("no mongos proxy available")):this.s.disconnectHandler.add("remove",t,e,n,r)};const D=["findAndModify","insert","update","delete"];function $(t){if(t.listeners("topologyDescriptionChanged").length>0){var e="Unknown";t.connectedProxies.length>0&&(e="Sharded");var n={topologyType:e,servers:[]},r=t.disconnectedProxies.concat(t.connectingProxies);n.servers=n.servers.concat(r.map((function(t){var e=t.getDescription();return e.type="Unknown",e}))),n.servers=n.servers.concat(t.connectedProxies.map((function(t){var e=t.getDescription();return e.type="Mongos",e})));var i=h(t.topologyDescription,n),o={topologyId:t.id,previousDescription:t.topologyDescription,newDescription:n,diff:i};i.servers.length>0&&t.emit("topologyDescriptionChanged",o),t.topologyDescription=n}}T.prototype.command=function(t,e,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.state===w)return r(new u(i("topology was destroyed")));var o=N(this,n.session);if((null==o||!o.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",t,e,n,r);if(null==o)return r(new u("no mongos proxy available"));var s=f(n);s.topology=this;const a=!n.retrying&&n.retryWrites&&n.session&&d(this)&&!n.session.inTransaction()&&(c=e,D.some(t=>c[t]));var c;a&&(n.session.incrementTransactionNumber(),n.willRetryWrite=a),o.command(t,e,s,(n,i)=>{if(!n)return r(null,i);if(!y(n))return r(n);if(a){const n=Object.assign({},s,{retrying:!0});return this.command(t,e,n,r)}return r(n)})},T.prototype.cursor=function(t,e,n){const r=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(r,t,e,n)},T.prototype.selectServer=function(t,e,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0,e={}),"function"==typeof e&&(n=e,e=t,t=void 0);const r=N(this,(e=e||{}).session);null!=r?(this.s.debug&&this.emit("pickedServer",null,r),n(null,r)):n(new u("server selection failed"))},T.prototype.connections=function(){for(var t=[],e=0;e<this.connectedProxies.length;e++)t=t.concat(this.connectedProxies[e].connections());return t},t.exports=T},function(t,e,n){"use strict";const r=n(123),i=n(13),o=n(95).ServerDescription,s=n(27).ServerType,a=n(155).TopologyDescription,c=n(27).TopologyType,u=n(166),l=n(280).Server,h=n(9).relayEvents,f=n(19),p=n(16).isRetryableWritesSupported,d=n(35).CoreCursor,m=n(6).deprecate,y=n(23).retrieveBSON(),g=n(16).createCompressionInfo,v=n(5).isRetryableError,b=n(47).ClientSession,_=n(5).MongoError,w=n(5).MongoServerSelectionError,S=n(16).resolveClusterTime,O=n(294).SrvPoller,E=n(16).getMMAPError,T=n(9).makeStateMachine,C=n(9).eachAsync,I=n(0).emitDeprecationWarning,A=n(47).ServerSessionPool,k=n(9).makeClientMetadata,x=n(99).CMAP_EVENT_NAMES,N=n(27),P=N.drainTimerQueue,j=N.clearAndRemoveTimerFrom,R=n(295),M=R.readPreferenceServerSelector,D=R.writableServerSelector;let $=0;const L=["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","commandStarted","commandSucceeded","commandFailed","monitoring"].concat(x),F=["connect","descriptionReceived","close","ended"],B=N.STATE_CLOSING,U=N.STATE_CLOSED,V=N.STATE_CONNECTING,q=N.STATE_CONNECTED,W=T({[U]:[U,V],[V]:[V,B,q,U],[q]:[q,B,U],[B]:[B,U]}),z=new Set(["autoReconnect","reconnectTries","reconnectInterval","bufferMaxEntries"]),H=Symbol("cancelled"),K=Symbol("waitQueue");class G extends i{constructor(t,e){super(),void 0===e&&"string"!=typeof t&&(e=t,t=[],e.host&&t.push({host:e.host,port:e.port})),"string"==typeof(t=t||[])&&(t=function(t){return t.split(",").map(t=>({host:t.split(":")[0],port:t.split(":")[1]||27017}))}(t)),e=Object.assign({},N.TOPOLOGY_DEFAULTS,e),e=Object.freeze(Object.assign(e,{metadata:k(e),compression:{compressors:g(e)}})),z.forEach(t=>{e[t]&&I(`The option \`${t}\` is incompatible with the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")});const n=function(t,e){const n=e.replicaSet||e.setName||e.rs_name;return 1!==t.length||n?n?c.ReplicaSetNoPrimary:c.Unknown:c.Single}(t,e),i=$++,s=t.reduce((t,e)=>{e.domain_socket&&(e.host=e.domain_socket);const n=e.port?`${e.host}:${e.port}`:`${e.host}:27017`;return t.set(n,new o(n)),t},new Map);this[K]=new r,this.s={id:i,options:e,seedlist:t,state:U,description:new a(n,s,e.replicaSet,null,null,null,e),serverSelectionTimeoutMS:e.serverSelectionTimeoutMS,heartbeatFrequencyMS:e.heartbeatFrequencyMS,minHeartbeatFrequencyMS:e.minHeartbeatFrequencyMS,Cursor:e.cursorFactory||d,bson:e.bson||new y([y.Binary,y.Code,y.DBRef,y.Decimal128,y.Double,y.Int32,y.Long,y.Map,y.MaxKey,y.MinKey,y.ObjectId,y.BSONRegExp,y.Symbol,y.Timestamp]),servers:new Map,sessionPool:new A(this),sessions:new Set,promiseLibrary:e.promiseLibrary||Promise,credentials:e.credentials,clusterTime:null,connectionTimers:new Set},e.srvHost&&(this.s.srvPoller=e.srvPoller||new O({heartbeatFrequencyMS:this.s.heartbeatFrequencyMS,srvHost:e.srvHost,logger:e.logger,loggerLevel:e.loggerLevel}),this.s.detectTopologyDescriptionChange=t=>{const e=t.previousDescription.type,n=t.newDescription.type;var r;e!==c.Sharded&&n===c.Sharded&&(this.s.handleSrvPolling=(r=this,function(t){const e=r.s.description;r.s.description=r.s.description.updateFromSrvPollingEvent(t),r.s.description!==e&&(J(r),r.emit("topologyDescriptionChanged",new u.TopologyDescriptionChangedEvent(r.s.id,e,r.s.description)))}),this.s.srvPoller.on("srvRecordDiscovery",this.s.handleSrvPolling),this.s.srvPoller.start())},this.on("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange)),this.setMaxListeners(1/0)}get description(){return this.s.description}get parserType(){return y.native?"c++":"js"}connect(t,e){if("function"==typeof t&&(e=t,t={}),t=t||{},this.s.state===q)return void("function"==typeof e&&e());var n,r;W(this,V),this.emit("topologyOpening",new u.TopologyOpeningEvent(this.s.id)),this.emit("topologyDescriptionChanged",new u.TopologyDescriptionChangedEvent(this.s.id,new a(c.Unknown),this.s.description)),n=this,r=Array.from(this.s.description.servers.values()),n.s.servers=r.reduce((t,e)=>{const r=X(n,e);return t.set(e.address,r),t},new Map),tt(t);const i=t.readPreference||f.primary;this.selectServer(M(i),t,t=>{if(t)return this.close(),void("function"==typeof e?e(t):this.emit("error",t));W(this,q),this.emit("open",t,this),this.emit("connect",this),"function"==typeof e&&e(t,this)})}close(t,e){"function"==typeof t&&(e=t,t={}),"boolean"==typeof t&&(t={force:t}),t=t||{},this.s.state!==U&&this.s.state!==B?(W(this,B),et(this[K],new _("Topology closed")),P(this.s.connectionTimers),this.s.srvPoller&&(this.s.srvPoller.stop(),this.s.handleSrvPolling&&(this.s.srvPoller.removeListener("srvRecordDiscovery",this.s.handleSrvPolling),delete this.s.handleSrvPolling)),this.s.detectTopologyDescriptionChange&&(this.removeListener("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange),delete this.s.detectTopologyDescriptionChange),this.s.sessions.forEach(t=>t.endSession()),this.s.sessionPool.endAllPooledSessions(()=>{C(Array.from(this.s.servers.values()),(e,n)=>Y(e,this,t,n),t=>{this.s.servers.clear(),this.emit("topologyClosed",new u.TopologyClosedEvent(this.s.id)),W(this,U),this.emit("close"),"function"==typeof e&&e(t)})})):"function"==typeof e&&e()}selectServer(t,e,n){if("function"==typeof e)if(n=e,"function"!=typeof t){let n;e=t,t instanceof f?n=t:"string"==typeof t?n=new f(t):(tt(e),n=e.readPreference||f.primary),t=M(n)}else e={};e=Object.assign({},{serverSelectionTimeoutMS:this.s.serverSelectionTimeoutMS},e);const r=this.description.type===c.Sharded,i=e.session,o=i&&i.transaction;if(r&&o&&o.server)return void n(void 0,o.server);let s=t;if("object"==typeof t){const e=t.readPreference?t.readPreference:f.primary;s=M(e)}const a={serverSelector:s,transaction:o,callback:n},u=e.serverSelectionTimeoutMS;u&&(a.timer=setTimeout(()=>{a[H]=!0,a.timer=void 0;const t=new w(`Server selection timed out after ${u} ms`,this.description);a.callback(t)},u)),this[K].push(a),nt(this)}shouldCheckForSessionSupport(){return this.description.type===c.Single?!this.description.hasKnownServers:!this.description.hasDataBearingServers}hasSessionSupport(){return null!=this.description.logicalSessionTimeoutMinutes}startSession(t,e){const n=new b(this,this.s.sessionPool,t,e);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(t,e){Array.isArray(t)||(t=[t]),this.command("admin.$cmd",{endSessions:t},{readPreference:f.primaryPreferred,noResponse:!0},()=>{"function"==typeof e&&e()})}serverUpdateHandler(t){if(!this.s.description.hasServer(t.address))return;const e=this.s.description,n=this.s.description.servers.get(t.address),r=t.$clusterTime;r&&S(this,r);const i=n&&n.equals(t);this.s.description=this.s.description.update(t),this.s.description.compatibilityError?this.emit("error",new _(this.s.description.compatibilityError)):(i||this.emit("serverDescriptionChanged",new u.ServerDescriptionChangedEvent(this.s.id,t.address,n,this.s.description.servers.get(t.address))),J(this,t),this[K].length>0&&nt(this),i||this.emit("topologyDescriptionChanged",new u.TopologyDescriptionChangedEvent(this.s.id,e,this.s.description)))}auth(t,e){"function"==typeof t&&(e=t,t=null),"function"==typeof e&&e(null,!0)}logout(t){"function"==typeof t&&t(null,!0)}insert(t,e,n,r){Z({topology:this,op:"insert",ns:t,ops:e},n,r)}update(t,e,n,r){Z({topology:this,op:"update",ns:t,ops:e},n,r)}remove(t,e,n,r){Z({topology:this,op:"remove",ns:t,ops:e},n,r)}command(t,e,n,r){"function"==typeof n&&(r=n,n=(n={})||{}),tt(n);const i=n.readPreference||f.primary;this.selectServer(M(i),n,(i,o)=>{if(i)return void r(i);const s=!n.retrying&&!!n.retryWrites&&n.session&&p(this)&&!n.session.inTransaction()&&(a=e,Q.some(t=>a[t]));var a;s&&(n.session.incrementTransactionNumber(),n.willRetryWrite=s),o.command(t,e,n,(i,o)=>{if(!i)return r(null,o);if(!v(i))return r(i);if(s){const i=Object.assign({},n,{retrying:!0});return this.command(t,e,i,r)}return r(i)})})}cursor(t,e,n){const r=(n=n||{}).topology||this,i=n.cursorFactory||this.s.Cursor;return tt(n),new i(r,t,e,n)}get clientMetadata(){return this.s.options.metadata}isConnected(){return this.s.state===q}isDestroyed(){return this.s.state===U}unref(){console.log("not implemented: `unref`")}lastIsMaster(){const t=Array.from(this.description.servers.values());return 0===t.length?{}:t.filter(t=>t.type!==s.Unknown)[0]||{maxWireVersion:this.description.commonWireVersion}}get logicalSessionTimeoutMinutes(){return this.description.logicalSessionTimeoutMinutes}get bson(){return this.s.bson}}Object.defineProperty(G.prototype,"clusterTime",{enumerable:!0,get:function(){return this.s.clusterTime},set:function(t){this.s.clusterTime=t}}),G.prototype.destroy=m(G.prototype.close,"destroy() is deprecated, please use close() instead");const Q=["findAndModify","insert","update","delete"];function Y(t,e,n,r){n=n||{},F.forEach(e=>t.removeAllListeners(e)),t.destroy(n,()=>{e.emit("serverClosed",new u.ServerClosedEvent(e.s.id,t.description.address)),L.forEach(e=>t.removeAllListeners(e)),"function"==typeof r&&r()})}function X(t,e,n){t.emit("serverOpening",new u.ServerOpeningEvent(t.s.id,e.address));const r=new l(e,t.s.options,t);if(h(r,t,L),r.on("descriptionReceived",t.serverUpdateHandler.bind(t)),n){const e=setTimeout(()=>{j(e,t.s.connectionTimers),r.connect()},n);return t.s.connectionTimers.add(e),r}return r.connect(),r}function J(t,e){if(e&&t.s.servers.has(e.address)){t.s.servers.get(e.address).s.description=e}for(const e of t.description.servers.values())if(!t.s.servers.has(e.address)){const n=X(t,e);t.s.servers.set(e.address,n)}for(const e of t.s.servers){const n=e[0];if(t.description.hasServer(n))continue;const r=t.s.servers.get(n);t.s.servers.delete(n),Y(r,t)}}function Z(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=t.topology,i=t.op,o=t.ns,s=t.ops,a=!t.retrying&&!!e.retryWrites&&e.session&&p(r)&&!e.session.inTransaction();r.selectServer(D(),e,(r,c)=>{if(r)return void n(r,null);const u=(r,i)=>{if(!r)return n(null,i);if(!v(r))return r=E(r),n(r);if(a){return Z(Object.assign({},t,{retrying:!0}),e,n)}return n(r)};n.operationId&&(u.operationId=n.operationId),a&&(e.session.incrementTransactionNumber(),e.willRetryWrite=a),c[i](o,s,e,u)})}function tt(t){if(null==t.readPreference)return;let e=t.readPreference;if("string"==typeof e)t.readPreference=new f(e);else if(!e||e instanceof f||"object"!=typeof e){if(!(e instanceof f))throw new TypeError("Invalid read preference: "+e)}else{const n=e.mode||e.preference;n&&"string"==typeof n&&(t.readPreference=new f(n,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}))}return t}function et(t,e){for(;t.length;){const n=t.shift();clearTimeout(n.timer),n[H]||n.callback(e)}}function nt(t){if(t.s.state===U)return void et(t[K],new _("Topology is closed, please connect"));const e=Array.from(t.description.servers.values()),n=t[K].length;for(let i=0;i<n&&t[K].length;++i){const n=t[K].shift();if(n[H])continue;let i;try{const r=n.serverSelector;i=r?r(t.description,e):e}catch(t){clearTimeout(n.timer),n.callback(t);continue}if(0===i.length){t[K].push(n);continue}const o=(r=i)[Math.floor(Math.random()*r.length)],s=t.s.servers.get(o.address),a=n.transaction;t.description.type===c.Sharded&&a&&a.isActive&&a.pinServer(s),clearTimeout(n.timer),n.callback(void 0,s)}var r;t[K].length>0&&t.s.servers.forEach(t=>process.nextTick(()=>t.requestCheck()))}t.exports={Topology:G}},function(t,e,n){"use strict";const r=n(13),i=n(281).ConnectionPool,o=n(99).CMAP_EVENT_NAMES,s=n(5).MongoError,a=n(9).relayEvents,c=n(23).retrieveBSON(),u=n(34),l=n(95).ServerDescription,h=n(19),f=n(293).Monitor,p=n(5).MongoNetworkError,d=n(9).collationNotSupported,m=n(23).debugOptions,y=n(5).isSDAMUnrecoverableError,g=n(5).isNetworkTimeoutError,v=n(5).isNodeShuttingDownError,b=n(9).maxWireVersion,_=n(9).makeStateMachine,w=n(27),S=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],O=w.STATE_CLOSING,E=w.STATE_CLOSED,T=w.STATE_CONNECTING,C=w.STATE_CONNECTED,I=_({[E]:[E,T],[T]:[T,O,C,E],[C]:[C,O,E],[O]:[O,E]}),A=Symbol("monitor");class k extends r{constructor(t,e,n){super(),this.s={description:t,options:e,logger:u("Server",e),bson:e.bson||new c([c.Binary,c.Code,c.DBRef,c.Decimal128,c.Double,c.Int32,c.Long,c.Map,c.MaxKey,c.MinKey,c.ObjectId,c.BSONRegExp,c.Symbol,c.Timestamp]),state:E,credentials:e.credentials,topology:n};const r=this.description.address.split(":"),s=Object.assign({host:r[0],port:parseInt(r[1],10),bson:this.s.bson},e);this.s.pool=new i(s),a(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"].concat(o)),this.s.pool.on("clusterTimeReceived",t=>{this.clusterTime=t}),this[A]=new f(this,this.s.options),a(this[A],this,["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","monitoring"]),this[A].on("resetConnectionPool",()=>{this.s.pool.clear()}),this[A].on("resetServer",t=>P(this,t)),this[A].on("serverHeartbeatSucceeded",t=>{this.emit("descriptionReceived",new l(this.description.address,t.reply,{roundTripTime:x(this.description.roundTripTime,t.duration)})),this.s.state===T&&(I(this,C),this.emit("connect",this))})}get description(){return this.s.description}get name(){return this.s.description.address}get autoEncrypter(){return this.s.options&&this.s.options.autoEncrypter?this.s.options.autoEncrypter:null}connect(){this.s.state===E&&(I(this,T),this[A].connect())}destroy(t,e){"function"==typeof t&&(e=t,t={}),t=Object.assign({},{force:!1},t),this.s.state!==E?(I(this,O),this[A].close(),this.s.pool.close(t,t=>{I(this,E),this.emit("closed"),"function"==typeof e&&e(t)})):"function"==typeof e&&e()}requestCheck(){this[A].requestCheck()}command(t,e,n,r){if("function"==typeof n&&(r=n,n=(n={})||{}),this.s.state===O||this.s.state===E)return void r(new s("server is closed"));const i=function(t,e){if(e.readPreference&&!(e.readPreference instanceof h))return new s("readPreference must be an instance of ReadPreference")}(0,n);if(i)return r(i);n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(`executing command [${JSON.stringify({ns:t,cmd:e,options:m(S,n)})}] against ${this.name}`),d(this,e)?r(new s(`server ${this.name} does not support collation`)):this.s.pool.withConnection((r,i,o)=>{if(r)return P(this,r),o(r);i.command(t,e,n,j(this,n,o))},r)}query(t,e,n,r,i){this.s.state!==O&&this.s.state!==E?this.s.pool.withConnection((i,o,s)=>{if(i)return P(this,i),s(i);o.query(t,e,n,r,j(this,r,s))},i):i(new s("server is closed"))}getMore(t,e,n,r,i){this.s.state!==O&&this.s.state!==E?this.s.pool.withConnection((i,o,s)=>{if(i)return P(this,i),s(i);o.getMore(t,e,n,r,j(this,r,s))},i):i(new s("server is closed"))}killCursors(t,e,n){this.s.state!==O&&this.s.state!==E?this.s.pool.withConnection((n,r,i)=>{if(n)return P(this,n),i(n);r.killCursors(t,e,j(this,null,i))},n):"function"==typeof n&&n(new s("server is closed"))}insert(t,e,n,r){N({server:this,op:"insert",ns:t,ops:e},n,r)}update(t,e,n,r){N({server:this,op:"update",ns:t,ops:e},n,r)}remove(t,e,n,r){N({server:this,op:"remove",ns:t,ops:e},n,r)}}function x(t,e){if(-1===t)return e;return.2*e+.8*t}function N(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};const r=t.server,i=t.op,o=t.ns,a=Array.isArray(t.ops)?t.ops:[t.ops];r.s.state!==O&&r.s.state!==E?d(r,e)?n(new s(`server ${r.name} does not support collation`)):r.s.pool.withConnection((t,n,s)=>{if(t)return P(r,t),s(t);n[i](o,a,e,j(r,e,s))},n):n(new s("server is closed"))}function P(t,e){t.emit("descriptionReceived",new l(t.description.address,null,{error:e}))}function j(t,e,n){const r=e&&e.session;return function(e,i){e&&(e instanceof p?(r&&!r.hasEnded&&(r.serverSession.isDirty=!0),g(e)||(P(t,e),t.s.pool.clear())):y(e)&&((b(t)<=7||v(e))&&t.s.pool.clear(),P(t,e),process.nextTick(()=>t.requestCheck()))),n(e,i)}}Object.defineProperty(k.prototype,"clusterTime",{get:function(){return this.s.topology.clusterTime},set:function(t){this.s.topology.clusterTime=t}}),t.exports={Server:k}},function(t,e,n){"use strict";const r=n(123),i=n(13).EventEmitter,o=n(34),s=n(0).makeCounter,a=n(5).MongoError,c=n(167).Connection,u=n(9).eachAsync,l=n(122),h=n(9).relayEvents,f=n(292),p=f.PoolClosedError,d=f.WaitQueueTimeoutError,m=n(99),y=m.ConnectionPoolCreatedEvent,g=m.ConnectionPoolClosedEvent,v=m.ConnectionCreatedEvent,b=m.ConnectionReadyEvent,_=m.ConnectionClosedEvent,w=m.ConnectionCheckOutStartedEvent,S=m.ConnectionCheckOutFailedEvent,O=m.ConnectionCheckedOutEvent,E=m.ConnectionCheckedInEvent,T=m.ConnectionPoolClearedEvent,C=Symbol("logger"),I=Symbol("connections"),A=Symbol("permits"),k=Symbol("minPoolSizeTimer"),x=Symbol("generation"),N=Symbol("connectionCounter"),P=Symbol("cancellationToken"),j=Symbol("waitQueue"),R=Symbol("cancelled"),M=new Set(["ssl","bson","connectionType","monitorCommands","socketTimeout","credentials","compression","host","port","localAddress","localPort","family","hints","lookup","path","ca","cert","sigalgs","ciphers","clientCertEngine","crl","dhparam","ecdhCurve","honorCipherOrder","key","privateKeyEngine","privateKeyIdentifier","maxVersion","minVersion","passphrase","pfx","secureOptions","secureProtocol","sessionIdContext","allowHalfOpen","rejectUnauthorized","pskCallback","ALPNProtocols","servername","checkServerIdentity","session","minDHSize","secureContext","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"]);function D(t,e){return e.generation!==t[x]}function $(t,e){return!!(t.options.maxIdleTimeMS&&e.idleTime>t.options.maxIdleTimeMS)}function L(t,e){const n=Object.assign({id:t[N].next().value,generation:t[x]},t.options);t[A]--,l(n,t[P],(n,r)=>{if(n)return t[A]++,t[C].debug(`connection attempt failed with error [${JSON.stringify(n)}]`),void("function"==typeof e&&e(n));t.closed?r.destroy({force:!0}):(h(r,t,["commandStarted","commandFailed","commandSucceeded","clusterTimeReceived"]),t.emit("connectionCreated",new v(t,r)),r.markAvailable(),t.emit("connectionReady",new b(t,r)),"function"!=typeof e?(t[I].push(r),B(t)):e(void 0,r))})}function F(t,e,n){t.emit("connectionClosed",new _(t,e,n)),t[A]++,process.nextTick(()=>e.destroy())}function B(t){if(t.closed)return;for(;t.waitQueueSize;){const e=t[j].peekFront();if(e[R]){t[j].shift();continue}if(!t.availableConnectionCount)break;const n=t[I].shift(),r=D(t,n),i=$(t,n);if(!r&&!i&&!n.closed)return t.emit("connectionCheckedOut",new O(t,n)),clearTimeout(e.timer),t[j].shift(),void e.callback(void 0,n);const o=n.closed?"error":r?"stale":"idle";F(t,n,o)}const e=t.options.maxPoolSize;t.waitQueueSize&&(e<=0||t.totalConnectionCount<e)&&L(t,(e,n)=>{const r=t[j].shift();null!=r?r[R]||(e?t.emit("connectionCheckOutFailed",new S(t,e)):t.emit("connectionCheckedOut",new O(t,n)),clearTimeout(r.timer),r.callback(e,n)):null==e&&t[I].push(n)})}t.exports={ConnectionPool:class extends i{constructor(t){if(super(),t=t||{},this.closed=!1,this.options=function(t,e){const n=Array.from(M).reduce((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e),{});return Object.freeze(Object.assign({},e,n))}(t,{connectionType:c,maxPoolSize:"number"==typeof t.maxPoolSize?t.maxPoolSize:100,minPoolSize:"number"==typeof t.minPoolSize?t.minPoolSize:0,maxIdleTimeMS:"number"==typeof t.maxIdleTimeMS?t.maxIdleTimeMS:0,waitQueueTimeoutMS:"number"==typeof t.waitQueueTimeoutMS?t.waitQueueTimeoutMS:0,autoEncrypter:t.autoEncrypter,metadata:t.metadata}),t.minSize>t.maxSize)throw new TypeError("Connection pool minimum size must not be greater than maxiumum pool size");this[C]=o("ConnectionPool",t),this[I]=new r,this[A]=this.options.maxPoolSize,this[k]=void 0,this[x]=0,this[N]=s(1),this[P]=new i,this[P].setMaxListeners(1/0),this[j]=new r,process.nextTick(()=>{this.emit("connectionPoolCreated",new y(this)),function t(e){if(e.closed||0===e.options.minPoolSize)return;const n=e.options.minPoolSize;for(let t=e.totalConnectionCount;t<n;++t)L(e);e[k]=setTimeout(()=>t(e),10)}(this)})}get address(){return`${this.options.host}:${this.options.port}`}get generation(){return this[x]}get totalConnectionCount(){return this[I].length+(this.options.maxPoolSize-this[A])}get availableConnectionCount(){return this[I].length}get waitQueueSize(){return this[j].length}checkOut(t){if(this.emit("connectionCheckOutStarted",new w(this)),this.closed)return this.emit("connectionCheckOutFailed",new S(this,"poolClosed")),void t(new p(this));const e={callback:t},n=this,r=this.options.waitQueueTimeoutMS;r&&(e.timer=setTimeout(()=>{e[R]=!0,e.timer=void 0,n.emit("connectionCheckOutFailed",new S(n,"timeout")),e.callback(new d(n))},r)),this[j].push(e),B(this)}checkIn(t){const e=this.closed,n=D(this,t),r=!!(e||n||t.closed);if(r||(t.markAvailable(),this[I].push(t)),this.emit("connectionCheckedIn",new E(this,t)),r){F(this,t,t.closed?"error":e?"poolClosed":"stale")}B(this)}clear(){this[x]+=1,this.emit("connectionPoolCleared",new T(this))}close(t,e){if("function"==typeof t&&(e=t),t=Object.assign({force:!1},t),this.closed)return e();for(this[P].emit("cancel");this.waitQueueSize;){const t=this[j].pop();clearTimeout(t.timer),t[R]||t.callback(new a("connection pool closed"))}this[k]&&clearTimeout(this[k]),"function"==typeof this[N].return&&this[N].return(),this.closed=!0,u(this[I].toArray(),(e,n)=>{this.emit("connectionClosed",new _(this,e,"poolClosed")),e.destroy(t,n)},t=>{this[I].clear(),this.emit("connectionPoolClosed",new g(this)),e(t)})}withConnection(t,e){this.checkOut((n,r)=>{t(n,r,(t,n)=>{"function"==typeof e&&(t?e(t):e(void 0,n)),r&&this.checkIn(r)})})}}}},function(t,e,n){"use strict";const r=n(26).Duplex,i=n(283),o=n(5).MongoParseError,s=n(41).decompress,a=n(37).Response,c=n(56).BinMsg,u=n(5).MongoError,l=n(14).opcodes.OP_COMPRESSED,h=n(14).opcodes.OP_MSG,f=n(14).MESSAGE_HEADER_SIZE,p=n(14).COMPRESSION_DETAILS_SIZE,d=n(14).opcodes,m=n(41).compress,y=n(41).compressorIDs,g=n(41).uncompressibleCommands,v=n(56).Msg,b=Symbol("buffer");t.exports=class extends r{constructor(t){super(t=t||{}),this.bson=t.bson,this.maxBsonMessageSize=t.maxBsonMessageSize||67108864,this[b]=new i}_write(t,e,n){this[b].append(t),function t(e,n){const r=e[b];if(r.length<4)return void n();const i=r.readInt32LE(0);if(i<0)return void n(new o(`Invalid message size: ${i}`));if(i>e.maxBsonMessageSize)return void n(new o(`Invalid message size: ${i}, max allowed: ${e.maxBsonMessageSize}`));if(i>r.length)return void n();const p=r.slice(0,i);r.consume(i);const d={length:p.readInt32LE(0),requestId:p.readInt32LE(4),responseTo:p.readInt32LE(8),opCode:p.readInt32LE(12)};let m=d.opCode===h?c:a;const y=e.responseOptions;if(d.opCode!==l){const i=p.slice(f);return e.emit("message",new m(e.bson,p,d,i,y)),void(r.length>=4?t(e,n):n())}d.fromCompressed=!0,d.opCode=p.readInt32LE(f),d.length=p.readInt32LE(f+4);const g=p[f+8],v=p.slice(f+9);m=d.opCode===h?c:a,s(g,v,(i,o)=>{i?n(i):o.length===d.length?(e.emit("message",new m(e.bson,p,d,o,y)),r.length>=4?t(e,n):n()):n(new u("Decompressing a compressed message from the server failed. The message is corrupt."))})}(this,n)}_read(){}writeCommand(t,e){if(!(e&&!!e.agreedCompressor)||!function(t){const e=t instanceof v?t.command:t.query,n=Object.keys(e)[0];return!g.has(n)}(t)){const e=t.toBin();return void this.push(Array.isArray(e)?Buffer.concat(e):e)}const n=Buffer.concat(t.toBin()),r=n.slice(f),i=n.readInt32LE(12);m({options:e},r,(n,o)=>{if(n)return void e.cb(n,null);const s=Buffer.alloc(f);s.writeInt32LE(f+p+o.length,0),s.writeInt32LE(t.requestId,4),s.writeInt32LE(0,8),s.writeInt32LE(d.OP_COMPRESSED,12);const a=Buffer.alloc(p);a.writeInt32LE(i,0),a.writeInt32LE(r.length,4),a.writeUInt8(y[e.agreedCompressor],8),this.push(Buffer.concat([s,a,o]))})}}},function(t,e,n){"use strict";var r=n(284).Duplex,i=n(6),o=n(29).Buffer;function s(t){if(!(this instanceof s))return new s(t);if(this._bufs=[],this.length=0,"function"==typeof t){this._callback=t;var e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",(function(t){t.on("error",e)})),this.on("unpipe",(function(t){t.removeListener("error",e)}))}else this.append(t);r.call(this)}i.inherits(s,r),s.prototype._offset=function(t){var e,n=0,r=0;if(0===t)return[0,0];for(;r<this._bufs.length;r++){if(t<(e=n+this._bufs[r].length)||r==this._bufs.length-1)return[r,t-n];n=e}},s.prototype._reverseOffset=function(t){for(var e=t[0],n=t[1],r=0;r<e;r++)n+=this._bufs[r].length;return n},s.prototype.append=function(t){var e=0;if(o.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof s)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else null!=t&&("number"==typeof t&&(t=t.toString()),this._appendBuffer(o.from(t)));return this},s.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},s.prototype._write=function(t,e,n){this._appendBuffer(t),"function"==typeof n&&n()},s.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},s.prototype.end=function(t){r.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype.get=function(t){if(!(t>this.length||t<0)){var e=this._offset(t);return this._bufs[e[0]][e[1]]}},s.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},s.prototype.copy=function(t,e,n,r){if(("number"!=typeof n||n<0)&&(n=0),("number"!=typeof r||r>this.length)&&(r=this.length),n>=this.length)return t||o.alloc(0);if(r<=0)return t||o.alloc(0);var i,s,a=!!t,c=this._offset(n),u=r-n,l=u,h=a&&e||0,f=c[1];if(0===n&&r==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:o.concat(this._bufs,this.length);for(s=0;s<this._bufs.length;s++)this._bufs[s].copy(t,h),h+=this._bufs[s].length;return t}if(l<=this._bufs[c[0]].length-f)return a?this._bufs[c[0]].copy(t,e,f,f+l):this._bufs[c[0]].slice(f,f+l);for(a||(t=o.allocUnsafe(u)),s=c[0];s<this._bufs.length;s++){if(!(l>(i=this._bufs[s].length-f))){this._bufs[s].copy(t,h,f,f+l);break}this._bufs[s].copy(t,h,f),h+=i,l-=i,f&&(f=0)}return t},s.prototype.shallowSlice=function(t,e){if(t=t||0,e="number"!=typeof e?this.length:e,t<0&&(t+=this.length),e<0&&(e+=this.length),t===e)return new s;var n=this._offset(t),r=this._offset(e),i=this._bufs.slice(n[0],r[0]+1);return 0==r[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,r[1]),0!=n[1]&&(i[0]=i[0].slice(n[1])),new s(i)},s.prototype.toString=function(t,e,n){return this.slice(e,n).toString(t)},s.prototype.consume=function(t){for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},s.prototype.duplicate=function(){for(var t=0,e=new s;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},s.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},s.prototype.indexOf=function(t,e,n){if(void 0===n&&"string"==typeof e&&(n=e,e=void 0),"function"==typeof t||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof t?t=o.from([t]):"string"==typeof t?t=o.from(t,n):t instanceof s?t=t.slice():o.isBuffer(t)||(t=o.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),0===t.length)return e>this.length?this.length:e;for(var r=this._offset(e),i=r[0],a=r[1];i<this._bufs.length;i++){for(var c=this._bufs[i];a<c.length;){if(c.length-a>=t.length){var u=c.indexOf(t,a);if(-1!==u)return this._reverseOffset([i,u]);a=c.length-t.length+1}else{var l=this._reverseOffset([i,a]);if(this._match(l,t))return l;a++}}a=0}return-1},s.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(var n=0;n<e.length;n++)if(this.get(t+n)!==e[n])return!1;return!0},function(){var t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var e in t)!function(e){s.prototype[e]=null===t[e]?function(t,n){return this.slice(t,t+n)[e](0,n)}:function(n){return this.slice(n,n+t[e])[e](0)}}(e)}(),t.exports=s},function(t,e,n){var r=n(26);"disable"===process.env.READABLE_STREAM&&r?(t.exports=r,(e=t.exports=r.Readable).Readable=r.Readable,e.Writable=r.Writable,e.Duplex=r.Duplex,e.Transform=r.Transform,e.PassThrough=r.PassThrough,e.Stream=r):((e=t.exports=n(168)).Stream=r||e,e.Readable=e,e.Writable=n(171),e.Duplex=n(59),e.Transform=n(173),e.PassThrough=n(290))},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},function(t,e,n){"use strict";var r=n(124).Buffer,i=n(6);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e,n,i,o=r.allocUnsafe(t>>>0),s=this.head,a=0;s;)e=s.data,n=o,i=a,e.copy(n,i),a+=s.data.length,s=s.next;return o},t}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e,n){t.exports=n(6).deprecate},function(t,e,n){var r=n(70),i=r.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,e),e.Buffer=s),o(i,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e,n){"use strict";t.exports=o;var r=n(173),i=Object.create(n(74));function o(t){if(!(this instanceof o))return new o(t);r.call(this,t)}i.inherits=n(75),i.inherits(o,r),o.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){"use strict";const r=n(95).parseServerType,i=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","__nodejs_mock_server__"];t.exports={StreamDescription:class{constructor(t,e){this.address=t,this.type=r(null),this.minWireVersion=void 0,this.maxWireVersion=void 0,this.maxBsonObjectSize=16777216,this.maxMessageSizeBytes=48e6,this.maxWriteBatchSize=1e5,this.compressors=e&&e.compression&&Array.isArray(e.compression.compressors)?e.compression.compressors:[]}receiveResponse(t){this.type=r(t),i.forEach(e=>{void 0!==t[e]&&(this[e]=t[e])}),t.compression&&(this.compressor=this.compressors.filter(e=>-1!==t.compression.indexOf(e))[0])}}}},function(t,e,n){"use strict";const r=n(5).MongoError;t.exports={PoolClosedError:class extends r{constructor(t){super("Attempted to check out a connection from closed connection pool"),this.name="MongoPoolClosedError",this.address=t.address}},WaitQueueTimeoutError:class extends r{constructor(t){super("Timed out while checking out a connection from connection pool"),this.name="MongoWaitQueueTimeoutError",this.address=t.address}}}},function(t,e,n){"use strict";const r=n(27).ServerType,i=n(13),o=n(122),s=n(167).Connection,a=n(27),c=n(9).makeStateMachine,u=n(5).MongoError,l=n(0).makeInterruptableAsyncInterval,h=n(0).calculateDurationInMs,f=n(0).now,p=n(166),d=p.ServerHeartbeatStartedEvent,m=p.ServerHeartbeatSucceededEvent,y=p.ServerHeartbeatFailedEvent,g=Symbol("server"),v=Symbol("monitorId"),b=Symbol("connection"),_=Symbol("cancellationToken"),w=a.STATE_CLOSED,S=a.STATE_CLOSING,O=c({[S]:[S,w],[w]:[w,"monitoring"],idle:["idle","monitoring",S],monitoring:["monitoring","idle",S]}),E=new Set([S,w,"monitoring"]);function T(t){return t.s.state===w||t.s.state===S}function C(t,e){t[b]&&t[b].closed&&(t[b]=void 0);const n=f();function r(r){t.emit("serverHeartbeatFailed",new y(h(n),r,t.address)),e(r)}function i(r){return t.emit("serverHeartbeatSucceeded",new m(h(n),r,t.address)),e(void 0,r)}if(t.emit("serverHeartbeatStarted",new d(t.address)),null==t[b])o(t.connectOptions,t[_],(e,n)=>e?(t[b]=void 0,void r(e)):T(t)?(n.destroy({force:!0}),void r(new u("monitor was destroyed"))):(t[b]=n,void i(n.ismaster)));else{const e=t.options.connectTimeoutMS;t[b].command("admin.$cmd",{ismaster:!0},{socketTimeout:e},(t,e)=>{t?r(t):i(e.result)})}}t.exports={Monitor:class extends i{constructor(t,e){super(e),this[g]=t,this[b]=void 0,this[_]=new i,this[_].setMaxListeners(1/0),this[v]=null,this.s={state:w},this.address=t.description.address,this.options=Object.freeze({connectTimeoutMS:"number"==typeof e.connectionTimeout?e.connectionTimeout:"number"==typeof e.connectTimeoutMS?e.connectTimeoutMS:1e4,heartbeatFrequencyMS:"number"==typeof e.heartbeatFrequencyMS?e.heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:"number"==typeof e.minHeartbeatFrequencyMS?e.minHeartbeatFrequencyMS:500});const n=t.description.address.split(":");this.connectOptions=Object.freeze(Object.assign({id:"<monitor>",host:n[0],port:parseInt(n[1],10),bson:t.s.bson,connectionType:s},t.s.options,this.options,{raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!0}))}connect(){if(this.s.state!==w)return;const t=this.options.heartbeatFrequencyMS,e=this.options.minHeartbeatFrequencyMS;var n;this[v]=l((n=this,t=>{function e(){T(n)||O(n,"idle"),t()}O(n,"monitoring"),process.nextTick(()=>n.emit("monitoring",n[g])),C(n,t=>null==t?e():n[g].description.type===r.Unknown?(n.emit("resetServer",t),e()):(n.emit("resetConnectionPool"),void C(n,t=>{t&&n.emit("resetServer",t),e()})))}),{interval:t,minInterval:e,immediate:!0})}requestCheck(){E.has(this.s.state)||this[v].wake()}close(){T(this)||(O(this,S),this[_].emit("cancel"),this[v]&&(this[v].stop(),this[v]=null),this[b]&&this[b].destroy({force:!0}),this.emit("close"),O(this,w))}}}},function(t,e,n){"use strict";const r=n(34),i=n(13).EventEmitter,o=n(125);class s{constructor(t){this.srvRecords=t}addresses(){return new Set(this.srvRecords.map(t=>`${t.name}:${t.port}`))}}t.exports.SrvPollingEvent=s,t.exports.SrvPoller=class extends i{constructor(t){if(super(),!t||!t.srvHost)throw new TypeError("options for SrvPoller must exist and include srvHost");this.srvHost=t.srvHost,this.rescanSrvIntervalMS=6e4,this.heartbeatFrequencyMS=t.heartbeatFrequencyMS||1e4,this.logger=r("srvPoller",t),this.haMode=!1,this.generation=0,this._timeout=null}get srvAddress(){return`_mongodb._tcp.${this.srvHost}`}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMS}start(){this._timeout||this.schedule()}stop(){this._timeout&&(clearTimeout(this._timeout),this.generation+=1,this._timeout=null)}schedule(){clearTimeout(this._timeout),this._timeout=setTimeout(()=>this._poll(),this.intervalMS)}success(t){this.haMode=!1,this.schedule(),this.emit("srvRecordDiscovery",new s(t))}failure(t,e){this.logger.warn(t,e),this.haMode=!0,this.schedule()}parentDomainMismatch(t){this.logger.warn(`parent domain mismatch on SRV record (${t.name}:${t.port})`,t)}_poll(){const t=this.generation;o.resolveSrv(this.srvAddress,(e,n)=>{if(t!==this.generation)return;if(e)return void this.failure("DNS error",e);const r=[];n.forEach(t=>{!function(t,e){const n=/^.*?\./,r=`.${t.replace(n,"")}`,i=`.${e.replace(n,"")}`;return r.endsWith(i)}(t.name,this.srvHost)?this.parentDomainMismatch(t):r.push(t)}),r.length?this.success(r):this.failure("No valid addresses found at host")})}}},function(t,e,n){"use strict";const r=n(27).ServerType,i=n(27).TopologyType,o=n(19),s=n(5).MongoError;function a(t,e){const n=Object.keys(t),r=Object.keys(e);for(let i=0;i<n.length;++i){const o=n[i];if(-1===r.indexOf(o)||e[o]!==t[o])return!1}return!0}function c(t,e){const n=e.reduce((t,e)=>-1===t?e.roundTripTime:Math.min(e.roundTripTime,t),-1),r=n+t.localThresholdMS;return e.reduce((t,e)=>(e.roundTripTime<=r&&e.roundTripTime>=n&&t.push(e),t),[])}function u(t){return t.type===r.RSPrimary}function l(t){return t.type===r.RSSecondary}function h(t){return t.type===r.RSSecondary||t.type===r.RSPrimary}function f(t){return t.type!==r.Unknown}t.exports={writableServerSelector:function(){return function(t,e){return c(t,e.filter(t=>t.isWritable))}},readPreferenceServerSelector:function(t){if(!t.isValid())throw new TypeError("Invalid read preference specified");return function(e,n){const r=e.commonWireVersion;if(r&&t.minWireVersion&&t.minWireVersion>r)throw new s(`Minimum wire version '${t.minWireVersion}' required, but found '${r}'`);if(e.type===i.Unknown)return[];if(e.type===i.Single||e.type===i.Sharded)return c(e,n.filter(f));const p=t.mode;if(p===o.PRIMARY)return n.filter(u);if(p===o.PRIMARY_PREFERRED){const t=n.filter(u);if(t.length)return t}const d=p===o.NEAREST?h:l,m=c(e,function(t,e){if(null==t.tags||Array.isArray(t.tags)&&0===t.tags.length)return e;for(let n=0;n<t.tags.length;++n){const r=t.tags[n],i=e.reduce((t,e)=>(a(r,e.tags)&&t.push(e),t),[]);if(i.length)return i}return[]}(t,function(t,e,n){if(null==t.maxStalenessSeconds||t.maxStalenessSeconds<0)return n;const r=t.maxStalenessSeconds,o=(e.heartbeatFrequencyMS+1e4)/1e3;if(r<o)throw new s(`maxStalenessSeconds must be at least ${o} seconds`);if(r<90)throw new s("maxStalenessSeconds must be at least 90 seconds");if(e.type===i.ReplicaSetWithPrimary){const r=Array.from(e.servers.values()).filter(u)[0];return n.reduce((n,i)=>((i.lastUpdateTime-i.lastWriteDate-(r.lastUpdateTime-r.lastWriteDate)+e.heartbeatFrequencyMS)/1e3<=t.maxStalenessSeconds&&n.push(i),n),[])}if(e.type===i.ReplicaSetNoPrimary){if(0===n.length)return n;const r=n.reduce((t,e)=>e.lastWriteDate>t.lastWriteDate?e:t);return n.reduce((n,i)=>((r.lastWriteDate-i.lastWriteDate+e.heartbeatFrequencyMS)/1e3<=t.maxStalenessSeconds&&n.push(i),n),[])}return n}(t,e,n.filter(d))));return p===o.SECONDARY_PREFERRED&&0===m.length?n.filter(u):m}}}},function(t,e,n){"use strict";t.exports={MongoCredentials:class{constructor(t){t=t||{},this.username=t.username,this.password=t.password,this.source=t.source||t.db,this.mechanism=t.mechanism||"default",this.mechanismProperties=t.mechanismProperties}equals(t){return this.mechanism===t.mechanism&&this.username===t.username&&this.password===t.password&&this.source===t.source}resolveAuthMechanism(t){"default"===this.mechanism.toLowerCase()&&(this.mechanism=function(t){if(t){if(Array.isArray(t.saslSupportedMechs))return t.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(t.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}(t))}}}},function(t,e,n){"use strict";const r=n(151),i=n(247),o=n(125),s=n(5).MongoParseError,a=n(19),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;function u(t,e){const n=/^.*?\./,r=`.${t.replace(n,"")}`,i=`.${e.replace(n,"")}`;return r.endsWith(i)}function l(t,e){if(Array.isArray(e))1===(e=e.filter((t,n)=>e.indexOf(t)===n)).length&&(e=e[0]);else if(e.indexOf(":")>0)e=e.split(",").reduce((e,n)=>{const r=n.split(":");return e[r[0]]=l(t,r[1]),e},{});else if(e.indexOf(",")>0)e=e.split(",").map(e=>l(t,e));else if("true"===e.toLowerCase()||"false"===e.toLowerCase())e="true"===e.toLowerCase();else if(!Number.isNaN(e)&&!f.has(t)){const t=parseFloat(e);Number.isNaN(t)||(e=parseFloat(e))}return e}const h=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),f=new Set(["authsource","replicaset"]),p=new Set(["GSSAPI","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),d={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel",tlsallowinvalidcertificates:"tlsAllowInvalidCertificates",tlsallowinvalidhostnames:"tlsAllowInvalidHostnames",tlsinsecure:"tlsInsecure",tlscafile:"tlsCAFile",tlscertificatekeyfile:"tlsCertificateKeyFile",tlscertificatekeyfilepassword:"tlsCertificateKeyFilePassword",wtimeout:"wTimeoutMS",j:"journal"};function m(t,e,n,r){if("journal"===e?e="j":"wtimeoutms"===e&&(e="wtimeout"),h.has(e)?n="true"===n||!0===n:"appname"===e?n=decodeURIComponent(n):"readconcernlevel"===e&&(t.readConcernLevel=n,e="readconcern",n={level:n}),"compressors"===e&&!(n=Array.isArray(n)?n:[n]).every(t=>"snappy"===t||"zlib"===t))throw new s("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===e&&!p.has(n))throw new s("Value for `authMechanism` must be one of: `DEFAULT`, `GSSAPI`, `PLAIN`, `MONGODB-X509`, `SCRAM-SHA-1`, `SCRAM-SHA-256`");if("readpreference"===e&&!a.isValid(n))throw new s("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===e&&(n<-1||n>9))throw new s("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==e&&"zlibcompressionlevel"!==e||(t.compression=t.compression||{},t=t.compression),"authmechanismproperties"===e&&("string"==typeof n.SERVICE_NAME&&(t.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(t.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(t.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),"readpreferencetags"===e&&(n=Array.isArray(n)?function(t){const e=[];for(let n=0;n<t.length;n++)e[n]={},t[n].split(",").forEach(t=>{const r=t.split(":");e[n][r[0]]=r[1]});return e}(n):[n]),r.caseTranslate&&d[e]?t[d[e]]=n:t[e]=n}const y=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);function g(t,e){const n={};let r=i.parse(t);!function(t){const e=Object.keys(t);if(-1!==e.indexOf("tlsInsecure")&&(-1!==e.indexOf("tlsAllowInvalidCertificates")||-1!==e.indexOf("tlsAllowInvalidHostnames")))throw new s("The `tlsInsecure` option cannot be used with `tlsAllowInvalidCertificates` or `tlsAllowInvalidHostnames`.");const n=v("tls",t,e),r=v("ssl",t,e);if(null!=n&&null!=r&&n!==r)throw new s("All values of `tls` and `ssl` must be the same.")}(r);for(const t in r){const i=r[t];if(""===i||null==i)throw new s("Incomplete key value pair for option");const o=t.toLowerCase();m(n,o,l(o,i),e)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}function v(t,e,n){const r=-1!==n.indexOf(t);let i;if(i=Array.isArray(e[t])?e[t][0]:e[t],r&&Array.isArray(e[t])){const n=e[t][0];e[t].forEach(e=>{if(e!==n)throw new s(`All values of ${t} must be the same.`)})}return i}const b="mongodb+srv",_=["mongodb",b];function w(t,e,n){"function"==typeof e&&(n=e,e={}),e=Object.assign({},{caseTranslate:!0},e);try{r.parse(t)}catch(t){return n(new s("URI malformed, cannot be parsed"))}const a=t.match(c);if(!a)return n(new s("Invalid connection string"));const l=a[1];if(-1===_.indexOf(l))return n(new s("Invalid protocol provided"));if(l===b)return function(t,e,n){const a=r.parse(t,!0);if(a.hostname.split(".").length<3)return n(new s("URI does not have hostname, domain name and tld"));if(a.domainLength=a.hostname.split(".").length,a.pathname&&a.pathname.match(","))return n(new s("Invalid URI, cannot contain multiple hostnames"));if(a.port)return n(new s(`Ports not accepted with '${b}' URIs`));const c=a.host;o.resolveSrv(`_mongodb._tcp.${c}`,(t,l)=>{if(t)return n(t);if(0===l.length)return n(new s("No addresses found at host"));for(let t=0;t<l.length;t++)if(!u(l[t].name,a.hostname,a.domainLength))return n(new s("Server record does not share hostname with parent URI"));a.protocol="mongodb",a.host=l.map(t=>`${t.name}:${t.port}`).join(","),"ssl"in e||a.search&&"ssl"in a.query&&null!==a.query.ssl||(a.query.ssl=!0),o.resolveTxt(c,(t,o)=>{if(t){if("ENODATA"!==t.code)return n(t);o=null}if(o){if(o.length>1)return n(new s("Multiple text records not allowed"));if(o=i.parse(o[0].join("")),Object.keys(o).some(t=>"authSource"!==t&&"replicaSet"!==t))return n(new s("Text record must only set `authSource` or `replicaSet`"));a.query=Object.assign({},o,a.query)}a.search=i.stringify(a.query),w(r.format(a),e,(t,e)=>{t?n(t):n(null,Object.assign({},e,{srvHost:c}))})})})}(t,e,n);const h=a[4].split("?"),f=h.length>0?h[0]:null,p=h.length>1?h[1]:null;let d;try{d=g(p,e)}catch(t){return n(t)}d=Object.assign({},d,e);const m={username:null,password:null,db:f&&""!==f?i.unescape(f):null};if(d.auth?(d.auth.username&&(m.username=d.auth.username),d.auth.user&&(m.username=d.auth.user),d.auth.password&&(m.password=d.auth.password)):(d.username&&(m.username=d.username),d.user&&(m.username=d.user),d.password&&(m.password=d.password)),-1!==a[4].split("?")[0].indexOf("@"))return n(new s("Unescaped slash in userinfo section"));const v=a[3].split("@");if(v.length>2)return n(new s("Unescaped at-sign in authority section"));if(null==v[0]||""===v[0])return n(new s("No username provided in authority section"));if(v.length>1){const t=v.shift().split(":");if(t.length>2)return n(new s("Unescaped colon in authority section"));if(""===t[0])return n(new s("Invalid empty username provided"));m.username||(m.username=i.unescape(t[0])),m.password||(m.password=t[1]?i.unescape(t[1]):null)}let S=null;const O=v.shift().split(",").map(t=>{let e=r.parse(`mongodb://${t}`);if("/:"===e.path)return S=new s("Double colon in host identifier"),null;if(t.match(/\.sock/)&&(e.hostname=i.unescape(t),e.port=null),Number.isNaN(e.port))return void(S=new s("Invalid port (non-numeric string)"));const n={host:e.hostname,port:e.port?parseInt(e.port):27017};if(0!==n.port)if(n.port>65535)S=new s("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;S=new s("Invalid port (negative number)")}else S=new s("Invalid port (zero) with hostname")}).filter(t=>!!t);if(S)return n(S);if(0===O.length||""===O[0].host||null===O[0].host)return n(new s("No hostname or hostnames provided in connection string"));const E={hosts:O,auth:m.db||m.username?m:null,options:Object.keys(d).length?d:null};var T;E.auth&&E.auth.db?E.defaultDatabase=E.auth.db:E.defaultDatabase="test",E.options=((T=E.options).tls&&(T.ssl=T.tls),T.tlsInsecure?(T.checkServerIdentity=!1,T.sslValidate=!1):Object.assign(T,{checkServerIdentity:!T.tlsAllowInvalidHostnames,sslValidate:!T.tlsAllowInvalidCertificates}),T.tlsCAFile&&(T.ssl=!0,T.sslCA=T.tlsCAFile),T.tlsCertificateKeyFile&&(T.ssl=!0,T.tlsCertificateFile?(T.sslCert=T.tlsCertificateFile,T.sslKey=T.tlsCertificateKeyFile):(T.sslKey=T.tlsCertificateKeyFile,T.sslCert=T.tlsCertificateKeyFile)),T.tlsCertificateKeyFilePassword&&(T.ssl=!0,T.sslPass=T.tlsCertificateKeyFilePassword),T);try{!function(t){if(null==t.options)return;const e=t.options,n=e.authsource||e.authSource;null!=n&&(t.auth=Object.assign({},t.auth,{db:n}));const r=e.authmechanism||e.authMechanism;if(null!=r){if(y.has(r)&&(!t.auth||null==t.auth.username))throw new s(`Username required for mechanism \`${r}\``);if("GSSAPI"===r){if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);t.auth=Object.assign({},t.auth,{db:"$external"})}if("MONGODB-X509"===r){if(t.auth&&null!=t.auth.password)throw new s(`Password not allowed for mechanism \`${r}\``);if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${r}\` specified.`);t.auth=Object.assign({},t.auth,{db:"$external"})}"PLAIN"===r&&t.auth&&null==t.auth.db&&(t.auth=Object.assign({},t.auth,{db:"$external"}))}t.auth&&null==t.auth.db&&(t.auth=Object.assign({},t.auth,{db:"admin"}))}(E)}catch(t){return n(t)}n(null,E)}t.exports=w},function(t,e,n){"use strict";const r=n(13).EventEmitter;t.exports=class extends r{constructor(){super()}instrument(t,e){this.$MongoClient=t;const n=this.$prototypeConnect=t.prototype.connect,r=this;t.prototype.connect=function(t){return this.s.options.monitorCommands=!0,this.on("commandStarted",t=>r.emit("started",t)),this.on("commandSucceeded",t=>r.emit("succeeded",t)),this.on("commandFailed",t=>r.emit("failed",t)),n.call(this,t)},"function"==typeof e&&e(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(t,e,n){"use strict";const r=n(60).buildCountCommand,i=n(0).handleCallback,o=n(3).MongoError,s=Array.prototype.push,a=n(35).CursorState;function c(t,e){if(0!==t.bufferedCount())return t._next(e),c}t.exports={count:function(t,e,n,i){e&&("number"==typeof t.cursorSkip()&&(n.skip=t.cursorSkip()),"number"==typeof t.cursorLimit()&&(n.limit=t.cursorLimit())),n.readPreference&&t.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&t.cmd&&"number"==typeof t.cmd.maxTimeMS&&(n.maxTimeMS=t.cmd.maxTimeMS);let o,s={};s.skip=n.skip,s.limit=n.limit,s.hint=n.hint,s.maxTimeMS=n.maxTimeMS,s.collectionName=t.namespace.collection;try{o=r(t,t.cmd.query,s)}catch(t){return i(t)}t.server=t.topology.s.coreTopology,t.topology.command(t.namespace.withCollection("$cmd"),o,t.options,(t,e)=>{i(t,e?e.result.n:null)})},each:function t(e,n){if(!n)throw o.create({message:"callback is mandatory",driver:!0});if(e.isNotified())return;if(e.s.state===a.CLOSED||e.isDead())return i(n,o.create({message:"Cursor is closed",driver:!0}));e.s.state===a.INIT&&(e.s.state=a.OPEN);let r=null;if(e.bufferedCount()>0){for(;r=c(e,n);)r(e,n);t(e,n)}else e.next((r,o)=>r?i(n,r):null==o?e.close({skipKillCursors:!0},()=>i(n,null,null)):void(!1!==i(n,null,o)&&t(e,n)))},toArray:function(t,e){const n=[];t.rewind(),t.s.state=a.INIT;const r=()=>{t._next((o,a)=>{if(o)return i(e,o);if(null==a)return t.close({skipKillCursors:!0},()=>i(e,null,n));if(n.push(a),t.bufferedCount()>0){let e=t.readBufferedDocuments(t.bufferedCount());t.s.transforms&&"function"==typeof t.s.transforms.doc&&(e=e.map(t.s.transforms.doc)),s.apply(n,e)}r()})};r()}}},function(t,e,n){"use strict";const r=n(21).buildCountCommand,i=n(4).OperationBase;t.exports=class extends i{constructor(t,e,n){super(n),this.cursor=t,this.applySkipLimit=e}execute(t){const e=this.cursor,n=this.applySkipLimit,i=this.options;n&&("number"==typeof e.cursorSkip()&&(i.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(i.limit=e.cursorLimit())),i.readPreference&&e.setReadPreference(i.readPreference),"number"!=typeof i.maxTimeMS&&e.cmd&&"number"==typeof e.cmd.maxTimeMS&&(i.maxTimeMS=e.cmd.maxTimeMS);let o,s={};s.skip=i.skip,s.limit=i.limit,s.hint=i.hint,s.maxTimeMS=i.maxTimeMS,s.collectionName=e.namespace.collection;try{o=r(e,e.cmd.query,s)}catch(e){return t(e)}e.server=e.topology.s.coreTopology,e.topology.command(e.namespace.withCollection("$cmd"),o,e.options,(e,n)=>{t(e,n?n.result.n:null)})}}},function(t,e,n){"use strict";const r=n(128),i=r.BulkOperationBase,o=r.Batch,s=r.bson,a=n(0).toError;function c(t,e,n){const i=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(i>=t.s.maxBsonObjectSize)throw a("document is larger than the maximum size "+t.s.maxBsonObjectSize);t.s.currentBatch=null,e===r.INSERT?t.s.currentBatch=t.s.currentInsertBatch:e===r.UPDATE?t.s.currentBatch=t.s.currentUpdateBatch:e===r.REMOVE&&(t.s.currentBatch=t.s.currentRemoveBatch);const c=t.s.maxKeySize;if(null==t.s.currentBatch&&(t.s.currentBatch=new o(e,t.s.currentIndex)),(t.s.currentBatch.size+1>=t.s.maxWriteBatchSize||t.s.currentBatch.size>0&&t.s.currentBatch.sizeBytes+c+i>=t.s.maxBatchSizeBytes||t.s.currentBatch.batchType!==e)&&(t.s.batches.push(t.s.currentBatch),t.s.currentBatch=new o(e,t.s.currentIndex)),Array.isArray(n))throw a("operation passed in cannot be an Array");return t.s.currentBatch.operations.push(n),t.s.currentBatch.originalIndexes.push(t.s.currentIndex),t.s.currentIndex=t.s.currentIndex+1,e===r.INSERT?(t.s.currentInsertBatch=t.s.currentBatch,t.s.bulkResult.insertedIds.push({index:t.s.bulkResult.insertedIds.length,_id:n._id})):e===r.UPDATE?t.s.currentUpdateBatch=t.s.currentBatch:e===r.REMOVE&&(t.s.currentRemoveBatch=t.s.currentBatch),t.s.currentBatch.size+=1,t.s.currentBatch.sizeBytes+=c+i,t}class u extends i{constructor(t,e,n){n=n||{},super(t,e,n=Object.assign(n,{addToOperationsList:c}),!1)}handleWriteError(t,e){return!this.s.batches.length&&super.handleWriteError(t,e)}}function l(t,e,n){return new u(t,e,n)}l.UnorderedBulkOperation=u,t.exports=l,t.exports.Bulk=u},function(t,e,n){"use strict";const r=n(128),i=r.BulkOperationBase,o=r.Batch,s=r.bson,a=n(0).toError;function c(t,e,n){const i=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(i>=t.s.maxBsonObjectSize)throw a("document is larger than the maximum size "+t.s.maxBsonObjectSize);null==t.s.currentBatch&&(t.s.currentBatch=new o(e,t.s.currentIndex));const c=t.s.maxKeySize;if((t.s.currentBatchSize+1>=t.s.maxWriteBatchSize||t.s.currentBatchSize>0&&t.s.currentBatchSizeBytes+c+i>=t.s.maxBatchSizeBytes||t.s.currentBatch.batchType!==e)&&(t.s.batches.push(t.s.currentBatch),t.s.currentBatch=new o(e,t.s.currentIndex),t.s.currentBatchSize=0,t.s.currentBatchSizeBytes=0),e===r.INSERT&&t.s.bulkResult.insertedIds.push({index:t.s.currentIndex,_id:n._id}),Array.isArray(n))throw a("operation passed in cannot be an Array");return t.s.currentBatch.originalIndexes.push(t.s.currentIndex),t.s.currentBatch.operations.push(n),t.s.currentBatchSize+=1,t.s.currentBatchSizeBytes+=c+i,t.s.currentIndex+=1,t}class u extends i{constructor(t,e,n){n=n||{},super(t,e,n=Object.assign(n,{addToOperationsList:c}),!0)}}function l(t,e,n){return new u(t,e,n)}l.OrderedBulkOperation=u,t.exports=l,t.exports.Bulk=u},function(t,e,n){"use strict";const r=n(101);t.exports=class extends r{constructor(t,e,n){const r=[{$match:e}];"number"==typeof n.skip&&r.push({$skip:n.skip}),"number"==typeof n.limit&&r.push({$limit:n.limit}),r.push({$group:{_id:1,n:{$sum:1}}}),super(t,r,n)}execute(t,e){super.execute(t,(t,n)=>{if(t)return void e(t,null);const r=n.result;if(null==r.cursor||null==r.cursor.firstBatch)return void e(null,0);const i=r.cursor.firstBatch;e(null,i.length?i[0].n:0)})}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(4).OperationBase,s=n(20).executeCommand,a=n(3).MongoError,c=n(3).ReadPreference;class u extends o{constructor(t,e,n){super(n),this.collection=t,this.indexSpecs=e}execute(t){const e=this.collection,n=this.indexSpecs;let r=this.options;const i=e.s.topology.capabilities();for(let e=0;e<n.length;e++)if(null==n[e].name){const r=[];if(n[e].collation&&i&&!i.commandsTakeCollation)return t(new a("server/primary/mongos does not support collation"));for(let t in n[e].key)r.push(`${t}_${n[e].key[t]}`);n[e].name=r.join("_")}r=Object.assign({},r,{readPreference:c.PRIMARY}),s(e.s.db,{createIndexes:e.collectionName,indexes:n},r,t)}}i(u,r.WRITE_OPERATION),t.exports=u},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).deleteCallback,o=n(21).removeDocuments;t.exports=class extends r{constructor(t,e,n){super(n),this.collection=t,this.filter=e}execute(t){const e=this.collection,n=this.filter,r=this.options;r.single=!1,o(e,n,r,(e,n)=>i(e,n,t))}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).deleteCallback,o=n(21).removeDocuments;t.exports=class extends r{constructor(t,e,n){super(n),this.collection=t,this.filter=e}execute(t){const e=this.collection,n=this.filter,r=this.options;r.single=!0,o(e,n,r,(e,n)=>i(e,n,t))}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(61),s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern;class c extends o{constructor(t,e,n,r){super(t,r),this.collection=t,this.key=e,this.query=n}execute(t,e){const n=this.collection,r=this.key,i=this.query,o=this.options,c={distinct:n.collectionName,key:r,query:i};"number"==typeof o.maxTimeMS&&(c.maxTimeMS=o.maxTimeMS),a(c,n,o);try{s(c,n,o)}catch(t){return e(t,null)}super.executeCommand(t,c,(t,n)=>{t?e(t):e(null,this.options.full?n:n.values)})}}i(c,[r.READ_OPERATION,r.RETRYABLE,r.EXECUTE_WITH_SELECTION]),t.exports=c},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(177),s=n(0).handleCallback;class a extends o{constructor(t,e){super(t,"*",e)}execute(t){super.execute(e=>{if(e)return s(t,e,!1);s(t,null,!0)})}}i(a,r.WRITE_OPERATION),t.exports=a},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(61);class s extends o{constructor(t,e,n){void 0===n&&(n=e,e=void 0),super(t,n),this.collectionName=t.s.namespace.collection,e&&(this.query=e)}execute(t,e){const n=this.options,r={count:this.collectionName};this.query&&(r.query=this.query),"number"==typeof n.skip&&(r.skip=n.skip),"number"==typeof n.limit&&(r.limit=n.limit),n.hint&&(r.hint=n.hint),super.executeCommand(t,r,(t,n)=>{t?e(t):e(null,n.n)})}}i(s,[r.READ_OPERATION,r.RETRYABLE,r.EXECUTE_WITH_SELECTION]),t.exports=s},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(4).Aspect,o=n(4).defineAspects,s=n(0).resolveReadPreference;class a extends r{constructor(t,e,n,r){super(r),this.ns=e,this.cmd=n,this.readPreference=s(t,this.options)}execute(t,e){this.server=t;const n=this.cursorState||{};t.query(this.ns.toString(),this.cmd,n,this.options,e)}}o(a,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),t.exports=a},function(t,e,n){"use strict";const r=n(0).handleCallback,i=n(4).OperationBase,o=n(0).toError;t.exports=class extends i{constructor(t,e,n){super(n),this.collection=t,this.query=e}execute(t){const e=this.collection,n=this.query,i=this.options;try{e.find(n,i).limit(-1).batchSize(1).next((e,n)=>{if(null!=e)return r(t,o(e),null);r(t,null,n)})}catch(e){t(e)}}}},function(t,e,n){"use strict";const r=n(102);t.exports=class extends r{constructor(t,e,n){const r=Object.assign({},n);r.fields=n.projection,r.remove=!0,super(t,e,r.sort,null,r)}}},function(t,e,n){"use strict";const r=n(102);t.exports=class extends r{constructor(t,e,n,r){const i=Object.assign({},r);i.fields=r.projection,i.update=!0,i.new=void 0!==r.returnOriginal&&!r.returnOriginal,i.upsert=void 0!==r.upsert&&!!r.upsert,super(t,e,i.sort,n,i)}}},function(t,e,n){"use strict";const r=n(102);t.exports=class extends r{constructor(t,e,n,r){const i=Object.assign({},r);i.fields=r.projection,i.update=!0,i.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,i.upsert="boolean"==typeof r.upsert&&r.upsert,super(t,e,i.sort,n,i)}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(4).OperationBase,s=n(0).decorateCommand,a=n(0).decorateWithReadConcern,c=n(20).executeCommand,u=n(0).handleCallback,l=n(0).resolveReadPreference,h=n(0).toError;class f extends o{constructor(t,e,n,r){super(r),this.collection=t,this.x=e,this.y=n}execute(t){const e=this.collection,n=this.x,r=this.y;let i=this.options,o={geoSearch:e.collectionName,near:[n,r]};o=s(o,i,["readPreference","session"]),i=Object.assign({},i),i.readPreference=l(e,i),a(o,e,i),c(e.s.db,o,i,(e,n)=>{if(e)return u(t,e);(n.err||n.errmsg)&&u(t,h(n)),u(t,null,n)})}}i(f,r.READ_OPERATION),t.exports=f},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).indexInformation;t.exports=class extends r{constructor(t,e){super(e),this.collection=t}execute(t){const e=this.collection;let n=this.options;n=Object.assign({},{full:!0},n),i(e.s.db,e.collectionName,n,t)}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).handleCallback,o=n(20).indexInformation;t.exports=class extends r{constructor(t,e,n){super(n),this.collection=t,this.indexes=e}execute(t){const e=this.collection,n=this.indexes,r=this.options;o(e.s.db,e.collectionName,r,(e,r)=>{if(null!=e)return i(t,e,null);if(!Array.isArray(n))return i(t,null,null!=r[n]);for(let e=0;e<n.length;e++)if(null==r[n[e]])return i(t,null,!1);return i(t,null,!0)})}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(175),o=n(3).MongoError,s=n(21).prepareDocs;t.exports=class extends r{constructor(t,e,n){super(n),this.collection=t,this.docs=e}execute(t){const e=this.collection;let n=this.docs;const r=this.options;if(!Array.isArray(n))return t(o.create({message:"docs parameter must be an array of documents",driver:!0}));r.serializeFunctions=r.serializeFunctions||e.s.serializeFunctions,n=s(e,n,r),new i(e,[{insertMany:n}],r).execute((e,r)=>{if(e)return t(e,null);t(null,function(t,e){const n={result:{ok:1,n:e.insertedCount},ops:t,insertedCount:e.insertedCount,insertedIds:e.insertedIds};e.getLastOp()&&(n.result.opTime=e.getLastOp());return n}(n,r))})}}},function(t,e,n){"use strict";const r=n(3).MongoError,i=n(4).OperationBase,o=n(21).insertDocuments;t.exports=class extends i{constructor(t,e,n){super(n),this.collection=t,this.doc=e}execute(t){const e=this.collection,n=this.doc,i=this.options;if(Array.isArray(n))return t(r.create({message:"doc parameter must be an object",driver:!0}));o(e,[n],i,(e,r)=>{if(null!=t){if(e&&t)return t(e);if(null==r)return t(null,{result:{ok:1}});r.insertedCount=r.result.n,r.insertedId=n._id,t&&t(null,r)}})}}},function(t,e,n){"use strict";const r=n(179),i=n(0).handleCallback;t.exports=class extends r{constructor(t,e){super(t,e)}execute(t){super.execute((e,n)=>{if(e)return i(t,e);i(t,null,!(!n||!n.capped))})}}},function(t,e,n){"use strict";const r=n(61),i=n(4).Aspect,o=n(4).defineAspects,s=n(9).maxWireVersion;class a extends r{constructor(t,e){super(t,e,{fullResponse:!0}),this.collectionNamespace=t.s.namespace}execute(t,e){if(s(t)<3){const n=this.collectionNamespace.withCollection("system.indexes").toString(),r=this.collectionNamespace.toString();return void t.query(n,{query:{ns:r}},{},this.options,e)}const n=this.options.batchSize?{batchSize:this.options.batchSize}:{};super.executeCommand(t,{listIndexes:this.collectionNamespace.collection,cursor:n},e)}}o(a,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),t.exports=a},function(t,e,n){"use strict";const r=n(0).applyWriteConcern,i=n(3).BSON.Code,o=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(20).executeCommand,c=n(0).handleCallback,u=n(0).isObject,l=n(132).loadDb,h=n(4).OperationBase,f=n(0).resolveReadPreference,p=n(0).toError,d=["readPreference","session","bypassDocumentValidation","w","wtimeout","j","writeConcern"];function m(t){if(!u(t)||"ObjectID"===t._bsontype)return t;const e=Object.keys(t);let n;const r={};for(let o=e.length-1;o>=0;o--)n=e[o],"function"==typeof t[n]?r[n]=new i(String(t[n])):r[n]=m(t[n]);return r}t.exports=class extends h{constructor(t,e,n,r){super(r),this.collection=t,this.map=e,this.reduce=n}execute(t){const e=this.collection,n=this.map,i=this.reduce;let u=this.options;const h={mapreduce:e.collectionName,map:n,reduce:i};for(let t in u)"scope"===t?h[t]=m(u[t]):-1===d.indexOf(t)&&(h[t]=u[t]);u=Object.assign({},u),u.readPreference=f(e,u),!1!==u.readPreference&&"primary"!==u.readPreference&&u.out&&1!==u.out.inline&&"inline"!==u.out?(u.readPreference="primary",r(h,{db:e.s.db,collection:e},u)):s(h,e,u),!0===u.bypassDocumentValidation&&(h.bypassDocumentValidation=u.bypassDocumentValidation);try{o(h,e,u)}catch(e){return t(e,null)}a(e.s.db,h,u,(n,r)=>{if(n)return c(t,n);if(1!==r.ok||r.err||r.errmsg)return c(t,p(r));const i={};if(r.timeMillis&&(i.processtime=r.timeMillis),r.counts&&(i.counts=r.counts),r.timing&&(i.timing=r.timing),r.results)return null!=u.verbose&&u.verbose?c(t,null,{results:r.results,stats:i}):c(t,null,r.results);let o=null;if(null!=r.result&&"object"==typeof r.result){const t=r.result;o=new(l())(t.db,e.s.db.s.topology,e.s.db.s.options).collection(t.collection)}else o=e.s.db.collection(r.result);if(null==u.verbose||!u.verbose)return c(t,n,o);c(t,n,{collection:o,stats:i})})}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(0).handleCallback;let o;t.exports=class extends r{constructor(t,e){super(e),this.db=t}execute(t){const e=this.db;let r=this.options,s=(o||(o=n(76)),o);r=Object.assign({},r,{nameOnly:!0}),e.listCollections({},r).toArray((n,r)=>{if(null!=n)return i(t,n,null);r=r.filter(t=>-1===t.name.indexOf("$")),i(t,null,r.map(t=>new s(e,e.s.topology,e.databaseName,t.name,e.s.pkFactory,e.s.options)))})}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(4).defineAspects,o=n(30),s=n(0).applyWriteConcern,a=n(0).handleCallback,c=n(132).loadCollection,u=n(3).MongoError,l=n(3).ReadPreference,h=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session","readConcern","writeConcern"];class f extends o{constructor(t,e,n){super(t,n),this.name=e}_buildCommand(){const t=this.name,e=this.options,n={create:t};for(let t in e)null!=e[t]&&"function"!=typeof e[t]&&-1===h.indexOf(t)&&(n[t]=e[t]);return n}execute(t){const e=this.db,n=this.name,r=this.options;let i=c();if(e.serverConfig&&e.serverConfig.isDestroyed())return t(new u("topology was destroyed"));let o=Object.assign({},r,{nameOnly:!0});o=s(o,{db:e},o),e.listCollections({name:n},o).setReadPreference(l.PRIMARY).toArray((s,c)=>{if(null!=s)return a(t,s,null);if(c.length>0&&o.strict)return a(t,u.create({message:`Collection ${n} already exists. Currently in strict mode.`,driver:!0}),null);if(c.length>0)try{return a(t,null,new i(e,e.s.topology,e.databaseName,n,e.s.pkFactory,r))}catch(s){return a(t,s)}super.execute(o=>{if(o)return a(t,o);try{return a(t,null,new i(e,e.s.topology,e.databaseName,n,e.s.pkFactory,r))}catch(o){return a(t,o)}})})}}i(f,r.WRITE_OPERATION),t.exports=f},function(t,e,n){"use strict";const r=n(61),i=n(4).Aspect,o=n(4).defineAspects,s=n(9).maxWireVersion,a=n(127);class c extends r{constructor(t,e,n){super(t,n,{fullResponse:!0}),this.db=t,this.filter=e,this.nameOnly=!!this.options.nameOnly,"number"==typeof this.options.batchSize&&(this.batchSize=this.options.batchSize)}execute(t,e){if(s(t)<3){let n=this.filter;const r=this.db.s.namespace.db;"string"!=typeof n.name||new RegExp("^"+r+"\\.").test(n.name)||(n=Object.assign({},n),n.name=this.db.s.namespace.withCollection(n.name).toString()),null==n&&(n.name=`/${r}/`),n=n.name?{$and:[{name:n.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const i=function(t){const e=`${t}.`;return{doc:t=>{const n=t.name.indexOf(e);return t.name&&0===n&&(t.name=t.name.substr(n+e.length)),t}}}(r);return void t.query(`${r}.${a.SYSTEM_NAMESPACE_COLLECTION}`,{query:n},{batchSize:this.batchSize||1e3},{},(t,n)=>{n&&n.message&&n.message.documents&&Array.isArray(n.message.documents)&&(n.message.documents=n.message.documents.map(i.doc)),e(t,n)})}const n={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(t,n,e)}}o(c,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),t.exports=c},function(t,e,n){"use strict";const r=n(30);t.exports=class extends r{constructor(t,e,n){super(t,n)}_buildCommand(){return{profile:-1}}execute(t){super.execute((e,n)=>{if(null==e&&1===n.ok){const e=n.was;return 0===e?t(null,"off"):1===e?t(null,"slow_only"):2===e?t(null,"all"):t(new Error("Error: illegal profiling level value "+e),null)}t(null!=e?e:new Error("Error with profile command"),null)})}}},function(t,e,n){"use strict";const r=n(30),i=new Set(["off","slow_only","all"]);t.exports=class extends r{constructor(t,e,n){let r=0;"off"===e?r=0:"slow_only"===e?r=1:"all"===e&&(r=2),super(t,n),this.level=e,this.profile=r}_buildCommand(){return{profile:this.profile}}execute(t){const e=this.level;if(!i.has(e))return t(new Error("Error: illegal profiling level value "+e));super.execute((n,r)=>null==n&&1===r.ok?t(null,e):t(null!=n?n:new Error("Error with profile command"),null))}}},function(t,e,n){"use strict";const r=n(30);t.exports=class extends r{constructor(t,e,n){let r={validate:e};const i=Object.keys(n);for(let t=0;t<i.length;t++)n.hasOwnProperty(i[t])&&"session"!==i[t]&&(r[i[t]]=n[i[t]]);super(t.s.db,n,null,r),this.collectionName}execute(t){const e=this.collectionName;super.execute((n,r)=>null!=n?t(n,null):0===r.ok?t(new Error("Error with validate command"),null):null!=r.result&&r.result.constructor!==String?t(new Error("Error with validation data"),null):null!=r.result&&null!=r.result.match(/exception|corrupt/)?t(new Error("Error: invalid collection "+e),null):null==r.valid||r.valid?t(null,r):t(new Error("Error: invalid collection "+e),null))}}},function(t,e,n){"use strict";const r=n(61),i=n(4).Aspect,o=n(4).defineAspects,s=n(0).MongoDBNamespace;class a extends r{constructor(t,e){super(t,e),this.ns=new s("admin","$cmd")}execute(t,e){const n={listDatabases:1};this.options.nameOnly&&(n.nameOnly=Number(n.nameOnly)),this.options.filter&&(n.filter=this.options.filter),"boolean"==typeof this.options.authorizedDatabases&&(n.authorizedDatabases=this.options.authorizedDatabases),super.executeCommand(t,n,e)}}o(a,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),t.exports=a},function(t,e,n){"use strict";const r=n(30),i=n(0).handleCallback;t.exports=class extends r{constructor(t,e){super(t.s.db,e,t)}_buildCommand(){return{reIndex:this.collection.collectionName}}execute(t){super.execute((e,n)=>{if(null!=t)return e?i(t,e,null):void i(t,null,!!n.ok)})}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).updateDocuments;t.exports=class extends r{constructor(t,e,n,r){super(r),this.collection=t,this.filter=e,this.doc=n}execute(t){const e=this.collection,n=this.filter,r=this.doc,o=this.options;o.multi=!1,i(e,n,r,o,(e,n)=>function(t,e,n,r){if(null==r)return;if(t&&r)return r(t);if(null==e)return r(null,{result:{ok:1}});e.modifiedCount=null!=e.result.nModified?e.result.nModified:e.result.n,e.upsertedId=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?e.result.upserted[0]:null,e.upsertedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length?e.result.upserted.length:0,e.matchedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?0:e.result.n,e.ops=[n],r&&r(null,e)}(e,n,r,t))}}},function(t,e,n){"use strict";const r=n(4).Aspect,i=n(30);class o extends i{constructor(t,e){super(t.s.db,e,t)}_buildCommand(){const t=this.collection,e=this.options,n={collStats:t.collectionName};return null!=e.scale&&(n.scale=e.scale),n}}(0,n(4).defineAspects)(o,r.READ_OPERATION),t.exports=o},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).updateCallback,o=n(21).updateDocuments;t.exports=class extends r{constructor(t,e,n,r){super(r),this.collection=t,this.filter=e,this.update=n}execute(t){const e=this.collection,n=this.filter,r=this.update,s=this.options;s.multi=!0,o(e,n,r,s,(e,n)=>i(e,n,t))}}},function(t,e,n){"use strict";const r=n(4).OperationBase,i=n(21).updateDocuments;t.exports=class extends r{constructor(t,e,n,r){super(r),this.collection=t,this.filter=e,this.update=n}execute(t){const e=this.collection,n=this.filter,r=this.update,o=this.options;o.multi=!1,i(e,n,r,o,(e,n)=>function(t,e,n){if(null==n)return;if(t)return n(t);if(null==e)return n(null,{result:{ok:1}});e.modifiedCount=null!=e.result.nModified?e.result.nModified:e.result.n,e.upsertedId=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?e.result.upserted[0]:null,e.upsertedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length?e.result.upserted.length:0,e.matchedCount=Array.isArray(e.result.upserted)&&e.result.upserted.length>0?0:e.result.n,n(null,e)}(e,n,t))}}},function(t,e,n){"use strict";const r=n(3).ReadPreference,i=n(151),o=n(6).format,s=n(3).Logger,a=n(125),c=n(58);function u(t,e){let n=/^.*?\./,r=`.${t.replace(n,"")}`,i=`.${e.replace(n,"")}`;return!!r.endsWith(i)}function l(t,e,n){let a,u;try{a=function(t,e){let n="",a="",u="",l="admin",h=i.parse(t,!0);if((null==h.hostname||""===h.hostname)&&-1===t.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===h.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(h.port,10))&&parseInt(h.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(h.path&&h.path.length>0&&"/"!==h.path[0]&&-1===t.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(h.query)for(let t in h.query){if(-1!==t.indexOf("::"))throw new Error("Double colon in host identifier");if(""===h.query[t])throw new Error("Query parameter "+t+" is an incomplete value pair")}if(h.auth){let e=h.auth.split(":");if(-1!==t.indexOf(h.auth)&&e.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==t.indexOf(h.auth)&&-1!==h.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let f=t.split("?").shift().split(","),p=[];for(let t=0;t<f.length;t++){let e=f[t];-1!==e.indexOf("mongodb")?-1!==e.indexOf("@")?p.push(e.split("@").pop()):p.push(e.substr("mongodb://".length)):-1!==e.indexOf("/")?p.push(e.split("/").shift()):-1===e.indexOf("/")&&p.push(e.trim())}for(let t=0;t<p.length;t++){let e=i.parse(o("mongodb://%s",p[t].trim()));if((!e.path||-1===e.path.indexOf(".sock"))&&(e.path&&-1!==e.path.indexOf(":")))throw e.path.split("/").length>1&&-1===e.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==t.indexOf("?")?(u=t.substr(t.indexOf("?")+1),n=t.substring("mongodb://".length,t.indexOf("?"))):n=t.substring("mongodb://".length);-1!==n.indexOf("@")&&(a=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(l=n.split(".sock/")[1],-1!==l.indexOf("/")){if(2===l.split("/").length&&0===l.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}l=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let d,m,y,g,v={},b=a||"",_=b.split(":",2),w=decodeURIComponent(_[0]);if(_[0]!==encodeURIComponent(w))throw new Error("Username contains an illegal unescaped character");if(_[0]=w,_[1]){let t=decodeURIComponent(_[1]);if(_[1]!==encodeURIComponent(t))throw new Error("Password contains an illegal unescaped character");_[1]=t}2===_.length&&(v.auth={user:_[0],password:_[1]});e&&null!=e.auth&&(v.auth=e.auth);let S={socketOptions:{}},O={read_preference_tags:[]},E={socketOptions:{}},T={socketOptions:{}};if(v.server_options=S,v.db_options=O,v.rs_options=E,v.mongos_options=T,t.match(/\.sock/)){let e=t.substring(t.indexOf("mongodb://")+"mongodb://".length,t.lastIndexOf(".sock")+".sock".length);-1!==e.indexOf("@")&&(e=e.split("@")[1]),e=decodeURIComponent(e),y=[{domain_socket:e}]}else{d=n;let t={};y=d.split(",").map((function(e){let n,r,i;if(i=/\[([^\]]+)\](?::(.+))?/.exec(e))n=i[1],r=parseInt(i[2],10)||27017;else{let t=e.split(":",2);n=t[0]||"localhost",r=null!=t[1]?parseInt(t[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return t[n+"_"+r]?null:(t[n+"_"+r]=1,{host:n,port:r})})).filter((function(t){return null!=t}))}v.dbName=l||"admin",m=(u||"").split(/[&;]/),m.forEach((function(t){if(t){var e=t.split("="),n=e[0],i=e[1];switch(n){case"slaveOk":case"slave_ok":S.slave_ok="true"===i,O.slaveOk="true"===i;break;case"maxPoolSize":case"poolSize":S.poolSize=parseInt(i,10),E.poolSize=parseInt(i,10);break;case"appname":v.appname=decodeURIComponent(i);break;case"autoReconnect":case"auto_reconnect":S.auto_reconnect="true"===i;break;case"ssl":if("prefer"===i){S.ssl=i,E.ssl=i,T.ssl=i;break}S.ssl="true"===i,E.ssl="true"===i,T.ssl="true"===i;break;case"sslValidate":S.sslValidate="true"===i,E.sslValidate="true"===i,T.sslValidate="true"===i;break;case"replicaSet":case"rs_name":E.rs_name=i;break;case"reconnectWait":E.reconnectWait=parseInt(i,10);break;case"retries":E.retries=parseInt(i,10);break;case"readSecondary":case"read_secondary":E.read_secondary="true"===i;break;case"fsync":O.fsync="true"===i;break;case"journal":O.j="true"===i;break;case"safe":O.safe="true"===i;break;case"nativeParser":case"native_parser":O.native_parser="true"===i;break;case"readConcernLevel":O.readConcern=new c(i);break;case"connectTimeoutMS":S.socketOptions.connectTimeoutMS=parseInt(i,10),E.socketOptions.connectTimeoutMS=parseInt(i,10),T.socketOptions.connectTimeoutMS=parseInt(i,10);break;case"socketTimeoutMS":S.socketOptions.socketTimeoutMS=parseInt(i,10),E.socketOptions.socketTimeoutMS=parseInt(i,10),T.socketOptions.socketTimeoutMS=parseInt(i,10);break;case"w":O.w=parseInt(i,10),isNaN(O.w)&&(O.w=i);break;case"authSource":O.authSource=i;break;case"gssapiServiceName":O.gssapiServiceName=i;break;case"authMechanism":if("GSSAPI"===i)if(null==v.auth){let t=decodeURIComponent(b);if(-1===t.indexOf("@"))throw new Error("GSSAPI requires a provided principal");v.auth={user:t,password:null}}else v.auth.user=decodeURIComponent(v.auth.user);else"MONGODB-X509"===i&&(v.auth={user:decodeURIComponent(b)});if("GSSAPI"!==i&&"MONGODB-X509"!==i&&"MONGODB-CR"!==i&&"DEFAULT"!==i&&"SCRAM-SHA-1"!==i&&"SCRAM-SHA-256"!==i&&"PLAIN"!==i)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");O.authMechanism=i;break;case"authMechanismProperties":{let t=i.split(","),e={};t.forEach((function(t){let n=t.split(":");e[n[0]]=n[1]})),O.authMechanismProperties=e,"string"==typeof e.SERVICE_NAME&&(O.gssapiServiceName=e.SERVICE_NAME),"string"==typeof e.SERVICE_REALM&&(O.gssapiServiceRealm=e.SERVICE_REALM),"string"==typeof e.CANONICALIZE_HOST_NAME&&(O.gssapiCanonicalizeHostName="true"===e.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":O.wtimeout=parseInt(i,10);break;case"readPreference":if(!r.isValid(i))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");O.readPreference=i;break;case"maxStalenessSeconds":O.maxStalenessSeconds=parseInt(i,10);break;case"readPreferenceTags":{let t={};if(null==(i=decodeURIComponent(i))||""===i){O.read_preference_tags.push(t);break}let e=i.split(/,/);for(let n=0;n<e.length;n++){let r=e[n].trim().split(/:/);t[r[0]]=r[1]}O.read_preference_tags.push(t)}break;case"compressors":{g=S.compression||{};let t=i.split(",");if(!t.every((function(t){return"snappy"===t||"zlib"===t})))throw new Error("Compressors must be at least one of snappy or zlib");g.compressors=t,S.compression=g}break;case"zlibCompressionLevel":{g=S.compression||{};let t=parseInt(i,10);if(t<-1||t>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");g.zlibCompressionLevel=t,S.compression=g}break;case"retryWrites":O.retryWrites="true"===i;break;case"minSize":O.minSize=parseInt(i,10);break;default:s("URL Parser").warn(`${n} is not supported as a connection string option`)}}})),0===O.read_preference_tags.length&&(O.read_preference_tags=null);if(!(-1!==O.w&&0!==O.w||!0!==O.journal&&!0!==O.fsync&&!0!==O.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");O.readPreference||(O.readPreference="primary");return O=Object.assign(O,e),v.servers=y,v}(t,e)}catch(t){u=t}return u?n(u,null):n(null,a)}t.exports=function(t,e,n){let r;"function"==typeof e&&(n=e,e={}),e=e||{};try{r=i.parse(t,!0)}catch(t){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==r.protocol&&"mongodb+srv:"!==r.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===r.protocol)return l(t,e,n);if(r.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(r.domainLength=r.hostname.split(".").length,r.pathname&&r.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(r.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let o=`_mongodb._tcp.${r.host}`;a.resolveSrv(o,(function(t,i){if(t)return n(t);if(0===i.length)return n(new Error("No addresses found at host"));for(let t=0;t<i.length;t++)if(!u(i[t].name,r.hostname,r.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let o=r.auth?`mongodb://${r.auth}@`:"mongodb://",s=i.map((function(t,e){return 0===e?`${o}${t.name}:${t.port}`:`${t.name}:${t.port}`})).join(",")+"/",c=[];if(r.path){let t=r.path.slice(1);-1!==t.indexOf("?")&&(t=t.slice(0,t.indexOf("?"))),s+=t}(e.ssl||r.search)&&(e.ssl||!r.search||r.search.match("ssl"))||c.push("ssl=true"),r.search&&c.push(r.search.replace("?","")),a.resolveTxt(r.host,(function(t,r){if(t&&"ENODATA"!==t.code)return n(t);if(t&&"ENODATA"===t.code&&(r=null),r){if(r.length>1)return n(new Error("Multiple text records not allowed"));if(!(r=(r=r[0]).length>1?r.join(""):r[0]).includes("authSource")&&!r.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));c.push(r)}c.length&&(s+=`?${c.join("&")}`),l(s,e,n)}))}))}},function(t,e,n){"use strict";const r=n(189),i=n(3).BSON.ObjectID,o=n(3).ReadPreference,s=n(29).Buffer,a=n(54),c=n(6).format,u=n(6),l=n(3).MongoError,h=u.inherits,f=n(26).Duplex,p=n(0).shallowClone,d=n(0).executeLegacyOperation,m=n(6).deprecate;const y=m(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var g=function t(e,n,s,a,c){if(y(),!(this instanceof t))return new t(e,n,s,a,c);this.db=e,void 0===c&&(c={}),void 0===a?(a=s,s=void 0):"object"==typeof a&&(c=a,a=s,s=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=s):void 0===s?(this.referenceBy=0,this.filename=n,null!=a.indexOf("w")&&(this.fileId=new i)):(this.referenceBy=1,this.fileId=n,this.filename=s),this.mode=null==a?"r":a,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?t.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||e.options.readPreference||o.primary,this.writeConcern=B(e,this.options),this.internalChunkSize=null==this.options.chunkSize?r.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var u=this.options.promiseLibrary||Promise;this.promiseLibrary=u,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(t){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=t}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};g.prototype.open=function(t,e){if("function"==typeof t&&(e=t,t={}),t=t||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw l.create({message:"Illegal mode "+this.mode,driver:!0});return d(this.db.s.topology,v,[this,t,e],{skipSessions:!0})};var v=function(t,e,n){var r=B(t.db,t.options);"w"===t.mode||"w+"===t.mode?t.collection().ensureIndex([["filename",1]],r,(function(){var e=t.chunkCollection(),i=p(r);i.unique=!0,e.ensureIndex([["files_id",1],["n",1]],i,(function(){I(t,r,(function(e,r){if(e)return n(e);t.isOpen=!0,n(e,r)}))}))})):I(t,r,(function(e,r){if(e)return n(e);t.isOpen=!0,n(e,r)}))};g.prototype.eof=function(){return this.position===this.length},g.prototype.getc=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,b,[this,t,e],{skipSessions:!0})};var b=function(t,e,n){t.eof()?n(null,null):t.currentChunk.eof()?x(t,t.currentChunk.chunkNumber+1,(function(e,r){t.currentChunk=r,t.position=t.position+1,n(e,t.currentChunk.getc())})):(t.position=t.position+1,n(null,t.currentChunk.getc()))};g.prototype.puts=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||{};var r=null==t.match(/\n$/)?t+"\n":t;return d(this.db.s.topology,this.write.bind(this),[r,e,n],{skipSessions:!0})},g.prototype.stream=function(){return new U(this)},g.prototype.write=function(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n=n||{},d(this.db.s.topology,L,[this,t,e,n,r],{skipSessions:!0})},g.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},g.prototype.writeFile=function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},d(this.db.s.topology,_,[this,t,e,n],{skipSessions:!0})};var _=function(t,e,n,i){"string"!=typeof e?t.open((function(t,n){if(t)return i(t,n);a.fstat(e,(function(t,o){if(t)return i(t,n);var c=0,u=0,l=function(){var t=s.alloc(n.chunkSize);a.read(e,t,0,t.length,c,(function(t,s,h){if(t)return i(t,n);c+=s,new r(n,{n:u++},n.writeConcern).write(h.slice(0,s),(function(t,r){if(t)return i(t,n);r.save({},(function(t){return t?i(t,n):(n.position=n.position+s,n.currentChunk=r,c>=o.size?void a.close(e,(function(t){if(t)return i(t);n.close((function(t){return i(t||null,n)}))})):process.nextTick(l))}))}))}))};process.nextTick(l)}))})):a.open(e,"r",(function(e,n){if(e)return i(e);t.writeFile(n,i)}))};g.prototype.close=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,w,[this,t,e],{skipSessions:!0})};var w=function(t,e,n){"w"===t.mode[0]?(e=Object.assign({},t.writeConcern,e),null!=t.currentChunk&&t.currentChunk.position>0?t.currentChunk.save({},(function(r){if(r&&"function"==typeof n)return n(r);t.collection((function(r,i){if(r&&"function"==typeof n)return n(r);null!=t.uploadDate||(t.uploadDate=new Date),k(t,(function(t,r){if(t){if("function"==typeof n)return n(t);throw t}i.save(r,e,(function(t){"function"==typeof n&&n(t,r)}))}))}))})):t.collection((function(r,i){if(r&&"function"==typeof n)return n(r);t.uploadDate=new Date,k(t,(function(t,r){if(t){if("function"==typeof n)return n(t);throw t}i.save(r,e,(function(t){"function"==typeof n&&n(t,r)}))}))}))):"r"===t.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(l.create({message:c("Illegal mode %s",t.mode),driver:!0}))};g.prototype.chunkCollection=function(t){return"function"==typeof t?this.db.collection(this.root+".chunks",t):this.db.collection(this.root+".chunks")},g.prototype.unlink=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,S,[this,t,e],{skipSessions:!0})};var S=function(t,e,n){P(t,(function(e){if(null!==e)return e.message="at deleteChunks: "+e.message,n(e);t.collection((function(e,r){if(null!==e)return e.message="at collection: "+e.message,n(e);r.remove({_id:t.fileId},t.writeConcern,(function(e){n(e,t)}))}))}))};g.prototype.collection=function(t){return"function"==typeof t&&this.db.collection(this.root+".files",t),this.db.collection(this.root+".files")},g.prototype.readlines=function(t,e,n){var r=Array.prototype.slice.call(arguments,0);return n="function"==typeof r[r.length-1]?r.pop():void 0,t=(t=r.length?r.shift():"\n")||"\n",e=r.length?r.shift():{},d(this.db.s.topology,O,[this,t,e,n],{skipSessions:!0})};var O=function(t,e,n,r){t.read((function(t,n){if(t)return r(t);var i=n.toString().split(e);i=i.length>0?i.splice(0,i.length-1):[];for(var o=0;o<i.length;o++)i[o]=i[o]+e;r(null,i)}))};g.prototype.rewind=function(t,e){return"function"==typeof t&&(e=t,t={}),t=t||{},d(this.db.s.topology,E,[this,t,e],{skipSessions:!0})};var E=function(t,e,n){0!==t.currentChunk.chunkNumber?"w"===t.mode[0]?P(t,(function(e){if(e)return n(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.position=0,n(null,t)})):t.currentChunk(0,(function(e,r){if(e)return n(e);t.currentChunk=r,t.currentChunk.rewind(),t.position=0,n(null,t)})):(t.currentChunk.rewind(),t.position=0,n(null,t))};g.prototype.read=function(t,e,n,r){var i=Array.prototype.slice.call(arguments,0);return r="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():null,e=i.length?i.shift():null,n=i.length?i.shift():{},d(this.db.s.topology,T,[this,t,e,n,r],{skipSessions:!0})};var T=function(t,e,n,r,i){var o=null==e?t.length-t.position:e,a=null==n?s.alloc(o):n;if(a._index=null!=n&&null!=n._index?n._index:0,t.currentChunk.length()-t.currentChunk.position+a._index>=o){var c=t.currentChunk.readSlice(o-a._index);return c.copy(a,a._index),t.position=t.position+a.length,0===o&&0===a.length?i(l.create({message:"File does not exist",driver:!0}),null):i(null,a)}(c=t.currentChunk.readSlice(t.currentChunk.length()-t.currentChunk.position)).copy(a,a._index),a._index+=c.length,x(t,t.currentChunk.chunkNumber+1,(function(n,r){if(n)return i(n);r.length()>0?(t.currentChunk=r,t.read(e,a,i)):a._index>0?i(null,a):i(l.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)}))};g.prototype.tell=function(t){var e=this;return"function"==typeof t?t(null,this.position):new e.promiseLibrary((function(t){t(e.position)}))},g.prototype.seek=function(t,e,n,r){var i=Array.prototype.slice.call(arguments,1);return r="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():null,n=i.length?i.shift():{},d(this.db.s.topology,C,[this,t,e,n,r],{skipSessions:!0})};var C=function(t,e,n,r,i){if("r"!==t.mode)return i(l.create({message:"seek is only supported for mode r",driver:!0}));var o=null==n?g.IO_SEEK_SET:n,s=e,a=0;a=o===g.IO_SEEK_CUR?t.position+s:o===g.IO_SEEK_END?t.length+s:s;var c=Math.floor(a/t.chunkSize);x(t,c,(function(e,n){return e?i(e,null):null==n?i(new Error("no chunk found")):(t.currentChunk=n,t.position=a,t.currentChunk.position=t.position%t.chunkSize,void i(e,t))}))},I=function(t,e,n){var o=t.collection(),s=1===t.referenceBy?{_id:t.fileId}:{filename:t.filename};function a(t){a.err||n(a.err=t)}s=null==t.fileId&&null==t.filename?null:s,e.readPreference=t.readPreference,null!=s?o.findOne(s,e,(function(o,s){if(o)return a(o);if(null!=s)t.fileId=s._id,t.filename="r"===t.mode||void 0===t.filename?s.filename:t.filename,t.contentType=s.contentType,t.internalChunkSize=s.chunkSize,t.uploadDate=s.uploadDate,t.aliases=s.aliases,t.length=s.length,t.metadata=s.metadata,t.internalMd5=s.md5;else{if("r"===t.mode){t.length=0;var u="ObjectID"===t.fileId._bsontype?t.fileId.toHexString():t.fileId;return a(l.create({message:c("file with id %s not opened for writing",1===t.referenceBy?u:t.filename),driver:!0}))}t.fileId=null==t.fileId?new i:t.fileId,t.contentType=g.DEFAULT_CONTENT_TYPE,t.internalChunkSize=null==t.internalChunkSize?r.DEFAULT_CHUNK_SIZE:t.internalChunkSize,t.length=0}"r"===t.mode?x(t,0,e,(function(e,r){if(e)return a(e);t.currentChunk=r,t.position=0,n(null,t)})):"w"===t.mode&&s?P(t,e,(function(e){if(e)return a(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)})):"w"===t.mode?(t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)):"w+"===t.mode&&x(t,N(t),e,(function(e,i){if(e)return a(e);t.currentChunk=null==i?new r(t,{n:0},t.writeConcern):i,t.currentChunk.position=t.currentChunk.data.length(),t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=t.length,n(null,t)}))})):(t.fileId=null==t.fileId?new i:t.fileId,t.contentType=g.DEFAULT_CONTENT_TYPE,t.internalChunkSize=null==t.internalChunkSize?r.DEFAULT_CHUNK_SIZE:t.internalChunkSize,t.length=0,"w"===t.mode?P(t,e,(function(e){if(e)return a(e);t.currentChunk=new r(t,{n:0},t.writeConcern),t.contentType=null==t.options.content_type?t.contentType:t.options.content_type,t.internalChunkSize=null==t.options.chunk_size?t.internalChunkSize:t.options.chunk_size,t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=0,n(null,t)})):"w+"===t.mode&&x(t,N(t),e,(function(e,i){if(e)return a(e);t.currentChunk=null==i?new r(t,{n:0},t.writeConcern):i,t.currentChunk.position=t.currentChunk.data.length(),t.metadata=null==t.options.metadata?t.metadata:t.options.metadata,t.aliases=null==t.options.aliases?t.aliases:t.options.aliases,t.position=t.length,n(null,t)})))},A=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var o="boolean"==typeof n&&n;if("w"!==t.mode)i(l.create({message:c("file with id %s not opened for writing",1===t.referenceBy?t.referenceBy:t.filename),driver:!0}),null);else{if(!(t.currentChunk.position+e.length>=t.chunkSize))return t.position=t.position+e.length,t.currentChunk.write(e),o?t.close((function(e){i(e,t)})):i(null,t);for(var s=t.currentChunk.chunkNumber,a=t.chunkSize-t.currentChunk.position,u=e.slice(0,a),h=e.slice(a),f=[t.currentChunk.write(u)];h.length>=t.chunkSize;){var p=new r(t,{n:s+1},t.writeConcern);u=h.slice(0,t.chunkSize),h=h.slice(t.chunkSize),s+=1,p.write(u),f.push(p)}t.currentChunk=new r(t,{n:s+1},t.writeConcern),h.length>0&&t.currentChunk.write(h),t.position=t.position+e.length;for(var d=f.length,m=0;m<f.length;m++)f[m].save({},(function(e){return e?i(e):(d-=1)<=0?o?t.close((function(e){i(e,t)})):i(null,t):void 0}))}},k=function(t,e){var n={_id:t.fileId,filename:t.filename,contentType:t.contentType,length:t.position?t.position:0,chunkSize:t.chunkSize,uploadDate:t.uploadDate,aliases:t.aliases,metadata:t.metadata},r={filemd5:t.fileId,root:t.root};t.db.command(r,(function(t,r){if(t)return e(t);n.md5=r.md5,e(null,n)}))},x=function(t,e,n,i){"function"==typeof n&&(i=n,n={}),(n=n||t.writeConcern).readPreference=t.readPreference,t.chunkCollection().findOne({files_id:t.fileId,n:e},n,(function(e,n){if(e)return i(e);i(null,new r(t,null==n?{}:n,t.writeConcern))}))},N=function(t){return Math.floor((t.length?t.length-1:0)/t.chunkSize)},P=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e||t.writeConcern,null!=t.fileId?t.chunkCollection().remove({files_id:t.fileId},e,(function(t){if(t)return n(t,!1);n(null,!0)})):n(null,!0)};g.DEFAULT_ROOT_COLLECTION="fs",g.DEFAULT_CONTENT_TYPE="binary/octet-stream",g.IO_SEEK_SET=0,g.IO_SEEK_CUR=1,g.IO_SEEK_END=2,g.exist=function(t,e,n,r,i){var o=Array.prototype.slice.call(arguments,2);return i="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length?o.shift():null,r=(r=o.length?o.shift():{})||{},d(t.s.topology,j,[t,e,n,r,i],{skipSessions:!0})};var j=function(t,e,n,r,i){var s=r.readPreference||o.PRIMARY,a=null!=n?n:g.DEFAULT_ROOT_COLLECTION;t.collection(a+".files",(function(t,n){if(t)return i(t);var r="string"==typeof e||"[object RegExp]"===Object.prototype.toString.call(e)?{filename:e}:{_id:e};null!=e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&(r=e),n.findOne(r,{readPreference:s},(function(t,e){if(t)return i(t);i(null,null!=e)}))}))};g.list=function(t,e,n,r){var i=Array.prototype.slice.call(arguments,1);return r="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():null,n=(n=i.length?i.shift():{})||{},d(t.s.topology,R,[t,e,n,r],{skipSessions:!0})};var R=function(t,e,n,r){null!=e&&"object"==typeof e&&(n=e,e=null);var i=n.readPreference||o.primary,s=null!=n.id&&n.id,a=null!=e?e:g.DEFAULT_ROOT_COLLECTION,c=[];t.collection(a+".files",(function(t,e){if(t)return r(t);e.find({},{readPreference:i},(function(t,e){if(t)return r(t);e.each((function(t,e){null!=e?c.push(s?e._id:e.filename):r(t,c)}))}))}))};g.read=function(t,e,n,r,i,o){var s=Array.prototype.slice.call(arguments,2);return o="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,r=s.length?s.shift():null,i=(i=s.length?s.shift():null)||{},d(t.s.topology,M,[t,e,n,r,i,o],{skipSessions:!0})};var M=function(t,e,n,r,i,o){new g(t,e,"r",i).open((function(t,e){return t?o(t):r&&r>=e.length?o("offset larger than size of file",null):n&&n>e.length?o("length is larger than the size of the file",null):r&&n&&r+n>e.length?o("offset and length is larger than the size of the file",null):void(null!=r?e.seek(r,(function(t,e){if(t)return o(t);e.read(n,o)})):e.read(n,o))}))};g.readlines=function(t,e,n,r,i){var o=Array.prototype.slice.call(arguments,2);return i="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length?o.shift():null,r=(r=o.length?o.shift():null)||{},d(t.s.topology,D,[t,e,n,r,i],{skipSessions:!0})};var D=function(t,e,n,r,i){var o=null==n?"\n":n;new g(t,e,"r",r).open((function(t,e){if(t)return i(t);e.readlines(o,i)}))};g.unlink=function(t,e,n,r){var i=Array.prototype.slice.call(arguments,2);return r="function"==typeof i[i.length-1]?i.pop():void 0,n=(n=i.length?i.shift():{})||{},d(t.s.topology,$,[this,t,e,n,r],{skipSessions:!0})};var $=function(t,e,n,r,i){var o=B(e,r);if(n.constructor===Array)for(var s=0,a=0;a<n.length;a++)++s,g.unlink(e,n[a],r,(function(){0==--s&&i(null,t)}));else new g(e,n,"w",r).open((function(e,n){if(e)return i(e);P(n,(function(e){if(e)return i(e);n.collection((function(e,r){if(e)return i(e);r.remove({_id:n.fileId},o,(function(e){i(e,t)}))}))}))}))},L=function(t,e,n,r,i){return s.isBuffer(e)?A(t,e,n,i):A(t,s.from(e,"binary"),n,i)},F=function(t){var e={};return null!=t.w&&(e.w=t.w),!0===t.journal&&(e.j=t.journal),!0===t.j&&(e.j=t.j),!0===t.fsync&&(e.fsync=t.fsync),null!=t.wtimeout&&(e.wtimeout=t.wtimeout),e},B=function(t,e){var n={w:1};if(null!=(e=e||{}).w||"boolean"==typeof e.j||"boolean"==typeof e.journal||"boolean"==typeof e.fsync?n=F(e):null!=e.safe&&"object"==typeof e.safe?n=F(e.safe):"boolean"==typeof e.safe?n={w:e.safe?1:0}:null!=t.options.w||"boolean"==typeof t.options.j||"boolean"==typeof t.options.journal||"boolean"==typeof t.options.fsync?n=F(t.options):!t.safe||null==t.safe.w&&"boolean"!=typeof t.safe.j&&"boolean"!=typeof t.safe.journal&&"boolean"!=typeof t.safe.fsync?"boolean"==typeof t.safe&&(n={w:t.safe?1:0}):n=F(t.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw l.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},U=function(t){f.call(this),this.gs=t,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};h(U,f),U.prototype._pipe=U.prototype.pipe,U.prototype.pipe=function(t){var e=this;return e.gs.isOpen?(e.totalBytesToRead=e.gs.length-e.gs.position,e._pipe.apply(e,[t])):e.gs.open((function(n){if(n)return e.emit("error",n);e.totalBytesToRead=e.gs.length-e.gs.position,e._pipe.apply(e,[t])})),t},U.prototype._read=function(){var t=this,e=function(){t.gs.read(n,(function(e,n){return e&&!t.endCalled?t.emit("error",e):t.endCalled||null==n?t.push(null):(n.length<=t.totalBytesToRead?(t.totalBytesToRead=t.totalBytesToRead-n.length,t.push(n)):n.length>t.totalBytesToRead&&(t.totalBytesToRead=t.totalBytesToRead-n._index,t.push(n.slice(0,n._index))),void(t.totalBytesToRead<=0&&(t.endCalled=!0)))}))},n=t.gs.length<t.gs.chunkSize?t.gs.length-t.seekPosition:t.gs.chunkSize;t.gs.isOpen?e():t.gs.open((function(n){if(t.totalBytesToRead=t.gs.length-t.gs.position,n)return t.emit("error",n);e()}))},U.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},U.prototype.write=function(t){var e=this;return e.endCalled?e.emit("error",l.create({message:"attempting to write to stream after end called",driver:!0})):e.gs.isOpen?(e.gs.write(t,(function(){e.emit("drain")})),!0):(e.gs.open((function(){e.gs.isOpen=!0,e.gs.write(t,(function(){process.nextTick((function(){e.emit("drain")}))}))})),!1)},U.prototype.end=function(t,e,n){var r=this,i=Array.prototype.slice.call(arguments,0);n="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():null,e=i.length?i.shift():null,r.endCalled=!0,t&&r.gs.write(t,(function(){r.gs.close((function(){"function"==typeof n&&n(),r.emit("end")}))})),r.gs.close((function(){"function"==typeof n&&n(),r.emit("end")}))},t.exports=g},function(t,e,n){"use strict";var r=n(13).EventEmitter,i=n(338),o=n(339),s=n(0).shallowClone,a=n(0).toError,c=n(6),u=n(0).executeLegacyOperation,l={bucketName:"fs",chunkSizeBytes:261120};function h(t,e){if(r.apply(this),this.setMaxListeners(0),e&&"object"==typeof e){e=s(e);for(var n=Object.keys(l),i=0;i<n.length;++i)e[n[i]]||(e[n[i]]=l[n[i]])}else e=l;this.s={db:t,options:e,_chunksCollection:t.collection(e.bucketName+".chunks"),_filesCollection:t.collection(e.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:t.s.promiseLibrary||Promise}}function f(t,e,n){t.s._filesCollection.deleteOne({_id:e},(function(r,i){if(r)return n(r);t.s._chunksCollection.deleteMany({files_id:e},(function(t){return t?n(t):i.result.n?void n():n(new Error("FileNotFound: no file with id "+e+" found"))}))}))}function p(t,e,n,r){var i={_id:e},o={$set:{filename:n}};t.s._filesCollection.updateOne(i,o,(function(t,n){return t?r(t):n.result.n?void r():r(a("File with id "+e+" not found"))}))}function d(t,e){t.s._filesCollection.drop((function(n){if(n)return e(n);t.s._chunksCollection.drop((function(t){return t?e(t):e()}))}))}t.exports=h,c.inherits(h,r),h.prototype.openUploadStream=function(t,e){return(e=e?s(e):{}).chunkSizeBytes||(e.chunkSizeBytes=this.s.options.chunkSizeBytes),new o(this,t,e)},h.prototype.openUploadStreamWithId=function(t,e,n){return(n=n?s(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=t,new o(this,e,n)},h.prototype.openDownloadStream=function(t,e){var n={_id:t};return e={start:e&&e.start,end:e&&e.end},new i(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,e)},h.prototype.delete=function(t,e){return u(this.s.db.s.topology,f,[this,t,e],{skipSessions:!0})},h.prototype.find=function(t,e){t=t||{},e=e||{};var n=this.s._filesCollection.find(t);return null!=e.batchSize&&n.batchSize(e.batchSize),null!=e.limit&&n.limit(e.limit),null!=e.maxTimeMS&&n.maxTimeMS(e.maxTimeMS),null!=e.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",e.noCursorTimeout),null!=e.skip&&n.skip(e.skip),null!=e.sort&&n.sort(e.sort),n},h.prototype.openDownloadStreamByName=function(t,e){var n={uploadDate:-1},r=null;e&&null!=e.revision&&(e.revision>=0?(n={uploadDate:1},r=e.revision):r=-e.revision-1);var o={filename:t};return e={sort:n,skip:r,start:e&&e.start,end:e&&e.end},new i(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,o,e)},h.prototype.rename=function(t,e,n){return u(this.s.db.s.topology,p,[this,t,e,n],{skipSessions:!0})},h.prototype.drop=function(t){return u(this.s.db.s.topology,d,[this,t],{skipSessions:!0})},h.prototype.getLogger=function(){return this.s.db.s.logger}},function(t,e,n){"use strict";var r=n(26),i=n(6);function o(t,e,n,i,o){this.s={bytesRead:0,chunks:t,cursor:null,expected:0,files:e,filter:i,init:!1,expectedEnd:0,file:null,options:o,readPreference:n},r.Readable.call(this)}function s(t){if(t.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function a(t,e){t.emit("error",e)}t.exports=o,i.inherits(o,r.Readable),o.prototype._read=function(){var t=this;this.destroyed||function(t,e){if(t.s.file)return e();t.s.init||(!function(t){var e={};t.s.readPreference&&(e.readPreference=t.s.readPreference);t.s.options&&t.s.options.sort&&(e.sort=t.s.options.sort);t.s.options&&t.s.options.skip&&(e.skip=t.s.options.skip);t.s.files.findOne(t.s.filter,e,(function(e,n){if(e)return a(t,e);if(!n){var r=t.s.filter._id?t.s.filter._id.toString():t.s.filter.filename,i=new Error("FileNotFound: file "+r+" was not found");return i.code="ENOENT",a(t,i)}if(n.length<=0)t.push(null);else if(t.destroyed)t.emit("close");else{t.s.bytesToSkip=function(t,e,n){if(n&&null!=n.start){if(n.start>e.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+e.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return t.s.bytesRead=Math.floor(n.start/e.chunkSize)*e.chunkSize,t.s.expected=Math.floor(n.start/e.chunkSize),n.start-t.s.bytesRead}}(t,n,t.s.options);var o={files_id:n._id};if(t.s.options&&null!=t.s.options.start){var s=Math.floor(t.s.options.start/n.chunkSize);s>0&&(o.n={$gte:s})}t.s.cursor=t.s.chunks.find(o).sort({n:1}),t.s.readPreference&&t.s.cursor.setReadPreference(t.s.readPreference),t.s.expectedEnd=Math.ceil(n.length/n.chunkSize),t.s.file=n,t.s.bytesToTrim=function(t,e,n,r){if(r&&null!=r.end){if(r.end>e.length)throw new Error("Stream end ("+r.end+") must not be more than the length of the file ("+e.length+")");if(r.start<0)throw new Error("Stream end ("+r.end+") must not be negative");var i=null!=r.start?Math.floor(r.start/e.chunkSize):0;return n.limit(Math.ceil(r.end/e.chunkSize)-i),t.s.expectedEnd=Math.ceil(r.end/e.chunkSize),Math.ceil(r.end/e.chunkSize)*e.chunkSize-r.end}}(t,n,t.s.cursor,t.s.options),t.emit("file",n)}}))}(t),t.s.init=!0);t.once("file",(function(){e()}))}(t,(function(){!function(t){if(t.destroyed)return;t.s.cursor.next((function(e,n){if(t.destroyed)return;if(e)return a(t,e);if(!n)return t.push(null),void process.nextTick(()=>{t.s.cursor.close((function(e){e?a(t,e):t.emit("close")}))});var r=t.s.file.length-t.s.bytesRead,i=t.s.expected++,o=Math.min(t.s.file.chunkSize,r);if(n.n>i){var s="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+i;return a(t,new Error(s))}if(n.n<i)return s="ExtraChunk: Got unexpected n: "+n.n+", expected: "+i,a(t,new Error(s));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==o)return r<=0?(s="ExtraChunk: Got unexpected n: "+n.n,a(t,new Error(s))):(s="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+o,a(t,new Error(s)));if(t.s.bytesRead+=c.length,0===c.length)return t.push(null);var u=null,l=null;null!=t.s.bytesToSkip&&(u=t.s.bytesToSkip,t.s.bytesToSkip=0);const h=i===t.s.expectedEnd-1,f=t.s.options.end-t.s.bytesToSkip;h&&null!=t.s.bytesToTrim?l=t.s.file.chunkSize-t.s.bytesToTrim:t.s.options.end&&f<n.data.length()&&(l=f),null==u&&null==l||(c=c.slice(u||0,l||c.length)),t.push(c)}))}(t)}))},o.prototype.start=function(t){return s(this),this.s.options.start=t,this},o.prototype.end=function(t){return s(this),this.s.options.end=t,this},o.prototype.abort=function(t){var e=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close((function(n){e.emit("close"),t&&t(n)})):(this.s.init||e.emit("close"),t&&t())}},function(t,e,n){"use strict";var r=n(3),i=n(53),o=n(26),s=n(6),a=n(29).Buffer;function c(t,e,n){if(n=n||{},this.bucket=t,this.chunks=t.s._chunksCollection,this.filename=e,this.files=t.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:r.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=a.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&i.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var o=this;!function(t,e){t.files.findOne({},{_id:1},(function(n,r){return n?e(n):r?e():void t.files.listIndexes().toArray((function(n,r){if(n){if(26===n.code){var i={filename:1,uploadDate:1};return void t.files.createIndex(i,{background:!1},(function(n){if(n)return e(n);h(t,e)}))}return e(n)}var o=!1;if(r.forEach((function(t){2===Object.keys(t.key).length&&1===t.key.filename&&1===t.key.uploadDate&&(o=!0)})),o)h(t,e);else{i={filename:1,uploadDate:1};var s=p(t);s.background=!1,t.files.createIndex(i,s,(function(n){if(n)return e(n);h(t,e)}))}}))}))}(this,(function(){o.bucket.s.checkedIndexes=!0,o.bucket.emit("index")}))}}function u(t,e,n){if(!t.state.errored){if(t.state.errored=!0,n)return n(e);t.emit("error",e)}}function l(t,e,n){return{_id:r.BSON.ObjectId(),files_id:t,n:e,data:n}}function h(t,e){t.chunks.listIndexes().toArray((function(n,r){if(n){if(26===n.code){var i={files_id:1,n:1};return void t.chunks.createIndex(i,{background:!1,unique:!0},(function(t){if(t)return e(t);e()}))}return e(n)}var o=!1;if(r.forEach((function(t){t.key&&(2===Object.keys(t.key).length&&1===t.key.files_id&&1===t.key.n&&(o=!0))})),o)e();else{i={files_id:1,n:1};var s=p(t);s.background=!1,s.unique=!0,t.chunks.createIndex(i,s,(function(t){if(t)return e(t);e()}))}}))}function f(t,e){if(t.done)return!0;if(t.state.streamEnd&&0===t.state.outstandingRequests&&!t.state.errored){t.done=!0;var n=function(t,e,n,r,i,o,s,a){var c={_id:t,length:e,chunkSize:n,uploadDate:new Date,filename:i};r&&(c.md5=r);o&&(c.contentType=o);s&&(c.aliases=s);a&&(c.metadata=a);return c}(t.id,t.length,t.chunkSizeBytes,t.md5&&t.md5.digest("hex"),t.filename,t.options.contentType,t.options.aliases,t.options.metadata);return!y(t,e)&&(t.files.insertOne(n,p(t),(function(r){if(r)return u(t,r,e);t.emit("finish",n)})),!0)}return!1}function p(t){var e={};return t.options.writeConcern&&(e.w=t.options.writeConcern.w,e.wtimeout=t.options.writeConcern.wtimeout,e.j=t.options.writeConcern.j),e}function d(t,e){return t.bucket.s.checkedIndexes?e(!1):(t.bucket.once("index",(function(){e(!0)})),!0)}function m(t,e){if(0===t.pos)return f(t,e);++t.state.outstandingRequests;var n=a.alloc(t.pos);t.bufToStore.copy(n,0,0,t.pos),t.md5&&t.md5.update(n);var r=l(t.id,t.n,n);if(y(t,e))return!1;t.chunks.insertOne(r,p(t),(function(e){if(e)return u(t,e);--t.state.outstandingRequests,f(t)}))}function y(t,e){return!!t.state.aborted&&("function"==typeof e&&e(new Error("this stream has been aborted")),!0)}t.exports=c,s.inherits(c,o.Writable),c.prototype.write=function(t,e,n){var r=this;return d(this,(function(){return function(t,e,n,r){if(y(t,r))return!1;var i=a.isBuffer(e)?e:a.from(e,n);if(t.length+=i.length,t.pos+i.length<t.chunkSizeBytes)return i.copy(t.bufToStore,t.pos),t.pos+=i.length,r&&r(),!0;var o=i.length,s=t.chunkSizeBytes-t.pos,c=Math.min(s,i.length),h=0;for(;o>0;){var d=i.length-o;if(i.copy(t.bufToStore,t.pos,d,d+c),t.pos+=c,0===(s-=c)){t.md5&&t.md5.update(t.bufToStore);var m=l(t.id,t.n,a.from(t.bufToStore));if(++t.state.outstandingRequests,++h,y(t,r))return!1;t.chunks.insertOne(m,p(t),(function(e){if(e)return u(t,e);--t.state.outstandingRequests,--h||(t.emit("drain",m),r&&r(),f(t))})),s=t.chunkSizeBytes,t.pos=0,++t.n}o-=c,c=Math.min(s,o)}return!1}(r,t,e,n)}))},c.prototype.abort=function(t){if(this.state.streamEnd){var e=new Error("Cannot abort a stream that has already completed");return"function"==typeof t?t(e):this.state.promiseLibrary.reject(e)}if(this.state.aborted)return e=new Error("Cannot call abort() on a stream twice"),"function"==typeof t?t(e):this.state.promiseLibrary.reject(e);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},(function(e){"function"==typeof t&&t(e)}))},c.prototype.end=function(t,e,n){var r=this;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),y(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",(function(t){n(null,t)})),t?this.write(t,e,(function(){m(r)})):d(this,(function(){m(r)})))}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=n(40).Decimal128},function(t,e,n){"use strict";
/*!
 * [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) ObjectId
 * @constructor NodeMongoDbObjectId
 * @see ObjectId
 */const r=n(40).ObjectId;
/*!
 * ignore
 */t.exports=r},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(40).ReadPreference;
/*!
 * Converts arguments to ReadPrefs the driver
 * can understand.
 *
 * @param {String|Array} pref
 * @param {Array} [tags]
 */
t.exports=function(t,e){if(Array.isArray(t)&&(e=t[1],t=t[0]),t instanceof r)return t;switch(t){case"p":t="primary";break;case"pp":t="primaryPreferred";break;case"s":t="secondary";break;case"sp":t="secondaryPreferred";break;case"n":t="nearest"}return new r(t,e)}},function(t,e,n){"use strict";
/*!
 * Dependencies
 */const r=n(344).ctor("require","modify","init","default","ignore");t.exports=function(){this.strictMode=void 0,this.selected=void 0,this.shardval=void 0,this.saveError=void 0,this.validationError=void 0,this.adhocPaths=void 0,this.removing=void 0,this.inserting=void 0,this.saving=void 0,this.version=void 0,this.getters={},this._id=void 0,this.populate=void 0,this.populated=void 0,this.wasPopulated=!1,this.scope=void 0,this.activePaths=new r,this.pathsToScopes={},this.cachedRequired={},this.session=null,this.$setCalled=new Set,this.ownerDocument=void 0,this.fullPath=void 0}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(12),i=t.exports=function(){};
/*!
 * StateMachine represents a minimal `interface` for the
 * constructors it builds via StateMachine.ctor(...).
 *
 * @api private
 */
/*!
 * StateMachine.ctor('state1', 'state2', ...)
 * A factory method for subclassing StateMachine.
 * The arguments are a list of states. For each state,
 * the constructor's prototype gets state transition
 * methods named after each state. These transition methods
 * place their path argument into the given state.
 *
 * @param {String} state
 * @param {String} [state]
 * @return {Function} subclass constructor
 * @private
 */
i.ctor=function(){const t=r.args(arguments),e=function(){i.apply(this,arguments),this.paths={},this.states={},this.stateNames=t;let e,n=t.length;for(;n--;)e=t[n],this.states[e]={}};return e.prototype=new i,t.forEach((function(t){e.prototype[t]=function(e){this._changeState(e,t)}})),e},
/*!
 * This function is wrapped by the state change functions:
 *
 * - `require(path)`
 * - `modify(path)`
 * - `init(path)`
 *
 * @api private
 */
i.prototype._changeState=function(t,e){const n=this.states[this.paths[t]];n&&delete n[t],this.paths[t]=e,this.states[e][t]=!0},
/*!
 * ignore
 */
i.prototype.clear=function(t){const e=Object.keys(this.states[t]);let n,r=e.length;for(;r--;)n=e[r],delete this.states[t][n],delete this.paths[n]},
/*!
 * Checks to see if at least one path is in the states passed in via `arguments`
 * e.g., this.some('required', 'inited')
 *
 * @param {String} state that we want to check for.
 * @private
 */
i.prototype.some=function(){const t=this,e=arguments.length?arguments:this.stateNames;return Array.prototype.some.call(e,(function(e){return Object.keys(t.states[e]).length}))},
/*!
 * This function builds the functions that get assigned to `forEach` and `map`,
 * since both of those methods share a lot of the same logic.
 *
 * @param {String} iterMethod is either 'forEach' or 'map'
 * @return {Function}
 * @api private
 */
i.prototype._iter=function(t){return function(){const e=arguments.length;let n=r.args(arguments,0,e-1);const i=arguments[e-1];n.length||(n=this.stateNames);const o=this,s=n.reduce((function(t,e){return t.concat(Object.keys(o.states[e]))}),[]);return s[t]((function(t,e,n){return i(t,e,n)}))}},
/*!
 * Iterates over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @private
 */
i.prototype.forEach=function(){return this.forEach=this._iter("forEach"),this.forEach.apply(this,arguments)},
/*!
 * Maps over the paths that belong to one of the parameter states.
 *
 * The function profile can look like:
 * this.forEach(state1, fn);         // iterates over all paths in state1
 * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2
 * this.forEach(fn);                 // iterates over all paths in all states
 *
 * @param {String} [state]
 * @param {String} [state]
 * @param {Function} callback
 * @return {Array}
 * @private
 */
i.prototype.map=function(){return this.map=this._iter("map"),this.map.apply(this,arguments)}},function(t,e){var n=["__proto__","constructor","prototype"];
/*!
 * Returns the value passed to it.
 */
function r(t){return t}e.get=function(t,n,i,o){var s;"function"==typeof i&&(i.length<2?(o=i,i=void 0):(s=i,i=void 0)),o||(o=r);var a="string"==typeof t?t.split("."):t;if(!Array.isArray(a))throw new TypeError("Invalid `path`. Must be either string or array");for(var c,u=n,l=0;l<a.length;++l){if(c=a[l],Array.isArray(u)&&!/^\d+$/.test(c)){var h=a.slice(l);return[].concat(u).map((function(t){return t?e.get(h,t,i||s,o):o(void 0)}))}if(s)u=s(u,c);else{var f=i&&u[i]?u[i]:u;u=f instanceof Map?f.get(c):f[c]}if(!u)return o(u)}return o(u)},e.has=function(t,e){var n="string"==typeof t?t.split("."):t;if(!Array.isArray(n))throw new TypeError("Invalid `path`. Must be either string or array");for(var r=n.length,i=e,o=0;o<r;++o){if(null==i||"object"!=typeof i||!(n[o]in i))return!1;i=i[n[o]]}return!0},e.unset=function(t,e){var r="string"==typeof t?t.split("."):t;if(!Array.isArray(r))throw new TypeError("Invalid `path`. Must be either string or array");for(var i=r.length,o=e,s=0;s<i;++s){if(null==o||"object"!=typeof o||!(r[s]in o))return!1;if(-1!==n.indexOf(r[s]))return!1;if(s===i-1)return delete o[r[s]],!0;o=o instanceof Map?o.get(r[s]):o[r[s]]}return!0},e.set=function(t,i,o,s,a,c){var u;"function"==typeof s&&(s.length<2?(a=s,s=void 0):(u=s,s=void 0)),a||(a=r);var l="string"==typeof t?t.split("."):t;if(!Array.isArray(l))throw new TypeError("Invalid `path`. Must be either string or array");if(null!=o){for(var h=0;h<l.length;++h)if(-1!==n.indexOf(l[h]))return;for(var f,p=c||/\$/.test(t)&&!1!==c,d=o,m=(h=0,l.length-1);h<m;++h)if("$"!=(f=l[h])){if(Array.isArray(d)&&!/^\d+$/.test(f)){var y=l.slice(h);if(!p&&Array.isArray(i))for(var g=0;g<d.length&&g<i.length;++g)e.set(y,i[g],d[g],s||u,a,p);else for(g=0;g<d.length;++g)e.set(y,i,d[g],s||u,a,p);return}if(u)d=u(d,f);else{var v=s&&d[s]?d[s]:d;d=v instanceof Map?v.get(f):v[f]}if(!d)return}else if(h==m-1)break;if(f=l[m],s&&d[s]&&(d=d[s]),Array.isArray(d)&&!/^\d+$/.test(f))if(!p&&Array.isArray(i))!
/*!
 * Recursively set nested arrays
 */
function t(e,n,r,i,o,s){for(var a,c=0;c<e.length&&c<n.length;++c)a=e[c],Array.isArray(a)&&Array.isArray(n[c])?t(a,n[c],r,i,o,s):a&&(i?i(a,r,s(n[c])):(a[o]&&(a=a[o]),a[r]=s(n[c])))}(d,i,f,u,s,a);else for(g=0;g<d.length;++g)item=d[g],item&&(u?u(item,f,a(i)):(item[s]&&(item=item[s]),item[f]=a(i)));else u?u(d,f,a(i)):d instanceof Map?d.set(f,a(i)):d[f]=a(i)}}},function(t,e,n){"use strict";const r=n(49);t.exports=class{constructor(t){if(this._docs={},null!=t&&(t=r(t),Object.assign(this,t),"object"==typeof t.subPopulate&&(this.populate=t.subPopulate),null!=t.perDocumentLimit&&null!=t.limit))throw new Error("Can not use `limit` and `perDocumentLimit` at the same time. Path: `"+t.path+"`.")}}},function(t,e,n){var r=n(70),i=r.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,e),e.Buffer=s),o(i,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e,n){"undefined"==typeof process||"renderer"===process.type?t.exports=n(349):t.exports=n(351)},function(t,e,n){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=n(196)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(o=i))})),t.splice(o,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())},function(t,e){var n=1e3,r=6e4,i=60*r,o=24*i;function s(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var a,c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(t);if("number"===c&&!1===isNaN(t))return e.long?s(a=t,o,"day")||s(a,i,"hour")||s(a,r,"minute")||s(a,n,"second")||a+" ms":function(t){if(t>=o)return Math.round(t/o)+"d";if(t>=i)return Math.round(t/i)+"h";if(t>=r)return Math.round(t/r)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){var r=n(352),i=n(6);(e=t.exports=n(196)).init=function(t){t.inspectOpts={};for(var n=Object.keys(e.inspectOpts),r=0;r<n.length;r++)t.inspectOpts[n[r]]=e.inspectOpts[n[r]]},e.log=function(){return process.stderr.write(i.format.apply(i,arguments)+"\n")},e.formatArgs=function(t){var n=this.namespace;if(this.useColors){var r=this.color,i="[3"+(r<8?r:"8;5;"+r),o="  "+i+";1m"+n+" [0m";t[0]=o+t[0].split("\n").join("\n"+o),t.push(i+"m+"+e.humanize(this.diff)+"[0m")}else t[0]=(e.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+n+" "+t[0]},e.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},e.load=s,e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):r.isatty(process.stderr.fd)},e.colors=[6,2,3,4,5,1];try{var o=n(353);o&&o.level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}function s(){return process.env.DEBUG}e.inspectOpts=Object.keys(process.env).filter((function(t){return/^debug_/i.test(t)})).reduce((function(t,e){var n=e.substring(6).toLowerCase().replace(/_([a-z])/g,(function(t,e){return e.toUpperCase()})),r=process.env[e];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),t[n]=r,t}),{}),e.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,i.inspect(t,this.inspectOpts).split("\n").map((function(t){return t.trim()})).join(" ")},e.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,i.inspect(t,this.inspectOpts)},e.enable(s())},function(t,e){t.exports=require("tty")},function(t,e,n){"use strict";const r=n(150),i=n(354),{env:o}=process;let s;function a(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(0===s)return 0;if(i("color=16m")||i("color=full")||i("color=truecolor"))return 3;if(i("color=256"))return 2;if(t&&!t.isTTY&&void 0===s)return 0;const e=s||0;if("dumb"===o.TERM)return e;if("win32"===process.platform){const t=r.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in o)||"codeship"===o.CI_NAME?1:e;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){const t=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:e}(t))}i("no-color")||i("no-colors")||i("color=false")||i("color=never")?s=0:(i("color")||i("colors")||i("color=true")||i("color=always"))&&(s=1),"FORCE_COLOR"in o&&(s=!0===o.FORCE_COLOR||"true"===o.FORCE_COLOR?1:!1===o.FORCE_COLOR||"false"===o.FORCE_COLOR?0:0===o.FORCE_COLOR.length?1:Math.min(parseInt(o.FORCE_COLOR,10),3)),t.exports={supportsColor:a,stdout:a(process.stdout),stderr:a(process.stderr)}},function(t,e,n){"use strict";t.exports=(t,e)=>{e=e||process.argv;const n=t.startsWith("-")?"":1===t.length?"-":"--",r=e.indexOf(n+t),i=e.indexOf("--");return-1!==r&&(-1===i||r<i)}},function(t,e,n){"use strict";var r=e;r.distinct=function(t){return t._fields&&Object.keys(t._fields).length>0?"field selection and slice":(Object.keys(r.distinct).every((function(n){return!t.options[n]||(e=n,!1)})),e);var e},r.distinct.select=r.distinct.slice=r.distinct.sort=r.distinct.limit=r.distinct.skip=r.distinct.batchSize=r.distinct.comment=r.distinct.maxScan=r.distinct.snapshot=r.distinct.hint=r.distinct.tailable=!0,r.findOneAndUpdate=r.findOneAndRemove=function(t){var e;return Object.keys(r.findOneAndUpdate).every((function(n){return!t.options[n]||(e=n,!1)})),e},r.findOneAndUpdate.limit=r.findOneAndUpdate.skip=r.findOneAndUpdate.batchSize=r.findOneAndUpdate.maxScan=r.findOneAndUpdate.snapshot=r.findOneAndUpdate.hint=r.findOneAndUpdate.tailable=r.findOneAndUpdate.comment=!0,r.count=function(t){return t._fields&&Object.keys(t._fields).length>0?"field selection and slice":(Object.keys(r.count).every((function(n){return!t.options[n]||(e=n,!1)})),e);var e},r.count.slice=r.count.batchSize=r.count.comment=r.count.maxScan=r.count.snapshot=r.count.tailable=!0},function(t,e,n){"use strict";var r=n(197);if("unknown"==r.type)throw new Error("Unknown environment");t.exports=r.isNode?n(357):(r.isMongo,n(109))},function(t,e,n){"use strict";var r=n(109);function i(t){this.collection=t,this.collectionName=t.collectionName}n(195).inherits(i,r),i.prototype.find=function(t,e,n){this.collection.find(t,e,(function(t,e){if(t)return n(t);try{e.toArray(n)}catch(t){n(t)}}))},i.prototype.findOne=function(t,e,n){this.collection.findOne(t,e,n)},i.prototype.count=function(t,e,n){this.collection.count(t,e,n)},i.prototype.distinct=function(t,e,n,r){this.collection.distinct(t,e,n,r)},i.prototype.update=function(t,e,n,r){this.collection.update(t,e,n,r)},i.prototype.updateMany=function(t,e,n,r){this.collection.updateMany(t,e,n,r)},i.prototype.updateOne=function(t,e,n,r){this.collection.updateOne(t,e,n,r)},i.prototype.replaceOne=function(t,e,n,r){this.collection.replaceOne(t,e,n,r)},i.prototype.deleteOne=function(t,e,n){this.collection.deleteOne(t,e,n)},i.prototype.deleteMany=function(t,e,n){this.collection.deleteMany(t,e,n)},i.prototype.remove=function(t,e,n){this.collection.remove(t,e,n)},i.prototype.findAndModify=function(t,e,n,r){var i=Array.isArray(n.sort)?n.sort:[];this.collection.findAndModify(t,i,e,n,r)},i.prototype.findStream=function(t,e,n){return this.collection.find(t,e).stream(n)},i.prototype.findCursor=function(t,e){return this.collection.find(t,e)},t.exports=i},function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=n(359)();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(t){}return i},t.exports=i},function(t,e,n){"use strict";t.exports=function(){var e=function(){return new p("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},r=function(){return new A.PromiseInspection(this._target())},i=function(t){return A.reject(new p(t))};function o(){}var s,a={},c=n(15);s=c.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null},c.notEnumerableProp(A,"_getDomain",s);var u=n(67),l=n(360),h=new l;u.defineProperty(A,"_async",{value:h});var f=n(43),p=A.TypeError=f.TypeError;A.RangeError=f.RangeError;var d=A.CancellationError=f.CancellationError;A.TimeoutError=f.TimeoutError,A.OperationalError=f.OperationalError,A.RejectionError=f.OperationalError,A.AggregateError=f.AggregateError;var m=function(){},y={},g={},v=n(363)(A,m),b=n(364)(A,m,v,i,o),_=n(365)(A),w=_.create,S=n(366)(A,_),O=(S.CapturedTrace,n(367)(A,v,g)),E=n(198)(g),T=n(199),C=c.errorObj,I=c.tryCatch;function A(t){t!==m&&function(t,e){if(null==t||t.constructor!==A)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new p("expecting a function but got "+c.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function k(t){this.promise._resolveCallback(t)}function x(t){this.promise._rejectCallback(t,!1)}function N(t){var e=new A(m);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return A.prototype.toString=function(){return"[object Promise]"},A.prototype.caught=A.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),o=0;for(n=0;n<e-1;++n){var s=arguments[n];if(!c.isObject(s))return i("Catch statement predicate: expecting an object but got "+c.classString(s));r[o++]=s}return r.length=o,t=arguments[n],this.then(void 0,E(r,t,this))}return this.then(void 0,t)},A.prototype.reflect=function(){return this._then(r,r,void 0,this,void 0)},A.prototype.then=function(t,e){if(S.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+c.classString(t);arguments.length>1&&(n+=", "+c.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},A.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},A.prototype.spread=function(t){return"function"!=typeof t?i("expecting a function but got "+c.classString(t)):this.all()._then(t,void 0,void 0,y,void 0)},A.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},A.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new b(this).promise()},A.prototype.error=function(t){return this.caught(c.originatesFromRejection,t)},A.getNewLibraryCopy=t.exports,A.is=function(t){return t instanceof A},A.fromNode=A.fromCallback=function(t){var e=new A(m);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=I(t)(T(e,n));return r===C&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},A.all=function(t){return new b(t).promise()},A.cast=function(t){var e=v(t);return e instanceof A||((e=new A(m))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},A.resolve=A.fulfilled=A.cast,A.reject=A.rejected=function(t){var e=new A(m);return e._captureStackTrace(),e._rejectCallback(t,!0),e},A.setScheduler=function(t){if("function"!=typeof t)throw new p("expecting a function but got "+c.classString(t));return h.setScheduler(t)},A.prototype._then=function(t,e,n,r,i){var o=void 0!==i,a=o?i:new A(m),u=this._target(),l=u._bitField;o||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var f=s();if(0!=(50397184&l)){var p,y,g=u._settlePromiseCtx;0!=(33554432&l)?(y=u._rejectionHandler0,p=t):0!=(16777216&l)?(y=u._fulfillmentHandler0,p=e,u._unsetRejectionIsUnhandled()):(g=u._settlePromiseLateCancellationObserver,y=new d("late cancellation observer"),u._attachExtraTrace(y),p=e),h.invoke(g,u,{handler:null===f?p:"function"==typeof p&&c.domainBind(f,p),promise:a,receiver:r,value:y})}else u._addCallbacks(t,e,a,r,f);return a},A.prototype._length=function(){return 65535&this._bitField},A.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},A.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},A.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},A.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},A.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},A.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},A.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},A.prototype._isFinal=function(){return(4194304&this._bitField)>0},A.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},A.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},A.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},A.prototype._setAsyncGuaranteed=function(){h.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},A.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==a)return void 0===e&&this._isBound()?this._boundValue():e},A.prototype._promiseAt=function(t){return this[4*t-4+2]},A.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},A.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},A.prototype._boundValue=function(){},A.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=a),this._addCallbacks(e,n,r,i,null)},A.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=a),this._addCallbacks(n,r,i,o,null)},A.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:c.domainBind(i,t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:c.domainBind(i,e));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=null===i?t:c.domainBind(i,t)),"function"==typeof e&&(this[s+1]=null===i?e:c.domainBind(i,e))}return this._setLength(o+1),o},A.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},A.prototype._resolveCallback=function(t,n){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(e(),!1);var r=v(t,this);if(!(r instanceof A))return this._fulfill(t);n&&this._propagateFrom(r,2);var i=r._target();if(i!==this){var o=i._bitField;if(0==(50397184&o)){var s=this._length();s>0&&i._migrateCallback0(this);for(var a=1;a<s;++a)i._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var c=new d("late cancellation observer");i._attachExtraTrace(c),this._reject(c)}}else this._reject(e())}},A.prototype._rejectCallback=function(t,e,n){var r=c.ensureErrorObject(t),i=r===t;if(!i&&!n&&S.warnings()){var o="a promise was rejected with a non-error: "+c.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,!!e&&i),this._reject(t)},A.prototype._resolveFromExecutor=function(t){if(t!==m){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,(function(t){e._resolveCallback(t)}),(function(t){e._rejectCallback(t,n)}));n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)}},A.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),e===y?n&&"number"==typeof n.length?o=I(t).apply(this._boundValue(),n):(o=C).e=new p("cannot .spread() a non-array: "+c.classString(n)):o=I(t).call(e,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===g?r._reject(n):o===C?r._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},A.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},A.prototype._followee=function(){return this._rejectionHandler0},A.prototype._setFollowee=function(t){this._rejectionHandler0=t},A.prototype._settlePromise=function(t,e,n,i){var s=t instanceof A,a=this._bitField,c=0!=(134217728&a);0!=(65536&a)?(s&&t._invokeInternalOnCancel(),n instanceof O&&n.isFinallyHandler()?(n.cancelPromise=t,I(e).call(n,i)===C&&t._reject(C.e)):e===r?t._fulfill(r.call(n)):n instanceof o?n._promiseCancelled(t):s||t instanceof b?t._cancel():n.cancel()):"function"==typeof e?s?(c&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,i,t)):e.call(n,i,t):n instanceof o?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(i,t):n._promiseRejected(i,t)):s&&(c&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(i):t._reject(i))},A.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,i=t.value;"function"==typeof e?n instanceof A?this._settlePromiseFromHandler(e,r,i,n):e.call(r,i,n):n instanceof A&&n._reject(i)},A.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},A.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},A.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},A.prototype._fulfill=function(t){var n=this._bitField;if(!((117506048&n)>>>16)){if(t===this){var r=e();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=t,(65535&n)>0&&(0!=(134217728&n)?this._settlePromises():h.settlePromises(this))}},A.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return h.fatalError(t,c.isNode);(65535&e)>0?h.settlePromises(this):this._ensurePossibleRejectionHandled()}},A.prototype._fulfillPromises=function(t,e){for(var n=1;n<t;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},A.prototype._rejectPromises=function(t,e){for(var n=1;n<t;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},A.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},A.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},A.defer=A.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new A(m),resolve:k,reject:x}},c.notEnumerableProp(A,"_makeSelfResolutionError",e),n(368)(A,m,v,i,S),n(369)(A,m,v,S),n(370)(A,b,i,S),n(371)(A),n(372)(A),n(373)(A,b,v,m,h,s),A.Promise=A,A.version="3.5.1",n(374)(A,b,i,v,m,S),n(375)(A),n(376)(A,i,v,w,m,S),n(377)(A,m,S),n(378)(A,i,m,v,o,S),n(379)(A),n(380)(A,m),n(381)(A,b,v,i),n(382)(A,m,v,i),n(383)(A,b,i,v,m,S),n(384)(A,b,S),n(385)(A,b,i),n(386)(A,m),n(387)(A,m),n(388)(A),c.toFastProperties(A),c.toFastProperties(A.prototype),N({a:1}),N({b:2}),N({c:3}),N(1),N((function(){})),N(void 0),N(!1),N(new A(m)),S.setBounds(l.firstLineError,c.lastLineError),A}},function(t,e,n){"use strict";var r;try{throw new Error}catch(t){r=t}var i=n(361),o=n(362),s=n(15);function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=i}function c(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function u(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function l(t){this._normalQueue._pushOne(t),this._queueTick()}a.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},a.prototype.disableTrampolineIfNecessary=function(){s.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout((function(){t(e)}),0);else try{this._schedule((function(){t(e)}))}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},s.hasDevTools?(a.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?c.call(this,t,e,n):this._schedule((function(){setTimeout((function(){t.call(e,n)}),100)}))},a.prototype.invoke=function(t,e,n){this._trampolineEnabled?u.call(this,t,e,n):this._schedule((function(){t.call(e,n)}))},a.prototype.settlePromises=function(t){this._trampolineEnabled?l.call(this,t):this._schedule((function(){t._settlePromises()}))}):(a.prototype.invokeLater=c,a.prototype.invoke=u,a.prototype.settlePromises=l),a.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},a.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=r},function(t,e,n){"use strict";var r,i=n(15),o=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var s=global.setImmediate,a=process.nextTick;r=i.isRecentNode?function(t){s.call(global,t)}:function(t){a.call(process,t)}}else if("function"==typeof o&&"function"==typeof o.resolve){var c=o.resolve();r=function(t){c.then(t)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var t=document.createElement("div"),e={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver((function(){t.classList.toggle("foo"),n=!1})).observe(r,e);return function(i){var o=new MutationObserver((function(){o.disconnect(),i()}));o.observe(t,e),n||(n=!0,r.classList.toggle("foo"))}}();t.exports=r},function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,n,r,i){for(var o=0;o<i;++o)n[o+r]=t[o+e],t[o+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},t.exports=r},function(t,e,n){"use strict";t.exports=function(t,e){var r=n(15),i=r.errorObj,o=r.isObject;var s={}.hasOwnProperty;return function(n,a){if(o(n)){if(n instanceof t)return n;var c=function(t){try{return function(t){return t.then}(t)}catch(t){return i.e=t,i}}(n);if(c===i){a&&a._pushContext();var u=t.reject(c.e);return a&&a._popContext(),u}if("function"==typeof c){if(function(t){try{return s.call(t,"_promise0")}catch(t){return!1}}(n)){u=new t(e);return n._then(u._fulfill,u._reject,void 0,u,null),u}return function(n,o,s){var a=new t(e),c=a;s&&s._pushContext();a._captureStackTrace(),s&&s._popContext();var u=r.tryCatch(o).call(n,(function(t){if(!a)return;a._resolveCallback(t),a=null}),(function(t){if(!a)return;a._rejectCallback(t,!1,!0),a=null}));!1,a&&u===i&&(a._rejectCallback(u.e,!0,!0),a=null);return c}(n,c,a)}}return n}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o){var s=n(15);s.isArray;function a(n){var r=this._promise=new t(e);n instanceof t&&r._propagateFrom(n,3),r._setOnCancel(this),this._values=n,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(n,o){var a=r(this._values,this._promise);if(a instanceof t){var c=(a=a._target())._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(o));else{var u=i("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(u,!1)}},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var c=r(e[a],i);s=c instanceof t?(c=c._target())._bitField:null,o?null!==s&&c.suppressUnhandledRejections():null!==s?0==(50397184&s)?(c._proxy(this,a),this._values[a]=c):o=0!=(33554432&s)?this._promiseFulfilled(c._value(),a):0!=(16777216&s)?this._promiseRejected(c._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(c,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},function(t,e,n){"use strict";t.exports=function(t){var e=!1,n=[];function r(){this._trace=new r.CapturedTrace(i())}function i(){var t=n.length-1;if(t>=0)return n[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},r.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},r.prototype._popContext=function(){if(void 0!==this._trace){var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},r.CapturedTrace=null,r.create=function(){if(e)return new r},r.deactivateLongStackTraces=function(){},r.activateLongStackTraces=function(){var n=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,c=t.prototype._promiseCreated;r.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=c,e=!1},e=!0,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,t._peekContext=t.prototype._peekContext=i,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},r}},function(t,e,n){"use strict";t.exports=function(t,e){var r,i,o,s=t._getDomain,a=t._async,c=n(43).Warning,u=n(15),l=u.canAttachTrace,h=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,f=/\((?:timers\.js):\d+:\d+\)/,p=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,d=null,m=null,y=!1,g=!(0==u.env("BLUEBIRD_DEBUG")||!u.env("BLUEBIRD_DEBUG")&&"development"!==u.env("NODE_ENV")),v=!(0==u.env("BLUEBIRD_WARNINGS")||!g&&!u.env("BLUEBIRD_WARNINGS")),b=!(0==u.env("BLUEBIRD_LONG_STACK_TRACES")||!g&&!u.env("BLUEBIRD_LONG_STACK_TRACES")),_=0!=u.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(v||!!u.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout((function(){t._notifyUnhandledRejection()}),1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){V("rejectionHandled",r,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),V("unhandledRejection",i,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,n){return L(t,e,n||this)},t.onPossiblyUnhandledRejection=function(t){var e=s();i="function"==typeof t?null===e?t:u.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=s();r="function"==typeof t?null===e?t:u.domainBind(e,t):void 0};var w=function(){};t.longStackTraces=function(){if(a.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!Y.longStackTraces&&W()){var n=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;Y.longStackTraces=!0,w=function(){if(a.haveItemsQueued()&&!Y.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=n,t.prototype._attachExtraTrace=r,e.deactivateLongStackTraces(),a.enableTrampoline(),Y.longStackTraces=!1},t.prototype._captureStackTrace=D,t.prototype._attachExtraTrace=$,e.activateLongStackTraces(),a.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return Y.longStackTraces&&W()};var S=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return u.global.dispatchEvent(t),function(t,e){var n=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!u.global.dispatchEvent(n)}}if("function"==typeof Event){t=new Event("CustomEvent");return u.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,!u.global.dispatchEvent(n)}}return(t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),u.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!u.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),O=u.isNode?function(){return process.emit.apply(process,arguments)}:u.global?function(t){var e="on"+t.toLowerCase(),n=u.global[e];return!!n&&(n.apply(u.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function E(t,e){return{promise:e}}var T={promiseCreated:E,promiseFulfilled:E,promiseRejected:E,promiseResolved:E,promiseCancelled:E,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:E},C=function(t){var e=!1;try{e=O.apply(null,arguments)}catch(t){a.throwLater(t),e=!0}var n=!1;try{n=S(t,T[t].apply(null,arguments))}catch(t){a.throwLater(t),n=!0}return n||e};function I(){return!1}function A(t,e,n){var r=this;try{t(e,n,(function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+u.toString(t));r._attachCancellationCallback(t)}))}catch(t){return t}}function k(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?u.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function x(){return this._onCancelField}function N(t){this._onCancelField=t}function P(){this._cancellationParent=void 0,this._onCancelField=void 0}function j(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&w()),"warnings"in e){var n=e.warnings;Y.warnings=!!n,_=Y.warnings,u.isObject(n)&&"wForgottenReturn"in n&&(_=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!Y.cancellation){if(a.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=P,t.prototype._propagateFrom=j,t.prototype._onCancel=x,t.prototype._setOnCancel=N,t.prototype._attachCancellationCallback=k,t.prototype._execute=A,R=j,Y.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!Y.monitoring?(Y.monitoring=!0,t.prototype._fireEvent=C):!e.monitoring&&Y.monitoring&&(Y.monitoring=!1,t.prototype._fireEvent=I)),t},t.prototype._fireEvent=I,t.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var R=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function M(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function D(){this._trace=new G(this._peekContext())}function $(t,e){if(l(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=B(t);u.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),u.notEnumerableProp(t,"__stackCleaned__",!0)}}}function L(e,n,r){if(Y.warnings){var i,o=new c(e);if(n)r._attachExtraTrace(o);else if(Y.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var s=B(o);o.stack=s.message+"\n"+s.stack.join("\n")}C("warning",o)||U(o,"",!0)}}function F(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||d.test(r),o=i&&z(r);i&&!o&&(y&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function B(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||d.test(r))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:F(e)}}function U(t,e,n){if("undefined"!=typeof console){var r;if(u.isObject(t)){var i=t.stack;r=e+m(i,t)}else r=e+String(t);"function"==typeof o?o(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function V(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){a.throwLater(t)}"unhandledRejection"===t?C(t,n,r)||i||U(n,"Unhandled rejection "):C(t,r)}function q(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():u.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){if(t.length<41)return t;return t.substr(0,38)+"..."}(e)+">, no stack trace)"}function W(){return"function"==typeof Q}var z=function(){return!1},H=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function K(t){var e=t.match(H);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function G(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);Q(this,G),e>32&&this.uncycle()}u.inherits(G,Error),e.CapturedTrace=G,G.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;for(r=(t=this._length=r)-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<t;++r){var s=n[e[r].stack];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var a=r>0?e[r-1]:this;s<t-1?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var c=a._length+1,u=r-2;u>=0;--u)e[u]._length=c,c++;return}}}},G.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=B(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(F(i.stack.split("\n"))),i=i._parent;!function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(a=s;a>=0;--a){var c=r[a];if(e[i]!==c)break;e.pop(),i--}e=r}}(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),u.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),u.notEnumerableProp(t,"__stackCleaned__",!0)}};var Q=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():q(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,d=t,m=e;var n=Error.captureStackTrace;return z=function(t){return h.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return d=/@/,m=e,y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return!("stack"in i)&&r&&"number"==typeof Error.stackTraceLimit?(d=t,m=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6}):(m=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?q(e):e.toString()},null)}();"undefined"!=typeof console&&void 0!==console.warn&&(o=function(t){console.warn(t)},u.isNode&&process.stderr.isTTY?o=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:u.isNode||"string"!=typeof(new Error).stack||(o=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var Y={warnings:v,longStackTraces:!1,cancellation:!1,monitoring:!1};return b&&t.longStackTraces(),{longStackTraces:function(){return Y.longStackTraces},warnings:function(){return Y.warnings},cancellation:function(){return Y.cancellation},monitoring:function(){return Y.monitoring},propagateFromFunction:function(){return R},boundValueFunction:function(){return M},checkForgottenReturns:function(t,e,n,r,i){if(void 0===t&&null!==e&&_){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),c=F(a),u=c.length-1;u>=0;--u){var l=c[u];if(!f.test(l)){var h=l.match(p);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(c.length>0){var d=c[0];for(u=0;u<a.length;++u)if(a[u]===d){u>0&&(s="\n"+a[u-1]);break}}}var m="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(m,!0,e)}},setBounds:function(t,e){if(W()){for(var n,r,i=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,a=-1,c=0;c<i.length;++c){if(u=K(i[c])){n=u.fileName,s=u.line;break}}for(c=0;c<o.length;++c){var u;if(u=K(o[c])){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(z=function(t){if(h.test(t))return!0;var e=K(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:L,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),L(n)},CapturedTrace:G,fireDomEvent:S,fireGlobalEvent:O}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var i=n(15),o=t.CancellationError,s=i.errorObj,a=n(198)(r);function c(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function u(t){this.finallyHandler=t}function l(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function h(){return p.call(this,this.promise._target()._settledValue())}function f(t){if(!l(this,t))return s.e=t,s}function p(n){var i=this.promise,a=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?a.call(i._boundValue()):a.call(i._boundValue(),n);if(c===r)return c;if(void 0!==c){i._setReturnedNonUndefined();var p=e(c,i);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var d=new o("late cancellation observer");return i._attachExtraTrace(d),s.e=d,s}p.isPending()&&p._attachCancellationCallback(new u(this))}return p._then(h,f,void 0,this,void 0)}}}return i.isRejected()?(l(this),s.e=n,s):(l(this),n)}return c.prototype.isFinallyHandler=function(){return 0===this.type},u.prototype._resultCancelled=function(){l(this.finallyHandler)},t.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new c(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,p,p)},t.prototype.tap=function(t){return this._passThrough(t,1,p)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,p);var r,o=new Array(n-1),s=0;for(r=0;r<n-1;++r){var c=arguments[r];if(!i.isObject(c))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+i.classString(c)));o[s++]=c}o.length=s;var u=arguments[r];return this._passThrough(a(o,u,this),1,void 0,p)},c}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o){var s=n(15),a=s.tryCatch;t.method=function(n){if("function"!=typeof n)throw new t.TypeError("expecting a function but got "+s.classString(n));return function(){var r=new t(e);r._captureStackTrace(),r._pushContext();var i=a(n).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(n){if("function"!=typeof n)return i("expecting a function but got "+s.classString(n));var r,c=new t(e);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];r=s.isArray(u)?a(n).apply(l,u):a(n).call(l,u)}else r=a(n)();var h=c._popContext();return o.checkForgottenReturns(r,h,"Promise.try",c),c._resolveFromSyncValue(r),c},t.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e,n){"use strict";t.exports=function(t,e,n,r){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},c=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var u=n(o),l=new t(e);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(u),u instanceof t){var f={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:u};h._then(e,s,void 0,l,f),u._then(a,c,void 0,l,f),l._setOnCancel(u)}else l._resolveCallback(h);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i){var o=n(15),s=o.tryCatch,a=o.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e,n){"use strict";t.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1],r=function(){throw e};return this.caught(t,r)},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];r instanceof t&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},function(t,e,n){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o,s){var a,c=n(15),u=c.canEvaluate,l=c.tryCatch,h=c.errorObj;if(u){for(var f=function(t){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,t))},p=function(t){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,t))},d=function(e){for(var n=new Array(e),r=0;r<n.length;++r)n[r]="this.p"+(r+1);var i=n.join(" = ")+" = null;",s="var promise;\n"+n.map((function(t){return"                                                         \n                promise = "+t+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "})).join("\n"),a=n.join(", "),c="Holder$"+e,u="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return u=u.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,a).replace(/\[TheProperties\]/g,i).replace(/\[CancellationCode\]/g,s),new Function("tryCatch","errorObj","Promise","async",u)(l,h,t,o)},m=[],y=[],g=[],v=0;v<8;++v)m.push(d(v+1)),y.push(f(v+1)),g.push(p(v+1));a=function(t){this._reject(t)}}t.join=function(){var n,o=arguments.length-1;if(o>0&&"function"==typeof arguments[o]&&(n=arguments[o],o<=8&&u)){(O=new t(i))._captureStackTrace();for(var l=m[o-1],h=new l(n),f=y,p=0;p<o;++p){var d=r(arguments[p],O);if(d instanceof t){var v=(d=d._target())._bitField;0==(50397184&v)?(d._then(f[p],a,void 0,O,h),g[p](d,h),h.asyncNeeded=!1):0!=(33554432&v)?f[p].call(O,d._value(),h):0!=(16777216&v)?O._reject(d._reason()):O._cancel()}else f[p].call(O,d,h)}if(!O._isFateSealed()){if(h.asyncNeeded){var b=s();null!==b&&(h.fn=c.domainBind(b,h.fn))}O._setAsyncGuaranteed(),O._setOnCancel(h)}return O}for(var _=arguments.length,w=new Array(_),S=0;S<_;++S)w[S]=arguments[S];n&&w.pop();var O=new e(w).promise();return void 0!==n?O.spread(n):O}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o,s){var a=t._getDomain,c=n(15),u=c.tryCatch,l=c.errorObj,h=t._async;function f(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=a();this._callback=null===i?e:c.domainBind(i,e),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function p(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+c.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+c.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(i.concurrency)));s=i.concurrency}return new f(e,n,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,o).promise()}c.inherits(f,e),f.prototype._asyncInit=function(){this._init$(void 0,-2)},f.prototype._init=function(){},f.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),a=this._preservedValues,c=this._limit;if(n<0){if(r[n=-1*n-1]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=e,this._queue.push(n),!1;null!==a&&(a[n]=e);var h=this._promise,f=this._callback,p=h._boundValue();h._pushContext();var d=u(f).call(p,e,n,o),m=h._popContext();if(s.checkForgottenReturns(d,m,null!==a?"Promise.filter":"Promise.map",h),d===l)return this._reject(d.e),!0;var y=i(d,this._promise);if(y instanceof t){var g=(y=y._target())._bitField;if(0==(50397184&g))return c>=1&&this._inFlight++,r[n]=y,y._proxy(this,-1*(n+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(y._reason()),!0):(this._cancel(),!0);d=y._value()}r[n]=d}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},f.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},f.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;o<n;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},f.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return p(this,t,e,null)},t.map=function(t,e,n,r){return p(t,e,n,r)}}},function(t,e,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){var e,r,s=n(15),a=s.canEvaluate,c=s.isIdentifier,u=function(t){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,t))(f)},l=function(t){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",t))},h=function(t,e,n){var r=n[t];if("function"!=typeof r){if(!c(t))return null;if(r=e(t),n[t]=r,n[" size"]++,n[" size"]>512){for(var i=Object.keys(n),o=0;o<256;++o)delete n[i[o]];n[" size"]=i.length-256}}return r};function f(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+s.classString(e)+" has no method '"+s.toString(n)+"'";throw new t.TypeError(i)}return r}function p(t){return f(t,this.pop()).apply(t,this)}function d(t){return t[this]}function m(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}e=function(t){return h(t,u,i)},r=function(t){return h(t,l,o)},t.prototype.call=function(t){for(var n=arguments.length,r=new Array(Math.max(n-1,0)),i=1;i<n;++i)r[i-1]=arguments[i];if(a){var o=e(t);if(null!==o)return this._then(o,void 0,void 0,r,void 0)}return r.push(t),this._then(p,void 0,void 0,r,void 0)},t.prototype.get=function(t){var e;if("number"==typeof t)e=m;else if(a){var n=r(t);e=null!==n?n:d}else e=d;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o,s){var a=n(15),c=n(43).TypeError,u=n(15).inherits,l=a.errorObj,h=a.tryCatch,f={};function p(t){setTimeout((function(){throw t}),0)}function d(e,n){var i=0,s=e.length,a=new t(o);return function o(){if(i>=s)return a._fulfill();var c=function(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(e[i++]);if(c instanceof t&&c._isDisposable()){try{c=r(c._getDisposer().tryDispose(n),e.promise)}catch(t){return p(t)}if(c instanceof t)return c._then(o,p,null,null,null)}o()}(),a}function m(t,e,n){this._data=t,this._promise=e,this._context=n}function y(t,e,n){this.constructor$(t,e,n)}function g(t){return m.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function v(t){this.length=t,this.promise=null,this[t-1]=null}m.prototype.data=function(){return this._data},m.prototype.promise=function(){return this._promise},m.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():f},m.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==f?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},m.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},u(y,m),y.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},v.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var n=arguments.length;if(n<2)return e("you must pass at least 2 arguments to Promise.using");var i,o=arguments[n-1];if("function"!=typeof o)return e("expecting a function but got "+a.classString(o));var c=!0;2===n&&Array.isArray(arguments[0])?(n=(i=arguments[0]).length,c=!1):(i=arguments,n--);for(var u=new v(n),f=0;f<n;++f){var p=i[f];if(m.isDisposer(p)){var y=p;(p=p.promise())._setDisposable(y)}else{var b=r(p);b instanceof t&&(p=b._then(g,null,null,{resources:u,index:f},void 0))}u[f]=p}var _=new Array(u.length);for(f=0;f<_.length;++f)_[f]=t.resolve(u[f]).reflect();var w=t.all(_).then((function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return l.e=n.error(),l;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}S._pushContext(),o=h(o);var r=c?o.apply(void 0,t):o(t),i=S._popContext();return s.checkForgottenReturns(r,i,"Promise.using",S),r})),S=w.lastly((function(){var e=new t.PromiseInspection(w);return d(u,e)}));return u.promise=S,S._setOnCancel(u),S},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new y(t,this,i());throw new c}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var i=n(15),o=t.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(t){return c(+this).thenReturn(t)},c=t.delay=function(n,i){var o,c;return void 0!==i?(o=t.resolve(i)._then(a,null,null,n,void 0),r.cancellation()&&i instanceof t&&o._setOnCancel(i)):(o=new t(e),c=setTimeout((function(){o._fulfill()}),+n),r.cancellation()&&o._setOnCancel(new s(c)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};t.prototype.delay=function(t){return c(t,this)};function u(t){return clearTimeout(this.handle),t}function l(t){throw clearTimeout(this.handle),t}t.prototype.timeout=function(t,e){var n,a;t=+t;var c=new s(setTimeout((function(){n.isPending()&&function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new o("operation timed out"):new o(e),i.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()}(n,e,a)}),t));return r.cancellation()?(a=this.then(),(n=a._then(u,l,void 0,c,void 0))._setOnCancel(c)):n=this._then(u,l,void 0,c,void 0),n}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o,s){var a=n(43).TypeError,c=n(15),u=c.errorObj,l=c.tryCatch,h=[];function f(e,n,i,o){if(s.cancellation()){var a=new t(r),c=this._finallyPromise=new t(r);this._promise=a.lastly((function(){return c})),a._captureStackTrace(),a._setOnCancel(this)}else{(this._promise=new t(r))._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}c.inherits(f,o),f.prototype._isResolved=function(){return null===this._promise},f.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},f.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=l(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},f.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=l(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=l(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},f.prototype.promise=function(){return this._promise},f.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},f.prototype._continue=function(e){var n=this._promise;if(e===u)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof t||null!==(o=function(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=l(n[o])(e);if(r._popContext(),s===u){r._pushContext();var a=t.reject(u.e);return r._popContext(),a}var c=i(s,r);if(c instanceof t)return c}return null}(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new a("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(t,e){if("function"!=typeof t)throw new a("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=f,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=e,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new a("expecting a function but got "+c.classString(t));h.push(t)},t.spawn=function(n){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new f(n,this),i=r.promise();return r._run(t.spawn),i}}},function(t,e,n){"use strict";t.exports=function(t){var e=n(15),r=t._async,i=e.tryCatch,o=e.errorObj;function s(t,n){if(!e.isArray(t))return a.call(this,t,n);var s=i(n).apply(this._boundValue(),[null].concat(t));s===o&&r.throwLater(s.e)}function a(t,e){var n=this._boundValue(),s=void 0===t?i(e).call(n,null):i(e).call(n,null,t);s===o&&r.throwLater(s.e)}function c(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var s=i(e).call(this._boundValue(),t);s===o&&r.throwLater(s.e)}t.prototype.asCallback=t.prototype.nodeify=function(t,e){if("function"==typeof t){var n=a;void 0!==e&&Object(e).spread&&(n=s),this._then(n,c,void 0,this,t)}return this}}},function(t,e,n){"use strict";t.exports=function(t,e){var r={},i=n(15),o=n(199),s=i.withAppended,a=i.maybeWrapAsError,c=i.canEvaluate,u=n(43).TypeError,l={__isPromisified__:!0},h=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),f=function(t){return i.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function p(t){return!h.test(t)}function d(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function m(t,e,n){var r=i.getDataPropertyOrDefault(t,e+n,l);return!!r&&d(r)}function y(t,e,n,r){for(var o=i.inheritedDataKeys(t),s=[],a=0;a<o.length;++a){var c=o[a],l=t[c],h=r===f||f(c);"function"!=typeof l||d(l)||m(t,c,e)||!r(c,l,t,h)||s.push(c,l)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new u("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(s,e,n),s}var g=c?function(n,c,u,l,h,f){var p=Math.max(0,function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0}(l)-1),d=function(t){for(var e=[t],n=Math.max(0,t-1-3),r=t-1;r>=n;--r)e.push(r);for(r=t+1;r<=3;++r)e.push(r);return e}(p),m="string"==typeof n||c===r;function y(t){var e,n=(e=t,i.filledRange(e,"_arg","")).join(", "),r=t>0?", ":"";return(m?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===c?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",n).replace(", ",r)}var g="string"==typeof n?"this != null ? this['"+n+"'] : fn":"fn",v="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+f+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var t="",e=0;e<d.length;++e)t+="case "+d[e]+":"+y(d[e]);return t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",m?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",g);return v=v.replace("Parameters",function(t){return i.filledRange(Math.max(t,3),"_arg","")}(p)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",v)(t,l,c,s,a,o,i.tryCatch,i.errorObj,i.notEnumerableProp,e)}:function(n,c,u,l,h,f){var p=function(){return this}(),d=n;function m(){var i=c;c===r&&(i=this);var u=new t(e);u._captureStackTrace();var l="string"==typeof d&&this!==p?this[d]:n,h=o(u,f);try{l.apply(i,s(arguments,h))}catch(t){u._rejectCallback(a(t),!0,!0)}return u._isFateSealed()||u._setAsyncGuaranteed(),u}return"string"==typeof d&&(n=l),i.notEnumerableProp(m,"__isPromisified__",!0),m};function v(t,e,n,o,s){for(var a=new RegExp(e.replace(/([$])/,"\\$")+"$"),c=y(t,e,a,n),u=0,l=c.length;u<l;u+=2){var h=c[u],f=c[u+1],p=h+e;if(o===g)t[p]=g(h,r,h,f,e,s);else{var d=o(f,(function(){return g(h,r,h,f,e,s)}));i.notEnumerableProp(d,"__isPromisified__",!0),t[p]=d}}return i.toFastProperties(t),t}t.promisify=function(t,e){if("function"!=typeof t)throw new u("expecting a function but got "+i.classString(t));if(d(t))return t;var n=function(t,e,n){return g(t,e,void 0,t,null,n)}(t,void 0===(e=Object(e)).context?r:e.context,!!e.multiArgs);return i.copyDescriptors(t,n,p),n},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new u("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var o=e.filter;"function"!=typeof o&&(o=f);var s=e.promisifier;if("function"!=typeof s&&(s=g),!i.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=i.inheritedDataKeys(t),c=0;c<a.length;++c){var l=t[a[c]];"constructor"!==a[c]&&i.isClass(l)&&(v(l.prototype,r,o,s,n),v(l,r,o,s,n))}return v(t,r,o,s,n)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i){var o,s=n(15),a=s.isObject,c=n(67);"function"==typeof Map&&(o=Map);var u=function(){var t=0,e=0;function n(n,r){this[t]=n,this[t+e]=r,t++}return function(r){e=r.size,t=0;var i=new Array(2*r.size);return r.forEach(n,i),i}}();function l(t){var e,n=!1;if(void 0!==o&&t instanceof o)e=u(t),n=!0;else{var r=c.keys(t),i=r.length;e=new Array(2*i);for(var s=0;s<i;++s){var a=r[s];e[s]=t[a],e[s+i]=a}}this.constructor$(e),this._isMap=n,this._init$(void 0,n?-6:-3)}function h(e){var n,o=r(e);return a(o)?(n=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new l(o).promise(),o instanceof t&&n._propagateFrom(o,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(l,e),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(t){for(var e=new o,n=t.length/2|0,r=0;r<n;++r){var i=t[n+r],s=t[r];e.set(i,s)}return e}(this._values);else{n={};for(var r=this.length(),i=0,s=this.length();i<s;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return h(this)},t.props=function(t){return h(t)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i){var o=n(15);function s(n,a){var c,u=r(n);if(u instanceof t)return(c=u).then((function(t){return s(t,c)}));if(null===(n=o.asArray(n)))return i("expecting an array or an iterable object but got "+o.classString(n));var l=new t(e);void 0!==a&&l._propagateFrom(a,3);for(var h=l._fulfill,f=l._reject,p=0,d=n.length;p<d;++p){var m=n[p];(void 0!==m||p in n)&&t.cast(m)._then(h,f,void 0,l,null)}return l}t.race=function(t){return s(t,void 0)},t.prototype.race=function(){return s(this,void 0)}}},function(t,e,n){"use strict";t.exports=function(t,e,r,i,o,s){var a=t._getDomain,c=n(15),u=c.tryCatch;function l(e,n,r,i){this.constructor$(e);var s=a();this._fn=null===s?n:c.domainBind(s,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function h(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function f(t,e,n,i){return"function"!=typeof e?r("expecting a function but got "+c.classString(e)):new l(t,e,n,i).promise()}function p(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n,r=this.array,i=r._promise,o=u(r._fn);i._pushContext(),(n=void 0!==r._eachValues?o.call(i._boundValue(),e,this.index,this.length):o.call(i._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=n);var a=i._popContext();return s.checkForgottenReturns(n,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",i),n}c.inherits(l,e),l.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==o&&this._eachValues.push(t)},l.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},l.prototype._iterate=function(e){var n,r;this._values=e;var i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(p,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(h,h,void 0,n,this)},t.prototype.reduce=function(t,e){return f(this,t,e,null)},t.reduce=function(t,e,n,r){return f(t,e,n,r)}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var i=t.PromiseInspection;function o(t){this.constructor$(t)}n(15).inherits(o,e),o.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(t,e){var n=new i;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},o.prototype._promiseRejected=function(t,e){var n=new i;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},t.settle=function(t){return r.deprecated(".settle()",".reflect()"),new o(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,n){"use strict";t.exports=function(t,e,r){var i=n(15),o=n(43).RangeError,s=n(43).AggregateError,a=i.isArray,c={};function u(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new u(t),i=n.promise();return n.setHowMany(e),n.init(),i}i.inherits(u,e),u.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=a(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},u.prototype.init=function(){this._initialized=!0,this._init()},u.prototype.setUnwrap=function(){this._unwrap=!0},u.prototype.howMany=function(){return this._howMany},u.prototype.setHowMany=function(t){this._howMany=t},u.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},u.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},u.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==c&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},u.prototype._fulfilled=function(){return this._totalResolved},u.prototype._rejected=function(){return this._values.length-this.length()},u.prototype._addRejected=function(t){this._values.push(t)},u.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},u.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new o(e)},u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return l(t,e)},t.prototype.some=function(t){return l(this,t)},t._SomePromiseArray=u}},function(t,e,n){"use strict";t.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},function(t,e,n){"use strict";t.exports=function(t,e){var n=t.reduce,r=t.all;function i(){return r(this)}t.prototype.each=function(t){return n(this,t,e,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return n(this,t,e,e)},t.each=function(t,r){return n(t,r,e,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=function(t,r){return n(t,r,e,e)}}},function(t,e,n){"use strict";t.exports=function(t){var e=t._SomePromiseArray;function n(t){var n=new e(t),r=n.promise();return n.setHowMany(1),n.setUnwrap(),n.init(),r}t.any=function(t){return n(t)},t.prototype.any=function(){return n(this)}}},function(t,e,n){"use strict";const r=t.exports={};r.DocumentNotFoundError=null,r.general={},r.general.default="Validator failed for path `{PATH}` with value `{VALUE}`",r.general.required="Path `{PATH}` is required.",r.Number={},r.Number.min="Path `{PATH}` ({VALUE}) is less than minimum allowed value ({MIN}).",r.Number.max="Path `{PATH}` ({VALUE}) is more than maximum allowed value ({MAX}).",r.Number.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.",r.Date={},r.Date.min="Path `{PATH}` ({VALUE}) is before minimum allowed value ({MIN}).",r.Date.max="Path `{PATH}` ({VALUE}) is after maximum allowed value ({MAX}).",r.String={},r.String.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.",r.String.match="Path `{PATH}` is invalid ({VALUE}).",r.String.minlength="Path `{PATH}` (`{VALUE}`) is shorter than the minimum allowed length ({MINLENGTH}).",r.String.maxlength="Path `{PATH}` (`{VALUE}`) is longer than the maximum allowed length ({MAXLENGTH})."},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(17);class i extends r{
/*!
   * MissingSchema Error constructor.
   * @param {String} name
   */
constructor(t){super("Schema hasn't been registered for model \""+t+'".\nUse mongoose.model(name, schema)')}}Object.defineProperty(i.prototype,"name",{value:"MissingSchemaError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";const r=n(68);
/*!
 * ignore
 */t.exports=function(t){var e,n;t.$immutable?(t.$immutableSetter=(e=t.path,n=t.options.immutable,function(t){if(null==this||null==this.$__)return t;if(this.isNew)return t;if(!("function"==typeof n?n.call(this,this):n))return t;const i=this.$__getValue(e);if("throw"===this.$__.strictMode&&t!==i)throw new r(e,"Path `"+e+"` is immutable and strict mode is set to throw.",!0);return i}),t.set(t.$immutableSetter)):t.$immutableSetter&&(t.setters=t.setters.filter(e=>e!==t.$immutableSetter),delete t.$immutableSetter)}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(28);class i extends r{constructor(t){super("Can't validate() the same doc multiple times in parallel. Document: "+t._id)}}Object.defineProperty(i.prototype,"name",{value:"ParallelValidateError"}),
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";const r=n(36);class i{constructor(t){Object.assign(this,t),null!=t&&null!=t.options&&(this.options=Object.assign({},t.options))}}Object.defineProperty(i.prototype,"ref",r),Object.defineProperty(i.prototype,"refPath",r),Object.defineProperty(i.prototype,"localField",r),Object.defineProperty(i.prototype,"foreignField",r),Object.defineProperty(i.prototype,"justOne",r),Object.defineProperty(i.prototype,"count",r),Object.defineProperty(i.prototype,"match",r),Object.defineProperty(i.prototype,"options",r),Object.defineProperty(i.prototype,"skip",r),Object.defineProperty(i.prototype,"limit",r),Object.defineProperty(i.prototype,"perDocumentLimit",r),t.exports=i},function(t,e,n){"use strict";const r=n(11),i=n(64);
/*!
 * Gather all indexes defined in the schema, including single nested,
 * document arrays, and embedded discriminators.
 */
t.exports=function(t){let e=[];const n=new WeakMap,o=t.constructor.indexTypes,s=new Map;return function t(a,c,u){if(n.has(a))return;n.set(a,!0),c=c||"";const l=Object.keys(a.paths);for(const n of l){const l=a.paths[n];if(null!=u&&u.paths[n])continue;if(l.$isMongooseDocumentArray||l.$isSingleNested){if(!0!==r(l,"options.excludeIndexes")&&!0!==r(l,"schemaOptions.excludeIndexes")&&!0!==r(l,"schema.options.excludeIndexes")&&t(l.schema,c+n+"."),null!=l.schema.discriminators){const e=l.schema.discriminators,r=Object.keys(e);for(const i of r)t(e[i],c+n+".",l.schema)}if(l.$isMongooseDocumentArray)continue}const h=l._index||l.caster&&l.caster._index;if(!1!==h&&null!=h){const t={},r=i(h),u=r?h:{},l="string"==typeof h?h:!!r&&h.type;if(l&&-1!==o.indexOf(l))t[c+n]=l;else if(u.text)t[c+n]="text",delete u.text;else{const e=-1===Number(h);t[c+n]=e?-1:1}delete u.type,"background"in u||(u.background=!0),null!=a.options.autoIndex&&(u._autoIndex=a.options.autoIndex);const f=u&&u.name;"string"==typeof f&&s.has(f)?Object.assign(s.get(f),t):(e.push([t,u]),s.set(f,t))}}n.delete(a),c?
/*!
   * Checks for indexes added to subdocs using Schema.index().
   * These indexes need their paths prefixed properly.
   *
   * schema._indexes = [ [indexObj, options], [indexObj, options] ..]
   */
function(t,n){const r=t._indexes,i=r.length;for(let t=0;t<i;++t){const i=r[t][0],o=r[t][1],s=Object.keys(i),a=s.length,c={};for(let t=0;t<a;++t){const e=s[t];c[n+e]=i[e]}const u=Object.assign({},o);if(null!=o&&null!=o.partialFilterExpression){u.partialFilterExpression={};const t=o.partialFilterExpression;for(const e of Object.keys(t))u.partialFilterExpression[n+e]=t[e]}e.push([c,u])}}(a,c):(a._indexes.forEach((function(t){"background"in t[1]||(t[1].background=!0)})),e=e.concat(a._indexes))}(t),e}},function(t,e,n){"use strict";t.exports=function(t,e){t.add(e.tree||{}),t.callQueue=t.callQueue.concat(e.callQueue),t.method(e.methods),t.static(e.statics);for(const n in e.query)t.query[n]=e.query[n];for(const n in e.virtuals)t.virtuals[n]=e.virtuals[n].clone();t.s.hooks.merge(e.s.hooks,!1)}},function(t,e,n){"use strict";const r=n(28),i=n(6);t.exports=function(t,e){if("string"==typeof t)return;if("function"==typeof t)return;throw new r('Invalid ref at path "'+e+'". Got '+i.inspect(t,{depth:0}))}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(25),i=n(17),o=n(398),s=n(213),a=n(12),c=n(8).populateModelSymbol,u=r.CastError;let l;function h(t,e){this.enumValues=[],this.regExp=null,r.call(this,t,e,"String")}
/*!
 * ignore
 */
function f(t){return this.castForQuery(t)}h.schemaName="String",h.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
h.prototype=Object.create(r.prototype),h.prototype.constructor=h,Object.defineProperty(h.prototype,"OptionsConstructor",{configurable:!1,enumerable:!1,writable:!1,value:o}),
/*!
 * ignore
 */
h._cast=s,h.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if(null!=t&&"string"!=typeof t)throw new Error;return t}),this._cast=t),this._cast},h.get=r.get,h.set=r.set,
/*!
 * ignore
 */
h._checkRequired=t=>(t instanceof String||"string"==typeof t)&&t.length,h.checkRequired=r.checkRequired,h.prototype.enum=function(){if(this.enumValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.enumValidator}),this),this.enumValidator=!1),void 0===arguments[0]||!1===arguments[0])return this;let t,e;a.isObject(arguments[0])?(t=arguments[0].values,e=arguments[0].message):(t=arguments,e=i.messages.String.enum);for(const e of t)void 0!==e&&this.enumValues.push(this.cast(e));const n=this.enumValues;return this.enumValidator=function(t){return void 0===t||~n.indexOf(t)},this.validators.push({validator:this.enumValidator,message:e,type:"enum",enumValues:n}),this},h.prototype.lowercase=function(t){return arguments.length>0&&!t?this:this.set((function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toLowerCase():t}))},h.prototype.uppercase=function(t){return arguments.length>0&&!t?this:this.set((function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toUpperCase():t}))},h.prototype.trim=function(t){return arguments.length>0&&!t?this:this.set((function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.trim():t}))},h.prototype.minlength=function(t,e){if(this.minlengthValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.minlengthValidator}),this)),null!=t){let n=e||i.messages.String.minlength;n=n.replace(/{MINLENGTH}/,t),this.validators.push({validator:this.minlengthValidator=function(e){return null===e||e.length>=t},message:n,type:"minlength",minlength:t})}return this},h.prototype.maxlength=function(t,e){if(this.maxlengthValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.maxlengthValidator}),this)),null!=t){let n=e||i.messages.String.maxlength;n=n.replace(/{MAXLENGTH}/,t),this.validators.push({validator:this.maxlengthValidator=function(e){return null===e||e.length<=t},message:n,type:"maxlength",maxlength:t})}return this},h.prototype.match=function(t,e){const n=e||i.messages.String.match;return this.validators.push({validator:function(e){if(!t)return!1;return null==e||""===e||t.test(e)},message:n,type:"regexp",regexp:t}),this},h.prototype.checkRequired=function(t,e){if(r._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():h.checkRequired())(t)},h.prototype.cast=function(t,e,i){if(r._isRef(this,t,e,i)){if(null==t)return t;if(l||(l=n(22)),t instanceof l)return t.$__.wasPopulated=!0,t;if("string"==typeof t)return t;if(Buffer.isBuffer(t)||!a.isObject(t))throw new u("string",t,this.path,null,this);const r=e.$__fullPath(this.path),i=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options[c])(t);return i.$__.wasPopulated=!0,i}const o="function"==typeof this.constructor.cast?this.constructor.cast():h.cast();try{return o(t)}catch(e){throw new u("string",t,this.path,null,this)}};const p=a.options(r.prototype.$conditionalHandlers,{$all:function(t){const e=this;return Array.isArray(t)?t.map((function(t){return e.castForQuery(t)})):[this.castForQuery(t)]},$gt:f,$gte:f,$lt:f,$lte:f,$options:String,$regex:f,$not:f});Object.defineProperty(h.prototype,"$conditionalHandlers",{configurable:!1,enumerable:!1,writable:!1,value:Object.freeze(p)}),h.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(n=this.$conditionalHandlers[t],!n)throw new Error("Can't use "+t+" with String.");return n.call(this,e)}return e=t,"[object RegExp]"===Object.prototype.toString.call(e)?e:this._castForQuery(e)},
/*!
 * Module exports.
 */
t.exports=h},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"enum",o),Object.defineProperty(i.prototype,"match",o),Object.defineProperty(i.prototype,"lowercase",o),Object.defineProperty(i.prototype,"trim",o),Object.defineProperty(i.prototype,"uppercase",o),Object.defineProperty(i.prototype,"minlength",o),Object.defineProperty(i.prototype,"maxlength",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"min",o),Object.defineProperty(i.prototype,"max",o),Object.defineProperty(i.prototype,"enum",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(31),i=n(25),o=n(137),s=n(12);function a(t,e){i.call(this,t,e,"Boolean")}a.schemaName="Boolean",a.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
a.prototype=Object.create(i.prototype),a.prototype.constructor=a,
/*!
 * ignore
 */
a._cast=o,a.set=i.set,a.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if(null!=t&&"boolean"!=typeof t)throw new Error;return t}),this._cast=t),this._cast},
/*!
 * ignore
 */
a._checkRequired=t=>!0===t||!1===t,a.checkRequired=i.checkRequired,a.prototype.checkRequired=function(t){return this.constructor._checkRequired(t)},Object.defineProperty(a,"convertToTrue",{get:()=>o.convertToTrue,set:t=>{o.convertToTrue=t}}),Object.defineProperty(a,"convertToFalse",{get:()=>o.convertToFalse,set:t=>{o.convertToFalse=t}}),a.prototype.cast=function(t){const e="function"==typeof this.constructor.cast?this.constructor.cast():a.cast();try{return e(t)}catch(e){throw new r("Boolean",t,this.path,e,this)}},a.$conditionalHandlers=s.options(i.prototype.$conditionalHandlers,{}),a.prototype.castForQuery=function(t,e){let n;return 2===arguments.length?(n=a.$conditionalHandlers[t],n?n.call(this,e):this._castForQuery(e)):this._castForQuery(t)},a.prototype._castNullish=function(t){if(void 0===t&&null!=this.$$context&&this.$$context._mongooseOptions.omitUndefined)return t;const e="function"==typeof this.constructor.cast?this.constructor.cast():a.cast();return null==e?t:!(e.convertToFalse instanceof Set&&e.convertToFalse.has(t))&&(!!(e.convertToTrue instanceof Set&&e.convertToTrue.has(t))||t)},
/*!
 * Module exports.
 */
t.exports=a},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(141),i=n(31),o=n(13).EventEmitter,s=n(406),a=n(25),c=n(50),u=n(145),l=n(11),h=n(226),f=n(6),p=n(12),d=n(227),m=n(8).arrayPathSymbol,y=n(8).documentArrayParent;let g,v;function b(t,e,n,i){null!=i&&null!=i._id?e=h(e,i):null!=n&&null!=n._id&&(e=h(e,n));const o=_(e,n);o.prototype.$basePath=t,r.call(this,t,o,n),this.schema=e,this.schemaOptions=i||{},this.$isMongooseDocumentArray=!0,this.Constructor=o,o.base=e.base;const s=this.defaultValue;"defaultValue"in this&&void 0===s||this.default((function(){let t=s.call(this);return Array.isArray(t)||(t=[t]),t}));const c=this;this.$embeddedSchemaType=new a(t+".$",{required:l(this,"schemaOptions.required",!1)}),this.$embeddedSchemaType.cast=function(t,e,n){return c.cast(t,e,n)[0]},this.$embeddedSchemaType.$isMongooseDocumentArrayElement=!0,this.$embeddedSchemaType.caster=this.Constructor,this.$embeddedSchemaType.schema=this.schema}
/*!
 * Ignore
 */
function _(t,e,r){function i(){v.apply(this,arguments),this.$session(this.ownerDocument().$session())}v||(v=n(81));const s=null!=r?r.prototype:v.prototype;i.prototype=Object.create(s),i.prototype.$__setSchema(t),i.schema=t,i.prototype.constructor=i,i.$isArraySubdocument=!0,i.events=new o;for(const e in t.methods)i.prototype[e]=t.methods[e];for(const e in t.statics)i[e]=t.statics[e];for(const t in o.prototype)i[t]=o.prototype[t];return i.options=e,i}
/*!
 * Scopes paths selected in a query to this array.
 * Necessary for proper default application of subdocument values.
 *
 * @param {DocumentArrayPath} array - the array to scope `fields` paths
 * @param {Object|undefined} fields - the root fields selected in the query
 * @param {Boolean|undefined} init - if we are being created part of a query result
 */
function w(t,e,n){if(!n||!e)return;const r=t.path+".",i=Object.keys(e);let o=i.length;const s={};let a,c,u;for(;o--;)if(c=i[o],c.startsWith(r)){if(u=c.substring(r.length),"$"===u)continue;u.startsWith("$.")&&(u=u.substr(2)),a||(a=!0),s[u]=e[c]}return a&&s||void 0}
/*!
 * Module exports.
 */b.schemaName="DocumentArray",b.options={castNonArrays:!0},
/*!
 * Inherits from ArrayType.
 */
b.prototype=Object.create(r.prototype),b.prototype.constructor=b,b.prototype.OptionsConstructor=s,b.prototype.discriminator=function(t,e,n){"function"==typeof t&&(t=p.getFunctionName(t));const r=_(e=u(this.casterConstructor,t,e,n),null,this.casterConstructor);r.baseCasterConstructor=this.casterConstructor;try{Object.defineProperty(r,"name",{value:t})}catch(t){}return this.casterConstructor.discriminators[t]=r,this.casterConstructor.discriminators[t]},b.prototype.doValidate=function(t,e,r,i){g||(g=n(52));const o=this;try{a.prototype.doValidate.call(this,t,(function(n){if(n)return n.$isArrayValidatorError=!0,e(n);let s,a=t&&t.length;if(!a)return e();if(i&&i.updateValidator)return e();t.isMongooseDocumentArray||(t=new g(t,o.path,r));function u(t){null!=t&&(s=t,s instanceof c||(s.$isArrayValidatorError=!0)),--a||e(s)}for(let n=0,r=a;n<r;++n){let r=t[n];if(null!=r){if(!(r instanceof v)){const e=d(o.casterConstructor,t[n]);r=t[n]=new e(r,t,void 0,void 0,n)}r.$__validate(u)}else--a||e(s)}}),r)}catch(t){return t.$isArrayValidatorError=!0,e(t)}},b.prototype.doValidateSync=function(t,e){const n=a.prototype.doValidateSync.call(this,t,e);if(null!=n)return n.$isArrayValidatorError=!0,n;const r=t&&t.length;let i=null;if(r){for(let e=0,n=r;e<n;++e){let n=t[e];if(!n)continue;if(!(n instanceof v)){const r=d(this.casterConstructor,t[e]);n=t[e]=new r(n,t,void 0,void 0,e)}const r=n.validateSync();r&&null==i&&(i=r)}return i}},
/*!
 * ignore
 */
b.prototype.getDefault=function(t){let e="function"==typeof this.defaultValue?this.defaultValue.call(t):this.defaultValue;if(null==e)return e;g||(g=n(52)),Array.isArray(e)||(e=[e]),e=new g(e,this.path,t);for(let t=0;t<e.length;++t){const n=new(d(this.casterConstructor,e[t]))({},e,void 0,void 0,t);n.init(e[t]),n.isNew=!0,Object.assign(n.$__.activePaths.default,n.$__.activePaths.init),n.$__.activePaths.init={},e[t]=n}return e},b.prototype.cast=function(t,e,r,o,s){let a,c;g||(g=n(52));const u={transform:!1,virtuals:!1};if(s=s||{},!Array.isArray(t)){if(!r&&!b.options.castNonArrays)throw new i("DocumentArray",f.inspect(t),this.path,null,this);return e&&r&&e.markModified(this.path),this.cast([t],e,r,o,s)}t&&t.isMongooseDocumentArray||s.skipDocumentArrayCast?t&&t.isMongooseDocumentArray&&(t=new g(t,this.path,e)):t=new g(t,this.path,e),null!=s.arrayPath&&(t[m]=s.arrayPath);const l=t.length;for(let n=0;n<l;++n){if(!t[n])continue;const s=d(this.casterConstructor,t[n]);if(!t[n].$__||t[n]instanceof s&&t[n][y]===e||(t[n]=t[n].toObject({transform:!1,virtuals:t[n].schema===s.schema})),t[n]instanceof v)null==t[n].__index&&t[n].$setIndex(n);else if(null!=t[n])if(r)e?a||(a=w(this,e.$__.selected,r)):a=!0,c=new s(null,t,!0,a,n),t[n]=c.init(t[n]);else if(o&&"function"==typeof o.id&&(c=o.id(t[n]._id)),o&&c&&p.deepEqual(c.toObject(u),t[n]))c.set(t[n]),t[n]=c;else try{c=new s(t[n],t,void 0,void 0,n),t[n]=c}catch(e){const r=f.inspect(t[n]);throw new i("embedded",r,t[m],e,this)}}return t},
/*!
 * ignore
 */
b.prototype.clone=function(){const t=Object.assign({},this.options),e=new this.constructor(this.path,this.schema,t,this.schemaOptions);return e.validators=this.validators.slice(),void 0!==this.requiredValidator&&(e.requiredValidator=this.requiredValidator),e.Constructor.discriminators=Object.assign({},this.Constructor.discriminators),e},t.exports=b},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"enum",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";t.exports=function t(e){if(!Array.isArray(e))return{min:0,max:0,containsNonArrayItem:!0};if(0===e.length)return{min:1,max:1,containsNonArrayItem:!1};const n=t(e[0]);for(let r=1;r<e.length;++r){const i=t(e[r]);i.min<n.min&&(n.min=i.min),i.max>n.max&&(n.max=i.max),n.containsNonArrayItem=n.containsNonArrayItem||i.containsNonArrayItem}return n.min=n.min+1,n.max=n.max+1,n}},function(t,e,n){"use strict";const r=n(31),i=n(137),o=n(213);
/*!
 * Casts val to an object suitable for `$text`. Throws an error if the object
 * can't be casted.
 *
 * @param {Any} val value to cast
 * @param {String} [path] path to associate with any errors that occured
 * @return {Object} casted object
 * @see https://docs.mongodb.com/manual/reference/operator/query/text/
 * @api private
 */
t.exports=function(t,e){if(null==t||"object"!=typeof t)throw new r("$text",t,e);return null!=t.$search&&(t.$search=o(t.$search,e+".$search")),null!=t.$language&&(t.$language=o(t.$language,e+".$language")),null!=t.$caseSensitive&&(t.$caseSensitive=i(t.$caseSensitive,e+".$castSensitive")),null!=t.$diacriticSensitive&&(t.$diacriticSensitive=i(t.$diacriticSensitive,e+".$diacriticSensitive")),t}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(22),i=n(13).EventEmitter,o=n(17),s=n(79),a=n(42),c=o.ValidationError,u=n(140),l=n(64);function h(t,e,n,i,c){if(!(this instanceof h))return new h(t,e,n,i,c);if(l(e)&&!e.instanceOfSchema&&(e=new s(e)),e=this.schema||e,!this.schema&&e.options._id&&void 0===(t=t||{})._id&&(t._id=new a),!e)throw new o.MissingSchemaError;this.$__setSchema(e),r.call(this,t,n,i,c),u(this,e,{decorateDoc:!0});for(const t in e.methods)this[t]=e.methods[t];for(const t in e.statics)this[t]=e.statics[t]}
/*!
 * Inherit from the NodeJS document
 */h.prototype=Object.create(r.prototype),h.prototype.constructor=h,
/*!
 * ignore
 */
h.events=new i,
/*!
 * Browser doc exposes the event emitter API
 */
h.$emitter=new i,["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"].forEach((function(t){h[t]=function(){return h.$emitter[t].apply(h.$emitter,arguments)}})),
/*!
 * Module exports.
 */
h.ValidationError=c,t.exports=h},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"excludeIndexes",o),Object.defineProperty(i.prototype,"_id",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(31),i=n(13).EventEmitter,o=n(206),s=n(408),a=n(25),c=n(136),u=n(112).castToNumber,l=n(145),h=n(217),f=n(11),p=n(227),d=n(226),m=n(51).internalToObjectOptions;let y;function g(t,e,n){t=d(t,n),this.caster=v(t),this.caster.path=e,this.caster.prototype.$basePath=e,this.schema=t,this.$isSingleNested=!0,a.call(this,e,n,"Embedded")}
/*!
 * ignore
 */
/*!
 * ignore
 */
function v(t,e){y||(y=n(225));const r=function(t,e,n){const r=this;this.$parent=n,y.apply(this,arguments),this.$session(this.ownerDocument().$session()),n&&(n.on("save",(function(){r.emit("save",r),r.constructor.emit("save",r)})),n.on("isNew",(function(t){r.isNew=t,r.emit("isNew",t),r.constructor.emit("isNew",t)})))},o=null!=e?e.prototype:y.prototype;(r.prototype=Object.create(o)).$__setSchema(t),r.prototype.constructor=r,r.schema=t,r.$isSingleNested=!0,r.events=new i,r.prototype.toBSON=function(){return this.toObject(m)};for(const e in t.methods)r.prototype[e]=t.methods[e];for(const e in t.statics)r[e]=t.statics[e];for(const t in i.prototype)r[t]=i.prototype[t];return r}
/*!
 * Special case for when users use a common location schema to represent
 * locations for use with $geoWithin.
 * https://docs.mongodb.org/manual/reference/operator/query/geoWithin/
 *
 * @param {Object} val
 * @api private
 */t.exports=g,g.prototype=Object.create(a.prototype),g.prototype.constructor=g,g.prototype.OptionsConstructor=s,g.prototype.$conditionalHandlers.$geoWithin=function(t){return{$geometry:this.castForQuery(t.$geometry)}},
/*!
 * ignore
 */
g.prototype.$conditionalHandlers.$near=g.prototype.$conditionalHandlers.$nearSphere=h.cast$near,g.prototype.$conditionalHandlers.$within=g.prototype.$conditionalHandlers.$geoWithin=h.cast$within,g.prototype.$conditionalHandlers.$geoIntersects=h.cast$geoIntersects,g.prototype.$conditionalHandlers.$minDistance=u,g.prototype.$conditionalHandlers.$maxDistance=u,g.prototype.$conditionalHandlers.$exists=c,g.prototype.cast=function(t,e,n,r){if(t&&t.$isSingleNested&&t.parent===e)return t;if(null!=t&&("object"!=typeof t||Array.isArray(t)))throw new o(this.path,t);const i=p(this.caster,t);let s;const a=f(e,"$__.selected",{}),c=this.path,u=Object.keys(a).reduce((t,e)=>(e.startsWith(c+".")&&(t[e.substr(c.length+1)]=a[e]),t),{});return n?(s=new i(void 0,u,e),s.init(t),s):0===Object.keys(t).length?new i({},u,e,void 0,{priorDoc:r}):new i(t,u,e,void 0,{priorDoc:r})},g.prototype.castForQuery=function(t,e,n){let i;if(2===arguments.length){if(i=this.$conditionalHandlers[t],!i)throw new Error("Can't use "+t);return i.call(this,e)}if(null==(e=t))return e;this.options.runSetters&&(e=this._applySetters(e));const o=p(this.caster,e),s=null!=n&&null!=n.strict?n.strict:void 0;try{e=new o(e,s)}catch(t){if(!(t instanceof r))throw new r("Embedded",e,this.path,t,this);throw t}return e},g.prototype.doValidate=function(t,e,n,r){const i=p(this.caster,t);if(r&&r.skipSchemaValidators)return t instanceof i||(t=new i(t,null,n)),t.validate(e);a.prototype.doValidate.call(this,t,(function(n){return n?e(n):t?void t.validate(e):e(null)}),n,r)},g.prototype.doValidateSync=function(t,e,n){if(!n||!n.skipSchemaValidators){const n=a.prototype.doValidateSync.call(this,t,e);if(n)return n}if(t)return t.validateSync()},g.prototype.discriminator=function(t,e,n){return e=l(this.caster,t,e,n),this.caster.discriminators[t]=v(e,this.caster),this.caster.discriminators[t]},
/*!
 * ignore
 */
g.prototype.clone=function(){const t=Object.assign({},this.options),e=new this.constructor(this.schema,this.path,t);return e.validators=this.validators.slice(),void 0!==this.requiredValidator&&(e.requiredValidator=this.requiredValidator),e.caster.discriminators=Object.assign({},this.caster.discriminators),e}},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"_id",o),t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(144),i=n(410),o=n(25),s=n(216),a=n(12),c=n(8).populateModelSymbol,u=r.Binary,l=o.CastError;let h;function f(t,e){o.call(this,t,e,"Buffer")}
/*!
 * ignore
 */
function p(t){return this.castForQuery(t)}f.schemaName="Buffer",f.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
f.prototype=Object.create(o.prototype),f.prototype.constructor=f,f.prototype.OptionsConstructor=i,
/*!
 * ignore
 */
f._checkRequired=t=>!(!t||!t.length),f.set=o.set,f.checkRequired=o.checkRequired,f.prototype.checkRequired=function(t,e){return o._isRef(this,t,e,!0)?!!t:this.constructor._checkRequired(t)},f.prototype.cast=function(t,e,i){let s;if(o._isRef(this,t,e,i)){if(null==t)return t;if(h||(h=n(22)),t instanceof h)return t.$__.wasPopulated=!0,t;if(Buffer.isBuffer(t))return t;if(!a.isObject(t))throw new l("Buffer",t,this.path,null,this);const r=e.$__fullPath(this.path);return s=new((e.ownerDocument?e.ownerDocument():e).populated(r,!0).options[c])(t),s.$__.wasPopulated=!0,s}if(t&&t._id&&(t=t._id),t&&t.isMongooseBuffer)return t;if(Buffer.isBuffer(t))return t&&t.isMongooseBuffer||(t=new r(t,[this.path,e]),null!=this.options.subtype&&(t._subtype=this.options.subtype)),t;if(t instanceof u){if(s=new r(t.value(!0),[this.path,e]),"number"!=typeof t.sub_type)throw new l("Buffer",t,this.path,null,this);return s._subtype=t.sub_type,s}if(null===t)return t;const f=typeof t;if("string"===f||"number"===f||Array.isArray(t)||"object"===f&&"Buffer"===t.type&&Array.isArray(t.data))return"number"===f&&(t=[t]),s=new r(t,[this.path,e]),null!=this.options.subtype&&(s._subtype=this.options.subtype),s;throw new l("Buffer",t,this.path,null,this)},f.prototype.subtype=function(t){return this.options.subtype=t,this},f.prototype.$conditionalHandlers=a.options(o.prototype.$conditionalHandlers,{$bitsAllClear:s,$bitsAnyClear:s,$bitsAllSet:s,$bitsAnySet:s,$gt:p,$gte:p,$lt:p,$lte:p}),f.prototype.castForQuery=function(t,e){let n;if(2===arguments.length){if(n=this.$conditionalHandlers[t],!n)throw new Error("Can't use "+t+" with Buffer.");return n.call(this,e)}e=t;const r=this._castForQuery(e);return r?r.toObject({transform:!1,virtuals:!1}):r},
/*!
 * Module exports.
 */
t.exports=f},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"subtype",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module requirements.
 */const r=n(17),i=n(412),o=n(25),s=n(413),a=n(12),c=o.CastError;function u(t,e){o.call(this,t,e,"Date")}
/*!
 * Date Query casting.
 *
 * @api private
 */
function l(t){return this.cast(t)}u.schemaName="Date",u.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
u.prototype=Object.create(o.prototype),u.prototype.constructor=u,u.prototype.OptionsConstructor=i,
/*!
 * ignore
 */
u._cast=s,u.set=o.set,u.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if(null!=t&&!(t instanceof Date))throw new Error;return t}),this._cast=t),this._cast},u.prototype.expires=function(t){return this._index&&"Object"===this._index.constructor.name||(this._index={}),this._index.expires=t,a.expires(this._index),this},
/*!
 * ignore
 */
u._checkRequired=t=>t instanceof Date,u.checkRequired=o.checkRequired,u.prototype.checkRequired=function(t,e){if(o._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():u.checkRequired())(t)},u.prototype.min=function(t,e){if(this.minValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.minValidator}),this)),t){let n=e||r.messages.Date.min;"string"==typeof n&&(n=n.replace(/{MIN}/,t===Date.now?"Date.now()":t.toString()));const i=this;this.validators.push({validator:this.minValidator=function(e){let n=t;"function"==typeof t&&t!==Date.now&&(n=n.call(this));const r=n===Date.now?n():i.cast(n);return null===e||e.valueOf()>=r.valueOf()},message:n,type:"min",min:t})}return this},u.prototype.max=function(t,e){if(this.maxValidator&&(this.validators=this.validators.filter((function(t){return t.validator!==this.maxValidator}),this)),t){let n=e||r.messages.Date.max;"string"==typeof n&&(n=n.replace(/{MAX}/,t===Date.now?"Date.now()":t.toString()));const i=this;this.validators.push({validator:this.maxValidator=function(e){let n=t;"function"==typeof n&&n!==Date.now&&(n=n.call(this));const r=n===Date.now?n():i.cast(n);return null===e||e.valueOf()<=r.valueOf()},message:n,type:"max",max:t})}return this},u.prototype.cast=function(t){const e="function"==typeof this.constructor.cast?this.constructor.cast():u.cast();try{return e(t)}catch(e){throw new c("date",t,this.path,e,this)}},u.prototype.$conditionalHandlers=a.options(o.prototype.$conditionalHandlers,{$gt:l,$gte:l,$lt:l,$lte:l}),u.prototype.castForQuery=function(t,e){if(2!==arguments.length)return this._castForQuery(t);const n=this.$conditionalHandlers[t];if(!n)throw new Error("Can't use "+t+" with Date.");return n.call(this,e)},
/*!
 * Module exports.
 */
t.exports=u},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"min",o),Object.defineProperty(i.prototype,"max",o),Object.defineProperty(i.prototype,"expires",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";const r=n(66);t.exports=function(t){if(null==t||""===t)return null;if(t instanceof Date)return r.ok(!isNaN(t.valueOf())),t;let e;if(r.ok("boolean"!=typeof t),e=t instanceof Number||"number"==typeof t?new Date(t):"string"==typeof t&&!isNaN(Number(t))&&(Number(t)>=275761||Number(t)<-271820)?new Date(Number(t)):"function"==typeof t.valueOf?new Date(t.valueOf()):new Date(t),!isNaN(e.valueOf()))return e;r.ok(!1)}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(415),i=n(25),o=n(222),s=n(42),a=n(12),c=n(8).populateModelSymbol,u=i.CastError;let l;function h(t,e){const n="string"==typeof t&&24===t.length&&/^[a-f0-9]+$/i.test(t),r=e&&e.suppressWarning;!n&&void 0!==t||r||(console.warn("mongoose: To create a new ObjectId please try `Mongoose.Types.ObjectId` instead of using `Mongoose.Schema.ObjectId`. Set the `suppressWarning` option if you're trying to create a hex char path in your schema."),console.trace()),i.call(this,t,e,"ObjectID")}
/*!
 * ignore
 */
function f(t){return this.cast(t)}
/*!
 * ignore
 */
function p(){return new s}function d(t){if(l||(l=n(22)),this instanceof l){if(void 0===t){const t=new s;return this.$__._id=t,t}this.$__._id=t}return t}
/*!
 * Module exports.
 */h.schemaName="ObjectId",h.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
h.prototype=Object.create(i.prototype),h.prototype.constructor=h,h.prototype.OptionsConstructor=r,h.get=i.get,h.set=i.set,h.prototype.auto=function(t){return t&&(this.default(p),this.set(d)),this},
/*!
 * ignore
 */
h._checkRequired=t=>t instanceof s
/*!
 * ignore
 */,h._cast=o,h.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if(!(t instanceof s))throw new Error(t+" is not an instance of ObjectId");return t}),this._cast=t),this._cast},h.checkRequired=i.checkRequired,h.prototype.checkRequired=function(t,e){if(i._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():h.checkRequired())(t)},h.prototype.cast=function(t,e,r){if(i._isRef(this,t,e,r)){if(null==t)return t;if(l||(l=n(22)),t instanceof l)return t.$__.wasPopulated=!0,t;if(t instanceof s)return t;if("objectid"===(t.constructor.name||"").toLowerCase())return new s(t.toHexString());if(Buffer.isBuffer(t)||!a.isObject(t))throw new u("ObjectId",t,this.path,null,this);const r=e.$__fullPath(this.path),i=(e.ownerDocument?e.ownerDocument():e).populated(r,!0);let o=t;return e.$__.populated&&e.$__.populated[r]&&e.$__.populated[r].options&&e.$__.populated[r].options.options&&e.$__.populated[r].options.options.lean||(o=new i.options[c](t),o.$__.wasPopulated=!0),o}const o="function"==typeof this.constructor.cast?this.constructor.cast():h.cast();try{return o(t)}catch(e){throw new u("ObjectId",t,this.path,e,this)}},h.prototype.$conditionalHandlers=a.options(i.prototype.$conditionalHandlers,{$gt:f,$gte:f,$lt:f,$lte:f}),p.$runBeforeSetters=!0,t.exports=h},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"auto",o),
/*!
 * ignore
 */
t.exports=i},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(25),i=r.CastError,o=n(63),s=n(417),a=n(12),c=n(8).populateModelSymbol;let u;function l(t,e){r.call(this,t,e,"Decimal128")}
/*!
 * ignore
 */
function h(t){return this.cast(t)}l.schemaName="Decimal128",l.defaultOptions={},
/*!
 * Inherits from SchemaType.
 */
l.prototype=Object.create(r.prototype),l.prototype.constructor=l,
/*!
 * ignore
 */
l._cast=s,l.set=r.set,l.cast=function(t){return 0===arguments.length||(!1===t&&(t=t=>{if(null!=t&&!(t instanceof o))throw new Error;return t}),this._cast=t),this._cast},
/*!
 * ignore
 */
l._checkRequired=t=>t instanceof o,l.checkRequired=r.checkRequired,l.prototype.checkRequired=function(t,e){if(r._isRef(this,t,e,!0))return!!t;return("function"==typeof this.constructor.checkRequired?this.constructor.checkRequired():l.checkRequired())(t)},l.prototype.cast=function(t,e,s){if(r._isRef(this,t,e,s)){if(null==t)return t;if(u||(u=n(22)),t instanceof u)return t.$__.wasPopulated=!0,t;if(t instanceof o)return t;if(Buffer.isBuffer(t)||!a.isObject(t))throw new i("Decimal128",t,this.path,null,this);const r=e.$__fullPath(this.path),s=(e.ownerDocument?e.ownerDocument():e).populated(r,!0);let l=t;return e.$__.populated&&e.$__.populated[r]&&e.$__.populated[r].options&&e.$__.populated[r].options.options&&e.$__.populated[r].options.options.lean||(l=new s.options[c](t),l.$__.wasPopulated=!0),l}const h="function"==typeof this.constructor.cast?this.constructor.cast():l.cast();try{return h(t)}catch(e){throw new i("Decimal128",t,this.path,e,this)}},l.prototype.$conditionalHandlers=a.options(r.prototype.$conditionalHandlers,{$gt:h,$gte:h,$lt:h,$lte:h}),
/*!
 * Module exports.
 */
t.exports=l},function(t,e,n){"use strict";const r=n(63),i=n(66);t.exports=function(t){return null==t?t:"object"==typeof t&&"string"==typeof t.$numberDecimal?r.fromString(t.$numberDecimal):t instanceof r?t:"string"==typeof t?r.fromString(t):Buffer.isBuffer(t)?new r(t):"number"==typeof t?r.fromString(String(t)):"function"==typeof t.valueOf&&"string"==typeof t.valueOf()?r.fromString(t.valueOf()):void i.ok(!1)}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(223),i=n(419),o=n(25);
/*!
 * ignore
 */
class s extends o{constructor(t,e){super(t,e,"Map"),this.$isSchemaMap=!0}set(t,e){return o.set(t,e)}cast(t,e,n){if(t instanceof r)return t;if(n){const n=new r({},this.path,e,this.$__schemaType);if(t instanceof global.Map)for(const r of t.keys())n.$init(r,n.$__schemaType.cast(t.get(r),e,!0));else for(const r of Object.keys(t))n.$init(r,n.$__schemaType.cast(t[r],e,!0));return n}return new r(t,this.path,e,this.$__schemaType)}clone(){const t=super.clone();return null!=this.$__schemaType&&(t.$__schemaType=this.$__schemaType.clone()),t}}s.prototype.OptionsConstructor=i,s.defaultOptions={},t.exports=s},function(t,e,n){"use strict";const r=n(32);class i extends r{}const o=n(36);Object.defineProperty(i.prototype,"of",o),t.exports=i},function(t,e,n){"use strict";const r=n(11);
/*!
 * Like `schema.path()`, except with a document, because impossible to
 * determine path type without knowing the embedded discriminator key.
 */t.exports=function t(e,n,i){const o=(i=i||{}).typeOnly,s=n.split(".");let a=null,c="adhocOrUndefined";for(let n=0;n<s.length;++n){const u=s.slice(0,n+1).join(".");if(a=e.schema.path(u),null!=a){if("Mixed"===a.instance)return o?"real":a;if(c=e.schema.pathType(u),(a.$isSingleNested||a.$isMongooseDocumentArrayElement)&&null!=a.schema.discriminators){const o=a.schema.discriminators,c=e.get(u+"."+r(a,"schema.options.discriminatorKey"));if(null==c||null==o[c])continue;const l=s.slice(n+1).join(".");return t(e.get(u),l,i)}}else c="adhocOrUndefined"}return o?c:a}},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * Returns this documents _id cast to a string.
 */
function r(){return null!=this._id?String(this._id):null}t.exports=function(t){!t.paths.id&&!t.options.noVirtualId&&t.options.id&&t.virtual("id").get(r)}},function(t,e,n){"use strict";const r=n(83);
/*!
 * ignore
 */t.exports=function(t){const e=Object.keys(t);let n=e.length,i=null;if(1===n&&"_id"===e[0])i=!!t[e[n]];else for(;n--;)if("_id"!==e[n]&&r(t[e[n]])){i=!t[e[n]];break}return i}},function(t,e,n){"use strict";t.exports=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}},function(t,e,n){"use strict";
/*!
 * Valid mongoose options
 */const r=Object.freeze(["applyPluginsToChildSchemas","applyPluginsToDiscriminators","autoIndex","bufferCommands","cloneSchemas","debug","maxTimeMS","objectIdGetter","runValidators","selectPopulatedPaths","strict","toJSON","toObject","useCreateIndex","useFindAndModify","useNewUrlParser","usePushEach","useUnifiedTopology","typePojoToMixed"]);t.exports=r},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(26).Readable,i=n(24),o=n(228),s=n(113);function a(t,e){r.call(this,{objectMode:!0}),this.cursor=null,this.query=t;const n=this,i=t.model;this._mongooseOptions={},this._transforms=[],this.model=i,this.options=e||{},i.hooks.execPre("find",t,()=>{this._transforms=this._transforms.concat(t._transforms.slice()),this.options.transform&&this._transforms.push(e.transform),this.options.batchSize&&(this.options.cursor=e.cursor||{},this.options.cursor.batchSize=e.batchSize),i.collection.find(t._conditions,this.options,(function(t,e){if(n._error&&(e.close((function(){})),n.listeners("error").length>0&&n.emit("error",n._error)),t)return n.emit("error",t);n.cursor=e,n.emit("cursor",e)}))})}
/*!
 * Get the next doc from the underlying cursor and mongooseify it
 * (populate, etc.)
 */
function c(t,e){let n=e;return t._transforms.length&&(n=function(n,r){if(n||null===r&&!t._mongooseOptions.transformNull)return e(n,r);e(n,t._transforms.reduce((function(e,n){return n.call(t,e)}),r))}),t._error?process.nextTick((function(){n(t._error)})):t.cursor?t.cursor.next((function(e,r){if(e)return n(e);if(!r)return n(null,null);const i=t.query._mongooseOptions;if(!i.populate)return i.lean?n(null,r):u(t,r,null,n);const o=s.preparePopulationOptionsMQ(t.query,t.query._mongooseOptions);o.__noPromise=!0,t.query.model.populate(r,o,(function(e,r){return e?n(e):i.lean?n(null,r):u(t,r,o,n)}))})):void t.once("cursor",(function(){c(t,e)}))}
/*!
 * ignore
 */
/*!
 * Convert a raw doc into a full mongoose doc.
 */
function u(t,e,n,r){const i=s.createModel(t.query.model,e,t.query._fields),o=n?{populated:n}:void 0;i.init(e,o,(function(t){if(t)return r(t);r(null,i)}))}n(6).inherits(a,r),
/*!
 * Necessary to satisfy the Readable API
 */
a.prototype._read=function(){const t=this;c(this,(function(e,n){return e?t.emit("error",e):n?void t.push(n):(t.push(null),void t.cursor.close((function(e){if(e)return t.emit("error",e);setTimeout((function(){!t.destroyed&&t.emit("close")}),0)})))}))},a.prototype.map=function(t){return this._transforms.push(t),this},
/*!
 * Marks this cursor as errored
 */
a.prototype._markError=function(t){return this._error=t,this},a.prototype.close=function(t){return i(t,t=>{this.cursor.close(e=>{if(e)return t(e),this.listeners("error").length>0&&this.emit("error",e);this.emit("close"),t(null)})},this.model.events)},a.prototype.next=function(t){return i(t,t=>{c(this,(function(e,n){if(e)return t(e);t(null,n)}))},this.model.events)},a.prototype.eachAsync=function(t,e,n){const r=this;return"function"==typeof e&&(n=e,e={}),o((function(t){return c(r,t)}),t,e=e||{},n)},a.prototype.options,a.prototype.addCursorFlag=function(t,e){const n=this;return function(t,e){if(t.cursor)return e();t.once("cursor",(function(){e()}))}(this,(function(){n.cursor.addCursorFlag(t,e)})),this},
/*!
 * ignore
 */
a.prototype.transformNull=function(t){return 0===arguments.length&&(t=!0),this._mongooseOptions.transformNull=t,this},t.exports=a},function(t,e,n){"use strict";t.exports=function(t,e,n,r,i){const o=Object.keys(t).reduce((t,n)=>t||n.startsWith(e+"."),!1),s=e+"."+n.options.discriminatorKey;o||1!==i.length||i[0]!==s||r.splice(r.indexOf(s),1)}},function(t,e,n){"use strict";const r=n(428),i=n(110),o=n(429),s=n(231);t.exports=function(t){const e=t.options.arrayFilters;if(!Array.isArray(e))return;const n=t.getUpdate(),a=t.schema,c=a.options.strictQuery,u=s(n),l=Object.keys(u).reduce((t,e)=>{const n=e.match(/\$\[[^\]]+\]/g);if(null==n)return t;for(const r of n){const n=e.indexOf(r);if(n!==e.lastIndexOf(r))throw new Error(`Path '${e}' contains the same array filter multiple times`);t[r.substring(2,r.length-1)]=e.substr(0,n-1).replace(/\$\[[^\]]+\]/g,"0")}return t},{});for(const n of e){if(null==n)throw new Error(`Got null array filter in ${e}`);for(const e in n){if(null==n[e])continue;const s=e.indexOf(".");let u=-1===s?l[e]+".0":l[e.substr(0,s)]+".0"+e.substr(s);if(null==u)throw new Error(`Filter path not found for ${e}`);u=i(u);const h=o(a,u);if(null==h){if(!c)return;throw new Error(`Could not find path "${u}" in schema`)}"object"==typeof n[e]?n[e]=r(t,h,n[e]):n[e]=h.castForQuery(n[e])}}}},function(t,e,n){"use strict";const r=n(142);t.exports=function(t,e,n){const i=t;if(!Object.keys(n).some(r))return e.castForQueryWrapper({val:n,context:i});const o=Object.keys(n);let s=o.length;for(;s--;){const t=o[s],a=n[t];if("$not"===t){if(a&&e&&!e.caster){const o=Object.keys(a);if(o.length&&r(o[0]))for(const t in a)a[t]=e.castForQueryWrapper({$conditional:t,val:a[t],context:i});else n[t]=e.castForQueryWrapper({$conditional:t,val:a,context:i});continue}}else n[t]=e.castForQueryWrapper({$conditional:t,val:a,context:i})}return n}},function(t,e,n){"use strict";
/*!
 * Behaves like `Schema#path()`, except for it also digs into arrays without
 * needing to put `.0.`, so `getPath(schema, 'docArr.elProp')` works.
 */t.exports=function(t,e){let n=t.path(e);if(null!=n)return n;const r=e.split(".");let i="",o=!1;for(const e of r)/^\d+$/.test(e)&&o||(i=0===i.length?e:i+"."+e,n=t.path(i),null!=n&&n.schema&&(t=n.schema,i="",n.$isMongooseDocumentArray&&(o=!0)));return n}},function(t,e,n){"use strict";const r=n(110),i=n(11),o=n(39);
/*!
 * Like `schema.path()`, except with a document, because impossible to
 * determine path type without knowing the embedded discriminator key.
 */
t.exports=function(t,e,n,s){const a=s.split(".");let c=null,u="adhocOrUndefined";n=n||{},e=e||{};for(let s=0;s<a.length;++s){const l=r(a.slice(0,s+1).join("."));if(c=t.path(l),null!=c&&(u=t.pathType(l),(c.$isSingleNested||c.$isMongooseDocumentArrayElement)&&null!=c.schema.discriminators)){const t=i(c,"schema.options.discriminatorKey"),r=l+"."+t,h=r.replace(/\.\d+\./,".");let f=null;r in n&&(f=n[r]),h in n&&(f=n[h]);const p=l.replace(/\.\d+$/,"");if(c.$isMongooseDocumentArrayElement&&null!=i(n[p],"$elemMatch."+t)&&(f=n[p].$elemMatch[t]),r in e&&(f=e[r]),null==f)continue;const d=o(c.caster,f).schema,m=a.slice(s+1).join(".");if(c=d.path(m),null!=c){u=d._getPathType(m);break}}}return{type:u,schematype:c}}},function(t,e,n){"use strict";const r=n(68);t.exports=function(t,e,n,i,o,s){if(null==t||!t.options||!t.options.immutable)return!1;let a=t.options.immutable;if("function"==typeof a&&(a=a.call(s,s)),!a)return!1;if(!1===e)return!1;if("throw"===e)throw new r(null,`Field ${o} is immutable and strict = 'throw'`);return delete n[i],!0}},function(t,e,n){"use strict";const r=n(11);function i(t,e,n,i,o){const s=t.path(n);if(null==s)return;let a=r(s,"options.immutable",null);null!=a&&("function"==typeof a&&(a=a.call(o,o)),a&&(i.$setOnInsert=i.$setOnInsert||{},i.$setOnInsert[n]=e[n],delete e[n]))}t.exports=function(t,e,n){if(null==e)return;const r=Object.keys(e);for(const o of r){const r=o.startsWith("$");if("$set"===o){const r=Object.keys(e[o]);for(const s of r)i(t,e[o],s,e,n)}else r||i(t,e,o,e,n)}}},function(t,e,n){"use strict";const r=n(113);t.exports=
/*!
 * Given a model and an array of docs, hydrates all the docs to be instances
 * of the model. Used to initialize docs returned from the db from `find()`
 *
 * @param {Model} model
 * @param {Array} docs
 * @param {Object} fields the projection used, including `select` from schemas
 * @param {Object} userProvidedFields the user-specified projection
 * @param {Object} opts
 * @param {Array} [opts.populated]
 * @param {ClientSession} [opts.session]
 * @param {Function} callback
 */
function(t,e,n,i,o,s){const a=[];let c=e.length;const u=c;let l=null;function h(t){null!=t&&(l=l||t),null==l?--c||process.nextTick(()=>s(l,a)):--c||process.nextTick(()=>s(l))}for(let s=0;s<u;++s){a[s]=r.createModel(t,e[s],n,i);try{a[s].init(e[s],o,h)}catch(l){h(l)}a[s].$session(o.session)}}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){if(null==t)return!1;const e=Object.keys(t),n=e.length;for(let t=0;t<n;++t)if(e[t].startsWith("$"))return!0;return!1}},function(t,e,n){"use strict";const r=n(83);
/*!
 * ignore
 */t.exports=function(t){if(null==t)return!1;const e=Object.keys(t),n=e.length;if(0===n)return!1;for(let i=0;i<n;++i){const n=e[i];if(!n.startsWith("+")&&(r(t[n])&&t[n]))return!0}return!1}},function(t,e,n){"use strict";
/*!
 * ignore
 */
/*!
 * ignore
 */
function r(t,e){const n=e.split("."),r=n.length;let i=n[0];for(let e=1;e<r;++e){if(null!=t[i])return!0;i+="."+n[e]}return null!=t[i]}t.exports=function(t){const e=t._mongooseOptions;if(null!=e.populate){const n=Object.keys(e.populate),i=t._userProvidedFields||{};if(t.selectedInclusively())for(const e of n)r(i,e)?0===i[e]&&delete t._fields[e]:t.select(e);else if(t.selectedExclusively())for(const e of n)null==i[e]&&delete t._fields[e]}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(50),i=n(110),o=n(82).flatten,s=n(82).modifiedPaths;t.exports=function(t,e,n,a,c){let u;const l=Object.keys(n||{});let h={},f={};const p={},d={},m=l.length;let y=!1;const g={};let v,b,_;for(_=0;_<m;++_)if(l[_].startsWith("$")){if(y=!0,"$push"===l[_]||"$addToSet"===l[_]){u=Object.keys(n[l[_]]);for(let t=0;t<u.length;++t)v=n[l[_]][u[t]],v&&v.$each?d[u[t]]=(d[u[t]]||[]).concat(v.$each):d[u[t]]=(d[u[t]]||[]).concat([v]);continue}s(n[l[_]],"",g);const t=o(n[l[_]],null,null,e),r=Object.keys(t),a=r.length;for(let e=0;e<a;++e){const n=i(r[e]);b=l[_],n.includes("$")||("$set"===b||"$setOnInsert"===b||"$pull"===b||"$pullAll"===b?(f[n]=t[r[e]],p[n]="$pull"===b||"$pullAll"===b):"$unset"===b&&(f[n]=void 0),h[n]=!0)}}y||(s(n,"",g),f=o(n,null,null,e),h=Object.keys(f));const w=Object.keys(f),S=w.length,O=[],E=[],T=[],C=a&&"query"===a.context?t:null;function I(t,n){const i=e._getSchema(w[t]);if(null!=i&&("Mixed"!==i.instance||i.path===w[t]))if(n&&Array.isArray(n.$in))n.$in.forEach((t,e)=>{O.push((function(n){i.doValidate(t,(function(t){t&&(t.path=w[e]+".$in."+e,E.push(t)),n(null)}),C,{updateValidator:!0})}))});else{if(p[w[t]]&&i.$isMongooseArray)return;i.$isMongooseDocumentArrayElement&&null!=n&&null!=n.$__?(T.push(w[t]),O.push((function(e){i.doValidate(n,(function(r){if(r)return r.path=w[t],E.push(r),e(null);n.validate((function(n){if(n)if(n.errors)for(const e of Object.keys(n.errors)){const r=n.errors[e];r.path=w[t]+"."+e,E.push(r)}else n.path=w[t],E.push(n);e(null)}))}),C,{updateValidator:!0})}))):O.push((function(e){for(const n of T)if(w[t].startsWith(n+"."))return e(null);i.doValidate(n,(function(n){if(null!=i.schema&&!1===i.schema.options.storeSubdocValidationError&&n instanceof r)return e(null);n&&(n.path=w[t],E.push(n)),e(null)}),C,{updateValidator:!0})}))}}for(_=0;_<S;++_)I(_,f[w[_]]);const A=Object.keys(d);for(const n of A){let r=e._getSchema(n);if(r&&r.$isMongooseDocumentArray)O.push((function(e){r.doValidate(d[n],x(n,E,e),a&&"query"===a.context?t:null)}));else{r=e._getSchema(n+".0");for(const e of d[n])O.push((function(i){r.doValidate(e,x(n,E,i),a&&"query"===a.context?t:null,{updateValidator:!0})}))}}if(null==c)return function(t){let e=O.length;if(0===e)return k(t);for(const n of O)n((function(){--e<=0&&k(t)}))};{let t=O.length;if(0===t)return k(c);for(const e of O)e((function(){--t<=0&&k(c)}))}function k(t){if(E.length){const e=new r(null);for(const t of E)e.addError(t.path,t);return t(e)}t(null)}function x(t,e,n){return function(r){r&&(r.path=t,e.push(r)),n(null)}}}},function(t,e,n){"use strict";
/*!
 * A query thunk is the function responsible for sending the query to MongoDB,
 * like `Query#_findOne()` or `Query#_execUpdate()`. The `Query#exec()` function
 * calls a thunk. The term "thunk" here is the traditional Node.js definition:
 * a function that takes exactly 1 parameter, a callback.
 *
 * This function defines common behavior for all query thunks.
 */t.exports=function(t){return function(e){++this._executionCount,t.call(this,e)}}},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(235),i=n(236),o=n(22),s=n(135),a=n(204),c=n(13).EventEmitter,u=n(144),l=n(17),h=n(203),f=n(108),p=n(147),d=n(441),m=n(442),y=n(79),g=n(237),v=n(148),b=n(50),_=n(201),w=n(202),S=n(139),O=n(140),E=n(445),T=n(446),C=n(447),I=n(230),A=n(448),k=n(451),x=n(452),N=n(145),P=n(149),j=n(11),R=n(39),M=n(453),D=n(62),$=n(51).internalToObjectOptions,L=n(457),F=n(458),B=n(459),U=n(114),V=n(231),q=n(460),W=n(24),z=n(461),H=n(6),K=n(12),G=n(8).arrayAtomicsSymbol,Q=Symbol("mongoose#Model#collection"),Y=Symbol("mongoose#Model#db"),X=n(8).modelSymbol,J=Symbol("mongoose#Model#subclassed"),Z=Object.assign({},$,{bson:!0});function tt(t,e,n){if(e instanceof y)throw new TypeError("2nd argument to `Model` must be a POJO or string, **not** a schema. Make sure you're calling `mongoose.model()`, not `mongoose.Model()`.");o.call(this,t,e,n)}
/*!
 * Inherits from Document.
 *
 * All Model.prototype features are available on
 * top level (non-sub) documents.
 */
/*!
 * ignore
 */
function et(t,e){if(null==t.$where)return;const n=Object.keys(t.$where),r=n.length;for(let i=0;i<r;++i)e[n[i]]=t.$where[n[i]]}
/*!
 * ignore
 */
/*!
 * Apply the operation to the delta (update) clause as
 * well as track versioning for our where clause.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Mixed} val
 * @param {String} [operation]
 */
function nt(t,e,n,r,i,o){if(o||(o="$set"),n[o]||(n[o]={}),n[o][r.path]=i,!1!==t.schema.options.versionKey&&!
/*!
 * Determines whether versioning should be skipped for the given path
 *
 * @param {Document} self
 * @param {String} path
 * @return {Boolean} true if versioning should be skipped for the given path
 */
function(t,e){const n=t.schema.options.skipVersioning;return!!n&&n[e=e.replace(/\.\d+\./,".")]}(t,r.path)&&3!=(3&t.$__.version)){switch(o){case"$set":case"$unset":case"$pop":case"$pull":case"$pullAll":case"$push":case"$addToSet":break;default:return}"$push"===o||"$addToSet"===o||"$pullAll"===o||"$pull"===o?t.$__.version=2:/^\$p/.test(o)||Array.isArray(i)?t.increment():/\.\d+\.|\.\d+$/.test(r.path)&&(t.$__.version=1)}}
/*!
 * Compiles an update and where clause for a `val` with _atomics.
 *
 * @param {Document} self
 * @param {Object} where
 * @param {Object} delta
 * @param {Object} data
 * @param {Array} value
 */function rt(t,e,n,r,i){if(n.$set&&n.$set[r.path])return;if("function"==typeof i.$__getAtomics)return void i.$__getAtomics().forEach((function(e){const i=e[0],o=e[1];nt(t,0,n,r,o,i)}));const o=i[G],s=Object.keys(o);let a,c,u=s.length;if(0===u)return K.isMongooseObject(i)?i=i.toObject({depopulate:1,_isNested:!0}):i.valueOf&&(i=i.valueOf()),nt(t,0,n,r,i);function l(t){return K.isMongooseObject(t)?t.toObject({depopulate:1,_isNested:!0}):t}for(;u--;)c=s[u],a=o[c],K.isMongooseObject(a)?a=a.toObject({depopulate:!0,transform:!1,_isNested:!0}):Array.isArray(a)?a=a.map(l):a.valueOf&&(a=a.valueOf()),"$addToSet"===c&&(a={$each:a}),nt(t,0,n,r,a,c)}
/*!
 * Determine if array was populated with some form of filter and is now
 * being updated in a manner which could overwrite data unintentionally.
 *
 * @see https://github.com/Automattic/mongoose/issues/1334
 * @param {Document} doc
 * @param {String} path
 * @return {String|undefined}
 */
function it(t,e,n){const r=t.populated(e,!0);if(!r&&t.$__.selected){const n=e.split(".")[0];if(t.$__.selected[n+".$"])return n}if(r&&n&&n.isMongooseArray&&(r.options.match||r.options.options&&K.object.hasOwnProperty(r.options.options,"limit")||r.options.options&&r.options.options.skip||r.options.select&&(0===r.options.select._id||/\s?-_id\s?/.test(r.options.select)))){const t=n[G];if(0===Object.keys(t).length||t.$set||t.$pop)return e}}
/*!
 * Make sure `this` is a model
 */
function ot(t,e){if(null==t||t===global)throw new l("`Model."+e+"()` cannot run without a model as `this`. Make sure you are calling `MyModel."+e+"()` where `MyModel` is a Mongoose model.");if(null==t[X])throw new l("`Model."+e+"()` cannot run without a model as `this`. Make sure you are not calling `new Model."+e+"()`")}
/*!
 * Give the constructor the ability to emit events.
 */tt.prototype.__proto__=o.prototype,tt.prototype.$isMongooseModelPrototype=!0,tt.prototype.db,tt.prototype.collection,tt.prototype.modelName,tt.prototype.$where,tt.prototype.baseModelName,tt.events,
/*!
 * Compiled middleware for this model. Set in `applyHooks()`.
 *
 * @api private
 * @property _middleware
 * @memberOf Model
 * @static
 */
tt._middleware,tt.prototype.$__handleSave=function(t,e){const n=this;let r={};"safe"in t&&at(t),I(this.schema,t),"w"in t&&(r.w=t.w),"j"in t&&(r.j=t.j),"wtimeout"in t&&(r.wtimeout=t.wtimeout),"checkKeys"in t&&(r.checkKeys=t.checkKeys);const i=this.$session();if(r.hasOwnProperty("session")||(r.session=i),0===Object.keys(r).length&&(r=null),this.isNew){const t=this.toObject(Z);if(void 0===(t||{})._id)return void setTimeout((function(){e(new l("document must have an _id before saving"))}),0);this.$__version(!0,t),this[Q].insertOne(t,r,(function(t,r){if(t)return ut(n,!0),void e(t,null);e(null,r)})),this.$__reset(),ut(this,!1),this.$__.inserting=!0}else{this.$__.inserting=!1;const n=this.$__delta();if(!n){const n=Object.assign({},t,r);return void this.constructor.exists(this.$__where(),n).then(t=>{if(!t)throw new s(this.$__where(),this.constructor.modelName);this.$__reset(),e()}).catch(e)}{if(n instanceof l)return void e(n);const t=this.$__where(n[0]);if(t instanceof l)return void e(t);et(this,t),this[Q].updateOne(t,n[1],r,(function(n,r){n?e(n):(r.$where=t,e(null,r))}))}ut(this,!1)}},
/*!
 * ignore
 */
tt.prototype.$__save=function(t,e){this.$__handleSave(t,(n,r)=>{const i=this.schema.s.hooks;if(n)return i.execPost("save:error",this,[this],{error:n},t=>{e(t,this)});const o=this.modifiedPaths();this.$__reset();let a=0;if(0!==j(t,"safe.w")&&0!==j(t,"w")){if(r&&(a=Array.isArray(r)?r.length:r.result&&void 0!==r.result.n?r.result.n:r.result&&void 0!==r.result.nModified?r.result.nModified:r),this.$__.version&&!this.$__.inserting){const t=2==(2&this.$__.version);this.$__.version=void 0;const n=this.schema.options.versionKey,r=this.$__getValue(n)||0;if(a<=0){const t=this.$__.$versionError||new _(this,r,o);return e(t)}t&&this.$__setValue(n,r+1)}if(null!=r&&a<=0)return n=new s(r.$where,this.constructor.modelName,a,r),i.execPost("save:error",this,[this],{error:n},t=>{e(t,this)})}this.$__.saving=void 0,this.emit("save",this,a),this.constructor.emit("save",this,a),e(null,this)})},tt.prototype.save=function(t,e){let n;return this.$op="save",this.$__.saving?n=new w(this):this.$__.saving=new w(this),"function"==typeof t&&(e=t,t=void 0),(t=new m(t)).hasOwnProperty("session")&&this.$session(t.session),this.$__.$versionError=
/*!
 * ignore
 */
function(t,e){const n=t.schema.options.versionKey;if(!n)return null;const r=t.$__getValue(n)||0;return new _(t,r,e)}(this,this.modifiedPaths()),e=this.constructor.$handleCallbackError(e),W(e,e=>{if(e=this.constructor.$wrapCallback(e),n)return this.$__handleReject(n),e(n);this.$__.saveOptions=t,this.$__save(t,t=>{if(this.$__.saving=void 0,delete this.$__.saveOptions,delete this.$__.$versionError,this.$op=null,t)return this.$__handleReject(t),e(t);e(null,this)})},this.constructor.events)},tt.prototype.$__delta=function(){const t=this.$__dirty();if(!t.length&&3!==this.$__.version)return;const e={},n={},r=t.length,i=[];let o=0;for(e._id=this._doc._id,null!=j(e,"_id.$__",null)&&(e._id=e._id.toObject({transform:!1,depopulate:!0}));o<r;++o){const r=t[o];let s=r.value;const a=it(this,r.path,s);if(a)i.push(a);else{if(!this.populated(r.path,!0)&&this.$__.selected){const t=r.path.split("."),n=t[0];if(this.$__.selected[n]&&this.$__.selected[n].$elemMatch){if(!(t.length>1&&0==t[1]&&void 0===e[n])){i.push(r.path);continue}e[n]=this.$__.selected[n],t[1]="$",r.path=t.join(".")}}i.length||(void 0===s?nt(this,0,n,r,1,"$unset"):null===s?nt(this,0,n,r,null):s.isMongooseArray&&s.$path()&&s[G]?rt(this,0,n,r,s):s[u.pathSymbol]&&Buffer.isBuffer(s)?(s=s.toObject(),nt(this,0,n,r,s)):(s=K.clone(s,{depopulate:!0,transform:!1,virtuals:!1,getters:!1,_isNested:!0}),nt(this,0,n,r,s)))}}return i.length?new a(i):(this.$__.version&&this.$__version(e,n),[e,n])},tt.prototype.$__version=function(t,e){const n=this.schema.options.versionKey;if(!0!==t){if(this.isSelected(n)){if(1==(1&this.$__.version)){const e=this.$__getValue(n);null!=e&&(t[n]=e)}2==(2&this.$__.version)&&(null!=j(e.$set,n,null)?++e.$set[n]:(e.$inc=e.$inc||{},e.$inc[n]=1))}}else n&&this.$__setValue(n,e[n]=0)},tt.prototype.increment=function(){return this.$__.version=3,this},tt.prototype.$__where=function(t){return t||(t={}),t._id||(t._id=this._doc._id),void 0===this._doc._id?new l("No _id found on document!"):t},tt.prototype.remove=function(t,e){return"function"==typeof t&&(e=t,t=void 0),(t=new d(t)).hasOwnProperty("session")&&this.$session(t.session),this.$op="remove",e=this.constructor.$handleCallbackError(e),W(e,e=>{e=this.constructor.$wrapCallback(e),this.$__remove(t,(t,n)=>{this.$op=null,e(t,n)})},this.constructor.events)},tt.prototype.delete=tt.prototype.remove,tt.prototype.deleteOne=function(t,e){return"function"==typeof t&&(e=t,t=void 0),t||(t={}),e=this.constructor.$handleCallbackError(e),W(e,e=>{e=this.constructor.$wrapCallback(e),this.$__deleteOne(t,e)},this.constructor.events)},
/*!
 * ignore
 */
tt.prototype.$__remove=function(t,e){if(this.$__.isDeleted)return D(()=>e(null,this));const n=this.$__where();if(n instanceof l)return e(n);et(this,n);const r=this.$session();t.hasOwnProperty("session")||(t.session=r),this[Q].deleteOne(n,t,t=>{if(!t)return this.$__.isDeleted=!0,this.emit("remove",this),this.constructor.emit("remove",this),e(null,this);this.$__.isDeleted=!1,e(t)})},
/*!
 * ignore
 */
tt.prototype.$__deleteOne=tt.prototype.$__remove,tt.prototype.model=function(t){return this[Y].model(t)},tt.exists=function(t,e,n){ot(this,"exists"),"function"==typeof e&&(n=e,e=null);const r=this.findOne(t).select({_id:1}).lean().setOptions(e);if("function"!=typeof n)return r.then(t=>!!t);r.exec((function(t,e){if(null!=t)return n(t);n(null,!!e)}))},tt.discriminator=function(t,e,n){let r;if("function"==typeof t&&(r=t,t=K.getFunctionName(r),!(r.prototype instanceof tt)))throw new l("The provided class "+t+" must extend Model");if(ot(this,"discriminator"),K.isObject(e)&&!e.instanceOfSchema&&(e=new y(e)),e=N(this,t,e,n,!0),this.db.models[t])throw new h(t);e.$isRootDiscriminator=!0,e.$globalPluginsApplied=!0,r=this.db.model(r||t,e,this.collection.name),this.discriminators[t]=r;const i=this.discriminators[t];if(i.prototype.__proto__=this.prototype,Object.defineProperty(i,"baseModelName",{value:this.modelName,configurable:!0,writable:!1}),E(i,e),C(i,e),null!=this[J])for(const n of this[J])n.discriminators=n.discriminators||{},n.discriminators[t]=r.__subclass(r.db,e,n.collection.name);return i};for(const t in c.prototype)tt[t]=c.prototype[t];function st(t,e){if(null!=t.baseModelName&&e.unique&&!("partialFilterExpression"in e)&&!("sparse"in e)){const n=t.schema.discriminatorMapping&&t.schema.discriminatorMapping.value||t.modelName;e.partialFilterExpression={[t.schema.options.discriminatorKey]:n}}return e}tt.init=function(t){if(ot(this,"init"),this.schema.emit("init",this),null!=this.$init)return t?(this.$init.then(()=>t(),e=>t(e)),null):this.$init;const e=f.get(),n=K.getOption("autoIndex",this.schema.options,this.db.config,this.db.base.options),r=null==this.schema.options.autoCreate?this.db.config.autoCreate:this.schema.options.autoCreate,i=n?t=>this.ensureIndexes({_automatic:!0},t):t=>t(),o=r?t=>this.createCollection({},t):t=>t();if(this.$init=new e((t,e)=>{o(n=>{if(n)return e(n);i(n=>{if(n)return e(n);t(this)})})}),t)return this.$init.then(()=>t(),e=>t(e)),this.$caught=!0,null;{const t=this.$init.catch,e=this;this.$init.catch=function(){return this.$caught=!0,t.apply(e.$init,arguments)}}return this.$init},tt.createCollection=function(t,e){if(ot(this,"createCollection"),"string"==typeof t)throw new l("You can't specify a new collection name in Model.createCollection.This is not like Connection.createCollection. Only options are accepted here.");"function"==typeof t&&(e=t,t=null);const n=j(this,"schema.options.collation",null);return null!=n&&(t=Object.assign({collation:n},t)),e=this.$handleCallbackError(e),W(e,e=>{e=this.$wrapCallback(e),this.db.createCollection(this.collection.collectionName,t,K.tick(n=>{if(n)return e(n);this.collection=this.db.collection(this.collection.collectionName,t),e(null,this.collection)}))},this.events)},tt.syncIndexes=function(t,e){return ot(this,"syncIndexes"),e=this.$handleCallbackError(e),W(e,e=>{e=this.$wrapCallback(e),this.createCollection(n=>{if(n)return e(n);this.cleanIndexes((n,r)=>{if(null!=n)return e(n);this.createIndexes(t,t=>{if(null!=t)return e(t);e(null,r)})})})},this.events)},tt.cleanIndexes=function(t){return ot(this,"cleanIndexes"),t=this.$handleCallbackError(t),W(t,t=>{const e=this.collection;this.listIndexes((n,r)=>{if(null!=n)return t(n);const i=this.schema.indexes(),o=[];for(const t of r){let e=!1;if(!L(t)){for(const n of i){const r=n[0],i=st(this,K.clone(n[1]));F(r,i,t)&&(e=!0)}e||o.push(t.name)}}if(0===o.length)return t(null,[]);!function(t,n){let r=t.length,i=!1;t.forEach(o=>{e.dropIndex(o,e=>{if(null!=e)return i=!0,n(e);i||--r||n(null,t)})})}(o,t)})})},tt.listIndexes=function(t){ot(this,"listIndexes");const e=t=>{this.collection.listIndexes().toArray(t)};return t=this.$handleCallbackError(t),W(t,t=>{t=this.$wrapCallback(t),this.collection.buffer?this.collection.addQueue(e,[t]):e(t)},this.events)},tt.ensureIndexes=function(t,e){return ot(this,"ensureIndexes"),"function"==typeof t&&(e=t,t=null),e=this.$handleCallbackError(e),W(e,e=>{e=this.$wrapCallback(e),
/*!
 * ignore
 */
function(t,e,n){const r=t.schema.indexes();let i;e=e||{};const o=function(e){e&&!t.$caught&&t.emit("error",e),t.emit("index",e||i),n&&n(e)};for(const e of r)L(e)&&console.warn('mongoose: Cannot specify a custom index on `_id` for model name "'+t.modelName+'", MongoDB does not allow overwriting the default `_id` index. See http://bit.ly/mongodb-id-index');if(!r.length)return void D((function(){o()}));const s=t.schema._baseSchema,a=s?s.indexes():[],c=function(){if(e._automatic&&(!1===t.schema.options.autoIndex||null==t.schema.options.autoIndex&&!1===t.db.config.autoIndex))return o();const n=r.shift();if(!n)return o();if(e._automatic&&!1===n[1]._autoIndex)return c();if(a.find(t=>K.deepEqual(t,n)))return c();const s=K.clone(n[0]),u=K.clone(n[1]);delete u._autoIndex,st(t,u),"safe"in e&&at(e),I(t.schema,u),function(e,n){t.emit("index-single-start",e,n)}(s,e);let l=!!t.base.options.useCreateIndex;"useCreateIndex"in t.db.config&&(l=!!t.db.config.useCreateIndex),"createIndex"in e&&(l=!!e.createIndex),"background"in e&&(u.background=e.background);const h=l?"createIndex":"ensureIndex";t.collection[h](s,u,K.tick((function(e,n){!function(e,n,r,i){t.emit("index-single-done",e,n,r,i)}(e,s,u,n),e&&(i||(i=e),t.$caught||t.emit("error",e)),c()})))};D((function(){e._automatic&&!t.collection.collection?t.collection.addQueue(c,[]):c()}))}(this,t||{},t=>{if(t)return e(t);e(null)})},this.events)},tt.createIndexes=function(t,e){return ot(this,"createIndexes"),"function"==typeof t&&(e=t,t={}),(t=t||{}).createIndex=!0,this.ensureIndexes(t,e)};const at=H.deprecate((function(t){t.safe&&("boolean"==typeof t.safe&&(t.w=t.safe,delete t.safe),"object"==typeof t.safe&&(t.w=t.safe.w,t.j=t.safe.j,t.wtimeout=t.safe.wtimeout,delete t.safe))}),"Mongoose: the `safe` option for `save()` is deprecated. Use the `w` option instead: http://bit.ly/mongoose-save");
/*!
 * Decorate the update with a version key, if necessary
 */
function ct(t,e,n){if(!n||!j(e,"upsert",!1))return;V(t)[n]||(e.overwrite?t[n]=0:(t.$setOnInsert||(t.$setOnInsert={}),t.$setOnInsert[n]=0))}
/*!
 * ignore
 */
function ut(t,e){t.isNew=e,t.emit("isNew",e),t.constructor.emit("isNew",e);const n=t.$__getAllSubdocs();for(const t of n)t.isNew=e}
/*!
 * Common code for `updateOne()`, `updateMany()`, `replaceOne()`, and `update()`
 * because they need to do the same thing
 */
function lt(t,e,n,r,i,s){const a=new t.Query({},{},t,t.collection);return s=t.$handleCallbackError(s),n=n instanceof o?n.toObject():K.clone(n),ct(r,i="function"==typeof i?i:K.clone(i),j(t,"schema.options.versionKey",null)),a[e](n,r,i,s)}tt.schema,
/*!
 * Connection instance the model uses.
 *
 * @property db
 * @api public
 * @memberOf Model
 */
tt.db,
/*!
 * Collection the model uses.
 *
 * @property collection
 * @api public
 * @memberOf Model
 */
tt.collection,tt.base,tt.discriminators,tt.translateAliases=function(t){ot(this,"translateAliases");const e=(e,n)=>{let r;const i=[],o=e.split(".");let s=this.schema;for(const t in o){const e=o[t];s&&s.aliases[e]?(r=s.aliases[e],i.push(r)):i.push(e),s=s&&s.paths[r]?s.paths[r].schema:null}const a=i.join(".");return t instanceof Map?t.set(a,n):t[a]=n,a!==e&&(t instanceof Map?t.delete(e):delete t[e]),t};if("object"==typeof t){if(t instanceof Map)for(const n of new Map(t))t=e(n[0],n[1]);else for(const n of Object.keys(t))if(t=e(n,t[n]),"$"===n[0]&&Array.isArray(t[n]))for(const e in t[n])t[n][e]=this.translateAliases(t[n][e]);return t}return t},tt.remove=function(t,e,n){ot(this,"remove"),"function"==typeof t?(n=t,t={},e=null):"function"==typeof e&&(n=e,e=null);const r=new this.Query({},{},this,this.collection);return r.setOptions(e),n=this.$handleCallbackError(n),r.remove(t,n)},tt.deleteOne=function(t,e,n){ot(this,"deleteOne"),"function"==typeof t?(n=t,t={},e=null):"function"==typeof e&&(n=e,e=null);const r=new this.Query({},{},this,this.collection);return r.setOptions(e),n=this.$handleCallbackError(n),r.deleteOne(t,n)},tt.deleteMany=function(t,e,n){ot(this,"deleteMany"),"function"==typeof t?(n=t,t={},e=null):"function"==typeof e&&(n=e,e=null);const r=new this.Query({},{},this,this.collection);return r.setOptions(e),n=this.$handleCallbackError(n),r.deleteMany(t,n)},tt.find=function(t,e,n,r){ot(this,"find"),"function"==typeof t?(r=t,t={},e=null,n=null):"function"==typeof e?(r=e,e=null,n=null):"function"==typeof n&&(r=n,n=null);const i=new this.Query({},{},this,this.collection);return i.select(e),i.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&i.selectedInclusively()&&i.select(this.schema.options.discriminatorKey),r=this.$handleCallbackError(r),i.find(t,r)},tt.findById=function(t,e,n,r){return ot(this,"findById"),void 0===t&&(t=null),r=this.$handleCallbackError(r),this.findOne({_id:t},e,n,r)},tt.findOne=function(t,e,n,r){ot(this,"findOne"),"function"==typeof n?(r=n,n=null):"function"==typeof e?(r=e,e=null,n=null):"function"==typeof t&&(r=t,t={},e=null,n=null);const i=new this.Query({},{},this,this.collection);return i.select(e),i.setOptions(n),this.schema.discriminatorMapping&&this.schema.discriminatorMapping.isRoot&&i.selectedInclusively()&&i.select(this.schema.options.discriminatorKey),r=this.$handleCallbackError(r),i.findOne(t,r)},tt.estimatedDocumentCount=function(t,e){ot(this,"estimatedDocumentCount");const n=new this.Query({},{},this,this.collection);return e=this.$handleCallbackError(e),n.estimatedDocumentCount(t,e)},tt.countDocuments=function(t,e){ot(this,"countDocuments"),"function"==typeof t&&(e=t,t={});const n=new this.Query({},{},this,this.collection);return e=this.$handleCallbackError(e),n.countDocuments(t,e)},tt.count=function(t,e){ot(this,"count"),"function"==typeof t&&(e=t,t={});const n=new this.Query({},{},this,this.collection);return e=this.$handleCallbackError(e),n.count(t,e)},tt.distinct=function(t,e,n){ot(this,"distinct");const r=new this.Query({},{},this,this.collection);return"function"==typeof e&&(n=e,e={}),n=this.$handleCallbackError(n),r.distinct(t,e,n)},tt.where=function(t,e){ot(this,"where");const n=new this.Query({},{},this,this.collection).find({});return n.where.apply(n,arguments)},tt.$where=function(){ot(this,"$where");const t=new this.Query({},{},this,this.collection).find({});return t.$where.apply(t,arguments)},tt.findOneAndUpdate=function(t,e,n,r){if(ot(this,"findOneAndUpdate"),"function"==typeof n)r=n,n=null;else if(1===arguments.length){if("function"==typeof t){const t="Model.findOneAndUpdate(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndUpdate(conditions, update, options, callback)\n  "+this.modelName+".findOneAndUpdate(conditions, update, options)\n  "+this.modelName+".findOneAndUpdate(conditions, update)\n  "+this.modelName+".findOneAndUpdate(update)\n  "+this.modelName+".findOneAndUpdate()\n";throw new TypeError(t)}e=t,t=void 0}let i;r=this.$handleCallbackError(r),n&&(i=n.fields||n.projection),ct(e=K.clone(e,{depopulate:!0,_isNested:!0}),n,this.schema.options.versionKey);const o=new this.Query({},{},this,this.collection);return o.select(i),o.findOneAndUpdate(t,e,n,r)},tt.findByIdAndUpdate=function(t,e,n,r){if(ot(this,"findByIdAndUpdate"),r=this.$handleCallbackError(r),1===arguments.length){if("function"==typeof t){const t="Model.findByIdAndUpdate(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndUpdate(id, callback)\n  "+this.modelName+".findByIdAndUpdate(id)\n  "+this.modelName+".findByIdAndUpdate()\n";throw new TypeError(t)}return this.findOneAndUpdate({_id:t},void 0)}return t instanceof o&&(t=t._id),this.findOneAndUpdate.call(this,{_id:t},e,n,r)},tt.findOneAndDelete=function(t,e,n){if(ot(this,"findOneAndDelete"),1===arguments.length&&"function"==typeof t){const t="Model.findOneAndDelete(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndDelete(conditions, callback)\n  "+this.modelName+".findOneAndDelete(conditions)\n  "+this.modelName+".findOneAndDelete()\n";throw new TypeError(t)}let r;"function"==typeof e&&(n=e,e=void 0),n=this.$handleCallbackError(n),e&&(r=e.select,e.select=void 0);const i=new this.Query({},{},this,this.collection);return i.select(r),i.findOneAndDelete(t,e,n)},tt.findByIdAndDelete=function(t,e,n){if(ot(this,"findByIdAndDelete"),1===arguments.length&&"function"==typeof t){const t="Model.findByIdAndDelete(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndDelete(id, callback)\n  "+this.modelName+".findByIdAndDelete(id)\n  "+this.modelName+".findByIdAndDelete()\n";throw new TypeError(t)}return n=this.$handleCallbackError(n),this.findOneAndDelete({_id:t},e,n)},tt.findOneAndReplace=function(t,e,n,r){if(ot(this,"findOneAndReplace"),1===arguments.length&&"function"==typeof t){const t="Model.findOneAndReplace(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndReplace(conditions, callback)\n  "+this.modelName+".findOneAndReplace(conditions)\n  "+this.modelName+".findOneAndReplace()\n";throw new TypeError(t)}let i;3===arguments.length&&"function"==typeof n&&(r=n,n=e,e=void 0),2===arguments.length&&"function"==typeof e&&(r=e,e=void 0,n=void 0),r=this.$handleCallbackError(r),n&&(i=n.select,n.select=void 0);const o=new this.Query({},{},this,this.collection);return o.select(i),o.findOneAndReplace(t,e,n,r)},tt.findOneAndRemove=function(t,e,n){if(ot(this,"findOneAndRemove"),1===arguments.length&&"function"==typeof t){const t="Model.findOneAndRemove(): First argument must not be a function.\n\n  "+this.modelName+".findOneAndRemove(conditions, callback)\n  "+this.modelName+".findOneAndRemove(conditions)\n  "+this.modelName+".findOneAndRemove()\n";throw new TypeError(t)}let r;"function"==typeof e&&(n=e,e=void 0),n=this.$handleCallbackError(n),e&&(r=e.select,e.select=void 0);const i=new this.Query({},{},this,this.collection);return i.select(r),i.findOneAndRemove(t,e,n)},tt.findByIdAndRemove=function(t,e,n){if(ot(this,"findByIdAndRemove"),1===arguments.length&&"function"==typeof t){const t="Model.findByIdAndRemove(): First argument must not be a function.\n\n  "+this.modelName+".findByIdAndRemove(id, callback)\n  "+this.modelName+".findByIdAndRemove(id)\n  "+this.modelName+".findByIdAndRemove()\n";throw new TypeError(t)}return n=this.$handleCallbackError(n),this.findOneAndRemove({_id:t},e,n)},tt.create=function(t,e,n){let r,i;ot(this,"create");const o=this.schema.options.discriminatorKey;if(Array.isArray(t))r=t,i="function"==typeof e?e:n,e=null!=e&&"object"==typeof e?e:{};else{const t=arguments[arguments.length-1];e={},"function"!=typeof t&&t?r=K.args(arguments):(i=t,r=K.args(arguments,0,arguments.length-1)),2!==r.length||null==r[0]||null==r[1]||null!=r[0].session||null==t.session||"ClientSession"!==t.session.constructor.name||this.schema.path("session")||console.warn("WARNING: to pass a `session` to `Model.create()` in Mongoose, you **must** pass an array as the first argument. See: https://mongoosejs.com/docs/api.html#model_Model.create")}return W(i,n=>{if(n=this.$wrapCallback(n),0===r.length)return n(null);const i=[];let s;r.forEach(t=>{i.push(n=>{const r=this.discriminators&&null!=t[o]?this.discriminators[t[o]]||R(this,t[o]):this;if(null==r)throw new l(`Discriminator "${t[o]}" not `+`found for model "${this.modelName}"`);let i=t;const a=(t,e)=>{if(t)return s||(s=t),n(null,{error:t});n(null,{doc:e})};if(!(i instanceof r))try{i=new r(i)}catch(t){return a(t)}i.save(e,a)})});let a=i.length;if(0===a)return n(null,[]);const c=(e,r)=>{const i=[],o=r.length;for(let t=0;t<o;++t)r[t].doc&&i.push(r[t].doc);if(s)return n(s,i);t instanceof Array?n(null,i):n.apply(this,[null].concat(i))},u=[];i.forEach((t,e)=>{t((t,n)=>{if(u[e]=n,--a<=0)return c(0,u)})})},this.events)},tt.watch=function(t,e){ot(this,"watch");return new i(n=>{if(this.collection.buffer)this.collection.addQueue(()=>{if(this.closed)return;const r=this.collection.watch(t,e);n(null,r)});else{const r=this.collection.watch(t,e);n(null,r)}},t,e)},tt.startSession=function(){return ot(this,"startSession"),this.db.startSession.apply(this.db,arguments)},tt.insertMany=function(t,e,n){return ot(this,"insertMany"),"function"==typeof e&&(n=e,e=null),W(n,n=>{this.$__insertMany(t,e,n)},this.events)},
/*!
 * ignore
 */
tt.$__insertMany=function(t,e,n){const r=this;"function"==typeof e&&(n=e,e=null),n&&(n=this.$handleCallbackError(n),n=this.$wrapCallback(n)),n=n||K.noop;const i=j(e=e||{},"limit",1e3),o=j(e,"rawResult",!1),s=j(e,"ordered",!0),a=j(e,"lean",!1);Array.isArray(t)||(t=[t]);const c=[],u=t.map(t=>n=>{if(!(t instanceof r))try{t=new r(t)}catch(t){return n(t)}if(null!=e.session&&t.$session(e.session),a)return process.nextTick(()=>n(null,t));t.validate({__noPromise:!0},(function(e){if(e)return!1===s?(c.push(e),n(null,null)):n(e);n(null,t)}))});q(u,i,(function(t,i){if(t)return void n(t,null);const a=i.filter((function(t){return null!=t}));if(a.length<1){if(o){return n(null,{mongoose:{validationErrors:c}})}return void n(null,[])}const u=a.map((function(t){return t.schema.options.versionKey&&(t[t.schema.options.versionKey]=0),t.initializeTimestamps?t.initializeTimestamps().toObject($):t.toObject($)}));r.collection.insertMany(u,e,(function(t,e){if(t){null==t.writeErrors&&null!=j(t,"result.result.writeErrors")&&(t.writeErrors=t.result.result.writeErrors);const e=new Set(t.writeErrors.map(t=>t.index));return t.insertedDocs=a.filter((t,n)=>!e.has(n)),void n(t,null)}for(const t of a)t.$__reset(),ut(t,!1);if(o)return!1===s&&(e.mongoose={validationErrors:c}),n(null,e);n(null,a)}))}))},tt.bulkWrite=function(t,e,n){ot(this,"bulkWrite"),"function"==typeof e&&(n=e,e=null),e=e||{};const r=t.map(t=>k(this,t,e));return n=this.$handleCallbackError(n),W(n,n=>{n=this.$wrapCallback(n),P(r,(t,e)=>t(e),r=>r?n(r):0===t.length?n(null,x()):void this.collection.bulkWrite(t,e,(t,e)=>{if(t)return n(t);n(null,e)}))},this.events)},tt.hydrate=function(t,e){ot(this,"hydrate");const r=n(113).createModel(this,t,e);return r.init(t),r},tt.update=function(t,e,n,r){return ot(this,"update"),lt(this,"update",t,e,n,r)},tt.updateMany=function(t,e,n,r){return ot(this,"updateMany"),lt(this,"updateMany",t,e,n,r)},tt.updateOne=function(t,e,n,r){return ot(this,"updateOne"),lt(this,"updateOne",t,e,n,r)},tt.replaceOne=function(t,e,n,r){ot(this,"replaceOne");const i=j(this,"schema.options.versionKey",null);return i&&!e[i]&&(e[i]=0),lt(this,"replaceOne",t,e,n,r)},tt.mapReduce=function(t,e){return ot(this,"mapReduce"),e=this.$handleCallbackError(e),W(e,e=>{if(e=this.$wrapCallback(e),!tt.mapReduce.schema){const t={noId:!0,noVirtualId:!0,strict:!1};tt.mapReduce.schema=new y({},t)}if(t.out||(t.out={inline:1}),!1!==t.verbose&&(t.verbose=!0),t.map=String(t.map),t.reduce=String(t.reduce),t.query){let e=new this.Query(t.query);e.cast(this),t.query=e._conditions,e=void 0}this.collection.mapReduce(null,null,t,(t,n)=>{if(t)return e(t);if(n.collection){const t=tt.compile("_mapreduce_"+n.collection.collectionName,tt.mapReduce.schema,n.collection.collectionName,this.db,this.base);return t._mapreduce=!0,n.model=t,e(null,n)}e(null,n)})},this.events)},tt.aggregate=function(t,e){if(ot(this,"aggregate"),arguments.length>2||"Object"===j(t,"constructor.name"))throw new l("Mongoose 5.x disallows passing a spread of operators to `Model.aggregate()`. Instead of `Model.aggregate({ $match }, { $skip })`, do `Model.aggregate([{ $match }, { $skip }])`");"function"==typeof t&&(e=t,t=[]);const n=new r(t||[]);return n.model(this),void 0===e||(e=this.$handleCallbackError(e),e=this.$wrapCallback(e),n.exec(e)),n},tt.validate=function(t,e,n,r){return W(r,r=>{const i=this.schema;let o=Object.keys(i.paths);if(null!=e){const t=new Set(e);o=o.filter(e=>{const n=e.split(".");let r=n[0];for(const e of n){if(t.has(r))return!0;r+="."+e}return t.has(e)})}for(const e of o){const n=i.path(e);n&&n.$isMongooseArray&&c(j(t,e),e)}let s=o.length,a=null;for(const e of o){const r=i.path(e);if(null==r){u();continue}const o=e.split(".");let s=t;for(let t=0;t<o.length-1;++t)s=s[o[t]];let c=j(t,e,void 0);if(null!=c)try{c=r.cast(c),s[o[o.length-1]]=c}catch(t){a=a||new b,a.addError(e,t),u();continue}r.doValidate(c,t=>{if(t)if(a=a||new b,t instanceof b)for(const n of Object.keys(t.errors))a.addError(`${e}.${t.errors[n].path}`,n);else a.addError(t.path,t);u()},n,{path:e})}function c(t,e){if(null!=t)for(let n=0;n<t.length;++n)Array.isArray(t[n])?c(t[n],e+"."+n):o.push(e+"."+n)}function u(){if(--s<=0)return r(a)}})},tt.geoSearch=function(t,e,n){return ot(this,"geoSearch"),"function"==typeof e&&(n=e,e={}),n=this.$handleCallbackError(n),W(n,n=>{let r;if(n=this.$wrapCallback(n),void 0!==t&&K.isObject(t)?e.near?Array.isArray(e.near)||(r=new l("near option must be an array [x, y]")):r=new l("Must specify the near option in geoSearch"):r=new l("Must pass conditions to geoSearch"),r)return n(r);e.search=t,this.collection.geoHaystackSearch(e.near[0],e.near[1],e,(t,r)=>{if(t)return n(t);let i=r.results.length;if(e.lean||0===i)return n(null,r.results);function o(t){if(t)return n(t);--i||n(null,r.results)}for(let t=0;t<r.results.length;++t){const e=r.results[t];r.results[t]=new this,r.results[t].init(e,{},o)}})},this.events)},tt.populate=function(t,e,n){ot(this,"populate");const r=this;e=K.populate(e);return n=this.$handleCallbackError(n),W(n,n=>{n=this.$wrapCallback(n),
/*!
 * Populate helper
 *
 * @param {Model} model the model to use
 * @param {Document|Array} docs Either a single document or array of documents to populate.
 * @param {Object} paths
 * @param {Function} [cb(err,doc)] Optional callback, executed upon completion. Receives `err` and the `doc(s)`.
 * @return {Function}
 * @api private
 */
function(t,e,n,r,i){let o=n.length;if(0===n.length)return i(null,e);for(const r of n)pt(t,e,r,s);function s(t){if(t)return i(t,null);--o||i(null,e)}}
/*!
 * Populates `docs`
 */(r,t,e,0,n)},this.events)};const ht=/\s?-_id\s?/,ft=/\s?-_id\s?/g;function pt(t,e,n,r){if(Array.isArray(e)||(e=[e]),0===e.length||e.every(K.isNullOrUndefined))return r();const i=M(t,e,n);if(i instanceof l)return D((function(){r(i)}));const o=i.length;let s=[];function a(t){return void 0!==t}let c=o,u=!1;const h=[];for(let e=0;e<o;++e){const n=i[e];let r=n.options.select;const o=gt(n.match);let s=K.array.flatten(n.ids,a);s=K.array.unique(s);const l={};if(l.sort=j(n,"options.options.sort",void 0),l.excludeId=ht.test(r)||r&&0===r._id,0===s.length||s.every(K.isNullOrUndefined))--c,(n.count||n.isVirtual)&&mt(t,[],n,l);else{if(u=!0,1===n.foreignField.size){const t=Array.from(n.foreignField)[0],e=n.model.schema.path(t);"_id"===t&&o._id||(s=yt(s,e,n.options.skipInvalidIds),o[t]={$in:s})}else{const t=[];Array.isArray(o.$or)?(o.$and=[{$or:o.$or},{$or:t}],delete o.$or):o.$or=t;for(const e of n.foreignField)if("_id"!==e||!o._id){s=yt(s,n.model.schema.path(e),n.options.skipInvalidIds),t.push({[e]:{$in:s}})}}l.excludeId&&("string"==typeof r?r=r.replace(ft," "):(r=K.object.shallowCopy(r),delete r._id)),n.options.options&&null!=n.options.options.limit?l.originalLimit=n.options.options.limit:null!=n.options.limit&&(l.originalLimit=n.options.limit),h.push([n,o,r,l,f])}}if(!u){if(null!=n.populate){const i=K.populate(n.populate).map(t=>Object.assign({},t,{path:n.path+"."+t.path}));return t.populate(e,i,r)}return r()}for(const t of h)dt.apply(null,t);function f(e,n){if(null!=e)return r(e,null);s=s.concat(n),0==--c&&function(){for(const e of h){const n=e[0],r=e[3];mt(t,s,n,r)}for(const t of h)z(t[0].foreignField,t[0].options,s);r()}()}}
/*!
 * ignore
 */function dt(t,e,n,r,i){const o=K.clone(t.options.populate),s=Object.assign({skip:t.options.skip,limit:t.options.limit,perDocumentLimit:t.options.perDocumentLimit},t.options.options);t.count&&delete s.skip,null!=s.perDocumentLimit?(s.limit=s.perDocumentLimit,delete s.perDocumentLimit):null!=s.limit&&(s.limit=s.limit*t.ids.length);const a=t.model.find(e,n,s);for(const e of t.foreignField)"_id"!==e&&a.selectedInclusively()&&!B(a._fields,e)&&a.select(e);if(t.count)for(const e of t.foreignField)a.select(e);o&&a.populate(o),a.exec((e,n)=>{if(null!=e)return i(e);for(const e of n)U.set(e,t.model);i(null,n)})}
/*!
 * ignore
 */function mt(t,e,n,r){const i=n.options,s=n.isVirtual,a=n.justOne;let c;const u=j(i,"options.lean",!1),l=e.length,h={},f={};let p,d;const m=K.clone(n.allIds);for(let t=0;t<l;t++)if(d=e[t],null!=d)for(const e of n.foreignField){if(c=K.getValue(e,d),Array.isArray(c)){c=K.array.flatten(c);for(let e of c)e instanceof o&&(e=e._id),p=String(e),f[p]?Array.isArray(f[p])?(f[p].push(d),h[p].push(t)):(f[p]=[f[p],d],h[p]=[h[p],t]):s&&!a?(f[p]=[d],h[p]=[t]):(f[p]=d,h[p]=t)}else c instanceof o&&(c=c._id),p=String(c),f[p]?Array.isArray(f[p])?(f[p].push(d),h[p].push(t)):(f[p]=[f[p],d],h[p]=[h[p],t]):(f[p]=d,h[p]=t);u||(d.$__.wasPopulated=!0)}A({originalModel:t,rawIds:n.isVirtual?m:n.allIds,allIds:m,foreignField:n.foreignField,rawDocs:f,rawOrder:h,docs:n.docs,path:i.path,options:r,justOne:n.justOne,isVirtual:n.isVirtual,allOptions:n,populatedModel:n.model,lean:u,virtual:n.virtual,count:n.count,match:n.match})}
/*!
 * Optionally filter out invalid ids that don't conform to foreign field's schema
 * to avoid cast errors (gh-7706)
 */function yt(t,e,n){return t=t.filter(t=>!(t instanceof v)),n?t.filter(t=>{try{return e.cast(t),!0}catch(t){return!1}}):t}
/*!
 * Format `mod.match` given that it may be an array that we need to $or if
 * the client has multiple docs with match functions
 */function gt(t){return Array.isArray(t)?t.length>1?{$or:[].concat(t.map(t=>Object.assign({},t)))}:Object.assign({},t[0]):Object.assign({},t)}
/*!
 * Compiler utility.
 *
 * @param {String|Function} name model name or class extending Model
 * @param {Schema} schema
 * @param {String} collectionName
 * @param {Connection} connection
 * @param {Mongoose} base mongoose instance
 */tt.compile=function(t,e,n,r,i){if(!1!==e.options.versionKey&&!e.paths[e.options.versionKey]){const t={};t[e.options.versionKey]=Number,e.add(t)}let o;"function"==typeof t&&t.prototype instanceof tt?(o=t,t=o.name,e.loadClass(o,!1),o.prototype.$isMongooseModelPrototype=!0):o=function t(e,n,r){if(t.hooks.execPreSync("createModel",e),!(this instanceof t))return new t(e,n,r);const i=t.schema.options.discriminatorKey;if(null==t.discriminators||null==e||null==e[i])return void tt.call(this,e,n,r);const o=t.discriminators[e[i]]||R(t,e[i]);if(null!=o)return new o(e,n,r);tt.call(this,e,n,r)},o.hooks=e.s.hooks.clone(),o.base=i,o.modelName=t,o.prototype instanceof tt||(o.__proto__=tt,o.prototype.__proto__=tt.prototype),o.model=function(t){return this.db.model(t)},o.db=r,o.prototype.db=r,o.prototype[Y]=r,o.discriminators=o.prototype.discriminators=void 0,o[X]=!0,o.events=new c,o.prototype.$__setSchema(e);const s={schemaUserProvidedOptions:e._userProvidedOptions||{},capped:e.options.capped,autoCreate:e.options.autoCreate,Promise:o.base.Promise};return o.prototype.collection=r.collection(n,s),o.prototype[Q]=o.prototype.collection,E(o,e),C(o,e),O(o,e),T(o,e.s.hooks,e.statics),o.schema=o.prototype.schema,o.collection=o.prototype.collection,o.Query=function(){p.apply(this,arguments)},o.Query.prototype=Object.create(p.prototype),o.Query.base=p.base,S(o.Query,o),
/*!
 * Register custom query methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */
function(t,e){for(const n in e)t.Query.prototype[n]=e[n]}
/*!
 * Subclass this model with `conn`, `schema`, and `collection` settings.
 *
 * @param {Connection} conn
 * @param {Schema} [schema]
 * @param {String} [collection]
 * @return {Model}
 */(o,e.query),o},tt.__subclass=function(t,e,n){const r=this,i=function t(e,n,i){if(!(this instanceof t))return new t(e,n,i);r.call(this,e,n,i)};if(i.__proto__=r,i.prototype.__proto__=r.prototype,i.db=t,i.prototype.db=t,i.prototype[Y]=t,r[J]=r[J]||[],r[J].push(i),null!=r.discriminators){i.discriminators={};for(const t of Object.keys(r.discriminators))i.discriminators[t]=r.discriminators[t].__subclass(r.db,r.discriminators[t].schema,n)}const o=e&&"string"!=typeof e?e:r.prototype.schema,s=o.options||{},a=o._userProvidedOptions||{};n||(n=r.prototype.schema.get("collection")||K.toCollectionName(r.modelName,this.base.pluralize()));const c={schemaUserProvidedOptions:a,capped:o&&s.capped};return i.prototype.collection=t.collection(n,c),i.prototype[Q]=i.prototype.collection,i.collection=i.prototype.collection,i.init(()=>{}),i},tt.$handleCallbackError=function(t){if(null==t)return t;if("function"!=typeof t)throw new l("Callback must be a function, got "+t);const e=this;return function(){try{t.apply(null,arguments)}catch(t){e.emit("error",t)}}},
/*!
 * ignore
 */
tt.$wrapCallback=function(t){const e=new g,n=this;return function(r){return null!=r&&"MongoServerSelectionError"===r.name&&(arguments[0]=e.assimilateError(r)),null!=r&&"MongoNetworkError"===r.name&&r.message.endsWith("timed out")&&n.db.emit("timeout"),t.apply(null,arguments)}},tt.inspect=function(){return`Model { ${this.modelName} }`},H.inspect.custom&&(
/*!
  * Avoid Node deprecation warning DEP0079
  */
tt[H.inspect.custom]=tt.inspect)
/*!
 * Module exports.
 */,t.exports=tt},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(28),i=n(26).Readable,o=n(24),s=n(228);function a(t){i.call(this,{objectMode:!0}),this.cursor=null,this.agg=t,this._transforms=[];const e=t._model;delete t.options.cursor.useMongooseAggCursor,this._mongooseOptions={},
/*!
 * ignore
 */
function(t,e,n){t.collection.buffer?t.collection.emitter.once("queue",(function(){t.hooks.execPre("aggregate",n,(function(){e.cursor=t.collection.aggregate(n._pipeline,n.options||{}),e.emit("cursor",e.cursor)}))})):t.hooks.execPre("aggregate",n,(function(){e.cursor=t.collection.aggregate(n._pipeline,n.options||{}),e.emit("cursor",e.cursor)}))}
/*!
 * Necessary to satisfy the Readable API
 */(e,this,t)}if(n(6).inherits(a,i),a.prototype._read=function(){const t=this;c(this,(function(e,n){return e?t.emit("error",e):n?void t.push(n):(t.push(null),void t.cursor.close((function(e){if(e)return t.emit("error",e);setTimeout((function(){!t.destroyed&&t.emit("close")}),0)})))}))},null!=Symbol.asyncIterator){const t="Mongoose does not support using async iterators with an existing aggregation cursor. See http://bit.ly/mongoose-async-iterate-aggregation";a.prototype[Symbol.asyncIterator]=function(){throw new r(t)}}
/*!
 * Get the next doc from the underlying cursor and mongooseify it
 * (populate, etc.)
 */
function c(t,e){let n=e;return t._transforms.length&&(n=function(n,r){if(n||null===r&&!t._mongooseOptions.transformNull)return e(n,r);e(n,t._transforms.reduce((function(t,e){return e(t)}),r))}),t._error?process.nextTick((function(){n(t._error)})):t.cursor?t.cursor.next((function(t,e){return t?n(t):e?void n(null,e):n(null,null)})):void t.once("cursor",(function(){c(t,e)}))}a.prototype.map=function(t){return this._transforms.push(t),this},
/*!
 * Marks this cursor as errored
 */
a.prototype._markError=function(t){return this._error=t,this},a.prototype.close=function(t){return o(t,t=>{this.cursor.close(e=>{if(e)return t(e),this.listeners("error").length>0&&this.emit("error",e);this.emit("close"),t(null)})})},a.prototype.next=function(t){return o(t,t=>{c(this,t)})},a.prototype.eachAsync=function(t,e,n){const r=this;return"function"==typeof e&&(n=e,e={}),s((function(t){return c(r,t)}),t,e=e||{},n)},
/*!
 * ignore
 */
a.prototype.transformNull=function(t){return 0===arguments.length&&(t=!0),this._mongooseOptions.transformNull=t,this},a.prototype.addCursorFlag=function(t,e){const n=this;
/*!
 * ignore
 */
return function(t,e){if(t.cursor)return e();t.once("cursor",(function(){e()}))}(this,(function(){n.cursor.addCursorFlag(t,e)})),this},t.exports=a},function(t,e,n){"use strict";const r=n(49);t.exports=class{constructor(t){null!=t&&Object.assign(this,r(t))}}},function(t,e,n){"use strict";const r=n(49);t.exports=class{constructor(t){null!=t&&Object.assign(this,r(t))}}},function(t,e,n){"use strict";t.exports=function(t){return null!=t&&"TopologyDescription"===t.constructor.name&&Array.from(t.servers.values()).every(t=>"Unknown"===t.type)}},function(t,e,n){"use strict";t.exports=function(t){return null!=t&&"TopologyDescription"===t.constructor.name&&Array.from(t.servers.keys()).every(t=>t.endsWith(".mongodb.net:27017"))}},function(t,e,n){"use strict";const r=n(11);
/*!
 * Register methods for this model
 *
 * @param {Model} model
 * @param {Schema} schema
 */t.exports=function t(e,n){function i(t,n){Object.defineProperty(e.prototype,t,{get:function(){const e={};for(const r in n.methods[t])e[r]=n.methods[t][r].bind(this);return e},configurable:!0})}for(const t of Object.keys(n.methods)){const o=n.methods[t];if(n.tree.hasOwnProperty(t))throw new Error('You have a method and a property in your schema both named "'+t+'"');n.reserved[t]&&!r(n,`methodOptions.${t}.suppressWarning`,!1)&&console.warn(`mongoose: the method name "${t}" is used by mongoose `+"internally, overwriting it may cause bugs. If you're sure you know what you're doing, you can suppress this error by using "+`\`schema.method('${t}', fn, { suppressWarning: true })\`.`),"function"==typeof o?e.prototype[t]=o:i(t,n)}e.$appliedMethods=!0;for(const e of Object.keys(n.paths)){const r=n.paths[e];r.$isSingleNested&&!r.caster.$appliedMethods&&t(r.caster,r.schema),r.$isMongooseDocumentArray&&!r.Constructor.$appliedMethods&&t(r.Constructor,r.schema)}}},function(t,e,n){"use strict";const r=n(139).middlewareFunctions,i=n(24);t.exports=function(t,e,n){e=e.filter(t=>-1!==r.indexOf(t.name)?!!t.model:!1!==t.model),t.$__insertMany=e.createWrapper("insertMany",t.$__insertMany,t,{useErrorHandlers:!0,numCallbackParams:1});for(const r of Object.keys(n))if(e.hasHooks(r)){const n=t[r];t[r]=function(){const o=arguments.length,s=o>0?arguments[o-1]:null,a="function"==typeof s?s:null,c=Array.prototype.slice.call(arguments,0,null==a?o:o-1);return i(a,i=>{e.execPre(r,t,c,(function(o){if(null!=o)return i(o);let s=0;const a=n.apply(t,c.concat(u));function u(n,o){if(!(s++>0))return null!=n?i(n):void e.execPost(r,t,[o],(function(t){if(null!=t)return i(t);i(null,o)}))}null!=a&&"function"==typeof a.then&&a.then(t=>u(null,t),t=>u(t))}))},t.events)}}}},function(t,e,n){"use strict";
/*!
 * Register statics for this model
 * @param {Model} model
 * @param {Schema} schema
 */t.exports=function(t,e){for(const n in e.statics)t[n]=e.statics[n]}},function(t,e,n){"use strict";const r=n(148),i=n(449),o=n(11),s=n(238),a=n(114),c=n(65),u=n(450).default,l=n(12);function h(t){return Array.isArray(t)?t.some(t=>Array.isArray(t))?t.map(t=>h(t)):t.length:null==t?0:1}
/*!
 * 1) Apply backwards compatible find/findOne behavior to sub documents
 *
 *    find logic:
 *      a) filter out non-documents
 *      b) remove _id from sub docs when user specified
 *
 *    findOne
 *      a) if no doc found, set to null
 *      b) remove _id from sub docs when user specified
 *
 * 2) Remove _ids when specified by users query.
 *
 * background:
 * _ids are left in the query even when user excludes them so
 * that population mapping can occur.
 */function f(t,e,n){if(Array.isArray(t)){const r=[],i=t.length;for(let o=0;o<i;++o){const i=t[o];if((d(i)||n.retainNullValues&&null==i)&&(p(i,e),r.push(i),e.originalLimit&&r.length>=e.originalLimit))break}for(;t.length>r.length;)Array.prototype.pop.apply(t,[]);for(let e=0;e<r.length;++e)t[e]=r[e];return t}return d(t)?(p(t,e),t):t instanceof Map?t:!0===n.justOne?null==t?t:null:!1===n.justOne?[]:t}
/*!
 * Remove _id from `subdoc` if user specified "lean" query option
 */function p(t,e){e.excludeId&&("function"==typeof t.$__setValue?delete t._doc._id:delete t._id)}
/*!
 * Determine if `obj` is something we can set a populated path to. Can be a
 * document, a lean document, or an array/map that contains docs.
 */function d(t){return null!=t&&(Array.isArray(t)||t.$isMongooseMap||null!=t.$__||a.has(t))}t.exports=function(t){const e=o(t,"allOptions.options.options"),n=Object.assign({},t.options,e,{justOne:t.justOne});n.$nullIfNotFound=t.isVirtual;const p=t.populatedModel,d=[].concat(t.rawIds);i(t.rawIds,t.rawDocs,t.rawOrder,n);const m=t.docs,y=t.rawIds,g=t.options,v=t.count&&t.isVirtual;function b(e){if(v)return e;if(e instanceof r)return e.val;if(!0===t.justOne&&Array.isArray(e)){const t=[];for(const n of e){const e=a.get(n);null!=e&&e!==p||t.push(n)}for(;e.length>t.length;)Array.prototype.pop.apply(e,[]);for(let n=0;n<t.length;++n)e[n]=t[n];return f(e[0],g,n)}return!1!==t.justOne||Array.isArray(e)?f(e,g,n):f([e],g,n)}for(let e=0;e<m.length;++e){const n=l.getValue(t.path,m[e]);if(null==n&&!s(t.originalModel.schema,t.path))continue;let r;r=v?h(y[e]):Array.isArray(t.match)?Array.isArray(y[e])?u(t.match[e],y[e]):u(t.match[e],[y[e]])[0]:y[e];const i=t.originalModel.schema,a=null!=o(m[e],"$__",null);let f=a?n instanceof Map:l.isPOJO(n);if(f=f&&o(i._getSchema(t.path),"$isSchemaMap"),!t.isVirtual&&f){const t=n instanceof Map?Array.from(n.keys()):Object.keys(n);r=r.reduce((e,n,r)=>(e.set(t[r],n),e),new Map)}if(t.isVirtual&&a){m[e].populated(t.path,t.justOne?d[0]:d,t.allOptions),c.set(t.path,r,m[e],b);continue}const p=t.path.split(".");let g=m[e];const _=p[0];for(let t=0;t<p.length-1&&(!Array.isArray(g)||l.isArrayIndex(p[t]));++t){if(null==g[p[t]]){const e=i._getSchema(_);if(null==r&&null!=e&&e.$isMongooseArray)return;g[p[t]]={}}if(g=g[p[t]],"object"!=typeof g)return}m[e].$__&&m[e].populated(t.path,t.allIds[e],t.allOptions),l.setValue(t.path,r,m[e],b,!1)}}},function(t,e,n){"use strict";const r=n(114),i=n(8).modelSymbol,o=n(12);t.exports=
/*!
 * Assign `vals` returned by mongo query to the `rawIds`
 * structure returned from utils.getVals() honoring
 * query sort order if specified by user.
 *
 * This can be optimized.
 *
 * Rules:
 *
 *   if the value of the path is not an array, use findOne rules, else find.
 *   for findOne the results are assigned directly to doc path (including null results).
 *   for find, if user specified sort order, results are assigned directly
 *   else documents are put back in original order of array if found in results
 *
 * @param {Array} rawIds
 * @param {Array} vals
 * @param {Boolean} sort
 * @api private
 */
function t(e,n,s,a,c){const u=[],l=a.sort&&e.length>1,h=a.$nullIfNotFound;let f,p,d;for(let m=0;m<e.length;++m)if(d=e[m],Array.isArray(d))t(d,n,s,a,!0),u.push(d);else if(null!==d||l){if(p=String(d),f=n[p],a.clone&&null!=f)if(a.lean){const t=r.get(f);f=o.clone(f),r.set(f,t)}else f=f.constructor.hydrate(f._doc);c?f?l?u[s[p]]=f:u.push(f):null!=d&&null!=d[i]?u.push(d):u.push(a.retainNullValues||h?null:d):u[m]=f||null}else u.push(d);e.length=0,u.length&&u.forEach((function(t,n){e[n]=t}))}},function(t,e,n){"use strict";function r(t){return"function"==typeof t}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return t instanceof Date?t.getTime():i(t)?t.map(o):t&&"function"==typeof t.toJSON?t.toJSON():t}function s(t,e){return r(t.get)?t.get(e):t[e]}function a(t){return function(e,n){if(!i(n)||!n.length)return t(e,n);for(var r=0,o=n.length;r<o;r++)if(t(e,s(n,r)))return!0;return!1}}function c(t,e,n,r){return t.v(t.a,e,n,r)}n.r(e),n.d(e,"default",(function(){return v})),n.d(e,"indexOf",(function(){return b})),n.d(e,"compare",(function(){return _}));var u,l={$eq:a((function(t,e){return t(e)})),$ne:(u=function(t,e){return!t(e)},function(t,e){if(!i(e)||!e.length)return u(t,e);for(var n=0,r=e.length;n<r;n++)if(!u(t,s(e,n)))return!1;return!0}),$gt:a((function(t,e){return _(o(e),t)>0})),$gte:a((function(t,e){return _(o(e),t)>=0})),$lt:a((function(t,e){return _(o(e),t)<0})),$lte:a((function(t,e){return _(o(e),t)<=0})),$mod:a((function(t,e){return e%t[0]==t[1]})),$in:function(t,e){if(!(e instanceof Array)){var n=o(e);if(n===e&&"object"==typeof e)for(i=t.length;i--;)if(String(t[i])===String(e)&&"[object Object]"!==String(e))return!0;if(void 0===n)for(i=t.length;i--;)if(null==t[i])return!0;for(i=t.length;i--;){var r=c(g(s(t,i),void 0),e,i,t);if(r&&"[object Object]"!==String(r)&&"[object Object]"!==String(e))return!0}return!!~t.indexOf(n)}for(var i=e.length;i--;)if(~t.indexOf(o(s(e,i))))return!0;return!1},$nin:function(t,e,n,r){return!l.$in(t,e,n,r)},$not:function(t,e,n,r){return!c(t,e,n,r)},$type:function(t,e){return null!=e&&(e instanceof t||e.constructor==t)},$all:function(t,e,n,r){return l.$and(t,e,n,r)},$size:function(t,e){return!!e&&t===e.length},$or:function(t,e,n,r){for(var i=0,o=t.length;i<o;i++)if(c(s(t,i),e,n,r))return!0;return!1},$nor:function(t,e,n,r){return!l.$or(t,e,n,r)},$and:function(t,e,n,r){for(var i=0,o=t.length;i<o;i++)if(!c(s(t,i),e,n,r))return!1;return!0},$regex:a((function(t,e){return"string"==typeof e&&t.test(e)})),$where:function(t,e,n,r){return t.call(e,e,n,r)},$elemMatch:function(t,e,n,r){return i(e)?!!~f(e,t):c(t,e,n,r)},$exists:function(t,e,n,r){return r.hasOwnProperty(n)===t}},h={$eq:function(t){return t instanceof RegExp?function(e){return"string"==typeof e&&t.test(e)}:t instanceof Function?t:i(t)&&!t.length?function(t){return i(t)&&!t.length}:null===t?function(t){return null==t}:function(e){return 0===_(o(e),o(t))}},$ne:function(t){return h.$eq(t)},$and:function(t){return t.map(y)},$all:function(t){return h.$and(t)},$or:function(t){return t.map(y)},$nor:function(t){return t.map(y)},$not:function(t){return y(t)},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return"string"==typeof t?new Function("obj","return "+t):t},$elemMatch:function(t){return y(t)},$exists:function(t){return!!t}};function f(t,e){for(var n=0;n<t.length;n++){s(t,n);if(c(e,s(t,n)))return n}return-1}function p(t,e){return{a:t,v:e}}function d(t,e){var n=[];if(function t(e,n,r,o,a){if(r===n.length||null==e)return void a.push([e,n[r-1],o]);var c=s(n,r);if(i(e)&&isNaN(Number(c)))for(var u=0,l=e.length;u<l;u++)t(s(e,u),n,r,e,a);else t(s(e,c),n,r+1,e,a)}(e,t.k,0,e,n),1===n.length){var r=n[0];return c(t.nv,r[0],r[1],r[2])}for(var o=t&&t.q&&void 0!==t.q.$ne,a=o,u=0;u<n.length;u++){var l=n[u],h=c(t.nv,l[0],l[1],l[2]);o?a&=h:a|=h}return a}function m(t,e,n){return{a:{k:t,nv:e,q:n},v:d}}function y(t){var e;(t=o(t))&&((e=t)&&e.constructor===Object)||(t={$eq:t});var n=[];for(var r in t){var i=t[r];if("$options"!==r)if(l[r])h[r]&&(i=h[r](i,t)),n.push(p(o(i),l[r]));else{if(36===r.charCodeAt(0))throw new Error("Unknown operation "+r);n.push(m(r.split("."),y(i),i))}}return 1===n.length?n[0]:p(n,l.$and)}function g(t,e){var n=y(t);return e&&(n={a:n,v:function(t,n,r,i){return c(t,e(n),r,i)}}),n}function v(t,e,n){r(e)&&(n=e,e=void 0);var i=g(t,n);function o(t,e,n){return c(i,t,e,n)}return e?e.filter(o):o}function b(t,e,n){return f(e,g(t,n))}function _(t,e){if(t===e)return 0;if(typeof t==typeof e){if(t>e)return 1;if(t<e)return-1}}},function(t,e,n){"use strict";const r=n(39),i=n(210),o=n(212),s=n(80),a=n(232),c=n(234);function u(t,e){null!=t&&t.discriminatorMapping&&!t.discriminatorMapping.isRoot&&(e[t.discriminatorMapping.key]=t.discriminatorMapping.value)}
/*!
 * gets discriminator model if discriminator key is present in object
 */function l(t,e){const n=t.schema.options.discriminatorKey;return null!=e&&e.hasOwnProperty(n)&&(t=r(t,e[n])||t),t}
/*!
 * Given a model and a bulkWrite op, return a thunk that handles casting and
 * validating the individual op.
 */
t.exports=function(t,e,n){const r=t.base.now();return e.insertOne?r=>{const i=l(t,e.insertOne.document),o=new i(e.insertOne.document);null!=i.schema.options.timestamps&&o.initializeTimestamps(),null!=n.session&&o.$session(n.session),e.insertOne.document=o,e.insertOne.document.validate({__noPromise:!0},(function(t){if(t)return r(t,null);r(null)}))}:e.updateOne?h=>{try{if(!e.updateOne.filter)throw new Error("Must provide a filter object.");if(!e.updateOne.update)throw new Error("Must provide an update object.");const h=l(t,e.updateOne.filter),f=h.schema,p=null!=n.strict?n.strict:h.schema.options.strict;if(u(f,e.updateOne.filter),null!=h.schema.$timestamps&&!1!==e.updateOne.timestamps){const t=h.schema.$timestamps.createdAt,n=h.schema.$timestamps.updatedAt;o(r,t,n,e.updateOne.update,{})}i(r,e.updateOne.update,h.schema),e.updateOne.setDefaultsOnInsert&&c(e.updateOne.filter,h.schema,e.updateOne.update,{setDefaultsOnInsert:!0,upsert:e.updateOne.upsert}),e.updateOne.filter=s(h.schema,e.updateOne.filter,{strict:p,upsert:e.updateOne.upsert}),e.updateOne.update=a(h.schema,e.updateOne.update,{strict:p,overwrite:!1,upsert:e.updateOne.upsert})}catch(t){return h(t,null)}h(null)}:e.updateMany?h=>{try{if(!e.updateMany.filter)throw new Error("Must provide a filter object.");if(!e.updateMany.update)throw new Error("Must provide an update object.");const h=l(t,e.updateMany.filter),f=h.schema,p=null!=n.strict?n.strict:h.schema.options.strict;if(e.updateMany.setDefaultsOnInsert&&c(e.updateMany.filter,h.schema,e.updateMany.update,{setDefaultsOnInsert:!0,upsert:e.updateMany.upsert}),null!=h.schema.$timestamps&&!1!==e.updateMany.timestamps){const t=h.schema.$timestamps.createdAt,n=h.schema.$timestamps.updatedAt;o(r,t,n,e.updateMany.update,{})}i(r,e.updateMany.update,h.schema),u(f,e.updateMany.filter),e.updateMany.filter=s(h.schema,e.updateMany.filter,{strict:p,upsert:e.updateMany.upsert}),e.updateMany.update=a(h.schema,e.updateMany.update,{strict:p,overwrite:!1,upsert:e.updateMany.upsert})}catch(t){return h(t,null)}h(null)}:e.replaceOne?r=>{const i=l(t,e.replaceOne.filter),o=i.schema,a=null!=n.strict?n.strict:i.schema.options.strict;u(o,e.replaceOne.filter);try{e.replaceOne.filter=s(i.schema,e.replaceOne.filter,{strict:a,upsert:e.replaceOne.upsert})}catch(t){return r(t,null)}const c=new i(e.replaceOne.replacement,a,!0);null!=i.schema.options.timestamps&&c.initializeTimestamps(),null!=n.session&&c.$session(n.session),e.replaceOne.replacement=c,e.replaceOne.replacement.validate({__noPromise:!0},(function(t){if(t)return r(t,null);r(null)}))}:e.deleteOne?n=>{const r=l(t,e.deleteOne.filter);u(r.schema,e.deleteOne.filter);try{e.deleteOne.filter=s(r.schema,e.deleteOne.filter)}catch(t){return n(t,null)}n(null)}:e.deleteMany?n=>{const r=l(t,e.deleteMany.filter);u(r.schema,e.deleteMany.filter);try{e.deleteMany.filter=s(r.schema,e.deleteMany.filter)}catch(t){return n(t,null)}n(null)}:t=>{t(new Error("Invalid op passed to `bulkWrite()`"),null)}}},function(t,e,n){"use strict";t.exports=function(){return{result:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},insertedCount:0,matchedCount:0,modifiedCount:0,deletedCount:0,upsertedCount:0,upsertedIds:{},insertedIds:{},n:0}}},function(t,e,n){"use strict";const r=n(17),i=n(148),o=n(11),s=n(39),a=n(454),c=n(455),u=n(238),l=n(456),h=n(6),f=n(12),p=n(8).modelSymbol,d=n(8).populateModelSymbol,m=n(78).schemaMixedSymbol;
/*!
 * ignore
 */
function y(t,e){return"function"!=typeof t||t[p]?t:t.call(e,e)}
/*!
 * Retrieve the _id of `val` if a Document or Array of Documents.
 *
 * @param {Array|Document|Any} val
 * @return {Array|Document|Any}
 */function g(t,e){if(null!=t&&null!=t.$__)return t._id;if(Array.isArray(t)){for(let e=0;e<t.length;++e)null!=t[e]&&null!=t[e].$__&&(t[e]=t[e]._id);return t.isMongooseArray&&t.$schema()?t.$schema().cast(t,t.$parent()):[].concat(t)}if(null!=t&&"Object"===t.constructor.name&&(null==e||null==e[m])){const e=[];for(const n of Object.keys(t))e.push(t[n]);return e}return t instanceof Map?Array.from(t.values()):t}t.exports=function(t,e,n){let v,b;const _=e.length,w={},S=[],O=n.model&&n.model.modelName||n.model;let E,T,C,I,A,k,x;const N=n.model;let P=!1;const j=t.schema;let R=c(j,null,n.path);R=Array.isArray(R)?R:[R].filter(t=>null!=t);const M=R.find(t=>null!=o(t,"options.refPath",null));for(v=0;v<_;v++){b=e[v];let s=null;if(E=c(j,b,n.path),null!=E&&E.$isMongooseDocumentArray&&null==E.options.ref&&null==E.options.refPath)continue;if(j.nested[n.path])continue;if(E&&E.$isUnderneathDocArray&&null!=o(n,"options.sort"))return new r("Cannot populate with `sort` on path "+n.path+" because it is a subproperty of a document array");A=null;let a=!!M,h=M?o(M,"options.refPath",null):null;if(Array.isArray(E)){const t=E;for(const e of t){let t,r;try{r=D(b,e),t=r.modelNames,a=a||r.isRefPath,h=l(h,b,n.path)||r.refPath,s=r.justOne}catch(t){return t}if((!a||r.isRefPath)&&t){A=A||[];for(const e of t)-1===A.indexOf(e)&&A.push(e)}}}else{try{const t=D(b,E);A=t.modelNames,a=t.isRefPath,h=t.refPath,s=t.justOne}catch(t){return t}if(!A)continue}const y=u(t.schema,n.path),_=null==y?null:y.virtual;let O,T=!1;if(_&&_.options){const t=y.nestedSchemaPath?y.nestedSchemaPath+".":"";O="function"==typeof _.options.localField?t+_.options.localField.call(b,b):t+_.options.localField,T=_.options.count,null==_.options.skip||n.hasOwnProperty("skip")||(n.skip=_.options.skip),null==_.options.limit||n.hasOwnProperty("limit")||(n.limit=_.options.limit),null==_.options.perDocumentLimit||n.hasOwnProperty("perDocumentLimit")||(n.perDocumentLimit=_.options.perDocumentLimit)}else O=n.path;let x=_&&_.options?_.options.foreignField:"_id";if("justOne"in n&&void 0!==n.justOne)s=n.justOne;else if(_&&_.options&&_.options.refPath){const t=l(_.options.refPath,b,n.path);s=!!_.options.justOne,P=!0;const e=f.getValue(t,b);A=Array.isArray(e)?e:[e]}else if(_&&_.options&&_.options.ref){let t;t="function"==typeof _.options.ref?_.options.ref.call(b,b):_.options.ref,s=!!_.options.justOne,P=!0,A||(A=[].concat(t))}else E&&!E[m]&&(s=Array.isArray(E)?E.every(t=>!t.$isMongooseArray):!E.$isMongooseArray);if(!A)continue;if(_&&(!O||!x))return new r("If you are populating a virtual, you must set the localField and foreignField options");n.isVirtual=P,n.virtual=_,"function"==typeof O&&(O=O.call(b,b)),"function"==typeof x&&(x=x.call(b));const R=j._getPathType(O),$="real"===R?j.path(O):R.schema,L=$&&$.getters?$.getters:[];let F;const B=o(n,"options",{}),U="getters"in B?B.getters:n.isVirtual&&o(_,"options.getters",!1);if(L.length>0&&U){const e=null!=b.$__?b:t.hydrate(b),n=f.getValue(O,b);if(Array.isArray(n)){const t=f.getValue(O.split(".").slice(0,-1),e);F=n.map((e,n)=>$.applyGetters(e,t[n]))}else F=$.applyGetters(n,e)}else F=g(f.getValue(O,b),E);const V=String(f.getValue(x,b));n._docs[V]=Array.isArray(F)?F.slice():F;let q=o(n,"match",null)||o(I,"match",null)||o(n,"virtual.options.match",null)||o(n,"virtual.options.options.match",null);const W="function"==typeof q;if(W&&(q=q.call(b,b)),a&&null!=h){const t=h.split(".");let e="";for(let r=0;r<t.length;++r){const o=t[r];e=e+(0===e.length?"":".")+o;const s=j.path(e);if(null!=s&&s.$isMongooseArray&&null!=s.caster.discriminators&&Object.keys(s.caster.discriminators).length>0){const o=f.getValue(e,b),a=n.path.substr(e.length+1),c=s.caster.schema.options.discriminatorKey;A=[];for(const n of o){const o=f.getValue(c,n),u=s.caster.discriminators[o],l=u&&u.schema;if(null==l)continue;const h=l.path(a);if(null==h||null==h.options.refPath){const t=f.getValue(O.substr(e.length+1),n);F=F.map(e=>e===t?i(e):e);continue}const p=f.getValue(t.slice(r+1).join("."),n);A.push(p)}}}}let z=A.length;for(;z--;){if(k=A[z],null==k)continue;const e=null!=n.connection?n.connection:t.db;try{C=N&&N[p]?N:k[p]?k:e.model(k)}catch(t){return t}let r=F;const i=Array.isArray(F)?f.array.flatten(F):[];a&&Array.isArray(F)&&i.length===A.length&&(r=i.filter((t,e)=>A[e]===k)),w[k]&&null==I.perDocumentLimit?(w[k].localField.add(O),w[k].foreignField.add(x),w[k].docs.push(b),w[k].ids.push(r),w[k].allIds.push(F),W&&w[k].match.push(q)):(I={model:C},P&&o(_,"options.options")&&(I.options=f.clone(_.options.options)),f.merge(I,n),n[d]=C,w[k]={model:C,options:I,match:W?[q]:q,docs:[b],ids:[r],allIds:[F],localField:new Set([O]),foreignField:new Set([x]),justOne:s,isVirtual:P,virtual:_,count:T,[d]:C},S.push(w[k]))}}return S;function D(e,i){let c,p,d=!1,m=null;i&&i.caster&&(i=i.caster),i&&i.$isSchemaMap&&(i=i.$__schemaType),!i&&t.discriminators&&(p=t.schema.discriminatorMapping.key),T=i&&i.options&&i.options.refPath;const g=l(T,e,n.path);if(O)c=[O];else if(g){if(null!=n._queryProjection&&a(n._queryProjection,g))throw new r("refPath `"+g+"` must not be excluded in projection, got "+h.inspect(n._queryProjection));c=j.virtuals.hasOwnProperty(g)&&null==e.$__?[j.virtuals[g].applyGetters(void 0,e)]:f.getValue(g,e),Array.isArray(c)&&(c=f.array.flatten(c)),d=!0}else{let r,a=t;if(!i&&p){if(x=f.getValue(p,e),x){const e=s(t,x);if(null!=e)a=e;else try{a=t.db.model(x)}catch(t){return t}r=a.schema._getSchema(n.path),r&&r.caster&&(r=r.caster)}}else r=i;const h=u(a.schema,n.path),g=null==h?null:h.virtual;let v,b;null!=r&&(m=!r.$isMongooseArray&&!r._arrayPath),null!=(v=o(r,"options.ref"))?(v=y(v,e),c=[v]):null!=(v=o(g,"options.ref"))?(v=y(v,e),c=Array.isArray(v)?v:[v],P=!0):null!=(b=o(r,"options.refPath"))?(d=!0,b=l(b,e,n.path),c=f.getValue(b,e),Array.isArray(c)&&(c=f.array.flatten(c))):c=p?null:[t.modelName]}return c?(Array.isArray(c)||(c=[c]),{modelNames:c,isRefPath:d,refPath:g,justOne:m}):{modelNames:c,isRefPath:d,refPath:g,justOne:m}}}},function(t,e,n){"use strict";const r=n(83);
/*!
 * Determines if `path` is excluded by `projection`
 *
 * @param {Object} projection
 * @param {string} path
 * @return {Boolean}
 */t.exports=function(t,e){if("_id"===e)return 0===t._id;const n=Object.keys(t);let i=null;for(const o of n)if(r(t[o])){i=1===t[e]?"inclusive":"exclusive";break}return"inclusive"===i?1!==t[e]:"exclusive"===i&&0===t[e]}},function(t,e,n){"use strict";
/*!
 * ignore
 */const r=n(77),i=n(11),o=n(114),s=n(65),a=n(8).populateModelSymbol;
/*!
 * @param {Schema} schema
 * @param {Object} doc POJO
 * @param {string} path
 */
t.exports=function(t,e,n){const c=t.path(n),u=e;if(c)return c;const l=n.split(".");for(let t=0;t<l.length;++t)"$"===l[t]&&(l[t]="0");return function t(n,c,l,h){let f,p,d=n.length+1;for(;d--;){if(p=n.slice(0,d).join("."),f=c.path(p),null==f)continue;if(f.caster){if(f.caster instanceof r)return f.caster;let i=null;if(null!=f.schema&&null!=f.schema.discriminators){const t=f.schema.discriminators,n=p+"."+f.schema.options.discriminatorKey,r=l&&s.get(n,l)||[];i=Object.keys(t).reduce((function(n,i){return null!=e&&-1===r.indexOf(i)||n.push(t[i]),n}),[])}if(d!==n.length&&f.schema){let e;if("$"===n[d])return d+1===n.length?f:(e=t(n.slice(d+1),c,l?s.get(p,l):null,h.concat(n.slice(0,d))),e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!f.schema.$isSingleNested),e);if(null!=i&&i.length>0){e=[];for(const r of i){const i=t(n.slice(d),r,l?s.get(p,l):null,h.concat(n.slice(0,d)));null!=i&&(i.$isUnderneathDocArray=i.$isUnderneathDocArray||!f.schema.$isSingleNested,i.$isUnderneathDocArray&&(e.$isUnderneathDocArray=!0),e.push(i))}return e}return e=t(n.slice(d),f.schema,l?s.get(p,l):null,h.concat(n.slice(0,d))),e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!f.schema.$isSingleNested),e}if(d!==n.length&&f.$isMongooseArray&&f.casterConstructor.$isMongooseArray){let e=f;for(;e.$isMongooseArray&&!e.$isMongooseDocumentArray;)e=e.casterConstructor;return t(n.slice(d),e.schema,null,h.concat(n.slice(0,d)))}}const m=h.concat([p]).join(".");if(null!=u&&u.$__&&u.populated(m)&&d<n.length){const r=e.$__.populated[m].options[a];if(null!=r){const e=t(n.slice(d),r.schema,l?s.get(p,l):null,h.concat(n.slice(0,d)));return e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!r.schema.$isSingleNested),e}}const y=i(u,p);if(null!=y){const e=Array.isArray(y)&&y.length>0?o.get(y[0]):o.get(y),r=null!=e?e.schema:null;if(null!=r){const e=t(n.slice(d),r,l?s.get(p,l):null,h.concat(n.slice(0,d)));return e&&(e.$isUnderneathDocArray=e.$isUnderneathDocArray||!r.$isSingleNested),e}}return f}}(l,t,e,[])}},function(t,e,n){"use strict";t.exports=function(t,e,n){if(null==t)return t;"function"==typeof t&&(t=t.call(e,e,n));const r=/(\.\d+$|\.\d+\.)/g;if(r.test(n)){const e=n.split(r);if(""===e[e.length-1])throw new Error("Can't populate individual element in an array");let i="",o=t;for(let t=0;t<e.length;t+=2){const n=e[t];if(!o.startsWith(n+".")){if(t===e.length-1){i+=o,o="";break}throw new Error("Could not normalize ref path, chunk "+n+" not in populated path")}i+=o.substr(0,n.length)+e[t+1],o=o.substr(n.length+1)}return i}return t}},function(t,e,n){"use strict";const r=n(11);t.exports=function(t){if(Array.isArray(t)){const e=Object.keys(t[0]);return 1===e.length&&"_id"===e[0]&&"hashed"!==t[0]._id}if("object"!=typeof t)return!1;const e=r(t,"key",{});return 1===Object.keys(e).length&&e.hasOwnProperty("_id")}},function(t,e,n){"use strict";const r=n(11),i=n(12);t.exports=function(t,e,n){if(null!=n.textIndexVersion){const i=n.weights;if(Object.keys(i).length!==Object.keys(t).length)return!1;for(const n of Object.keys(i)){if(!(n in t))return!1;const o=i[n];if(o!==r(e,"weights."+n)&&(1!==o||null!=r(e,"weights."+n)))return!1}return e.default_language===n.default_language||"english"===n.default_language&&null==e.default_language}const o=["unique","partialFilterExpression","sparse","expireAfterSeconds","collation"];for(const t of o)if(t in e||t in n)if("collation"===t){if(null==e[t]||null==n[t])return null==e[t]&&null==n[t];const i=Object.keys(e.collation),o=e.collation,s=n.collation;for(const t of i)if(r(o,t)!==r(s,t))return!1}else if(!i.deepEqual(e[t],n[t]))return!1;const s=Object.keys(t),a=Object.keys(n.key);if(s.length!==a.length)return!1;for(let e=0;e<s.length;++e){if(s[e]!==a[e])return!1;if(!i.deepEqual(t[s[e]],n.key[a[e]]))return!1}return!0}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t,e){const n=e.split(".");let r,i,o,s="";for(let a=0;a<n.length;++a)if(s+=s.length?".":""+n[a],t[s]){for(i=Object.keys(t),o=i.length,r=0;r<o;++r)0!==i[a].indexOf(s+".")||i[a].indexOf(e);return!0}return!1}},function(t,e,n){"use strict";t.exports=
/*!
 * ignore
 */
function(t,e,n){let r=0,i=0,o=null;if(e<=0)throw new Error("Limit must be positive");if(0===t.length)return n(null,[]);for(let n=0;n<t.length&&n<e;++n)s();function s(){var e;t[i+r]((e=i+r,(c,u)=>{if(--r,++i,null==o){if(null!=c)return o=c,n(o);if(a[e]=u,i===t.length)return n(null,a);i+r<t.length&&s()}})),++r}const a=[]}},function(t,e,n){"use strict";const r=n(11),i=n(65),o=n(233);
/*!
 * ignore
 */
t.exports=function(t,e,n){const s=o(r(e,"select",null),!0)||o(r(e,"options.select",null),!0);if(null!=s)for(const e of t)if(s.hasOwnProperty("-"+e))for(const t of n)null!=t.$__?i.unset(e,t._doc):i.unset(e,t)}},function(t,e){t.exports=
/*!
 * Pluralize function.
 *
 * @author TJ Holowaychuk (extracted from _ext.js_)
 * @param {String} string to pluralize
 * @api private
 */
function(t){var e;if(t=t.toLowerCase(),!~r.indexOf(t)&&(e=n.filter((function(e){return t.match(e[0])})))[0])return t.replace(e[0][0],e[0][1]);return t},e.pluralization=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(kn|w|l)ife$/gi,"$1ives"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/([^a-z])$/,"$1"],[/$/gi,"s"]];var n=e.pluralization;e.uncountables=["advice","energy","excretion","digestion","cooperation","health","justice","labour","machinery","equipment","information","pollution","sewage","paper","money","species","series","rain","rice","fish","sheep","moose","deer","news","expertise","status","media"];var r=e.uncountables},function(t,e,n){"use strict";const r=n(149);
/*!
 * ignore
 */t.exports=function(t){t.s.hooks.pre("remove",!1,(function(t){if(this.ownerDocument)return void t();const e=this,n=this.$__getAllSubdocs();r(n,(function(t,e){t.$__remove(e)}),(function(n){if(n)return e.schema.s.hooks.execPost("remove:error",e,[e],{error:n},(function(e){t(e)}));t()}))}),null,!0)}},function(t,e,n){"use strict";const r=n(149);
/*!
 * ignore
 */t.exports=function(t){t.s.hooks.pre("save",!1,(function(t){if(this.ownerDocument)return void t();const e=this,n=this.$__getAllSubdocs();n.length?r(n,(function(t,e){t.schema.s.hooks.execPre("save",t,(function(t){e(t)}))}),(function(n){if(n)return e.schema.s.hooks.execPost("save:error",e,[e],{error:n},(function(e){t(e)}));t()})):t()}),null,!0),t.s.hooks.post("save",(function(t,e){if(this.ownerDocument)return void e();const n=this,i=this.$__getAllSubdocs();i.length?r(i,(function(t,e){t.schema.s.hooks.execPost("save",t,[t],(function(t){e(t)}))}),(function(t){if(t)return n.schema.s.hooks.execPost("save:error",n,[n],{error:t},(function(t){e(t)}));e()})):e()}),null,!0)}},function(t,e,n){"use strict";
/*!
 * ignore
 */t.exports=function(t){t.pre("save",!1,(function(t,e){const n=this;if(this.ownerDocument)return t();let r;if(r=e&&"object"==typeof e&&"validateBeforeSave"in e?!!e.validateBeforeSave:this.schema.options.validateBeforeSave,r){const r=e&&"object"==typeof e&&"validateModifiedOnly"in e?{validateModifiedOnly:e.validateModifiedOnly}:null;this.validate(r,(function(e){return n.schema.s.hooks.execPost("save:error",n,[n],{error:e},(function(e){n.$op="save",t(e)}))}))}else t()}),null,!0)}},function(t,e,n){"use strict";const r=n(8).objectIdSymbol,i=n(12);
/*!
 * ignore
 */
function o(){let t,e;if(this.$__.shardval){t=Object.keys(this.$__.shardval),e=t.length,this.$where=this.$where||{};for(let n=0;n<e;++n)this.$where[t[n]]=this.$__.shardval[t[n]]}}
/*!
 * ignore
 */
/*!
 * ignore
 */
function s(){const t=this.schema.options.shardKey||this.schema.options.shardkey;if(!i.isPOJO(t))return;const e=this.$__.shardval={},n=Object.keys(t),o=n.length;let s;for(let t=0;t<o;++t)s=this.$__getValue(n[t]),null==s?e[n[t]]=s:i.isMongooseObject(s)?e[n[t]]=s.toObject({depopulate:!0,_isNested:!0}):s instanceof Date||s[r]?e[n[t]]=s:"function"==typeof s.valueOf?e[n[t]]=s.valueOf():e[n[t]]=s}
/*!
 * ignore
 */
t.exports=function(t){t.post("init",(function(){return s.call(this),this})),t.pre("save",(function(t){o.call(this),t()})),t.pre("remove",(function(t){o.call(this),t()})),t.post("save",(function(){s.call(this)}))},t.exports.storeShard=s},function(t,e,n){"use strict";"undefined"!=typeof jest&&"undefined"!=typeof window&&console.warn("Mongoose: looks like you're trying to test a Mongoose app with Jest's default jsdom test environment. Please make sure you read Mongoose's docs on configuring Jest to test Node.js apps: http://mongoosejs.com/docs/jest.html")},function(t,e,n){var r={"./connection":241,"./drivers/node-mongodb-native/connection":469};function i(t){var e=o(t);return n(e)}function o(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=o,t.exports=i,i.id=468},function(t,e,n){"use strict";
/*!
 * Module dependencies.
 */const r=n(241),i=n(105);function o(){r.apply(this,arguments),this._listening=!1}o.STATES=i,
/*!
 * Inherits from Connection.
 */
o.prototype.__proto__=r.prototype,o.prototype.useDb=function(t,e){if(e&&e.useCache&&this.relatedDbs[t])return this.relatedDbs[t];const n=new this.constructor;n.name=t,n.base=this.base,n.collections={},n.models={},n.replica=this.replica,n.config=Object.assign({},this.base.connection.config,n.config),n.name=this.name,n.options=this.options,n._readyState=this._readyState,n._closeCalled=this._closeCalled,n._hasOpened=this._hasOpened,n._listening=!1,n.host=this.host,n.port=this.port,n.user=this.user,n.pass=this.pass;const r=this;function o(){n.client=r.client,n.db=r.client.db(t),n.onOpen(),
/*!
 * Register listeners for important events and bubble appropriately.
 */
function(t){if(t.db._listening)return;t.db._listening=!0,t.db.on("close",(function(e){if(!t._closeCalled)return t.db.serverConfig.autoReconnect?(t.readyState=i.disconnected,void t.emit("close")):void t.onClose(e)})),t.db.on("error",(function(e){t.emit("error",e)})),t.db.on("reconnect",(function(){t.readyState=i.connected,t.emit("reconnect"),t.emit("reconnected"),t.onOpen()})),t.db.on("timeout",(function(e){t.emit("timeout",e)})),t.db.on("open",(function(e,n){i.disconnected===t.readyState&&n&&n.databaseName&&(t.readyState=i.connected,t.emit("reconnect"),t.emit("reconnected"))})),t.db.on("parseError",(function(e){t.emit("parseError",e)}))}(n)}return n.client=r.client,this.db&&this._readyState===i.connected?o():this.once("connected",o),n.name=t,this.otherDbs.push(n),n.otherDbs.push(this),e&&e.useCache&&(this.relatedDbs[n.name]=n,n.relatedDbs=this.relatedDbs),n},o.prototype.doClose=function(t,e){return this.client.close(t,(t,n)=>{setTimeout(()=>e(t,n),1)}),this},
/*!
 * Module exports.
 */
t.exports=o},function(t,e,n){var r={"./collection":191,"./drivers/node-mongodb-native/collection":190};function i(t){var e=o(t);return n(e)}function o(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=o,t.exports=i,i.id=470},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var r=n(18);(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};var n=function(t){t=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,t];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}return globalThis}(this);function i(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function o(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:i(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var s=t[o];s in i||(i[s]={}),i=i[s]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",(function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.a=null}function i(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;r.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c((function(){e.g()}))}this.a.push(t)};var s=n.setTimeout;r.prototype.c=function(t){s(t,0)},r.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},r.prototype.f=function(t){this.c((function(){throw t}))},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.s(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.w(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)a.b(this.a[t]);this.a=null}};var a=new r;return e.prototype.s=function(t){var e=this.f();t.Oa(e.resolve,e.reject)},e.prototype.w=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,s=new e((function(t,e){i=t,o=e}));return this.Oa(r(t,i),r(n,o)),s},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Oa=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?a.b(n):this.a.push(n)},e.resolve=i,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=o(t),s=r.next();!s.done;s=r.next())i(s.value).Oa(e,n)}))},e.all=function(t){var n=o(t),r=n.next();return r.done?i([]):new e((function(t,e){function o(e){return function(n){s[e]=n,0==--a&&t(s)}}var s=[],a=0;do{s.push(void 0),a++,i(r.value).Oa(o(s.length-1),e),r=n.next()}while(!r.done)}))},e}));var s=s||{},a=this||self,c=/^[\w+/_-]+[=]{0,2}$/,u=null;function l(){}function h(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function f(t){var e=h(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){return"function"==h(t)}function d(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function m(t){return Object.prototype.hasOwnProperty.call(t,y)&&t[y]||(t[y]=++g)}var y="closure_uid_"+(1e9*Math.random()>>>0),g=0;function v(t,e,n){return t.call.apply(t.bind,arguments)}function b(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:b).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function O(t,e){function n(){}n.prototype=e.prototype,t.Za=e.prototype,t.prototype=new n,t.prototype.constructor=t}function E(t,e,n){this.code=I+t,this.message=e||A[t]||"",this.a=n||null}function T(t){var e=t&&t.code;return e?new E(e.substring(I.length),t.message,t.serverResponse):null}O(E,Error),E.prototype.v=function(){var t={code:this.code,message:this.message};return this.a&&(t.serverResponse=this.a),t},E.prototype.toJSON=function(){return this.v()};var C,I="auth/",A={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},k={hd:{Ra:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Xa:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Ua:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},pd:{Ra:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",Xa:"https://securetoken.googleapis.com/v1/token",Ua:"https://identitytoolkit.googleapis.com/v2/",id:"p"},rd:{Ra:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Xa:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Ua:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},sd:{Ra:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",Xa:"https://test-securetoken.sandbox.googleapis.com/v1/token",Ua:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function x(t){for(var e in k)if(k[e].id===t)return{firebaseEndpoint:(t=k[e]).Ra,secureTokenEndpoint:t.Xa,identityPlatformEndpoint:t.Ua};return null}function N(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function P(t){if(Error.captureStackTrace)Error.captureStackTrace(this,P);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function j(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");P.call(this,n+t[r])}function R(t,e){throw new j("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function M(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function $(){this.b=this.a=null}C=x("__EID__")?"__EID__":void 0,O(P,Error),P.prototype.name="CustomError",O(j,P),j.prototype.name="AssertionError",M.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var L=new M((function(){return new B}),(function(t){t.reset()}));function F(){var t=ge,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function B(){this.next=this.b=this.a=null}$.prototype.add=function(t,e){var n=L.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},B.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},B.prototype.reset=function(){this.next=this.b=this.a=null};var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},V=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var q=Array.prototype.filter?function(t,e){return Array.prototype.filter.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=[],i=0,o="string"==typeof t?t.split(""):t,s=0;s<n;s++)if(s in o){var a=o[s];e.call(void 0,a,s,t)&&(r[i++]=a)}return r},W=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i="string"==typeof t?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},z=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function H(t,e){return 0<=U(t,e)}function K(t,e){var n;return(n=0<=(e=U(t,e)))&&Array.prototype.splice.call(t,e,1),n}function G(t,e){!function(t,e){for(var n="string"==typeof t?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,(function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0}))}function Q(t){return Array.prototype.concat.apply([],arguments)}function Y(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var X,J=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},Z=/&/g,tt=/</g,et=/>/g,nt=/"/g,rt=/'/g,it=/\x00/g,ot=/[\x00&<>"']/;function st(t,e){return-1!=t.indexOf(e)}function at(t,e){return t<e?-1:t>e?1:0}t:{var ct=a.navigator;if(ct){var ut=ct.userAgent;if(ut){X=ut;break t}}X=""}function lt(t){return st(X,t)}function ht(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function ft(t){for(var e in t)return!1;return!0}function pt(t){var e,n={};for(e in t)n[e]=t[e];return n}var dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<dt.length;o++)n=dt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function yt(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(d(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;R("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}function gt(t,e){this.a=t===_t&&e||"",this.b=bt}function vt(t){return t instanceof gt&&t.constructor===gt&&t.b===bt?t.a:(R("expected object of type Const, got '"+t+"'"),"type_error:Const")}gt.prototype.ra=!0,gt.prototype.qa=function(){return this.a},gt.prototype.toString=function(){return"Const{"+this.a+"}"};var bt={},_t={},wt=new gt(_t,"");function St(t,e){this.a=t===At&&e||"",this.b=It}function Ot(t){return t instanceof St&&t.constructor===St&&t.b===It?t.a:(R("expected object of type TrustedResourceUrl, got '"+t+"' of type "+h(t)),"type_error:TrustedResourceUrl")}function Et(t,e){var n=vt(t);if(!Ct.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return t=n.replace(Tt,(function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof gt?vt(t):encodeURIComponent(String(t))})),new St(At,t)}St.prototype.ra=!0,St.prototype.qa=function(){return this.a.toString()},St.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Tt=/%{(\w+)}/g,Ct=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,It={},At={};function kt(t,e){this.a=t===Rt&&e||"",this.b=jt}function xt(t){return t instanceof kt&&t.constructor===kt&&t.b===jt?t.a:(R("expected object of type SafeUrl, got '"+t+"' of type "+h(t)),"type_error:SafeUrl")}kt.prototype.ra=!0,kt.prototype.qa=function(){return this.a.toString()},kt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Nt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Pt(t){return t instanceof kt?t:(t="object"==typeof t&&t.ra?t.qa():String(t),Nt.test(t)||(t="about:invalid#zClosurez"),new kt(Rt,t))}var jt={},Rt={};function Mt(){this.a="",this.b=$t}function Dt(t){return t instanceof Mt&&t.constructor===Mt&&t.b===$t?t.a:(R("expected object of type SafeHtml, got '"+t+"' of type "+h(t)),"type_error:SafeHtml")}Mt.prototype.ra=!0,Mt.prototype.qa=function(){return this.a.toString()},Mt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var $t={};function Lt(t){var e=new Mt;return e.a=t,e}Lt("<!DOCTYPE html>");var Ft=Lt("");function Bt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Ut(t){return ot.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(Z,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(tt,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(et,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(nt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(rt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(it,"&#0;"))),t}function Vt(t){return Vt[" "](t),t}Lt("<br>"),Vt[" "]=l;var qt,Wt,zt=lt("Opera"),Ht=lt("Trident")||lt("MSIE"),Kt=lt("Edge"),Gt=Kt||Ht,Qt=lt("Gecko")&&!(st(X.toLowerCase(),"webkit")&&!lt("Edge"))&&!(lt("Trident")||lt("MSIE"))&&!lt("Edge"),Yt=st(X.toLowerCase(),"webkit")&&!lt("Edge");function Xt(){var t=a.document;return t?t.documentMode:void 0}t:{var Jt="",Zt=(Wt=X,Qt?/rv:([^\);]+)(\)|;)/.exec(Wt):Kt?/Edge\/([\d\.]+)/.exec(Wt):Ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Wt):Yt?/WebKit\/(\S+)/.exec(Wt):zt?/(?:Version)[ \/]?(\S+)/.exec(Wt):void 0);if(Zt&&(Jt=Zt?Zt[1]:""),Ht){var te=Xt();if(null!=te&&te>parseFloat(Jt)){qt=String(te);break t}}qt=Jt}var ee,ne={};function re(t){return function(t,e){var n=ne;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=J(String(qt)).split("."),r=J(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=at(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||at(0==s[2].length,0==a[2].length)||at(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}ee=a.document&&Ht?Xt():void 0;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(Wt){}var ie=!Ht||9<=Number(ee);function oe(t){var e=document;return"string"==typeof t?e.getElementById(t):t}function se(t,e){ht(e,(function(e,n){e&&"object"==typeof e&&e.ra&&(e=e.qa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:ue.hasOwnProperty(n)?t.setAttribute(ue[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e}))}var ae,ce,ue={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function le(t,e,n){function r(n){n&&e.appendChild("string"==typeof n?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!f(o)||d(o)&&0<o.nodeType?r(o):V(fe(o)?Y(o):o,r)}}function he(t,e){return e=String(e),"application/xhtml+xml"===t.contentType&&(e=e.toLowerCase()),t.createElement(e)}function fe(t){if(t&&"number"==typeof t.length){if(d(t))return"function"==typeof t.item||"string"==typeof t.item;if(p(t))return"function"==typeof t.item}return!1}function pe(t){a.setTimeout((function(){throw t}),0)}function de(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!lt("Presto")&&(t=function(){var t=he(document,"IFRAME");t.style.display="none",function(t){var e=new St(At,vt(wt));yt(t,"HTMLIFrameElement"),t.src=Ot(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(Dt(Ft)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_((function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!lt("Trident")&&!lt("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).Db;n.Db=null,t()}},function(t){r.next={Db:t},r=r.next,e.port2.postMessage(0)}}return function(t){a.setTimeout(t,0)}}function me(t,e){ce||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);ce=function(){t.then(ve)}}else ce=function(){var t=ve;!p(a.setImmediate)||a.Window&&a.Window.prototype&&!lt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(ae||(ae=de()),ae(t)):a.setImmediate(t)}}(),ye||(ce(),ye=!0),ge.add(t,e)}var ye=!1,ge=new $;function ve(){for(var t;t=F();){try{t.a.call(t.b)}catch(t){pe(t)}D(L,t)}ye=!1}function be(t,e){if(this.a=_e,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,(function(t){Pe(n,we,t)}),(function(t){if(!(t instanceof Fe))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Pe(n,Se,t)}))}catch(t){Pe(this,Se,t)}}var _e=0,we=2,Se=3;function Oe(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Oe.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Ee=new M((function(){return new Oe}),(function(t){t.reset()}));function Te(t,e,n){var r=Ee.get();return r.g=t,r.b=e,r.f=n,r}function Ce(t){if(t instanceof be)return t;var e=new be(l);return Pe(e,we,t),e}function Ie(t){return new be((function(e,n){n(t)}))}function Ae(t,e,n){je(t,e,n,null)||me(w(e,t))}function ke(t){return new be((function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Mb:!0,value:o}:{Mb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Ae(t[o],w(i,o,!0),w(i,o,!1));else e(r)}))}function xe(t,e){t.b||t.a!=we&&t.a!=Se||Re(t),t.f?t.f.next=e:t.b=e,t.f=e}function Ne(t,e,n,r){var i=Te(null,null,null);return i.a=new be((function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof Fe?o(e):t(i)}catch(t){o(t)}}:o})),i.a.c=t,xe(t,i),i.a}function Pe(t,e,n){t.a==_e&&(t===n&&(e=Se,n=new TypeError("Promise cannot resolve to itself")),t.a=1,je(n,t.Yc,t.Zc,t)||(t.i=n,t.a=e,t.c=null,Re(t),e!=Se||n instanceof Fe||function(t,e){t.g=!0,me((function(){t.g&&Le.call(null,e)}))}(t,n)))}function je(t,e,n,r){if(t instanceof be)return xe(t,Te(e||l,n||null,r)),!0;if(N(t))return t.then(e,n,r),!0;if(d(t))try{var i=t.then;if(p(i))return function(t,e,n,r,i){function o(t){s||(s=!0,r.call(i,t))}var s=!1;try{e.call(t,(function(t){s||(s=!0,n.call(i,t))}),o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function Re(t){t.h||(t.h=!0,me(t.ec,t))}function Me(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function De(t,e,n,r){if(n==Se&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,$e(e,n,r);else try{e.c?e.g.call(e.f):$e(e,n,r)}catch(t){Le.call(null,t)}D(Ee,e)}function $e(t,e,n){e==we?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}be.prototype.then=function(t,e,n){return Ne(this,p(t)?t:null,p(e)?e:null,n)},be.prototype.$goog_Thenable=!0,(t=be.prototype).ma=function(t,e){return(t=Te(t,t,e)).c=!0,xe(this,t),this},t.o=function(t,e){return Ne(this,null,t,e)},t.cancel=function(t){if(this.a==_e){var e=new Fe(t);me((function(){!function t(e,n){if(e.a==_e)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,s=null,a=r.b;a&&(a.c||(i++,a.a==e&&(o=a),!(o&&1<i)));a=a.next)o||(s=a);o&&(r.a==_e&&1==i?t(r,n):(s?((i=s).next==r.f&&(r.f=i),i.next=i.next.next):Me(r),De(r,o,Se,n)))}e.c=null}else Pe(e,Se,n)}(this,e)}),this)}},t.Yc=function(t){this.a=_e,Pe(this,we,t)},t.Zc=function(t){this.a=_e,Pe(this,Se,t)},t.ec=function(){for(var t;t=Me(this);)De(this,t,this.a,this.i);this.h=!1};var Le=pe;function Fe(t){P.call(this,t)}function Be(){0!=Ue&&(Ve[m(this)]=this),this.wa=this.wa,this.na=this.na}O(Fe,P),Fe.prototype.name="cancel";var Ue=0,Ve={};function qe(t){if(!t.wa&&(t.wa=!0,t.Ba(),0!=Ue)){var e=m(t);if(0!=Ue&&t.na&&0<t.na.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Ve[e]}}Be.prototype.wa=!1,Be.prototype.Ba=function(){if(this.na)for(;this.na.length;)this.na.shift()()};var We=Object.freeze||function(t){return t},ze=!Ht||9<=Number(ee),He=Ht&&!re("9"),Ke=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Ge(t,e){this.type=t,this.b=this.target=e,this.defaultPrevented=!1}function Qe(t,e){if(Ge.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Qt){t:{try{Vt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Ye[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Ge.prototype.preventDefault=function(){this.defaultPrevented=!0},O(Qe,Ge);var Ye=We({2:"touch",3:"pen",4:"mouse"});Qe.prototype.preventDefault=function(){Qe.Za.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,He)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},Qe.prototype.f=function(){return this.a};var Xe="closure_listenable_"+(1e6*Math.random()|0),Je=0;function Ze(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ta=i,this.key=++Je,this.ua=this.Na=!1}function tn(t){t.ua=!0,t.listener=null,t.proxy=null,t.src=null,t.Ta=null}function en(t){this.src=t,this.a={},this.b=0}function nn(t,e){var n=e.type;n in t.a&&K(t.a[n],e)&&(tn(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function rn(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ua&&o.listener==e&&o.capture==!!n&&o.Ta==r)return i}return-1}en.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=rn(t,e,r,i);return-1<s?(e=t[s],n||(e.Na=!1)):((e=new Ze(e,this.src,o,!!r,i)).Na=n,t.push(e)),e};var on="closure_lm_"+(1e6*Math.random()|0),sn={};function an(t,e,n,r,i){if(r&&r.once)un(t,e,n,r,i);else if(Array.isArray(e))for(var o=0;o<e.length;o++)an(t,e[o],n,r,i);else n=vn(n),t&&t[Xe]?_n(t,e,n,d(r)?!!r.capture:!!r,i):cn(t,e,n,!1,r,i)}function cn(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=d(i)?!!i.capture:!!i,a=yn(t);if(a||(t[on]=a=new en(t)),!(n=a.add(e,n,r,s,o)).proxy){if(r=function(){var t=mn,e=ze?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ke||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(fn(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}0}}function un(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)un(t,e[o],n,r,i);else n=vn(n),t&&t[Xe]?wn(t,e,n,d(r)?!!r.capture:!!r,i):cn(t,e,n,!0,r,i)}function ln(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)ln(t,e[o],n,r,i);else r=d(r)?!!r.capture:!!r,n=vn(n),t&&t[Xe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=rn(o=t.a[e],n,r,i))&&(tn(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=yn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=rn(e,n,r,i)),(n=-1<t?e[t]:null)&&hn(n))}function hn(t){if("number"!=typeof t&&t&&!t.ua){var e=t.src;if(e&&e[Xe])nn(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(fn(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=yn(e))?(nn(n,t),0==n.b&&(n.src=null,e[on]=null)):tn(t)}}}function fn(t){return t in sn?sn[t]:sn[t]="on"+t}function pn(t,e,n,r){var i=!0;if((t=yn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ua&&(o=dn(o,r),i=i&&!1!==o)}return i}function dn(t,e){var n=t.listener,r=t.Ta||t.src;return t.Na&&hn(t),n.call(r,e)}function mn(t,e){if(t.ua)return!0;if(!ze){if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Qe(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=pn(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=pn(r[i],t,!1,e),n=n&&o}return n}return dn(t,new Qe(e,this))}function yn(t){return(t=t[on])instanceof en?t:null}var gn="__closure_events_fn_"+(1e9*Math.random()>>>0);function vn(t){return p(t)?t:(t[gn]||(t[gn]=function(e){return t.handleEvent(e)}),t[gn])}function bn(){Be.call(this),this.u=new en(this),this.Yb=this,this.eb=null}function _n(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function wn(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function Sn(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ua&&s.capture==n){var a=s.listener,c=s.Ta||s.src;s.Na&&nn(t.u,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function On(t,e,n){if(p(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function En(t){var e=null;return new be((function(n,r){-1==(e=On((function(){n(void 0)}),t))&&r(Error("Failed to schedule timer."))})).o((function(t){throw a.clearTimeout(e),t}))}function Tn(t){if(t.V&&"function"==typeof t.V)return t.V();if("string"==typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function Cn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.V||"function"!=typeof t.V){if(f(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function In(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof In)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function An(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];kn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)kn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function kn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}O(bn,Be),bn.prototype[Xe]=!0,bn.prototype.addEventListener=function(t,e,n,r){an(this,t,e,n,r)},bn.prototype.removeEventListener=function(t,e,n,r){ln(this,t,e,n,r)},bn.prototype.dispatchEvent=function(t){var e,n=this.eb;if(n)for(e=[];n;n=n.eb)e.push(n);n=this.Yb;var r=t.type||t;if("string"==typeof t)t=new Ge(t,n);else if(t instanceof Ge)t.target=t.target||n;else{var i=t;mt(t=new Ge(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.b=e[o];i=Sn(s,r,!0,t)&&i}if(i=Sn(s=t.b=n,r,!0,t)&&i,i=Sn(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Sn(s=t.b=e[o],r,!1,t)&&i;return i},bn.prototype.Ba=function(){if(bn.Za.Ba.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)tn(n[r]);delete e.a[t],e.b--}}this.eb=null},(t=In.prototype).V=function(){An(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return An(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return kn(this.b,t)?this.b[t]:e},t.set=function(t,e){kn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var xn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/\\#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof Nn?(this.h=void 0!==e?e:t.h,Pn(this,t.f),this.i=t.i,this.b=t.b,jn(this,t.l),this.c=t.c,Rn(this,Zn(t.a)),this.g=t.g):t&&(n=String(t).match(xn))?(this.h=!!e,Pn(this,n[1]||"",!0),this.i=Fn(n[2]||""),this.b=Fn(n[3]||"",!0),jn(this,n[4]),this.c=Fn(n[5]||"",!0),Rn(this,n[6]||"",!0),this.g=Fn(n[7]||"")):(this.h=!!e,this.a=new Kn(null,this.h))}function Pn(t,e,n){t.f=n?Fn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function jn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.l=e}else t.l=null}function Rn(t,e,n){e instanceof Kn?(t.a=e,function(t,e){e&&!t.f&&(Gn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Yn(this,e),Jn(this,n,t))}),t)),t.f=e}(t.a,t.h)):(n||(e=Bn(e,zn)),t.a=new Kn(e,t.h))}function Mn(t,e,n){t.a.set(e,n)}function Dn(t,e){return t.a.get(e)}function $n(t){return t instanceof Nn?new Nn(t):new Nn(t,void 0)}function Ln(t,e){var n=new Nn(null,void 0);return Pn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Fn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Bn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Nn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Bn(e,Vn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Bn(e,Vn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Bn(n,"/"==n.charAt(0)?Wn:qn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Bn(n,Hn)),t.join("")},Nn.prototype.resolve=function(t){var e=new Nn(this),n=!!t.f;n?Pn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)jn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(st(i,"./")||st(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?Rn(e,Zn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Vn=/[#\/\?@]/g,qn=/[#\?:]/g,Wn=/[#\?]/g,zn=/[#\?@]/g,Hn=/#/g;function Kn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Gn(t){t.a||(t.a=new In,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Qn(t){var e=Cn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Kn(null,void 0);t=Tn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];Array.isArray(o)?Jn(n,i,o):n.add(i,o)}return n}function Yn(t,e){Gn(t),e=tr(t,e),kn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,kn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&An(t)))}function Xn(t,e){return Gn(t),e=tr(t,e),kn(t.a.b,e)}function Jn(t,e,n){Yn(t,e),0<n.length&&(t.c=null,t.a.set(tr(t,e),Y(n)),t.b+=n.length)}function Zn(t){var e=new Kn;return e.c=t.c,t.a&&(e.a=new In(t.a),e.b=t.b),e}function tr(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function er(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(Array.isArray(n)){var i=n;n=i.length,r.push("[");for(var o="",s=0;s<n;s++)r.push(o),t(e,i[s],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(s=n[i])&&(r.push(o),or(i,r),r.push(":"),t(e,s,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":or(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new nr,t,e),e.join("")}function nr(){}(t=Kn.prototype).add=function(t,e){Gn(this),this.c=null,t=tr(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){Gn(this),this.a.forEach((function(n,r){V(n,(function(n){t.call(e,n,r,this)}),this)}),this)},t.X=function(){Gn(this);for(var t=this.a.V(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.V=function(t){Gn(this);var e=[];if("string"==typeof t)Xn(this,t)&&(e=Q(e,this.a.get(tr(this,t))));else{t=this.a.V();for(var n=0;n<t.length;n++)e=Q(e,t[n])}return e},t.set=function(t,e){return Gn(this),this.c=null,Xn(this,t=tr(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.V(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var rr={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},ir=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function or(t,e){e.push('"',t.replace(ir,(function(t){var e=rr[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),rr[t]=e),e})),'"')}function sr(){var t=Tr();return Ht&&!!ee&&11==ee||/Edge\/\d+/.test(t)}function ar(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function cr(t,e){e=e||a.window;var n="about:blank";t&&(n=xt(Pt(t))),e.location.href=n}function ur(t){return!!((t=(t||Tr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function lr(t){t=t||a.window;try{t.close()}catch(t){}}function hr(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Tr().toLowerCase(),r&&(e.target=r,st(n,"crios/")&&(e.target="_blank")),Sr(Tr())==_r&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof kt?n:Pt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var s=i.join(",");if((lt("iPhone")&&!lt("iPod")&&!lt("iPad")||lt("iPad")||lt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(yt(s=he(document,"A"),"HTMLAnchorElement"),e instanceof kt||e instanceof kt||(e="object"==typeof e&&e.ra?e.qa():String(e),Nt.test(e)||(e="about:invalid#zClosurez"),e=new kt(Rt,e)),s.href=xt(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=xt(e),s&&(Gt&&st(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=Lt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Ut(t)+'">'),r=s.document)&&(r.write(Dt(t)),r.close())):(s=r.open(xt(e),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(t){}return s}var fr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pr=/^[^@]+@[^@]+$/;function dr(){var t=null;return new be((function(e){"complete"==a.document.readyState?e():(t=function(){e()},un(window,"load",t))})).o((function(e){throw ln(window,"load",t),e}))}function mr(t){return t=t||Tr(),!("file:"!==xr()&&"ionic:"!==xr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function yr(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function gr(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function vr(){return r.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":r.a.INTERNAL.hasOwnProperty("node")?"Node":gr()?"Worker":"Browser"}function br(){var t=vr();return"ReactNative"===t||"Node"===t}var _r="Firefox",wr="Chrome";function Sr(t){var e=t.toLowerCase();return st(e,"opera/")||st(e,"opr/")||st(e,"opios/")?"Opera":st(e,"iemobile")?"IEMobile":st(e,"msie")||st(e,"trident/")?"IE":st(e,"edge/")?"Edge":st(e,"firefox/")?_r:st(e,"silk/")?"Silk":st(e,"blackberry")?"Blackberry":st(e,"webos")?"Webos":!st(e,"safari/")||st(e,"chrome/")||st(e,"crios/")||st(e,"android")?!st(e,"chrome/")&&!st(e,"crios/")||st(e,"edge/")?st(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":wr:"Safari"}var Or={jd:"FirebaseCore-web",ld:"FirebaseUI-web"};function Er(t,e){e=e||[];var n,r=[],i={};for(n in Or)i[Or[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=vr())?r=Sr(i=Tr()):"Worker"===r&&(r=Sr(i=Tr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function Tr(){return a.navigator&&a.navigator.userAgent||""}function Cr(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function Ir(){try{var t=a.localStorage,e=Mr();if(t)return t.setItem(e,"1"),t.removeItem(e),!sr()||!!a.indexedDB}catch(t){return gr()&&!!a.indexedDB}return!1}function Ar(){return(kr()||"chrome-extension:"===xr()||mr())&&!br()&&Ir()&&!gr()}function kr(){return"http:"===xr()||"https:"===xr()}function xr(){return a.location&&a.location.protocol||null}function Nr(t){return!ur(t=t||Tr())&&Sr(t)!=_r}function Pr(t){return void 0===t?null:er(t)}function jr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Rr(t){if(null!==t)return JSON.parse(t)}function Mr(t){return t||Math.floor(1e9*Math.random()).toString()}function Dr(t){return"Safari"!=Sr(t=t||Tr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function $r(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Lr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=Tr(),e=vr(),this.b=ur(t)||"ReactNative"===e}function Fr(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Br(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Ur(){return!(!Cr("fireauth.oauthhelper",a)&&!Cr("fireauth.iframe",a))}Lr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!kr()&&"chrome-extension:"!==xr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Vr,qr={};function Wr(t){qr[t]||(qr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var zr={};Object.defineProperty(zr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(zr,"abcd",{configurable:!0,enumerable:!0,value:2}),Vr=2==zr.abcd}catch(Wt){Vr=!1}function Hr(t,e,n){Vr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Kr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Hr(t,n,e[n])}function Gr(t){var e={};return Kr(e,t),e}function Qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Hr(e,n,Qr(t[n]));return e}function Yr(t){var e=t&&(t[ei]?"phone":null);if(!(e&&t&&t[ti]))throw new E("internal-error","Internal assert: invalid MultiFactorInfo object");Hr(this,"uid",t[ti]),Hr(this,"displayName",t[Jr]||null);var n=null;t[Zr]&&(n=new Date(t[Zr]).toUTCString()),Hr(this,"enrollmentTime",n),Hr(this,"factorId",e)}function Xr(t){try{var e=new ni(t)}catch(t){e=null}return e}Yr.prototype.v=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var Jr="displayName",Zr="enrolledAt",ti="mfaEnrollmentId",ei="phoneInfo";function ni(t){Yr.call(this,t),Hr(this,"phoneNumber",t[ei])}function ri(t){var e={},n=t[ai],r=t[ui],i=t[li];if(t=Xr(t[ci]),!i||i!=oi&&i!=si&&!n||i==si&&!r||i==ii&&!t)throw Error("Invalid checkActionCode response!");i==si?(e[fi]=n||null,e[di]=n||null,e[hi]=r):(e[fi]=r||null,e[di]=r||null,e[hi]=n||null),e[pi]=t||null,Hr(this,yi,i),Hr(this,mi,Qr(e))}O(ni,Yr),ni.prototype.v=function(){var t=ni.Za.v.call(this);return t.phoneNumber=this.phoneNumber,t};var ii="REVERT_SECOND_FACTOR_ADDITION",oi="EMAIL_SIGNIN",si="VERIFY_AND_CHANGE_EMAIL",ai="email",ci="mfaInfo",ui="newEmail",li="requestType",hi="email",fi="fromEmail",pi="multiFactorInfo",di="previousEmail",mi="data",yi="operation";function gi(t){var e=Dn(t=$n(t),vi)||null,n=Dn(t,bi)||null,r=Dn(t,Si)||null;if(r=r&&Ei[r]||null,!e||!n||!r)throw new E("argument-error",vi+", "+bi+"and "+Si+" are required in a valid action code URL.");Kr(this,{apiKey:e,operation:r,code:n,continueUrl:Dn(t,_i)||null,languageCode:Dn(t,wi)||null,tenantId:Dn(t,Oi)||null})}var vi="apiKey",bi="oobCode",_i="continueUrl",wi="languageCode",Si="mode",Oi="tenantId",Ei={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ii,signIn:oi,verifyAndChangeEmail:si,verifyEmail:"VERIFY_EMAIL"};function Ti(t){try{return new gi(t)}catch(t){return null}}function Ci(t){var e=t[Ni];if(void 0===e)throw new E("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new E("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Ii];if(n&&"object"==typeof n){e=n[Ri];var r=n[Pi];if(n=n[ji],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new E("argument-error",Pi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new E("argument-error",ji+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new E("argument-error",Ri+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new E("missing-android-pkg-name")}}else if(void 0!==n)throw new E("argument-error",Ii+" property must be a non null object when specified.");if(this.f=null,(e=t[xi])&&"object"==typeof e){if("string"==typeof(e=e[Mi])&&e.length)this.f=e;else if(void 0!==e)throw new E("argument-error",Mi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new E("argument-error",xi+" property must be a non null object when specified.");if(void 0!==(e=t[ki])&&"boolean"!=typeof e)throw new E("argument-error",ki+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Ai])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new E("argument-error",Ai+" property must be a non empty string when specified.");this.i=t||null}var Ii="android",Ai="dynamicLinkDomain",ki="handleCodeInApp",xi="iOS",Ni="url",Pi="installApp",ji="minimumVersion",Ri="packageName",Mi="bundleId";function Di(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var $i=null;function Li(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=$i[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!$i){$i={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var r=t.concat(e[n].split("")),i=0;i<r.length;i++){var o=r[i];void 0===$i[o]&&($i[o]=i)}}}();for(var r=0;;){var i=n(-1),o=n(0),s=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|o>>4),64!=s&&(e(o<<4&240|s>>2),64!=a&&e(s<<6&192|a))}}(t,(function(t){e+=String.fromCharCode(t)})),e}function Fi(t){var e=Ui(t);if(!(e&&e.sub&&e.iss&&e.aud&&e.exp))throw Error("Invalid JWT");this.g=t,this.c=e.exp,this.h=e.sub,S(),this.a=e.provider_id||e.firebase&&e.firebase.sign_in_provider||null,this.f=e.firebase&&e.firebase.tenant||null,this.b=!!e.is_anonymous||"anonymous"==this.a}function Bi(t){try{return new Fi(t)}catch(t){return null}}function Ui(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Li(t))}catch(t){}return null}Fi.prototype.S=function(){return this.f},Fi.prototype.i=function(){return this.b},Fi.prototype.toString=function(){return this.g};var Vi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),qi=["client_id","response_type","scope","redirect_uri","state"],Wi={kd:{Ha:"locale",ta:700,sa:600,ea:"facebook.com",Va:qi},md:{Ha:null,ta:500,sa:750,ea:"github.com",Va:qi},nd:{Ha:"hl",ta:515,sa:680,ea:"google.com",Va:qi},td:{Ha:"lang",ta:485,sa:705,ea:"twitter.com",Va:Vi},gd:{Ha:"locale",ta:640,sa:600,ea:"apple.com",Va:[]}};function zi(t){for(var e in Wi)if(Wi[e].ea==t)return Wi[e];return null}function Hi(t){var e={};e["facebook.com"]=Xi,e["google.com"]=Zi,e["github.com"]=Ji,e["twitter.com"]=to;var n=t&&t[Gi];try{if(n)return e[n]?new e[n](t):new Yi(t);if(void 0!==t[Ki])return new Qi(t)}catch(t){}return null}var Ki="idToken",Gi="providerId";function Qi(t){var e=t[Gi];if(!e&&t[Ki]){var n=Bi(t[Ki]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Hr(this,"providerId",e),Hr(this,"isNewUser",n)}function Yi(t){Qi.call(this,t),Hr(this,"profile",Qr((t=Rr(t.rawUserInfo||"{}"))||{}))}function Xi(t){if(Yi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ji(t){if(Yi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Hr(this,"username",this.profile&&this.profile.login||null)}function Zi(t){if(Yi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function to(t){if(Yi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Hr(this,"username",t.screenName||null)}function eo(t){var e=$n(t),n=Dn(e,"link"),r=Dn($n(n),"link");return e=Dn(e,"deep_link_id"),Dn($n(e),"link")||e||r||n||t}function no(t,e){if(!t&&!e)throw new E("internal-error","Internal assert: no raw session string available");if(t&&e)throw new E("internal-error","Internal assert: unable to determine the session type");this.a=t||null,this.b=e||null,this.type=this.a?ro:io}O(Yi,Qi),O(Xi,Yi),O(Ji,Yi),O(Zi,Yi),O(to,Yi);var ro="enroll",io="signin";function oo(){}function so(t,e){return t.then((function(t){if(t[Gs]){var n=Bi(t[Gs]);if(!n||e!=n.h)throw new E("user-mismatch");return t}throw new E("user-mismatch")})).o((function(t){throw t&&t.code&&t.code==I+"user-not-found"?new E("user-mismatch"):t}))}function ao(t,e){if(!e)throw new E("internal-error","failed to construct a credential");this.a=e,Hr(this,"providerId",t),Hr(this,"signInMethod",t)}function co(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function uo(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new ao(t.providerId,t.pendingToken)}catch(t){}return null}function lo(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Hr(this,"idToken",e.idToken),e.accessToken&&Hr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Hr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new E("internal-error","failed to construct a credential");Hr(this,"accessToken",e.oauthToken),Hr(this,"secret",e.oauthTokenSecret)}Hr(this,"providerId",t),Hr(this,"signInMethod",n)}function ho(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Qn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function fo(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new lo(t.providerId,e,t.signInMethod)}catch(t){}}return null}function po(t,e){this.Oc=e||[],Kr(this,{providerId:t,isOAuthProvider:!0}),this.Fb={},this.lb=(zi(t)||{}).Ha||null,this.kb=null}function mo(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new E("argument-error",'SAML provider IDs must be prefixed with "saml."');po.call(this,t,[])}function yo(t){po.call(this,t,qi),this.a=[]}function go(){yo.call(this,"facebook.com")}function vo(t){if(!t)throw new E("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return d(t)&&(e=t.accessToken),(new go).credential({accessToken:e})}function bo(){yo.call(this,"github.com")}function _o(t){if(!t)throw new E("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return d(t)&&(e=t.accessToken),(new bo).credential({accessToken:e})}function wo(){yo.call(this,"google.com"),this.Aa("profile")}function So(t,e){var n=t;return d(t)&&(n=t.idToken,e=t.accessToken),(new wo).credential({idToken:n,accessToken:e})}function Oo(){po.call(this,"twitter.com",Vi)}function Eo(t,e){var n=t;if(d(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new E("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new lo("twitter.com",n,"twitter.com")}function To(t,e,n){this.a=t,this.f=e,Hr(this,"providerId","password"),Hr(this,"signInMethod",n===Io.EMAIL_LINK_SIGN_IN_METHOD?Io.EMAIL_LINK_SIGN_IN_METHOD:Io.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Co(t){return t&&t.email&&t.password?new To(t.email,t.password,t.signInMethod):null}function Io(){Kr(this,{providerId:"password",isOAuthProvider:!1})}function Ao(t,e){if(!(e=ko(e)))throw new E("argument-error","Invalid email link!");return new To(t,e.code,Io.EMAIL_LINK_SIGN_IN_METHOD)}function ko(t){return(t=Ti(t=eo(t)))&&t.operation===oi?t:null}function xo(t){if(!(t.bb&&t.ab||t.Ja&&t.da))throw new E("internal-error");this.a=t,Hr(this,"providerId","phone"),this.ea="phone",Hr(this,"signInMethod","phone")}function No(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return V(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){t[n]&&(e[n]=t[n])})),new xo(e)}return null}function Po(t){return t.a.Ja&&t.a.da?{temporaryProof:t.a.Ja,phoneNumber:t.a.da}:{sessionInfo:t.a.bb,code:t.a.ab}}function jo(t){try{this.a=t||r.a.auth()}catch(t){throw new E("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Kr(this,{providerId:"phone",isOAuthProvider:!1})}function Ro(t,e){if(!t)throw new E("missing-verification-id");if(!e)throw new E("missing-verification-code");return new xo({bb:t,ab:e})}function Mo(t){if(t.temporaryProof&&t.phoneNumber)return new xo({Ja:t.temporaryProof,da:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,s=t&&t.pendingToken;try{switch(e){case"google.com":return So(o,n);case"facebook.com":return vo(n);case"github.com":return _o(n);case"twitter.com":return Eo(n,r);default:return n||r||o||s?s?0==e.indexOf("saml.")?new ao(e,s):new lo(e,{pendingToken:s,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new yo(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function Do(t){if(!t.isOAuthProvider)throw new E("invalid-oauth-provider")}function $o(t,e,n,r,i,o,s){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=s||null,this.a=i||null,!this.g&&!this.a)throw new E("invalid-auth-event");if(this.g&&this.a)throw new E("invalid-auth-event");if(this.g&&!this.f)throw new E("invalid-auth-event")}function Lo(t){return(t=t||{}).type?new $o(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&T(t.error),t.postBody,t.tenantId):null}function Fo(){this.b=null,this.a=[]}no.prototype.Fa=function(){return this.a?Ce(this.a):Ce(this.b)},no.prototype.v=function(){return this.type==ro?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},oo.prototype.ia=function(){},oo.prototype.b=function(){},oo.prototype.c=function(){},oo.prototype.v=function(){},ao.prototype.ia=function(t){return da(t,co(this))},ao.prototype.b=function(t,e){var n=co(this);return n.idToken=e,ma(t,n)},ao.prototype.c=function(t,e){return so(ya(t,co(this)),e)},ao.prototype.v=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},lo.prototype.ia=function(t){return da(t,ho(this))},lo.prototype.b=function(t,e){var n=ho(this);return n.idToken=e,ma(t,n)},lo.prototype.c=function(t,e){return so(ya(t,ho(this)),e)},lo.prototype.v=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},po.prototype.Ia=function(t){return this.Fb=pt(t),this},O(mo,po),O(yo,po),yo.prototype.Aa=function(t){return H(this.a,t)||this.a.push(t),this},yo.prototype.Nb=function(){return Y(this.a)},yo.prototype.credential=function(t,e){var n;if(!(n=d(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new E("argument-error","credential failed: must provide the ID token and/or the access token.");return new lo(this.providerId,n,this.providerId)},O(go,yo),Hr(go,"PROVIDER_ID","facebook.com"),Hr(go,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),O(bo,yo),Hr(bo,"PROVIDER_ID","github.com"),Hr(bo,"GITHUB_SIGN_IN_METHOD","github.com"),O(wo,yo),Hr(wo,"PROVIDER_ID","google.com"),Hr(wo,"GOOGLE_SIGN_IN_METHOD","google.com"),O(Oo,po),Hr(Oo,"PROVIDER_ID","twitter.com"),Hr(Oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),To.prototype.ia=function(t){return this.signInMethod==Io.EMAIL_LINK_SIGN_IN_METHOD?Xa(t,Ea,{email:this.a,oobCode:this.f}):Xa(t,Ha,{email:this.a,password:this.f})},To.prototype.b=function(t,e){return this.signInMethod==Io.EMAIL_LINK_SIGN_IN_METHOD?Xa(t,Ta,{idToken:e,email:this.a,oobCode:this.f}):Xa(t,La,{idToken:e,email:this.a,password:this.f})},To.prototype.c=function(t,e){return so(this.ia(t),e)},To.prototype.v=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},Kr(Io,{PROVIDER_ID:"password"}),Kr(Io,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Kr(Io,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),xo.prototype.ia=function(t){return t.cb(Po(this))},xo.prototype.b=function(t,e){var n=Po(this);return n.idToken=e,Xa(t,Ga,n)},xo.prototype.c=function(t,e){var n=Po(this);return n.operation="REAUTH",so(t=Xa(t,Qa,n),e)},xo.prototype.v=function(){var t={providerId:"phone"};return this.a.bb&&(t.verificationId=this.a.bb),this.a.ab&&(t.verificationCode=this.a.ab),this.a.Ja&&(t.temporaryProof=this.a.Ja),this.a.da&&(t.phoneNumber=this.a.da),t},jo.prototype.cb=function(t,e){var n=this.a.b;return Ce(e.verify()).then((function(r){if("string"!=typeof r)throw new E("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":var i=d(t)?t.session:null,o=d(t)?t.phoneNumber:t;return(i&&i.type==ro?i.Fa().then((function(t){return function(t,e){return Xa(t,Ba,e).then((function(t){return t.phoneSessionInfo.sessionInfo}))}(n,{idToken:t,phoneEnrollmentInfo:{phoneNumber:o,recaptchaToken:r}})})):i&&i.type==io?i.Fa().then((function(e){return function(t,e){return Xa(t,Ua,e).then((function(t){return t.phoneResponseInfo.sessionInfo}))}(n,{mfaPendingCredential:e,mfaEnrollmentId:t.multiFactorHint&&t.multiFactorHint.uid||t.multiFactorUid,phoneSignInInfo:{recaptchaToken:r}})})):function(t,e){return Xa(t,Da,e)}(n,{phoneNumber:o,recaptchaToken:r})).then((function(t){return"function"==typeof e.reset&&e.reset(),t}),(function(t){throw"function"==typeof e.reset&&e.reset(),t}));default:throw new E("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Kr(jo,{PROVIDER_ID:"phone"}),Kr(jo,{PHONE_SIGN_IN_METHOD:"phone"}),$o.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},$o.prototype.S=function(){return this.h},$o.prototype.v=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.v()}};var Bo,Uo=null;function Vo(t){var e="unauthorized-domain",n=void 0,r=$n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Bt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Bt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",E.call(this,e,n)}function qo(t,e,n){E.call(this,t,n),(t=e||{}).Gb&&Hr(this,"email",t.Gb),t.da&&Hr(this,"phoneNumber",t.da),t.credential&&Hr(this,"credential",t.credential),t.Wb&&Hr(this,"tenantId",t.Wb)}function Wo(t){if(t.code){var e=t.code||"";0==e.indexOf(I)&&(e=e.substring(I.length));var n={credential:Mo(t),Wb:t.tenantId};if(t.email)n.Gb=t.email;else if(t.phoneNumber)n.da=t.phoneNumber;else if(!n.credential)return new E(e,t.message||void 0);return new qo(e,n,t.message)}return null}function zo(){}function Ho(t){return t.c||(t.c=t.b())}function Ko(){}function Go(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Qo(){}function Yo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.oc,this),this.a.onerror=_(this.Pb,this),this.a.onprogress=_(this.pc,this),this.a.ontimeout=_(this.tc,this)}function Xo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Jo(t,e,n){this.reset(t,e,n,void 0,void 0)}O(Vo,E),O(qo,E),qo.prototype.v=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.v();return e&&mt(t,e),t},qo.prototype.toJSON=function(){return this.v()},zo.prototype.c=null,O(Ko,zo),Ko.prototype.a=function(){var t=Go(this);return t?new ActiveXObject(t):new XMLHttpRequest},Ko.prototype.b=function(){var t={};return Go(this)&&(t[0]=!0,t[1]=!0),t},Bo=new Ko,O(Qo,zo),Qo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Yo;throw Error("Unsupported browser")},Qo.prototype.b=function(){return{}},(t=Yo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.oc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Xo(this,4)},t.Pb=function(){this.status=500,this.response=this.responseText="",Xo(this,4)},t.tc=function(){this.Pb()},t.pc=function(){this.status=200,Xo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Jo.prototype.a=null;function Zo(t){this.f=t,this.b=this.c=this.a=null}function ts(t,e){this.name=t,this.value=e}Jo.prototype.reset=function(t,e,n,r,i){"number"==typeof i||0,r||S(),delete this.a},ts.prototype.toString=function(){return this.name};var es=new ts("SEVERE",1e3),ns=new ts("WARNING",900),rs=new ts("CONFIG",700),is=new ts("FINE",500);Zo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(R("Root logger has no level set."),null)}(this).value)for(p(e)&&(e=e()),t=new Jo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var os={},ss=null;function as(t){var e;if(ss||(ss=new Zo(""),os[""]=ss,ss.c=rs),!(e=os[t])){e=new Zo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=as(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,os[t]=e}return e}function cs(t,e){t&&t.log(is,e,void 0)}function us(t){this.f=t}function ls(t){bn.call(this),this.s=t,this.readyState=hs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=as("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}O(us,zo),us.prototype.a=function(){return new ls(this.f)},us.prototype.b=function(t){return function(){return t}}({}),O(ls,bn);var hs=0;function fs(t){t.c.read().then(t.nc.bind(t)).catch(t.Sa.bind(t))}function ps(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,ds(t)}function ds(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ms(t){bn.call(this),this.headers=new In,this.D=t||null,this.c=!1,this.B=this.a=null,this.h=this.P=this.l="",this.f=this.O=this.i=this.N=!1,this.g=0,this.s=null,this.m=ys,this.w=this.R=!1}(t=ls.prototype).open=function(t,e){if(this.readyState!=hs)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,ds(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.s.fetch(new Request(this.g,e)).then(this.sc.bind(this),this.Sa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,ps(this,!1)),this.readyState=hs},t.sc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,ds(this)),this.a&&(this.readyState=3,ds(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.qc.bind(this),this.Sa.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,fs(this)):t.text().then(this.rc.bind(this),this.Sa.bind(this)))))},t.nc=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?ps(this,!0):ds(this),3==this.readyState&&fs(this)}},t.rc=function(t){this.a&&(this.response=this.responseText=t,ps(this,!0))},t.qc=function(t){this.a&&(this.response=t,ps(this,!0))},t.Sa=function(t){var e=this.h;e&&e.log(ns,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&ps(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(ns,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(ns,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},O(ms,bn);var ys="";ms.prototype.b=as("goog.net.XhrIo");var gs=/^https?$/i,vs=["POST","PUT"];function bs(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.P=n,t.N=!1,t.c=!0,t.a=t.D?t.D.a():Bo.a(),t.B=t.D?Ho(t.D):Ho(Bo),t.a.onreadystatechange=_(t.Sb,t);try{cs(t.b,As(t,"Opening Xhr")),t.O=!0,t.a.open(n,String(e),!0),t.O=!1}catch(e){return cs(t.b,As(t,"Error opening Xhr: "+e.message)),void ws(t,e)}e=r||"";var o=new In(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"==typeof t)V(t,e,void 0);else for(var n=Cn(t),r=Tn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,(function(t,e){o.set(e,t)})),i=function(t){t:{for(var e=_s,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(o.X()),r=a.FormData&&e instanceof a.FormData,!H(vs,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.R&&(t.a.withCredentials=t.R);try{Ts(t),0<t.g&&(t.w=function(t){return Ht&&re(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),cs(t.b,As(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.w)),t.w?(t.a.timeout=t.g,t.a.ontimeout=_(t.Ka,t)):t.s=On(t.Ka,t.g,t)),cs(t.b,As(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){cs(t.b,As(t,"Send error: "+e.message)),ws(t,e)}}function _s(t){return"content-type"==t.toLowerCase()}function ws(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Ss(t),Es(t)}function Ss(t){t.N||(t.N=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Os(t){if(t.c&&void 0!==s)if(t.B[1]&&4==Cs(t)&&2==Is(t))cs(t.b,As(t,"Local request error detected and ignored"));else if(t.i&&4==Cs(t))On(t.Sb,0,t);else if(t.dispatchEvent("readystatechange"),4==Cs(t)){cs(t.b,As(t,"Request complete")),t.c=!1;try{var e,n=Is(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.l).match(xn)[1]||null;if(!o&&a.self&&a.self.location){var c=a.self.location.protocol;o=c.substr(0,c.length-1)}i=!gs.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var u=2<Cs(t)?t.a.statusText:""}catch(e){cs(t.b,"Can not get status: "+e.message),u=""}t.h=u+" ["+Is(t)+"]",Ss(t)}}finally{Es(t)}}}function Es(t,e){if(t.a){Ts(t);var n=t.a,r=t.B[0]?l:null;t.a=null,t.B=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(es,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Ts(t){t.a&&t.w&&(t.a.ontimeout=null),t.s&&(a.clearTimeout(t.s),t.s=null)}function Cs(t){return t.a?t.a.readyState:0}function Is(t){try{return 2<Cs(t)?t.a.status:-1}catch(t){return-1}}function As(t,e){return e+" ["+t.P+" "+t.l+" "+Is(t)+"]"}function ks(t){var e=Bs;this.g=[],this.w=e,this.s=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.B=this.i=!1,this.h=0,this.b=null,this.l=0}function xs(t,e,n){t.a=!0,t.c=n,t.f=!e,Rs(t)}function Ns(t){if(t.a){if(!t.u)throw new Ms(t);t.u=!1}}function Ps(t,e,n,r){t.g.push([e,n,r]),t.a&&Rs(t)}function js(t){return z(t.g,(function(t){return p(t[1])}))}function Rs(t){if(t.h&&t.a&&js(t)){var e=t.h,n=Ls[e];n&&(a.clearTimeout(n.a),delete Ls[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var c=o.call(i||t.s,e);void 0!==c&&(t.f=t.f&&(c==e||c instanceof Error),t.c=e=c),(N(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,js(t)||(n=!0)}}t.c=e,r&&(c=_(t.m,t,!0),r=_(t.m,t,!1),e instanceof ks?(Ps(e,c,r),e.B=!0):e.then(c,r)),n&&(e=new $s(e),Ls[e.a]=e,t.h=e.a)}function Ms(){P.call(this)}function Ds(){P.call(this)}function $s(t){this.a=a.setTimeout(_(this.c,this),0),this.b=t}(t=ms.prototype).Ka=function(){void 0!==s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",cs(this.b,As(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(cs(this.b,As(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Es(this))},t.Ba=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Es(this,!0)),ms.Za.Ba.call(this)},t.Sb=function(){this.wa||(this.O||this.i||this.f?Os(this):this.Hc())},t.Hc=function(){Os(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ys:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(es,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return cs(this.b,"Can not get response: "+t.message),null}},ks.prototype.cancel=function(t){if(this.a)this.c instanceof ks&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.w?this.w.call(this.s,this):this.u=!0,this.a||(t=new Ds(this),Ns(this),xs(this,!1,t))}},ks.prototype.m=function(t,e){this.i=!1,xs(this,t,e)},ks.prototype.then=function(t,e,n){var r,i,o=new be((function(t,e){r=t,i=e}));return Ps(this,r,(function(t){t instanceof Ds?o.cancel():i(t)})),o.then(t,e,n)},ks.prototype.$goog_Thenable=!0,O(Ms,P),Ms.prototype.message="Deferred has already fired",Ms.prototype.name="AlreadyCalledError",O(Ds,P),Ds.prototype.message="Deferred was canceled",Ds.prototype.name="CanceledError",$s.prototype.c=function(){throw delete Ls[this.a],this.b};var Ls={};function Fs(t){var e={},n=e.document||document,r=Ot(t).toString(),i=he(document,"SCRIPT"),o={Tb:i,Ka:void 0},s=new ks(o),l=null,h=null!=e.timeout?e.timeout:5e3;return 0<h&&(l=window.setTimeout((function(){Us(i,!0);var t=new Ws(qs,"Timeout reached for loading script "+r);Ns(s),xs(s,!1,t)}),h),o.Ka=l),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Us(i,e.ud||!1,l),Ns(s),xs(s,!0,null))},i.onerror=function(){Us(i,!0,l);var t=new Ws(Vs,"Error while loading script "+r);Ns(s),xs(s,!1,t)},mt(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),se(i,o),function(t,e){yt(t,"HTMLScriptElement"),t.src=Ot(e),null===u&&(u=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=u)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function Bs(){if(this&&this.Tb){var t=this.Tb;t&&"SCRIPT"==t.tagName&&Us(t,!0,this.Ka)}}function Us(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),0)}var Vs=0,qs=1;function Ws(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),P.call(this,n),this.code=t}function zs(t){this.f=t}function Hs(t,e,n){if(this.c=t,t=e||{},this.u=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Qs,this.g=pt(t.secureTokenHeaders||Ys),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.l=t.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.i=t.firebaseTimeout||Xs,this.a=pt(t.firebaseHeaders||Js),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==vr(),!(n=a.XMLHttpRequest||n&&r.a.INTERNAL.node&&r.a.INTERNAL.node.XMLHttpRequest)&&!gr())throw new E("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,gr()?this.f=new us(self):br()?this.f=new zs(n):this.f=new Qo,this.b=null}O(Ws,P),O(zs,zo),zs.prototype.a=function(){return new this.f},zs.prototype.b=function(){return{}};var Ks,Gs="idToken",Qs=new Lr(3e4,6e4),Ys={"Content-Type":"application/x-www-form-urlencoded"},Xs=new Lr(3e4,6e4),Js={"Content-Type":"application/json"};function Zs(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function ta(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function ea(t,e,n,r,i,o,s){(function(){var t=Tr();return!((t=Sr(t)!=wr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t)&&(!Ht||!ee||9<ee)})()||gr()?t=_(t.w,t):(Ks||(Ks=new be((function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{a[ra]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){Ps(t,null,e,void 0)}(Fs(Et(na,{onload:ra})),(function(){e(Error("CORS_UNSUPPORTED"))}))}}(t,e)}))),t=_(t.s,t)),t(e,n,r,i,o,s)}Hs.prototype.S=function(){return this.b},Hs.prototype.w=function(t,e,n,r,i,o){if(gr()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new E("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var s=new ms(this.f);if(o){s.g=Math.max(0,o);var c=setTimeout((function(){s.dispatchEvent("timeout")}),o)}_n(s,"complete",(function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return cs(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)})),wn(s,"ready",(function(){c&&clearTimeout(c),qe(this)})),wn(s,"timeout",(function(){c&&clearTimeout(c),qe(this),e&&e(null)})),bs(s,t,n,r,i)};var na=new gt(_t,"https://apis.google.com/js/client.js?onload=%{onload}"),ra="__fcb"+Math.floor(1e6*Math.random()).toString();function ia(t,e,n,r,i,o,s){var a=$n(e+n);Mn(a,"key",t.c),s&&Mn(a,"cb",S().toString());var c="GET"==r;if(c)for(var u in i)i.hasOwnProperty(u)&&Mn(a,u,i[u]);return new be((function(e,n){ea(t,a.toString(),(function(t){t?t.error?n(Za(t,o||{})):e(t):n(new E("network-request-failed"))}),r,c?void 0:er(jr(i)),t.a,t.i.get())}))}function oa(t){if("string"!=typeof(t=t.email)||!pr.test(t))throw new E("invalid-email")}function sa(t){"email"in t&&oa(t)}function aa(t){if(!t[Gs]){if(t.mfaPendingCredential)throw new E("multi-factor-auth-required",null,pt(t));throw new E("internal-error")}}function ca(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new E("internal-error")}else{if(!t.sessionInfo)throw new E("missing-verification-id");if(!t.code)throw new E("missing-verification-code")}}Hs.prototype.s=function(t,e,n,r,i){var o=this;Ks.then((function(){window.gapi.client.setApiKey(o.c);var s=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(s),e&&e(t)}})})).o((function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})}))},Hs.prototype.vb=function(){return Xa(this,Fa,{})},Hs.prototype.xb=function(t,e){return Xa(this,$a,{idToken:t,email:e})},Hs.prototype.yb=function(t,e){return Xa(this,La,{idToken:t,password:e})};var ua={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function la(t){if(!t.phoneVerificationInfo)throw new E("internal-error");if(!t.phoneVerificationInfo.sessionInfo)throw new E("missing-verification-id");if(!t.phoneVerificationInfo.code)throw new E("missing-verification-code")}function ha(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new E("internal-error")}function fa(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Xn(t=new Kn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function pa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Wo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Wo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Wo(t)):t.errorMessage&&(e=Ja(t.errorMessage)),e)throw e;aa(t)}function da(t,e){return e.returnIdpCredential=!0,Xa(t,Va,e)}function ma(t,e){return e.returnIdpCredential=!0,Xa(t,Wa,e)}function ya(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Xa(t,qa,e)}function ga(t){if(!t.oobCode)throw new E("invalid-action-code")}(t=Hs.prototype).zb=function(t,e){var n={idToken:t},r=[];return ht(ua,(function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),Xa(this,$a,n)},t.rb=function(t,e){return mt(t={requestType:"PASSWORD_RESET",email:t},e),Xa(this,Pa,t)},t.sb=function(t,e){return mt(t={requestType:"EMAIL_SIGNIN",email:t},e),Xa(this,ka,t)},t.qb=function(t,e){return mt(t={requestType:"VERIFY_EMAIL",idToken:t},e),Xa(this,xa,t)},t.Ab=function(t,e,n){return mt(t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:t,newEmail:e},n),Xa(this,Na,t)},t.cb=function(t){return Xa(this,Ka,t)},t.jb=function(t,e){return Xa(this,Ma,{oobCode:t,newPassword:e})},t.Pa=function(t){return Xa(this,ba,{oobCode:t})},t.fb=function(t){return Xa(this,va,{oobCode:t})};var va={endpoint:"setAccountInfo",A:ga,Y:"email",C:!0},ba={endpoint:"resetPassword",A:ga,G:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e&&"VERIFY_AND_CHANGE_EMAIL"!=e)throw new E("internal-error")},C:!0},_a={endpoint:"signupNewUser",A:function(t){if(oa(t),!t.password)throw new E("weak-password")},G:aa,U:!0,C:!0},wa={endpoint:"createAuthUri",C:!0},Sa={endpoint:"deleteAccount",M:["idToken"]},Oa={endpoint:"setAccountInfo",M:["idToken","deleteProvider"],A:function(t){if("array"!=h(t.deleteProvider))throw new E("internal-error")}},Ea={endpoint:"emailLinkSignin",M:["email","oobCode"],A:oa,G:aa,U:!0,C:!0},Ta={endpoint:"emailLinkSignin",M:["idToken","email","oobCode"],A:oa,G:aa,U:!0},Ca={endpoint:"accounts/mfaEnrollment:finalize",M:["idToken","phoneVerificationInfo"],A:la,G:aa,C:!0,La:!0},Ia={endpoint:"accounts/mfaSignIn:finalize",M:["mfaPendingCredential","phoneVerificationInfo"],A:la,G:aa,C:!0,La:!0},Aa={endpoint:"getAccountInfo"},ka={endpoint:"getOobConfirmationCode",M:["requestType"],A:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new E("internal-error");oa(t)},Y:"email",C:!0},xa={endpoint:"getOobConfirmationCode",M:["idToken","requestType"],A:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new E("internal-error")},Y:"email",C:!0},Na={endpoint:"getOobConfirmationCode",M:["idToken","newEmail","requestType"],A:function(t){if("VERIFY_AND_CHANGE_EMAIL"!=t.requestType)throw new E("internal-error")},Y:"email",C:!0},Pa={endpoint:"getOobConfirmationCode",M:["requestType"],A:function(t){if("PASSWORD_RESET"!=t.requestType)throw new E("internal-error");oa(t)},Y:"email",C:!0},ja={hb:!0,endpoint:"getProjectConfig",Rb:"GET"},Ra={hb:!0,endpoint:"getRecaptchaParam",Rb:"GET",G:function(t){if(!t.recaptchaSiteKey)throw new E("internal-error")}},Ma={endpoint:"resetPassword",A:ga,Y:"email",C:!0},Da={endpoint:"sendVerificationCode",M:["phoneNumber","recaptchaToken"],Y:"sessionInfo",C:!0},$a={endpoint:"setAccountInfo",M:["idToken"],A:sa,U:!0},La={endpoint:"setAccountInfo",M:["idToken"],A:function(t){if(sa(t),!t.password)throw new E("weak-password")},G:aa,U:!0},Fa={endpoint:"signupNewUser",G:aa,U:!0,C:!0},Ba={endpoint:"accounts/mfaEnrollment:start",M:["idToken","phoneEnrollmentInfo"],A:function(t){if(!t.phoneEnrollmentInfo)throw new E("internal-error");if(!t.phoneEnrollmentInfo.phoneNumber)throw new E("missing-phone-number");if(!t.phoneEnrollmentInfo.recaptchaToken)throw new E("missing-app-credential")},G:function(t){if(!t.phoneSessionInfo||!t.phoneSessionInfo.sessionInfo)throw new E("internal-error")},C:!0,La:!0},Ua={endpoint:"accounts/mfaSignIn:start",M:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],A:function(t){if(!t.phoneSignInInfo||!t.phoneSignInInfo.recaptchaToken)throw new E("missing-app-credential")},G:function(t){if(!t.phoneResponseInfo||!t.phoneResponseInfo.sessionInfo)throw new E("internal-error")},C:!0,La:!0},Va={endpoint:"verifyAssertion",A:ha,Wa:fa,G:pa,U:!0,C:!0},qa={endpoint:"verifyAssertion",A:ha,Wa:fa,G:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new E("user-not-found");if(t.errorMessage)throw Ja(t.errorMessage);aa(t)},U:!0,C:!0},Wa={endpoint:"verifyAssertion",A:function(t){if(ha(t),!t.idToken)throw new E("internal-error")},Wa:fa,G:pa,U:!0},za={endpoint:"verifyCustomToken",A:function(t){if(!t.token)throw new E("invalid-custom-token")},G:aa,U:!0,C:!0},Ha={endpoint:"verifyPassword",A:function(t){if(oa(t),!t.password)throw new E("wrong-password")},G:aa,U:!0,C:!0},Ka={endpoint:"verifyPhoneNumber",A:ca,G:aa,C:!0},Ga={endpoint:"verifyPhoneNumber",A:function(t){if(!t.idToken)throw new E("internal-error");ca(t)},G:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Wo(t);aa(t)}},Qa={Eb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",A:ca,G:aa,C:!0},Ya={endpoint:"accounts/mfaEnrollment:withdraw",M:["idToken","mfaEnrollmentId"],G:function(t){if(!!t[Gs]^!!t.refreshToken)throw new E("internal-error")},C:!0,La:!0};function Xa(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.M))return Ie(new E("internal-error"));var r,i=!!e.La,o=e.Rb||"POST";return Ce(n).then(e.A).then((function(){return e.U&&(n.returnSecureToken=!0),e.C&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),ia(t,i?t.l:t.h,e.endpoint,o,n,e.Eb,e.hb||!1)})).then((function(t){return r=t,e.Wa?e.Wa(n,r):r})).then(e.G).then((function(){if(!e.Y)return r;if(!(e.Y in r))throw new E("internal-error");return r[e.Y]}))}function Ja(t){return Za({error:{errors:[{message:t}],code:400,message:t}})}function Za(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new E(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",mt(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new E(r[i],e);return!e&&t&&(e=Pr(t)),new E("internal-error",e)}function tc(t){this.b=t,this.a=null,this.nb=function(t){return(ic||(ic=new be((function(t,e){function n(){$r(),Cr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){$r(),e(Error("Network Error"))},timeout:nc.get()})}if(Cr("gapi.iframes.Iframe"))t();else if(Cr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){Cr("gapi.load")?n():e(Error("Network Error"))},Ce(Fs(r=Et(ec,{onload:r}))).o((function(){e(Error("Network Error"))}))}})).o((function(t){throw ic=null,t})))).then((function(){return new be((function(e,n){Cr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:Cr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),rc.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var ec=new gt(_t,"https://apis.google.com/js/api.js?onload=%{onload}"),nc=new Lr(3e4,6e4),rc=new Lr(5e3,15e3),ic=null;function oc(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Ln(this.i,"/__/auth/iframe"),Mn(this.a,"apiKey",this.g),Mn(this.a,"appName",this.h),this.b=null,this.c=[]}function sc(t,e,n,r,i){this.s=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function ac(t){try{return r.a.app(t).auth().Ea()}catch(t){return[]}}function cc(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.s=this.w=null,this.g=[],this.l=this.a=null}function uc(t){var e=ar();return function(t){return Xa(t,ja,{}).then((function(t){return t.authorizedDomains||[]}))}(t).then((function(t){t:{var n=$n(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],s=n,a=r;if(0==o.indexOf("chrome-extension://")?s=$n(o).b==s&&"chrome-extension"==a:"http"!=a&&"https"!=a?s=!1:fr.test(o)?s=s==o:(o=o.split(".").join("\\."),s=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(s)),s){t=!0;break t}}t=!1}if(!t)throw new Vo(ar())}))}function lc(t){return t.l||(t.l=dr().then((function(){if(!t.s){var e=t.c,n=t.h,r=ac(t.b),i=new oc(t.u,t.f,t.b);i.f=e,i.b=n,i.c=Y(r||[]),t.s=i.toString()}t.i=new tc(t.s),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.nb.then((function(){t.a.register("authEvent",e,Cr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(t.i,(function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Lo(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Ce(n)}return n.status="ERROR",Ce(n)}))}(t)}))),t.l}function hc(t){return t.m||(t.w=t.c?Er(t.c,ac(t.b)):null,t.m=new Hs(t.f,x(t.h),t.w)),t.m}function fc(t,e,n,r,i,o,s,a,c,u,l){return(t=new sc(t,e,n,r,i)).l=o,t.g=s,t.i=a,t.b=pt(c||null),t.f=u,t.ub(l).toString()}function pc(t){if(this.a=t||r.a.INTERNAL.reactNative&&r.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new E("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function dc(t){this.b=t,this.a={},this.f=_(this.c,this)}oc.prototype.toString=function(){return this.f?Mn(this.a,"v",this.f):Yn(this.a.a,"v"),this.b?Mn(this.a,"eid",this.b):Yn(this.a.a,"eid"),this.c.length?Mn(this.a,"fw",this.c.join(",")):Yn(this.a.a,"fw"),this.a.toString()},sc.prototype.ub=function(t){return this.h=t,this},sc.prototype.toString=function(){var t=Ln(this.s,"/__/auth/handler");if(Mn(t,"apiKey",this.m),Mn(t,"appName",this.c),Mn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=r.a.app(this.c).auth().ja()}catch(t){n=null}for(var i in e.kb=n,Mn(t,"providerId",this.a.providerId),n=jr((e=this.a).Fb))n[i]=n[i].toString();i=e.Oc,n=pt(n);for(var o=0;o<i.length;o++){var s=i[o];s in n&&delete n[s]}e.lb&&e.kb&&!n[e.lb]&&(n[e.lb]=e.kb),ft(n)||Mn(t,"customParameters",Pr(n))}if("function"==typeof this.a.Nb&&((e=this.a.Nb()).length&&Mn(t,"scopes",e.join(","))),this.l?Mn(t,"redirectUrl",this.l):Yn(t.a,"redirectUrl"),this.g?Mn(t,"eventId",this.g):Yn(t.a,"eventId"),this.i?Mn(t,"v",this.i):Yn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!Dn(t,a)&&Mn(t,a,this.b[a]);return this.h?Mn(t,"tid",this.h):Yn(t.a,"tid"),this.f?Mn(t,"eid",this.f):Yn(t.a,"eid"),(a=ac(this.c)).length&&Mn(t,"fw",a.join(",")),t.toString()},(t=cc.prototype).Lb=function(t,e,n){var r=new E("popup-closed-by-user"),i=new E("web-storage-unsupported"),o=this,s=!1;return this.ka().then((function(){(function(t){var e={type:"webStorageSupport"};return lc(t).then((function(){return function(t,e){return t.nb.then((function(){return new be((function(n){t.a.send(e.type,e,n,Cr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(t.i,e)})).then((function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(t&&lr(t),e(i),s=!0)}))})).o((function(){})).then((function(){if(!s)return function(t){return new be((function(e){return function n(){En(2e3).then((function(){if(t&&!t.closed)return n();e()}))}()}))}(t)})).then((function(){if(!s)return En(n).then((function(){e(r)}))}))},t.Ub=function(){var t=Tr();return!Nr(t)&&!Dr(t)},t.Qb=function(){return!1},t.Jb=function(t,e,n,r,i,o,s,a){if(!t)return Ie(new E("popup-blocked"));if(s&&!Nr())return this.ka().o((function(e){lr(t),i(e)})),r(),Ce();this.a||(this.a=uc(hc(this)));var c=this;return this.a.then((function(){var e=c.ka().o((function(e){throw lr(t),i(e),e}));return r(),e})).then((function(){(Do(n),s)||cr(fc(c.u,c.f,c.b,e,n,null,o,c.c,void 0,c.h,a),t)})).o((function(t){throw"auth/network-request-failed"==t.code&&(c.a=null),t}))},t.Kb=function(t,e,n,r){this.a||(this.a=uc(hc(this)));var i=this;return this.a.then((function(){Do(e),cr(fc(i.u,i.f,i.b,t,e,ar(),n,i.c,void 0,i.h,r))})).o((function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t}))},t.ka=function(){var t=this;return lc(this).then((function(){return t.i.nb})).o((function(){throw t.a=null,new E("network-request-failed")}))},t.Xb=function(){return!0},t.Ca=function(t){this.g.push(t)},t.Qa=function(t){G(this.g,(function(e){return e==t}))},(t=pc.prototype).get=function(t){return Ce(this.a.getItem(t)).then((function(t){return t&&Rr(t)}))},t.set=function(t,e){return Ce(this.a.setItem(t,Pr(e)))},t.T=function(t){return Ce(this.a.removeItem(t))},t.ba=function(){},t.ha=function(){};var mc,yc=[];function gc(t,e,n){ft(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function vc(t){this.a=t}function bc(t){this.c=t,this.b=!1,this.a=[]}function _c(t,e,n,r){var i,o,s,a,c=n||{},u=null;if(t.b)return Ie(Error("connection_unavailable"));var l=r?800:50,h="undefined"!=typeof MessageChannel?new MessageChannel:null;return new be((function(n,r){h?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),h.port1.start(),s=setTimeout((function(){r(Error("unsupported_event"))}),l),u={messageChannel:h,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(s),a=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===t.data.status?(clearTimeout(a),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(s),clearTimeout(a),r(Error("invalid_response"))))}},t.a.push(u),h.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:c},[h.port2])):r(Error("connection_unavailable"))})).then((function(e){return wc(t,u),e})).o((function(e){throw wc(t,u),e}))}function wc(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),G(t.a,(function(t){return t==e}))}}function Sc(){if(!Tc())throw new E("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=a.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.s=!1,this.h=null;var t=this;gr()&&self?(this.l=function(){var t=gr()?self:null;if(V(yc,(function(n){n.b==t&&(e=n)})),!e){var e=new dc(t);yc.push(e)}return e}(),gc(this.l,"keyChanged",(function(e,n){return xc(t).then((function(e){return 0<e.length&&V(t.a,(function(t){t(e)})),{keyProcessed:H(e,n.key)}}))})),gc(this.l,"ping",(function(){return Ce(["keyChanged"])}))):function(){var t=a.navigator;return t&&t.serviceWorker?Ce().then((function(){return t.serviceWorker.ready})).then((function(t){return t.active||null})).o((function(){return null})):Ce(null)}().then((function(e){(t.h=e)&&(t.g=new bc(new vc(e)),_c(t.g,"ping",null,!0).then((function(e){e[0].fulfilled&&H(e[0].value,"keyChanged")&&(t.s=!0)})).o((function(){})))}))}function Oc(t){return new be((function(e,n){var r=t.u.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new be((function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}}))}(t).then((function(){return Oc(t)})).then((function(t){e(t)})).o((function(t){n(t)}))}}))}function Ec(t){return t.m||(t.m=Oc(t)),t.m}function Tc(){try{return!!a.indexedDB}catch(t){return!1}}function Cc(t){return t.objectStore("firebaseLocalStorage")}function Ic(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ac(t){return new be((function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}}))}function kc(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?_c(t.g,"keyChanged",{key:e},t.s).then((function(){})).o((function(){})):Ce()}function xc(t){return Ec(t).then((function(t){var e=Cc(Ic(t,!1));return e.getAll?Ac(e.getAll()):new be((function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}}))})).then((function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r}))}function Nc(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Pc(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Ce().then((function(){if(Tc()){var t=Mr(),r="__sak"+t;return mc||(mc=new Sc),(n=mc).set(r,t).then((function(){return n.get(r)})).then((function(e){if(e!==t)throw Error("indexedDB not supported!");return n.T(r)})).then((function(){return n})).o((function(){return e.c}))}return e.c})).then((function(t){return e.type=t.type,t.ba((function(t){V(e.a,(function(e){e(t)}))})),t}))}function jc(){this.a={},this.type="inMemory"}function Rc(){if(!function(){var t="Node"==vr();if(!(t=Mc()||t&&r.a.INTERNAL.node&&r.a.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==vr())throw new E("internal-error","The LocalStorage compatibility library was not found.");throw new E("web-storage-unsupported")}this.a=Mc()||r.a.INTERNAL.node.localStorage,this.type="localStorage"}function Mc(){try{var t=a.localStorage,e=Mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Dc(){this.type="nullStorage"}function $c(){if(!function(){var t="Node"==vr();if(!(t=Lc()||t&&r.a.INTERNAL.node&&r.a.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==vr())throw new E("internal-error","The SessionStorage compatibility library was not found.");throw new E("web-storage-unsupported")}this.a=Lc()||r.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Lc(){try{var t=a.sessionStorage,e=Mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Fc(){var t={};t.Browser=Vc,t.Node=qc,t.ReactNative=Wc,t.Worker=zc,this.a=t[vr()]}dc.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];V(r,(function(e){i.push(Ce().then((function(){return e(t.origin,t.data.data)})))})),ke(i).then((function(r){var i=[];V(r,(function(t){i.push({fulfilled:t.Mb,value:t.value,reason:t.reason?t.reason.message:void 0})})),V(i,(function(t){for(var e in t)void 0===t[e]&&delete t[e]})),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})}))}},vc.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},bc.prototype.close=function(){for(;0<this.a.length;)wc(this,this.a[0]);this.b=!0},(t=Sc.prototype).set=function(t,e){var n,r=!1,i=this;return Ec(this).then((function(e){return Ac((e=Cc(Ic(n=e,!0))).get(t))})).then((function(o){var s=Cc(Ic(n,!0));return o?(o.value=e,Ac(s.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Ac(s.add(o)))})).then((function(){return i.c[t]=e,kc(i,t)})).ma((function(){r&&i.b--}))},t.get=function(t){return Ec(this).then((function(e){return Ac(Cc(Ic(e,!1)).get(t))})).then((function(t){return t&&t.value}))},t.T=function(t){var e=!1,n=this;return Ec(this).then((function(r){return e=!0,n.b++,Ac(Cc(Ic(r,!0)).delete(t))})).then((function(){return delete n.c[t],kc(n,t)})).ma((function(){e&&n.b--}))},t.ba=function(t){0==this.a.length&&function(t){Nc(t),function e(){t.f=setTimeout((function(){t.i=xc(t).then((function(e){0<e.length&&V(t.a,(function(t){t(e)}))})).then((function(){e()})).o((function(t){"STOP_EVENT"!=t.message&&e()}))}),800)}()}(this),this.a.push(t)},t.ha=function(t){G(this.a,(function(e){return e==t})),0==this.a.length&&Nc(this)},(t=Pc.prototype).get=function(t){return this.b.then((function(e){return e.get(t)}))},t.set=function(t,e){return this.b.then((function(n){return n.set(t,e)}))},t.T=function(t){return this.b.then((function(e){return e.T(t)}))},t.ba=function(t){this.a.push(t)},t.ha=function(t){G(this.a,(function(e){return e==t}))},(t=jc.prototype).get=function(t){return Ce(this.a[t])},t.set=function(t,e){return this.a[t]=e,Ce()},t.T=function(t){return delete this.a[t],Ce()},t.ba=function(){},t.ha=function(){},(t=Rc.prototype).get=function(t){var e=this;return Ce().then((function(){return Rr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Ce().then((function(){var r=Pr(e);null===r?n.T(t):n.a.setItem(t,r)}))},t.T=function(t){var e=this;return Ce().then((function(){e.a.removeItem(t)}))},t.ba=function(t){a.window&&an(a.window,"storage",t)},t.ha=function(t){a.window&&ln(a.window,"storage",t)},(t=Dc.prototype).get=function(){return Ce(null)},t.set=function(){return Ce()},t.T=function(){return Ce()},t.ba=function(){},t.ha=function(){},(t=$c.prototype).get=function(t){var e=this;return Ce().then((function(){return Rr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Ce().then((function(){var r=Pr(e);null===r?n.T(t):n.a.setItem(t,r)}))},t.T=function(t){var e=this;return Ce().then((function(){e.a.removeItem(t)}))},t.ba=function(){},t.ha=function(){};var Bc,Uc,Vc={F:Rc,$a:$c},qc={F:Rc,$a:$c},Wc={F:pc,$a:Dc},zc={F:Rc,$a:Dc},Hc={od:"local",NONE:"none",qd:"session"};function Kc(){var t=!(Dr(Tr())||!yr()),e=Nr(),n=Ir();this.m=t,this.h=e,this.l=n,this.a={},Bc||(Bc=new Fc),t=Bc;try{this.g=!sr()&&Ur()||!a.indexedDB?new t.a.F:new Pc(gr()?new jc:new t.a.F)}catch(t){this.g=new jc,this.h=!0}try{this.i=new t.a.$a}catch(t){this.i=new jc}this.u=new jc,this.f=_(this.Vb,this),this.b={}}function Gc(){return Uc||(Uc=new Kc),Uc}function Qc(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Yc(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Xc(t,e,n){return n=Yc(e,n),"local"==e.F&&(t.b[n]=null),Qc(t,e.F).T(n)}function Jc(t){t.c&&(clearInterval(t.c),t.c=null)}function Zc(t){this.a=t,this.b=Gc()}(t=Kc.prototype).get=function(t,e){return Qc(this,t.F).get(Yc(t,e))},t.set=function(t,e,n){var r=Yc(t,n),i=this,o=Qc(this,t.F);return o.set(r,e).then((function(){return o.get(r)})).then((function(e){"local"==t.F&&(i.b[r]=e)}))},t.addListener=function(t,e,n){t=Yc(t,e),this.l&&(this.b[t]=a.localStorage.getItem(t)),ft(this.a)&&(Qc(this,"local").ba(this.f),this.h||(sr()||!Ur())&&a.indexedDB||!this.l||function(t){Jc(t),t.c=setInterval((function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Qe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Vb(n))}}),1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Yc(t,e),this.a[t]&&(G(this.a[t],(function(t){return t==n})),0==this.a[t].length&&delete this.a[t]),ft(this.a)&&(Qc(this,"local").ha(this.f),Jc(this))},t.Vb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.ib(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Qc(this,"local").ha(this.f):Jc(this),this.m)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.ib(e))},Ht&&ee&&10==ee&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else V(t,_(this.ib,this))},t.ib=function(t){this.a[t]&&V(this.a[t],(function(t){t()}))};var tu,eu={name:"authEvent",F:"local"};function nu(){this.a=Gc()}function ru(t,e){this.b=iu,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=a.Int32Array?new Int32Array(64):Array(64),void 0===tu&&(tu=a.Int32Array?new Int32Array(hu):hu),this.reset()}O(ru,(function(){this.b=-1}));for(var iu=64,ou=iu-1,su=[],au=0;au<ou;au++)su[au]=0;var cu=Q(128,su);function uu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,s=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+s|0}r=0|t.a[0],i=0|t.a[1];var a=0|t.a[2],c=0|t.a[3],u=0|t.a[4],l=0|t.a[5],h=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&a^i&a)|0;s=(o=o+((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))|0)+((s=(s=u&l^~u&h)+(0|tu[e])|0)+(0|n[e])|0)|0,o=h,h=l,l=u,u=c+s|0,c=a,a=i,i=r,r=s+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+a|0,t.a[3]=t.a[3]+c|0,t.a[4]=t.a[4]+u|0,t.a[5]=t.a[5]+l|0,t.a[6]=t.a[6]+h|0,t.a[7]=t.a[7]+o|0}function lu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if("string"==typeof e)for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(uu(t),i=0);else{if(!f(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(uu(t),i=0)}}t.c=i,t.g+=n}ru.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):Y(this.h)};var hu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function fu(){ru.call(this,8,pu)}O(fu,ru);var pu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function du(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.s=i||null,this.h=e+":"+n,this.w=new nu,this.g=new Zc(this.h),this.f=null,this.b=[],this.a=this.c=null}function mu(t){return new E("invalid-cordova-configuration",t)}function yu(t){var e=new fu;lu(e,t),t=[];var n=8*e.g;56>e.c?lu(e,cu,56-e.c):lu(e,cu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(uu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return W(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}(t)}function gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function vu(t){return t.f||(t.f=t.ka().then((function(){return new be((function(e){t.Ca((function n(r){return e(r),t.Qa(n),!1})),function(t){function e(e){r=!0,i&&i.cancel(),bu(t).then((function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=eo(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Rr(Dn(o=$n(i),"firebaseError")||null))?T(o):null)?new $o(r.c,r.b,null,null,o,null,r.S()):new $o(r.c,r.b,i,r.f,null,null,r.S())),i=o||n}gu(t,i)}))}var n=new $o("unknown",null,null,null,new E("no-auth-event")),r=!1,i=En(500).then((function(){return bu(t).then((function(){r||gu(t,n)}))})),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(Cr("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},Uo||(Uo=new Fo),function(t){var e=Uo;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=Cr("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)}))}))),t.f}function bu(t){var e=null;return function(t){return t.b.get(eu,t.a).then((function(t){return Lo(t)}))}(t.g).then((function(n){return e=n,Xc((n=t.g).b,eu,n.a)})).then((function(){return e}))}function _u(t){this.a=t,this.b=Gc()}(t=du.prototype).ka=function(){return this.Ga?this.Ga:this.Ga=(mr(void 0)?dr().then((function(){return new be((function(t,e){var n=a.document,r=setTimeout((function(){e(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),t()}),!1)}))})):Ie(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof Cr("universalLinks.subscribe",a))throw mu("cordova-universal-links-plugin-fix is not installed");if(void 0===Cr("BuildInfo.packageName",a))throw mu("cordova-plugin-buildinfo is not installed");if("function"!=typeof Cr("cordova.plugins.browsertab.openUrl",a))throw mu("cordova-plugin-browsertab is not installed");if("function"!=typeof Cr("cordova.InAppBrowser.open",a))throw mu("cordova-plugin-inappbrowser is not installed")}),(function(){throw new E("cordova-not-ready")}))},t.Lb=function(t,e){return e(new E("operation-not-supported-in-this-environment")),Ce()},t.Jb=function(){return Ie(new E("operation-not-supported-in-this-environment"))},t.Xb=function(){return!1},t.Ub=function(){return!0},t.Qb=function(){return!0},t.Kb=function(t,e,n,r){if(this.c)return Ie(new E("redirect-operation-pending"));var i=this,o=a.document,s=null,c=null,u=null,l=null;return this.c=Ce().then((function(){return Do(e),vu(i)})).then((function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new $o(e,r,null,o,new E("no-auth-event"),null,i),c=Cr("BuildInfo.packageName",a);if("string"!=typeof c)throw new E("invalid-cordova-configuration");var u=Cr("BuildInfo.displayName",a),l={};if(Tr().toLowerCase().match(/iphone|ipad|ipod/))l.ibi=c;else{if(!Tr().toLowerCase().match(/android/))return Ie(new E("operation-not-supported-in-this-environment"));l.apn=c}u&&(l.appDisplayName=u),o=yu(o),l.sessionId=o;var h=fc(t.u,t.i,t.l,e,n,null,r,t.m,l,t.s,i);return t.ka().then((function(){var e=t.h;return t.w.a.set(eu,s.v(),e)})).then((function(){var e=Cr("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new E("invalid-cordova-configuration");var n=null;e((function(e){if(e){if("function"!=typeof(n=Cr("cordova.plugins.browsertab.openUrl",a)))throw new E("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=Cr("cordova.InAppBrowser.open",a)))throw new E("invalid-cordova-configuration");e=Tr(),t.a=n(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,t,e,n,r)})).then((function(){return new be((function(t,e){c=function(){var e=Cr("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Ca(c),u=function(){s||(s=En(2e3).then((function(){e(new E("redirect-cancelled-by-user"))})))},l=function(){Fr()&&u()},o.addEventListener("resume",u,!1),Tr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",l,!1)})).o((function(t){return bu(i).then((function(){throw t}))}))})).ma((function(){u&&o.removeEventListener("resume",u,!1),l&&o.removeEventListener("visibilitychange",l,!1),s&&s.cancel(),c&&i.Qa(c),i.c=null}))},t.Ca=function(t){this.b.push(t),vu(this).o((function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new $o("unknown",null,null,null,new E("no-auth-event")),t(e))}))},t.Qa=function(t){G(this.b,(function(e){return e==t}))};var wu={name:"pendingRedirect",F:"session"};function Su(t){return Xc(t.b,wu,t.a)}function Ou(t,e,n){this.i={},this.w=0,this.D=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.s,this),this.b=new $u,this.B=new Vu,this.g=new _u(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.B,this.c.linkViaPopup=this.B,this.c.reauthViaPopup=this.B,this.a=Eu(this.D,this.u,this.m,C)}function Eu(t,e,n,i){var o=r.a.SDK_VERSION||null;return mr()?new du(t,e,n,o,i):new cc(t,e,n,o,i)}function Tu(t){t.f||(t.f=!0,t.a.Ca(t.l));var e=t.a;return t.a.ka().o((function(n){throw t.a==e&&t.reset(),n}))}function Cu(t){t.a.Ub()&&Tu(t).o((function(e){var n=new $o("unknown",null,null,null,new E("operation-not-supported-in-this-environment"));Pu(e)&&t.s(n)})),t.a.Qb()||Lu(t.b)}function Iu(t,e){H(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(wu,t.a).then((function(t){return"pending"==t}))}(t.g).then((function(e){e?Su(t.g).then((function(){Tu(t).o((function(e){var n=new $o("unknown",null,null,null,new E("operation-not-supported-in-this-environment"));Pu(e)&&t.s(n)}))})):Cu(t)})).o((function(){Cu(t)}))}function Au(t,e){G(t.h,(function(t){return t==e}))}Ou.prototype.reset=function(){this.f=!1,this.a.Qa(this.l),this.a=Eu(this.D,this.u,this.m),this.i={}},Ou.prototype.s=function(t){if(!t)throw new E("invalid-auth-event");if(6e5<=S()-this.w&&(this.i={},this.w=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.Cb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.w=S())),e=!0;break}}return Lu(this.b),e};var ku=new Lr(2e3,1e4),xu=new Lr(3e4,6e4);function Nu(t,e,n,r,i,o,s){return t.a.Jb(e,n,r,(function(){t.f||(t.f=!0,t.a.Ca(t.l))}),(function(){t.reset()}),i,o,s)}function Pu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function ju(t,e,n,r,i){var o;return function(t){return t.b.set(wu,"pending",t.a)}(t.g).then((function(){return t.a.Kb(e,n,r,i).o((function(e){if(Pu(e))throw new E("operation-not-supported-in-this-environment");return o=e,Su(t.g).then((function(){throw o}))})).then((function(){return t.a.Xb()?new be((function(){})):Su(t.g).then((function(){return t.pa()})).then((function(){})).o((function(){}))}))}))}function Ru(t,e,n,r,i){return t.a.Lb(r,(function(t){e.la(n,null,t,i)}),ku.get())}Ou.prototype.pa=function(){return this.b.pa()};var Mu={};function Du(t,e,n){var r=e+":"+n;return Mu[r]||(Mu[r]=new Ou(t,e,n)),Mu[r]}function $u(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Lu(t){t.g||(t.g=!0,Uu(t,!1,null,null))}function Fu(t){t.g&&!t.i&&Uu(t,!1,null,null)}function Bu(t,e){if(t.b=function(){return Ce(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Uu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Ie(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):Bu(t,n):Bu(t,{user:null}),t.f=[],t.c=[]}function Vu(){}function qu(){this.Bb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.Bb},set:function(t){this.Bb=t},enumerable:!1})}function Wu(t,e){this.a=e,Hr(this,"verificationId",t)}function zu(t,e,n,r){return new jo(t).cb(e,n).then((function(t){return new Wu(t,r)}))}function Hu(t){var e=Ui(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new E("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Kr(this,{token:t,expirationTime:Br(1e3*e.exp),authTime:Br(1e3*e.auth_time),issuedAtTime:Br(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,signInSecondFactor:e.firebase&&e.firebase.sign_in_second_factor?e.firebase.sign_in_second_factor:null,claims:e})}function Ku(t,e,n){var r=e&&e[Qu];if(!r)throw new E("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=t,this.f=pt(e),this.g=n,this.c=new no(null,r),this.b=[];var i=this;V(e[Gu]||[],(function(t){(t=Xr(t))&&i.b.push(t)})),Hr(this,"auth",this.a),Hr(this,"session",this.c),Hr(this,"hints",this.b)}$u.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},$u.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Uu(this,!0,null,t.a),Ce()):e.Da(n,r)?function(t,e,n){n=n.Da(e.c,e.b);var r=e.g,i=e.f,o=e.i,s=e.S(),a=!!e.c.match(/Redirect$/);n(r,i,s,o).then((function(e){Uu(t,a,e,null)})).o((function(e){Uu(t,a,null,e)}))}(this,t,e):Ie(new E("invalid-auth-event")):(Uu(this,!1,null,null),Ce())}else Ie(new E("invalid-auth-event"))},$u.prototype.pa=function(){var t=this;return new be((function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new E("timeout");t.a&&t.a.cancel(),t.a=En(xu.get()).then((function(){t.b||(t.g=!0,Uu(t,!0,null,e))}))}(t))}))},Vu.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.la(t.c,null,t.a,t.b),Ce()):e.Da(n,r)?function(t,e){var n=t.b,r=t.c;e.Da(r,n)(t.g,t.f,t.S(),t.i).then((function(t){e.la(r,t,null,n)})).o((function(t){e.la(r,null,t,n)}))}(t,e):Ie(new E("invalid-auth-event"))}else Ie(new E("invalid-auth-event"))},Wu.prototype.confirm=function(t){return t=Ro(this.verificationId,t),this.a(t)};var Gu="mfaInfo",Qu="mfaPendingCredential";function Yu(t,e,n,r){E.call(this,"multi-factor-auth-required",r,e),this.b=new Ku(t,e,n),Hr(this,"resolver",this.b)}function Xu(t,e,n){if(t&&d(t.serverResponse)&&"auth/multi-factor-auth-required"===t.code)try{return new Yu(e,t.serverResponse,n,t.message)}catch(t){}return null}function Ju(){}function Zu(t){Hr(this,"factorId",t.ea),this.a=t}function tl(t){if(Zu.call(this,t),this.a.ea!=jo.PROVIDER_ID)throw new E("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function el(t,e){for(var n in Ge.call(this,t),e)this[n]=e[n]}function nl(t,e){this.a=t,this.b=[],this.c=_(this.wc,this),an(this.a,"userReloaded",this.c);var n=[];e&&e.multiFactor&&e.multiFactor.enrolledFactors&&V(e.multiFactor.enrolledFactors,(function(t){var e=null,r={};if(t){t.uid&&(r[ti]=t.uid),t.displayName&&(r[Jr]=t.displayName),t.enrollmentTime&&(r[Zr]=new Date(t.enrollmentTime).toISOString()),t.phoneNumber&&(r[ei]=t.phoneNumber);try{e=new ni(r)}catch(t){}t=e}else t=null;t&&n.push(t)})),rl(this,n)}function rl(t,e){t.b=e,Hr(t,"enrolledFactors",e)}function il(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function ol(t){this.c=t,this.b=this.a=null}function sl(t){return t.b&&1e3*t.b.c||0}function al(t,e){var n=e.refreshToken;t.b=Bi(e[Gs]||""),t.a=n}function cl(t,e){return function(t,e){return new be((function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?ea(t,t.u+"?key="+encodeURIComponent(t.c),(function(t){t?t.error?r(Za(t)):t.access_token&&t.refresh_token?n(t):r(new E("internal-error")):r(new E("network-request-failed"))}),"POST",Qn(e).toString(),t.g,t.m.get()):r(new E("internal-error"))}))}(t.c,e).then((function(e){return t.b=Bi(e.access_token),t.a=e.refresh_token,{accessToken:t.b.toString(),refreshToken:t.a}})).o((function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e}))}function ul(t,e){this.a=t||null,this.b=e||null,Kr(this,{lastSignInTime:Br(e||null),creationTime:Br(t||null)})}function ll(t,e,n,r,i,o){Kr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function hl(t,e,n){this.N=[],this.l=t.apiKey,this.m=t.appName,this.s=t.authDomain||null,t=r.a.SDK_VERSION?Er(r.a.SDK_VERSION):null,this.a=new Hs(this.l,x(C),t),this.b=new ol(this.a),vl(this,e[Gs]),al(this.b,e),Hr(this,"refreshToken",this.b.a),wl(this,n||{}),bn.call(this),this.P=!1,this.s&&Ar()&&(this.i=Du(this.s,this.l,this.m)),this.R=[],this.h=null,this.B=function(t){return new il((function(){return t.I(!0)}),(function(t){return!(!t||"auth/network-request-failed"!=t.code)}),(function(){var e=sl(t.b)-S()-3e5;return 0<e?e:0}))}(this),this.Z=_(this.Ma,this);var i=this;this.oa=null,this.za=function(t){i.va(t.g)},this.aa=null,this.W=[],this.ya=function(t){pl(i,t.c)},this.$=null,this.O=new nl(this,n),Hr(this,"multiFactor",this.O)}function fl(t,e){t.aa&&ln(t.aa,"languageCodeChanged",t.za),(t.aa=e)&&an(e,"languageCodeChanged",t.za)}function pl(t,e){t.W=e,ta(t.a,r.a.SDK_VERSION?Er(r.a.SDK_VERSION,t.W):null)}function dl(t,e){t.$&&ln(t.$,"frameworkChanged",t.ya),(t.$=e)&&an(e,"frameworkChanged",t.ya)}function ml(t){try{return r.a.app(t.m).auth()}catch(e){throw new E("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function yl(t){t.D||t.B.b||(t.B.start(),ln(t,"tokenChanged",t.Z),an(t,"tokenChanged",t.Z))}function gl(t){ln(t,"tokenChanged",t.Z),t.B.stop()}function vl(t,e){t.xa=e,Hr(t,"_lat",e)}function bl(t){for(var e=[],n=0;n<t.R.length;n++)e.push(t.R[n](t));return ke(e).then((function(){return t}))}function _l(t){t.i&&!t.P&&(t.P=!0,Iu(t.i,t))}function wl(t,e){Kr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new ul(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Sl(){}function Ol(t){return Ce().then((function(){if(t.D)throw new E("app-deleted")}))}function El(t){return W(t.providerData,(function(t){return t.providerId}))}function Tl(t,e){e&&(Cl(t,e.providerId),t.providerData.push(e))}function Cl(t,e){G(t.providerData,(function(t){return t.providerId==e}))}function Il(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Hr(t,e,n)}function Al(t,e){t!=e&&(Kr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?Hr(t,"metadata",function(t){return new ul(t.a,t.b)}(e.metadata)):Hr(t,"metadata",new ul),V(e.providerData,(function(e){Tl(t,e)})),function(t,e){t.b=e.b,t.a=e.a}(t.b,e.b),Hr(t,"refreshToken",t.b.a),rl(t.O,e.O.b))}function kl(t){return t.I().then((function(e){var n=t.isAnonymous;return function(t,e){return Xa(t.a,Aa,{idToken:e}).then(_(t.Ic,t))}(t,e).then((function(){return n||Il(t,"isAnonymous",!1),e}))}))}function xl(t,e){e[Gs]&&t.xa!=e[Gs]&&(al(t.b,e),t.dispatchEvent(new el("tokenChanged")),vl(t,e[Gs]),Il(t,"refreshToken",t.b.a))}function Nl(t,e){return kl(t).then((function(){if(H(El(t),e))return bl(t).then((function(){throw new E("provider-already-linked")}))}))}function Pl(t,e,n){return Gr({user:t,credential:Mo(e),additionalUserInfo:e=Hi(e),operationType:n})}function jl(t,e){return xl(t,e),t.reload().then((function(){return t}))}function Rl(t,e,n,i,o){if(!Ar())return Ie(new E("operation-not-supported-in-this-environment"));if(t.h&&!o)return Ie(t.h);var s=zi(n.providerId),a=Mr(t.uid+":::"),c=null;(!Nr()||yr())&&t.s&&n.isOAuthProvider&&(c=fc(t.s,t.l,t.m,e,n,null,a,r.a.SDK_VERSION||null,null,null,t.tenantId));var u=hr(c,s&&s.ta,s&&s.sa);return i=i().then((function(){if(Dl(t),!o)return t.I().then((function(){}))})).then((function(){return Nu(t.i,u,e,n,a,!!c,t.tenantId)})).then((function(){return new be((function(n,r){t.la(e,null,new E("cancelled-popup-request"),t.g||null),t.f=n,t.w=r,t.g=a,t.c=Ru(t.i,t,e,u,a)}))})).then((function(t){return u&&lr(u),t?Gr(t):null})).o((function(t){throw u&&lr(u),t})),$l(t,i,o)}function Ml(t,e,n,r,i){if(!Ar())return Ie(new E("operation-not-supported-in-this-environment"));if(t.h&&!i)return Ie(t.h);var o=null,s=Mr(t.uid+":::");return r=r().then((function(){if(Dl(t),!i)return t.I().then((function(){}))})).then((function(){return t.fa=s,bl(t)})).then((function(e){return t.ga&&(e=(e=t.ga).b.set(Bl,t.v(),e.a)),e})).then((function(){return ju(t.i,e,n,s,t.tenantId)})).o((function(e){if(o=e,t.ga)return Ul(t.ga);throw o})).then((function(){if(o)throw o})),$l(t,r,i)}function Dl(t){if(!t.i||!t.P){if(t.i&&!t.P)throw new E("internal-error");throw new E("auth-domain-config-required")}}function $l(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Ie(t.h)):e.o((function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new el("userInvalidated")),t.h=e),e}))}(t,e,n);return t.N.push(r),r.ma((function(){K(t.N,r)})),r.o((function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=Xu(e.v(),ml(t),_(t.hc,t))),n||e}))}function Ll(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!t.stsTokenManager||!t.stsTokenManager.accessToken)return null;n[Gs]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null;var r=new hl(e,n,t);return t.providerData&&V(t.providerData,(function(t){t&&Tl(r,Gr(t))})),t.redirectEventId&&(r.fa=t.redirectEventId),r}function Fl(t){this.a=t,this.b=Gc()}Ku.prototype.Pc=function(t){var e=this;return t.ob(this.a.b,this.c).then((function(t){var n=pt(e.f);return delete n[Gu],delete n[Qu],mt(n,t),e.g(n)}))},O(Yu,E),Ju.prototype.ob=function(t,e,n){return e.type==ro?function(t,e,n,r){return n.Fa().then((function(n){return n={idToken:n},void 0!==r&&(n.displayName=r),mt(n,{phoneVerificationInfo:Po(t.a)}),Xa(e,Ca,n)}))}(this,t,e,n):function(t,e,n){return n.Fa().then((function(n){return mt(n={mfaPendingCredential:n},{phoneVerificationInfo:Po(t.a)}),Xa(e,Ia,n)}))}(this,t,e)},O(Zu,Ju),O(tl,Zu),O(el,Ge),(t=nl.prototype).wc=function(t){rl(this,function(t){var e=[];return V(t.mfaInfo||[],(function(t){(t=Xr(t))&&e.push(t)})),e}(t.ed))},t.Ob=function(){return this.a.I().then((function(t){return new no(t,null)}))},t.dc=function(t,e){var n=this,r=this.a.a;return this.Ob().then((function(n){return t.ob(r,n,e)})).then((function(t){return xl(n.a,t),n.a.reload()}))},t.$c=function(t){var e=this,n="string"==typeof t?t:t.uid,r=this.a.a;return this.a.I().then((function(t){return Xa(r,Ya,{idToken:t,mfaEnrollmentId:n})})).then((function(t){var r=q(e.b,(function(t){return t.uid!=n}));return rl(e,r),xl(e.a,t),e.a.reload().o((function(t){if("auth/user-token-expired"!=t.code)throw t}))}))},t.v=function(){return{multiFactor:{enrolledFactors:W(this.b,(function(t){return t.v()}))}}},il.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=En(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then((function(){return function(){var t=a.document,e=null;return Fr()||!t?Ce():new be((function(n){e=function(){Fr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)})).o((function(n){throw t.removeEventListener("visibilitychange",e,!1),n}))}()})).then((function(){return e.h()})).then((function(){t(e,!0)})).o((function(n){e.i(n)&&t(e,!1)}))}(this,!0)},il.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},ol.prototype.v=function(){return{apiKey:this.c.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:sl(this)}},ol.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Ie(new E("user-token-expired")):t||!this.b||S()>sl(this)-3e4?this.a?cl(this,{grant_type:"refresh_token",refresh_token:this.a}):Ce(null):Ce({accessToken:this.b.toString(),refreshToken:this.a})},ul.prototype.v=function(){return{lastLoginAt:this.b,createdAt:this.a}},O(hl,bn),hl.prototype.va=function(t){this.oa=t,Zs(this.a,t)},hl.prototype.ja=function(){return this.oa},hl.prototype.Ea=function(){return Y(this.W)},hl.prototype.Ma=function(){this.B.b&&(this.B.stop(),this.B.start())},Hr(hl.prototype,"providerId","firebase"),(t=hl.prototype).reload=function(){var t=this;return $l(this,Ol(this).then((function(){return kl(t).then((function(){return bl(t)})).then(Sl)})))},t.mc=function(t){return this.I(t).then((function(t){return new Hu(t)}))},t.I=function(t){var e=this;return $l(this,Ol(this).then((function(){return e.b.getToken(t)})).then((function(t){if(!t)throw new E("internal-error");return t.accessToken!=e.xa&&(vl(e,t.accessToken),e.dispatchEvent(new el("tokenChanged"))),Il(e,"refreshToken",t.refreshToken),t.accessToken})))},t.Ic=function(t){if(!(t=t.users)||!t.length)throw new E("internal-error");wl(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?W(t,(function(t){return new ll(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)})):[]}(t),n=0;n<e.length;n++)Tl(this,e[n]);Il(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length)),this.dispatchEvent(new el("userReloaded",{ed:t}))},t.Jc=function(t){return Wr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.pb(t)},t.pb=function(t){var e=this,n=null;return $l(this,t.c(this.a,this.uid).then((function(t){return xl(e,t),n=Pl(e,t,"reauthenticate"),e.h=null,e.reload()})).then((function(){return n})),!0)},t.Ac=function(t){return Wr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.mb(t)},t.mb=function(t){var e=this,n=null;return $l(this,Nl(this,t.providerId).then((function(){return e.I()})).then((function(n){return t.b(e.a,n)})).then((function(t){return n=Pl(e,t,"link"),jl(e,t)})).then((function(){return n})))},t.Bc=function(t,e){var n=this;return $l(this,Nl(this,"phone").then((function(){return zu(ml(n),t,e,_(n.mb,n))})))},t.Kc=function(t,e){var n=this;return $l(this,Ce().then((function(){return zu(ml(n),t,e,_(n.pb,n))})),!0)},t.xb=function(t){var e=this;return $l(this,this.I().then((function(n){return e.a.xb(n,t)})).then((function(t){return xl(e,t),e.reload()})))},t.cd=function(t){var e=this;return $l(this,this.I().then((function(n){return t.b(e.a,n)})).then((function(t){return xl(e,t),e.reload()})))},t.yb=function(t){var e=this;return $l(this,this.I().then((function(n){return e.a.yb(n,t)})).then((function(t){return xl(e,t),e.reload()})))},t.zb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Ol(this);var e=this;return $l(this,this.I().then((function(n){return e.a.zb(n,{displayName:t.displayName,photoUrl:t.photoURL})})).then((function(t){return xl(e,t),Il(e,"displayName",t.displayName||null),Il(e,"photoURL",t.photoUrl||null),V(e.providerData,(function(t){"password"===t.providerId&&(Hr(t,"displayName",e.displayName),Hr(t,"photoURL",e.photoURL))})),bl(e)})).then(Sl))},t.ad=function(t){var e=this;return $l(this,kl(this).then((function(n){return H(El(e),t)?function(t,e,n){return Xa(t,Oa,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then((function(t){var n={};return V(t.providerUserInfo||[],(function(t){n[t.providerId]=!0})),V(El(e),(function(t){n[t]||Cl(e,t)})),n[jo.PROVIDER_ID]||Hr(e,"phoneNumber",null),bl(e)})):bl(e).then((function(){throw new E("no-such-provider")}))})))},t.delete=function(){var t=this;return $l(this,this.I().then((function(e){return Xa(t.a,Sa,{idToken:e})})).then((function(){t.dispatchEvent(new el("userDeleted"))}))).then((function(){for(var e=0;e<t.N.length;e++)t.N[e].cancel("app-deleted");fl(t,null),dl(t,null),t.N=[],t.D=!0,gl(t),Hr(t,"refreshToken",null),t.i&&Au(t.i,t)}))},t.Cb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.fa||null)==e||"reauthViaRedirect"==t&&(this.fa||null)==e)},t.la=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.w?this.w(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.w)},t.Da=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Hb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Ib,this):"linkViaRedirect"==t&&(this.fa||null)==e?_(this.Hb,this):"reauthViaRedirect"==t&&(this.fa||null)==e?_(this.Ib,this):null},t.Cc=function(t){var e=this;return Rl(this,"linkViaPopup",t,(function(){return Nl(e,t.providerId).then((function(){return bl(e)}))}),!1)},t.Lc=function(t){return Rl(this,"reauthViaPopup",t,(function(){return Ce()}),!0)},t.Dc=function(t){var e=this;return Ml(this,"linkViaRedirect",t,(function(){return Nl(e,t.providerId)}),!1)},t.Mc=function(t){return Ml(this,"reauthViaRedirect",t,(function(){return Ce()}),!0)},t.Hb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return $l(this,this.I().then((function(n){return ma(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})})).then((function(t){return o=Pl(i,t,"link"),jl(i,t)})).then((function(){return o})))},t.Ib=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return $l(this,Ce().then((function(){return so(ya(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)})).then((function(t){return o=Pl(i,t,"reauthenticate"),xl(i,t),i.h=null,i.reload()})).then((function(){return o})),!0)},t.qb=function(t){var e=this,n=null;return $l(this,this.I().then((function(e){return n=e,void 0===t||ft(t)?{}:Di(new Ci(t))})).then((function(t){return e.a.qb(n,t)})).then((function(t){if(e.email!=t)return e.reload()})).then((function(){})))},t.Ab=function(t,e){var n=this,r=null;return $l(this,this.I().then((function(t){return r=t,void 0===e||ft(e)?{}:Di(new Ci(e))})).then((function(e){return n.a.Ab(r,t,e)})).then((function(t){if(n.email!=t)return n.reload()})).then((function(){})))},t.hc=function(t){var e=null,n=this;return $l(this,t=so(Ce(t),n.uid).then((function(t){return e=Pl(n,t,"reauthenticate"),xl(n,t),n.h=null,n.reload()})).then((function(){return e})),!0)},t.toJSON=function(){return this.v()},t.v=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.s,stsTokenManager:this.b.v(),redirectEventId:this.fa||null};return this.metadata&&mt(t,this.metadata.v()),V(this.providerData,(function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))})),mt(t,this.O.v()),t};var Bl={name:"redirectUser",F:"session"};function Ul(t){return Xc(t.b,Bl,t.a)}function Vl(t){this.a=t,this.b=Gc(),this.c=null,this.f=function(t){var e=zl("local"),n=zl("session"),r=zl("none");return function(t,e,n){var r=Yc(e,n),i=Qc(t,e.F);return t.get(e,n).then((function(o){var s=null;try{s=Rr(a.localStorage.getItem(r))}catch(t){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)}))}(t.b,e,t.a).then((function(){return t.b.get(n,t.a)})).then((function(i){return i?n:t.b.get(r,t.a).then((function(n){return n?r:t.b.get(e,t.a).then((function(n){return n?e:t.b.get(Wl,t.a).then((function(t){return t?zl(t):e}))}))}))})).then((function(e){return t.c=e,ql(t,e.F)})).o((function(){t.c||(t.c=e)}))}(this),this.b.addListener(zl("local"),this.a,_(this.g,this))}function ql(t,e){var n,r=[];for(n in Hc)Hc[n]!==e&&r.push(Xc(t.b,zl(Hc[n]),t.a));return r.push(Xc(t.b,Wl,t.a)),function(t){return new be((function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},s=function(t){n(t)},a=0;a<t.length;a++)Ae(t[a],w(o,a),s);else e(i)}))}(r)}Vl.prototype.g=function(){var t=this,e=zl("local");Ql(this,(function(){return Ce().then((function(){return t.c&&"local"!=t.c.F?t.b.get(e,t.a):null})).then((function(n){if(n)return ql(t,"local").then((function(){t.c=e}))}))}))};var Wl={name:"persistence",F:"session"};function zl(t){return{name:"authUser",F:t}}function Hl(t,e){return Ql(t,(function(){return t.b.set(t.c,e.v(),t.a)}))}function Kl(t){return Ql(t,(function(){return Xc(t.b,t.c,t.a)}))}function Gl(t,e){return Ql(t,(function(){return t.b.get(t.c,t.a).then((function(t){return t&&e&&(t.authDomain=e),Ll(t||{})}))}))}function Ql(t,e){return t.f=t.f.then(e,e),t.f}function Yl(t){if(this.l=!1,Hr(this,"settings",new qu),Hr(this,"app",t),!ih(this).options||!ih(this).options.apiKey)throw new E("invalid-api-key");t=r.a.SDK_VERSION?Er(r.a.SDK_VERSION):null,this.b=new Hs(ih(this).options&&ih(this).options.apiKey,x(C),t),this.P=[],this.m=[],this.O=[],this.$b=r.a.INTERNAL.createSubscribe(_(this.xc,this)),this.W=void 0,this.ac=r.a.INTERNAL.createSubscribe(_(this.yc,this)),nh(this,null),this.i=new Vl(ih(this).options.apiKey+":"+ih(this).name),this.B=new Fl(ih(this).options.apiKey+":"+ih(this).name),this.Z=ch(this,function(t){var e=ih(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Bl,t.a).then((function(t){return t&&e&&(t.authDomain=e),Ll(t||{})}))}(t.B,ih(t).options.authDomain).then((function(e){return(t.D=e)&&(e.ga=t.B),Ul(t.B)}));return ch(t,e)}(t).then((function(){return Gl(t.i,e)})).then((function(e){return e?(e.ga=t.B,t.D&&(t.D.fa||null)==(e.fa||null)?e:e.reload().then((function(){return Hl(t.i,e).then((function(){return e}))})).o((function(n){return"auth/network-request-failed"==n.code?e:Kl(t.i)}))):null})).then((function(e){nh(t,e||null)}));return ch(t,n)}(this)),this.h=ch(this,function(t){return t.Z.then((function(){return th(t)})).o((function(){})).then((function(){if(!t.l)return t.oa()})).o((function(){})).then((function(){if(!t.l){t.aa=!0;var e=t.i;e.b.addListener(zl("local"),e.a,t.oa)}}))}(this)),this.aa=!1,this.oa=_(this.Xc,this),this.Ma=_(this.ca,this),this.xa=_(this.jc,this),this.ya=_(this.uc,this),this.za=_(this.vc,this),this.a=null,function(t){var e=ih(t).options.authDomain,n=ih(t).options.apiKey;e&&Ar()&&(t.Zb=t.Z.then((function(){if(!t.l){if(t.a=Du(e,n,ih(t).name),Iu(t.a,t),oh(t)&&_l(oh(t)),t.D){_l(t.D);var r=t.D;r.va(t.ja()),fl(r,t),pl(r=t.D,t.N),dl(r,t),t.D=null}return t.a}})))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.Ec,this),this.s=0,bn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ja()},set:function(t){this.va(t)},enumerable:!1}),t.$=null,Object.defineProperty(t,"ti",{get:function(){return this.S()},set:function(t){this.ub(t)},enumerable:!1}),t.R=null}(this),this.N=[]}function Xl(t){Ge.call(this,"languageCodeChanged"),this.g=t}function Jl(t){Ge.call(this,"frameworkChanged"),this.c=t}function Zl(t){return t.Zb||Ie(new E("auth-domain-config-required"))}function th(t){if(!Ar())return Ie(new E("operation-not-supported-in-this-environment"));var e=Zl(t).then((function(){return t.a.pa()})).then((function(t){return t?Gr(t):null}));return ch(t,e)}function eh(t,e){var n={};return n.apiKey=ih(t).options.apiKey,n.authDomain=ih(t).options.authDomain,n.appName=ih(t).name,t.Z.then((function(){return function(t,e,n,r){var i=new hl(t,e);return n&&(i.ga=n),r&&pl(i,r),i.reload().then((function(){return i}))}(n,e,t.B,t.Ea())})).then((function(e){return oh(t)&&e.uid==oh(t).uid?(Al(oh(t),e),t.ca(e)):(nh(t,e),_l(e),t.ca(e))})).then((function(){ah(t)}))}function nh(t,e){oh(t)&&(function(t,e){G(t.R,(function(t){return t==e}))}(oh(t),t.Ma),ln(oh(t),"tokenChanged",t.xa),ln(oh(t),"userDeleted",t.ya),ln(oh(t),"userInvalidated",t.za),gl(oh(t))),e&&(e.R.push(t.Ma),an(e,"tokenChanged",t.xa),an(e,"userDeleted",t.ya),an(e,"userInvalidated",t.za),0<t.s&&yl(e)),Hr(t,"currentUser",e),e&&(e.va(t.ja()),fl(e,t),pl(e,t.N),dl(e,t))}function rh(t,e){var n=null,r=null;return ch(t,e.then((function(e){return n=Mo(e),r=Hi(e),eh(t,e)}),(function(e){var n=null;throw e&&"auth/multi-factor-auth-required"===e.code&&(n=Xu(e.v(),t,_(t.ic,t))),n||e})).then((function(){return Gr({user:oh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function ih(t){return t.app}function oh(t){return t.currentUser}function sh(t){return oh(t)&&oh(t)._lat||null}function ah(t){if(t.aa){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](sh(t));if(t.W!==t.getUid()&&t.O.length)for(t.W=t.getUid(),e=0;e<t.O.length;e++)t.O[e]&&t.O[e](sh(t))}}function ch(t,e){return t.P.push(e),e.ma((function(){K(t.P,e)})),e}function uh(){}function lh(){this.a={},this.b=1e12}Vl.prototype.tb=function(t){var e=null,n=this;return function(t){var e=new E("invalid-persistence-type"),n=new E("unsupported-persistence-type");t:{for(r in Hc)if(Hc[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(vr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;case"Worker":if("session"===t||!Tc()&&"none"!==t)throw n;break;default:if(!Ir()&&"none"!==t)throw n}}(t),Ql(this,(function(){return t!=n.c.F?n.b.get(n.c,n.a).then((function(r){return e=r,ql(n,t)})).then((function(){if(n.c=zl(t),e)return n.b.set(n.c,e,n.a)})):Ce()}))},O(Yl,bn),O(Xl,Ge),O(Jl,Ge),(t=Yl.prototype).tb=function(t){return ch(this,t=this.i.tb(t))},t.va=function(t){this.$===t||this.l||(this.$=t,Zs(this.b,this.$),this.dispatchEvent(new Xl(this.ja())))},t.ja=function(){return this.$},t.dd=function(){var t=a.navigator;this.va(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.Ec=function(t){this.N.push(t),ta(this.b,r.a.SDK_VERSION?Er(r.a.SDK_VERSION,this.N):null),this.dispatchEvent(new Jl(this.N))},t.Ea=function(){return Y(this.N)},t.ub=function(t){this.R===t||this.l||(this.R=t,this.b.b=this.R)},t.S=function(){return this.R},t.toJSON=function(){return{apiKey:ih(this).options.apiKey,authDomain:ih(this).options.authDomain,appName:ih(this).name,currentUser:oh(this)&&oh(this).v()}},t.Cb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.la=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.w?this.w(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.w)},t.Da=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.gc,this):null},t.gc=function(t,e,n,r){var i=this,o={requestUri:t,postBody:r,sessionId:e,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),i.Z.then((function(){return rh(i,da(i.b,o))}))},t.Vc=function(t){if(!Ar())return Ie(new E("operation-not-supported-in-this-environment"));var e=this,n=zi(t.providerId),i=Mr(),o=null;(!Nr()||yr())&&ih(this).options.authDomain&&t.isOAuthProvider&&(o=fc(ih(this).options.authDomain,ih(this).options.apiKey,ih(this).name,"signInViaPopup",t,null,i,r.a.SDK_VERSION||null,null,null,this.S()));var s=hr(o,n&&n.ta,n&&n.sa);return ch(this,n=Zl(this).then((function(n){return Nu(n,s,"signInViaPopup",t,i,!!o,e.S())})).then((function(){return new be((function(t,n){e.la("signInViaPopup",null,new E("cancelled-popup-request"),e.g),e.f=t,e.w=n,e.g=i,e.c=Ru(e.a,e,"signInViaPopup",s,i)}))})).then((function(t){return s&&lr(s),t?Gr(t):null})).o((function(t){throw s&&lr(s),t})))},t.Wc=function(t){if(!Ar())return Ie(new E("operation-not-supported-in-this-environment"));var e=this;return ch(this,Zl(this).then((function(){return function(t){return Ql(t,(function(){return t.b.set(Wl,t.c.F,t.a)}))}(e.i)})).then((function(){return ju(e.a,"signInViaRedirect",t,void 0,e.S())})))},t.pa=function(){var t=this;return th(this).then((function(e){return t.a&&Fu(t.a.b),e})).o((function(e){throw t.a&&Fu(t.a.b),e}))},t.bd=function(t){if(!t)return Ie(new E("null-user"));if(this.R!=t.tenantId)return Ie(new E("tenant-id-mismatch"));var e=this,n={};n.apiKey=ih(this).options.apiKey,n.authDomain=ih(this).options.authDomain,n.appName=ih(this).name;var r=function(t,e,n,r){var i=t.b,o={};return o[Gs]=i.b&&i.b.toString(),o.refreshToken=i.a,e=new hl(e||{apiKey:t.l,authDomain:t.s,appName:t.m},o),n&&(e.ga=n),r&&pl(e,r),Al(e,t),e}(t,n,e.B,e.Ea());return ch(this,this.h.then((function(){if(ih(e).options.apiKey!=t.l)return r.reload()})).then((function(){return oh(e)&&t.uid==oh(e).uid?(Al(oh(e),t),e.ca(t)):(nh(e,r),_l(r),e.ca(r))})).then((function(){ah(e)})))},t.wb=function(){var t=this;return ch(this,this.h.then((function(){return t.a&&Fu(t.a.b),oh(t)?(nh(t,null),Kl(t.i).then((function(){ah(t)}))):Ce()})))},t.Xc=function(){var t=this;return Gl(this.i,ih(this).options.authDomain).then((function(e){if(!t.l){var n;if(n=oh(t)&&e){n=oh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Al(oh(t),e),oh(t).I();(oh(t)||e)&&(nh(t,e),e&&(_l(e),e.ga=t.B),t.a&&Iu(t.a,t),ah(t))}}))},t.ca=function(t){return Hl(this.i,t)},t.jc=function(){ah(this),this.ca(oh(this))},t.uc=function(){this.wb()},t.vc=function(){this.wb()},t.ic=function(t){var e=this;return this.h.then((function(){return rh(e,Ce(t))}))},t.xc=function(t){var e=this;this.addAuthTokenListener((function(){t.next(oh(e))}))},t.yc=function(t){var e=this;!function(t,e){t.O.push(e),ch(t,t.h.then((function(){!t.l&&H(t.O,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(sh(t)))})))}(this,(function(){t.next(oh(e))}))},t.Gc=function(t,e,n){var r=this;return this.aa&&Promise.resolve().then((function(){"function"==typeof t?t(oh(r)):"function"==typeof t.next&&t.next(oh(r))})),this.$b(t,e,n)},t.Fc=function(t,e,n){var r=this;return this.aa&&Promise.resolve().then((function(){r.W=r.getUid(),"function"==typeof t?t(oh(r)):"function"==typeof t.next&&t.next(oh(r))})),this.ac(t,e,n)},t.kc=function(t){var e=this;return ch(this,this.h.then((function(){return oh(e)?oh(e).I(t).then((function(t){return{accessToken:t}})):null})))},t.Rc=function(t){var e=this;return this.h.then((function(){return rh(e,Xa(e.b,za,{token:t}))})).then((function(t){var n=t.user;return Il(n,"isAnonymous",!1),e.ca(n),t}))},t.Sc=function(t,e){var n=this;return this.h.then((function(){return rh(n,Xa(n.b,Ha,{email:t,password:e}))}))},t.cc=function(t,e){var n=this;return this.h.then((function(){return rh(n,Xa(n.b,_a,{email:t,password:e}))}))},t.Ya=function(t){var e=this;return this.h.then((function(){return rh(e,t.ia(e.b))}))},t.Qc=function(t){return Wr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ya(t)},t.vb=function(){var t=this;return this.h.then((function(){var e=oh(t);if(e&&e.isAnonymous){var n=Gr({providerId:null,isNewUser:!1});return Gr({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return rh(t,t.b.vb()).then((function(e){var n=e.user;return Il(n,"isAnonymous",!0),t.ca(n),e}))}))},t.getUid=function(){return oh(this)&&oh(this).uid||null},t.bc=function(t){this.addAuthTokenListener(t),this.s++,0<this.s&&oh(this)&&yl(oh(this))},t.Nc=function(t){var e=this;V(this.m,(function(n){n==t&&e.s--})),0>this.s&&(this.s=0),0==this.s&&oh(this)&&gl(oh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),ch(this,this.h.then((function(){e.l||H(e.m,t)&&t(sh(e))})))},t.removeAuthTokenListener=function(t){G(this.m,(function(e){return e==t}))},t.delete=function(){this.l=!0;for(var t=0;t<this.P.length;t++)this.P[t].cancel("app-deleted");return this.P=[],this.i&&(t=this.i).b.removeListener(zl("local"),t.a,this.oa),this.a&&(Au(this.a,this),Fu(this.a.b)),Promise.resolve()},t.fc=function(t){return ch(this,function(t,e){return Xa(t,wa,{identifier:e,continueUri:kr()?ar():"http://localhost"}).then((function(t){return t.signinMethods||[]}))}(this.b,t))},t.zc=function(t){return!!ko(t)},t.sb=function(t,e){var n=this;return ch(this,Ce().then((function(){var t=new Ci(e);if(!t.c)throw new E("argument-error",ki+" must be true when sending sign in link to email");return Di(t)})).then((function(e){return n.b.sb(t,e)})).then((function(){})))},t.fd=function(t){return this.Pa(t).then((function(t){return t.data.email}))},t.jb=function(t,e){return ch(this,this.b.jb(t,e).then((function(){})))},t.Pa=function(t){return ch(this,this.b.Pa(t).then((function(t){return new ri(t)})))},t.fb=function(t){return ch(this,this.b.fb(t).then((function(){})))},t.rb=function(t,e){var n=this;return ch(this,Ce().then((function(){return void 0===e||ft(e)?{}:Di(new Ci(e))})).then((function(e){return n.b.rb(t,e)})).then((function(){})))},t.Uc=function(t,e){return ch(this,zu(this,t,e,_(this.Ya,this)))},t.Tc=function(t,e){var n=this;return ch(this,Ce().then((function(){var r=e||ar(),i=Ao(t,r);if(!(r=ko(r)))throw new E("argument-error","Invalid email link!");if(r.tenantId!==n.S())throw new E("tenant-id-mismatch");return n.Ya(i)})))},uh.prototype.render=function(){},uh.prototype.reset=function(){},uh.prototype.getResponse=function(){},uh.prototype.execute=function(){};var hh=null;function fh(t,e){return(e=ph(e))&&t.a[e]||null}function ph(t){return(t=void 0===t?1e12:t)?t.toString():null}function dh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=oe(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():an(this.f,"click",this.i)}function mh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function yh(){}function gh(){}lh.prototype.render=function(t,e){return this.a[this.b.toString()]=new dh(t,e),this.b++},lh.prototype.reset=function(t){var e=fh(this,t);t=ph(t),e&&t&&(e.delete(),delete this.a[t])},lh.prototype.getResponse=function(t){return(t=fh(this,t))?t.getResponse():null},lh.prototype.execute=function(t){(t=fh(this,t))&&t.execute()},dh.prototype.getResponse=function(){return mh(this),this.b},dh.prototype.execute=function(){mh(this);var t=this;this.a||(this.a=setTimeout((function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout((function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()}),6e4)}),500))},dh.prototype.delete=function(){mh(this),this.g=!0,clearTimeout(this.a),this.a=null,ln(this.f,"click",this.i)},Hr(yh,"FACTOR_ID","phone"),gh.prototype.g=function(){return hh||(hh=new lh),Ce(hh)},gh.prototype.c=function(){};var vh=null;function bh(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var _h=new gt(_t,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),wh=new Lr(3e4,6e4);bh.prototype.g=function(t){var e=this;return new be((function(n,r){var i=setTimeout((function(){r(new E("network-request-failed"))}),wh.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new E("internal-error"));delete a[e.a]},Ce(Fs(Et(_h,{onload:e.a,hl:t||""}))).o((function(){clearTimeout(i),r(new E("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(a.grecaptcha))}))},bh.prototype.c=function(){this.b--};var Sh=null;function Oh(t,e,n,r,i,o,s){if(Hr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.u=e,this.g=null,s?(vh||(vh=new gh),s=vh):(Sh||(Sh=new bh),s=Sh),this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Ch])throw new E("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ih],!a.document)throw new E("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!oe(e)||!this.i&&oe(e).hasChildNodes())throw new E("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.s=new Hs(t,o||null,i||null),this.w=r||function(){return null};var c=this;this.l=[];var u=this.a[Eh];this.a[Eh]=function(t){if(Ah(c,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=Cr(u,a);"function"==typeof e&&e(t)}};var l=this.a[Th];this.a[Th]=function(){if(Ah(c,null),"function"==typeof l)l();else if("string"==typeof l){var t=Cr(l,a);"function"==typeof t&&t()}}}var Eh="callback",Th="expired-callback",Ch="sitekey",Ih="size";function Ah(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function kh(t,e){return t.h.push(e),e.ma((function(){K(t.h,e)})),e}function xh(t){if(t.D)throw new E("internal-error","RecaptchaVerifier instance has been destroyed.")}function Nh(t,e,n){var i=!1;try{this.b=n||r.a.app()}catch(t){throw new E("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new E("invalid-api-key");n=this.b.options.apiKey;var o=this,s=null;try{s=this.b.auth().Ea()}catch(t){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}s=r.a.SDK_VERSION?Er(r.a.SDK_VERSION,s):null,Oh.call(this,n,t,e,(function(){try{var t=o.b.auth().ja()}catch(e){t=null}return t}),s,x(C),i)}function Ph(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,s=0;s<e.length;s++)if(e[s].optional)o=!0;else{if(o)throw new E("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].K(n[i])&&!o){if(e=e[i],0>i||i>=jh.length)throw new E("internal-error","Argument validator received an unsupported number of arguments.");n=jh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.J+".";break t}r=null}}if(r)throw new E("argument-error",t+" failed: "+r)}(t=Oh.prototype).Ga=function(){var t=this;return this.f?this.f:this.f=kh(this,Ce().then((function(){if(kr()&&!gr())return dr();throw new E("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return t.m.g(t.w())})).then((function(e){return t.g=e,Xa(t.s,Ra,{})})).then((function(e){t.a[Ch]=e.recaptchaSiteKey})).o((function(e){throw t.f=null,e})))},t.render=function(){xh(this);var t=this;return kh(this,this.Ga().then((function(){if(null===t.c){var e=t.u;if(!t.i){var n=oe(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),s=r[1];if(!ie&&s&&(s.name||s.type)){if(o=["<",o],s.name&&o.push(' name="',Ut(s.name),'"'),s.type){o.push(' type="',Ut(s.type),'"');var a={};mt(a,s),delete a.type,s=a}o.push(">"),o=o.join("")}return o=he(i,o),s&&("string"==typeof s?o.className=s:Array.isArray(s)?o.className=s.join(" "):se(o,s)),2<r.length&&le(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c})))},t.verify=function(){xh(this);var t=this;return kh(this,this.render().then((function(e){return new be((function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){G(t.l,(function(t){return t==e}))}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}}))})))},t.reset=function(){xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){xh(this),this.D=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=oe(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},O(Nh,Oh);var jh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Rh(t,e){return{name:t||"",J:"a valid string",optional:!!e,K:function(t){return"string"==typeof t}}}function Mh(t,e){return{name:t||"",J:"a boolean",optional:!!e,K:function(t){return"boolean"==typeof t}}}function Dh(t,e){return{name:t||"",J:"a valid object",optional:!!e,K:d}}function $h(t,e){return{name:t||"",J:"a function",optional:!!e,K:function(t){return"function"==typeof t}}}function Lh(t,e){return{name:t||"",J:"null",optional:!!e,K:function(t){return null===t}}}function Fh(t){return{name:t?t+"Credential":"credential",J:t?"a valid "+t+" credential":"a valid credential",optional:!1,K:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ia||!n)}}}function Bh(t,e){return d(t)&&"string"==typeof t.type&&t.type===e&&"function"==typeof t.Fa}function Uh(t){return d(t)&&"string"==typeof t.uid}function Vh(t,e,n,r){return{name:n||"",J:t.J+" or "+e.J,optional:!!r,K:function(n){return t.K(n)||e.K(n)}}}function qh(t,e){for(var n in e){var r=e[n].name;t[r]=Hh(r,t[n],e[n].j)}}function Wh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:w((function(t){return this[t]}),n),set:w((function(t,e,n,r){Ph(t,[n],[r],!0),this[e]=r}),r,n,e[n].gb),enumerable:!0})}}function zh(t,e,n,r){t[e]=Hh(e,n,r)}function Hh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Ph(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}qh(Yl.prototype,{fb:{name:"applyActionCode",j:[Rh("code")]},Pa:{name:"checkActionCode",j:[Rh("code")]},jb:{name:"confirmPasswordReset",j:[Rh("code"),Rh("newPassword")]},cc:{name:"createUserWithEmailAndPassword",j:[Rh("email"),Rh("password")]},fc:{name:"fetchSignInMethodsForEmail",j:[Rh("email")]},pa:{name:"getRedirectResult",j:[]},zc:{name:"isSignInWithEmailLink",j:[Rh("emailLink")]},Fc:{name:"onAuthStateChanged",j:[Vh(Dh(),$h(),"nextOrObserver"),$h("opt_error",!0),$h("opt_completed",!0)]},Gc:{name:"onIdTokenChanged",j:[Vh(Dh(),$h(),"nextOrObserver"),$h("opt_error",!0),$h("opt_completed",!0)]},rb:{name:"sendPasswordResetEmail",j:[Rh("email"),Vh(Dh("opt_actionCodeSettings",!0),Lh(null,!0),"opt_actionCodeSettings",!0)]},sb:{name:"sendSignInLinkToEmail",j:[Rh("email"),Dh("actionCodeSettings")]},tb:{name:"setPersistence",j:[Rh("persistence")]},Qc:{name:"signInAndRetrieveDataWithCredential",j:[Fh()]},vb:{name:"signInAnonymously",j:[]},Ya:{name:"signInWithCredential",j:[Fh()]},Rc:{name:"signInWithCustomToken",j:[Rh("token")]},Sc:{name:"signInWithEmailAndPassword",j:[Rh("email"),Rh("password")]},Tc:{name:"signInWithEmailLink",j:[Rh("email"),Rh("emailLink",!0)]},Uc:{name:"signInWithPhoneNumber",j:[Rh("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Vc:{name:"signInWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Wc:{name:"signInWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},bd:{name:"updateCurrentUser",j:[Vh({name:"user",J:"an instance of Firebase User",optional:!1,K:function(t){return!!(t&&t instanceof hl)}},Lh(),"user")]},wb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Rh(null,!0)]},dd:{name:"useDeviceLanguage",j:[]},fd:{name:"verifyPasswordResetCode",j:[Rh("code")]}}),Wh(Yl.prototype,{lc:{name:"languageCode",gb:Vh(Rh(),Lh(),"languageCode")},ti:{name:"tenantId",gb:Vh(Rh(),Lh(),"tenantId")}}),Yl.Persistence=Hc,Yl.Persistence.LOCAL="local",Yl.Persistence.SESSION="session",Yl.Persistence.NONE="none",qh(hl.prototype,{delete:{name:"delete",j:[]},mc:{name:"getIdTokenResult",j:[Mh("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[Mh("opt_forceRefresh",!0)]},Ac:{name:"linkAndRetrieveDataWithCredential",j:[Fh()]},mb:{name:"linkWithCredential",j:[Fh()]},Bc:{name:"linkWithPhoneNumber",j:[Rh("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Cc:{name:"linkWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"linkWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Jc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Fh()]},pb:{name:"reauthenticateWithCredential",j:[Fh()]},Kc:{name:"reauthenticateWithPhoneNumber",j:[Rh("phoneNumber"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]},Lc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",J:"a valid Auth provider",optional:!1,K:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},qb:{name:"sendEmailVerification",j:[Vh(Dh("opt_actionCodeSettings",!0),Lh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Rh(null,!0)]},ad:{name:"unlink",j:[Rh("provider")]},xb:{name:"updateEmail",j:[Rh("email")]},yb:{name:"updatePassword",j:[Rh("password")]},cd:{name:"updatePhoneNumber",j:[Fh("phone")]},zb:{name:"updateProfile",j:[Dh("profile")]},Ab:{name:"verifyBeforeUpdateEmail",j:[Rh("email"),Vh(Dh("opt_actionCodeSettings",!0),Lh(null,!0),"opt_actionCodeSettings",!0)]}}),qh(lh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),qh(uh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),qh(be.prototype,{ma:{name:"finally"},o:{name:"catch"},then:{name:"then"}}),Wh(qu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",gb:Mh("appVerificationDisabledForTesting")}}),qh(Wu.prototype,{confirm:{name:"confirm",j:[Rh("verificationCode")]}}),zh(oo,"fromJSON",(function(t){t="string"==typeof t?JSON.parse(t):t;for(var e,n=[fo,Co,No,uo],r=0;r<n.length;r++)if(e=n[r](t))return e;return null}),[Vh(Rh(),Dh(),"json")]),zh(Io,"credential",(function(t,e){return new To(t,e)}),[Rh("email"),Rh("password")]),qh(To.prototype,{v:{name:"toJSON",j:[Rh(null,!0)]}}),qh(go.prototype,{Aa:{name:"addScope",j:[Rh("scope")]},Ia:{name:"setCustomParameters",j:[Dh("customOAuthParameters")]}}),zh(go,"credential",vo,[Vh(Rh(),Dh(),"token")]),zh(Io,"credentialWithLink",Ao,[Rh("email"),Rh("emailLink")]),qh(bo.prototype,{Aa:{name:"addScope",j:[Rh("scope")]},Ia:{name:"setCustomParameters",j:[Dh("customOAuthParameters")]}}),zh(bo,"credential",_o,[Vh(Rh(),Dh(),"token")]),qh(wo.prototype,{Aa:{name:"addScope",j:[Rh("scope")]},Ia:{name:"setCustomParameters",j:[Dh("customOAuthParameters")]}}),zh(wo,"credential",So,[Vh(Rh(),Vh(Dh(),Lh()),"idToken"),Vh(Rh(),Lh(),"accessToken",!0)]),qh(Oo.prototype,{Ia:{name:"setCustomParameters",j:[Dh("customOAuthParameters")]}}),zh(Oo,"credential",Eo,[Vh(Rh(),Dh(),"token"),Rh("secret",!0)]),qh(yo.prototype,{Aa:{name:"addScope",j:[Rh("scope")]},credential:{name:"credential",j:[Vh(Rh(),Vh(Dh(),Lh()),"optionsOrIdToken"),Vh(Rh(),Lh(),"accessToken",!0)]},Ia:{name:"setCustomParameters",j:[Dh("customOAuthParameters")]}}),qh(lo.prototype,{v:{name:"toJSON",j:[Rh(null,!0)]}}),qh(ao.prototype,{v:{name:"toJSON",j:[Rh(null,!0)]}}),zh(jo,"credential",Ro,[Rh("verificationId"),Rh("verificationCode")]),qh(jo.prototype,{cb:{name:"verifyPhoneNumber",j:[Vh(Rh(),{name:"phoneInfoOptions",J:"valid phone info options",optional:!1,K:function(t){return!!t&&(t.session&&t.phoneNumber?Bh(t.session,ro)&&"string"==typeof t.phoneNumber:t.session&&t.multiFactorHint?Bh(t.session,io)&&Uh(t.multiFactorHint):t.session&&t.multiFactorUid?Bh(t.session,io)&&"string"==typeof t.multiFactorUid:!!t.phoneNumber&&"string"==typeof t.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",J:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,K:function(t){return!(!t||"string"!=typeof t.type||"function"!=typeof t.verify)}}]}}),qh(xo.prototype,{v:{name:"toJSON",j:[Rh(null,!0)]}}),qh(E.prototype,{toJSON:{name:"toJSON",j:[Rh(null,!0)]}}),qh(qo.prototype,{toJSON:{name:"toJSON",j:[Rh(null,!0)]}}),qh(Vo.prototype,{toJSON:{name:"toJSON",j:[Rh(null,!0)]}}),qh(Yu.prototype,{toJSON:{name:"toJSON",j:[Rh(null,!0)]}}),qh(Ku.prototype,{Pc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(t){return!!t&&!!t.ob}}]}}),qh(nl.prototype,{Ob:{name:"getSession",j:[]},dc:{name:"enroll",j:[{name:"multiFactorAssertion",J:"a valid multiFactorAssertion",optional:!1,K:function(t){return!!t&&!!t.ob}},Rh("displayName",!0)]},$c:{name:"unenroll",j:[Vh({name:"multiFactorInfo",J:"a valid multiFactorInfo",optional:!1,K:Uh},Rh(),"multiFactorInfoIdentifier")]}}),qh(Nh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),zh(gi,"parseLink",Ti,[Rh("link")]),zh(yh,"assertion",(function(t){return new tl(t)}),[Fh("phone")]),function(){if(void 0===r.a||!r.a.INTERNAL||!r.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:oi,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ii,VERIFY_AND_CHANGE_EMAIL:si,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:Yl,AuthCredential:oo,Error:E};zh(t,"EmailAuthProvider",Io,[]),zh(t,"FacebookAuthProvider",go,[]),zh(t,"GithubAuthProvider",bo,[]),zh(t,"GoogleAuthProvider",wo,[]),zh(t,"TwitterAuthProvider",Oo,[]),zh(t,"OAuthProvider",yo,[Rh("providerId")]),zh(t,"SAMLAuthProvider",mo,[Rh("providerId")]),zh(t,"PhoneAuthProvider",jo,[{name:"auth",J:"an instance of Firebase Auth",optional:!0,K:function(t){return!!(t&&t instanceof Yl)}}]),zh(t,"RecaptchaVerifier",Nh,[Vh(Rh(),{name:"",J:"an HTML element",optional:!1,K:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Dh("recaptchaParameters",!0),{name:"app",J:"an instance of Firebase App",optional:!0,K:function(t){return!!(t&&t instanceof r.a.app.App)}}]),zh(t,"ActionCodeURL",gi,[]),zh(t,"PhoneMultiFactorGenerator",yh,[]),r.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new Yl(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),r.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:_((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:_(t.kc,t),addAuthTokenListener:_(t.bc,t),removeAuthTokenListener:_(t.Nc,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),r.a.registerVersion("@firebase/auth","0.14.9"),r.a.INTERNAL.extendNamespace({User:hl})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){n(527);const r=n(530);n(531),e.signUp=async(t,e)=>{await r.auth().createUserWithEmailAndPassword(t,e).catch((function(t){throw t}))},e.login=async(t,e)=>{await r.auth().signInWithEmailAndPassword(t,e).catch((function(t){throw t}));return r.auth().currentUser.email},e.logout=async()=>(await r.auth().signOut(),"Logged Out Succesfully!"),e.getUserToken=async()=>{const t=r.auth().currentUser;if(null===t)return null;return await t.xa}},function(t,e,n){n(532).initializeApp({apiKey:"AIzaSyCmp2lHnXplB6cpMMIPf8g7kZjKLSv4VSc",authDomain:"clone-c48a1.firebaseapp.com",databaseURL:"https://clone-c48a1.firebaseio.com",projectId:"clone-c48a1",storageBucket:"clone-c48a1.appspot.com",messagingSenderId:"149435188681",appId:"1:149435188681:web:cd8811fb1a3bb5337e1418"})},function(t,e,n){"use strict";(function(t){var e,r=n(18),i=n(1),o=n(2),s=n(44),a=n(69),c=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Object(o.J)(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Object(o.D)(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),u=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Object(o.k)(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),l=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new c(e)}}catch(t){}return new u},h=l("localStorage"),f=l("sessionStorage"),p=new s.b("@firebase/database"),d=(e=1,function(){return e++}),m=function(t){var e=Object(o.I)(t),n=new o.e;n.update(e);var r=n.digest();return o.i.encodeByteArray(r)},y=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=y.apply(null,i):n+="object"==typeof i?Object(o.J)(i):i,n+=" "}return n},g=null,v=!0,b=function(t,e){Object(o.g)(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(p.logLevel=s.a.VERBOSE,g=p.log.bind(p),e&&f.set("logging_enabled",!0)):"function"==typeof t?g=t:(g=null,f.remove("logging_enabled"))},_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===v&&(v=!1,null===g&&!0===f.get("logging_enabled")&&b(!0)),g){var n=y.apply(null,t);g(n)}},w=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];_.apply(void 0,Object(i.f)([t],e))}},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+y.apply(void 0,Object(i.f)(t));p.error(n)},O=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+y.apply(void 0,Object(i.f)(t));throw p.error(n),new Error(n)},E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+y.apply(void 0,Object(i.f)(t));p.warn(n)},T=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},C="[MIN_NAME]",I="[MAX_NAME]",A=function(t,e){if(t===e)return 0;if(t===C||e===I)return-1;if(e===C||t===I)return 1;var n=D(t),r=D(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},k=function(t,e){return t===e?0:t<e?-1:1},x=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Object(o.J)(e))},N=function(t){if("object"!=typeof t||null===t)return Object(o.J)(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Object(o.J)(e[i]),r+=":",r+=N(t[e[i]]);return r+="}"},P=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function j(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var R=function(t){Object(o.g)(!T(t),"Invalid JSON number");var e,n,r,i,s;0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var c=a.join(""),u="";for(s=0;s<64;s+=8){var l=parseInt(c.substr(s,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},M=new RegExp("^-?(0*)\\d{1,10}$"),D=function(t){if(M.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},$=function(t){try{t()}catch(t){setTimeout((function(){var e=t.stack||"";throw E("Exception was thrown by user callback.",e),t}),Math.floor(0))}},L=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},F=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!1,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=A(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),B=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(o.H)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Object(o.H)(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Object(o.H)(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),U=function(){function t(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(Object(o.g)("string"==typeof t,"typeof type must == string"),Object(o.g)("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return j(e,(function(t,e){r.push(t+"="+e)})),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var V,q,W,z,H,K=function(t){var e=G(t),n=e.namespace;"firebase.com"===e.domain&&O(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||O("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&E("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new U(e.host,e.secure,n,r,"",n!==e.subdomain),path:new F(e.pathString)}},G=function(t){var e="",n="",r="",o="",s="",a=!0,c="https",u=443;if("string"==typeof t){var l=t.indexOf("//");l>=0&&(c=t.substring(0,l-1),t=t.substring(l+2));var h=t.indexOf("/");-1===h&&(h=t.length);var f=t.indexOf("?");-1===f&&(f=t.length),e=t.substring(0,Math.min(h,f)),h<f&&(o=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,f)));var p=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var o=Object(i.h)(t.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value;if(0!==a.length){var c=a.split("=");2===c.length?r[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):E("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,f)));(l=e.indexOf(":"))>=0?(a="https"===c||"wss"===c,u=parseInt(e.substring(l+1),10)):l=e.length;var d=e.slice(0,l);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var m=e.indexOf(".");r=e.substring(0,m).toLowerCase(),n=e.substring(m+1),s=r}"ns"in p&&(s=p.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:c,pathString:o,namespace:s}},Q=/[\[\].#$\/\u0000-\u001F\u007F]/,Y=/[\[\].#$\u0000-\u001F\u007F]/,X=function(t){return"string"==typeof t&&0!==t.length&&!Q.test(t)},J=function(t){return"string"==typeof t&&0!==t.length&&!Y.test(t)},Z=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!T(t)||t&&"object"==typeof t&&Object(o.k)(t,".sv")},tt=function(t,e,n,r,i){i&&void 0===n||et(Object(o.o)(t,e,i),n,r)},et=function(t,e,n){var r=n instanceof F?new B(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(T(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>10485760/3&&Object(o.H)(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,s=!1;if(j(e,(function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!X(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),et(t,n,r),r.pop()})),i&&s)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},nt=function(t,e,n,r,i){if(!i||void 0!==n){var s=Object(o.o)(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(s+" must be an object containing the children to replace.");var a=[];j(n,(function(t,e){var n=new F(t);if(et(s,e,r.child(n)),".priority"===n.getBack()&&!Z(e))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!X(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(F.comparePaths);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&s.contains(r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(s,a)}},rt=function(t,e,n,r){if(!r||void 0!==n){if(T(n))throw new Error(Object(o.o)(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Z(n))throw new Error(Object(o.o)(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},it=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(o.o)(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ot=function(t,e,n,r){if(!(r&&void 0===n||X(n)))throw new Error(Object(o.o)(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},st=function(t,e,n,r){if(!(r&&void 0===n||J(n)))throw new Error(Object(o.o)(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},at=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),st(t,e,n,r)},ct=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},ut=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!X(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),J(t)}(r))throw new Error(Object(o.o)(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},lt=function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(o.o)(t,e,r)+"must be a boolean.")},ht=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Object(o.K)("OnDisconnect.cancel",0,1,arguments.length),Object(o.L)("OnDisconnect.cancel",1,t,!0);var e=new o.b;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Object(o.K)("OnDisconnect.remove",0,1,arguments.length),ct("OnDisconnect.remove",this.path_),Object(o.L)("OnDisconnect.remove",1,t,!0);var e=new o.b;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Object(o.K)("OnDisconnect.set",1,2,arguments.length),ct("OnDisconnect.set",this.path_),tt("OnDisconnect.set",1,t,this.path_,!1),Object(o.L)("OnDisconnect.set",2,e,!0);var n=new o.b;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Object(o.K)("OnDisconnect.setWithPriority",2,3,arguments.length),ct("OnDisconnect.setWithPriority",this.path_),tt("OnDisconnect.setWithPriority",1,t,this.path_,!1),rt("OnDisconnect.setWithPriority",2,e,!1),Object(o.L)("OnDisconnect.setWithPriority",3,n,!0);var r=new o.b;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Object(o.K)("OnDisconnect.update",1,2,arguments.length),ct("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,E("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}nt("OnDisconnect.update",1,t,this.path_,!1),Object(o.L)("OnDisconnect.update",2,e,!0);var i=new o.b;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),ft=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Object(o.K)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),pt=(V="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",q=0,W=[],function(t){var e,n=t===q;q=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=V.charAt(t%64),t=Math.floor(t/64);Object(o.g)(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===W[e];e--)W[e]=0;W[e]++}else for(e=0;e<12;e++)W[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=V.charAt(W[e]);return Object(o.g)(20===i.length,"nextPushId: Length should be 20."),i}),dt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),mt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new dt(C,t),r=new dt(C,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return dt.MIN},t}(),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return z},set:function(t){z=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return A(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw Object(o.h)("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return new dt(I,z)},e.prototype.makePost=function(t,e){return Object(o.g)("string"==typeof t,"KeyIndex indexValue must always be a string."),new dt(t,z)},e.prototype.toString=function(){return".key"},e}(mt),gt=new yt;var vt,bt,_t,wt=function(t){return"number"==typeof t?"number:"+R(t):"string:"+t},St=function(t){if(t.isLeafNode()){var e=t.val();Object(o.g)("string"==typeof e||"number"==typeof e||"object"==typeof e&&Object(o.k)(e,".sv"),"Priority must be a string or number.")}else Object(o.g)(t===H||t.isEmpty(),"priority of unexpected type.");Object(o.g)(t===H||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ot=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Object(o.g)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),St(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return vt},set:function(t){vt=t},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(o.g)(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+wt(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?R(this.value_):this.value_,this.lazyHash_=m(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(Object(o.g)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),s=t.VALUE_TYPE_ORDER.indexOf(r);return Object(o.g)(i>=0,"Unknown leaf type: "+n),Object(o.g)(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var Et,Tt,Ct=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?A(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return new dt(I,new Ot("[PRIORITY-POST]",_t))},e.prototype.makePost=function(t,e){var n=bt(t);return new dt(e,new Ot("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(mt)),It=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),At=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:xt.EMPTY_NODE,this.right=null!=o?o:xt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return xt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return xt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),kt=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new At(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),xt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,At.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,At.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new It(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new It(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new It(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new It(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new kt,t}(),Nt=Math.log(2),Pt=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Nt,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),jt=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,s,a=r-e;if(0===a)return null;if(1===a)return o=t[e],s=n?n(o):o,new At(s,o.node,At.BLACK,null,null);var c=parseInt(a/2,10)+e,u=i(e,c),l=i(c+1,r);return o=t[c],s=n?n(o):o,new At(s,o.node,At.BLACK,u,l)},o=function(e){for(var r=null,o=null,s=t.length,a=function(e,r){var o=s-e,a=s;s-=e;var u=i(o+1,a),l=t[o],h=n?n(l):l;c(new At(h,l.node,r,null,u))},c=function(t){r?(r.left=t,r=t):(o=t,r=t)},u=0;u<e.count;++u){var l=e.nextBitIsOne(),h=Math.pow(2,e.count-(u+1));l?a(h,At.BLACK):(a(h,At.BLACK),a(h,At.RED))}return o}(new Pt(t.length));return new xt(r||e,o)},Rt={},Mt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return Object(o.g)(Rt&&Ct,"ChildrenNode.ts has not been loaded"),Et=Et||new t({".priority":Rt},{".priority":Ct})},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=Object(o.G)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof xt?e:null},t.prototype.hasIndex=function(t){return Object(o.k)(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){Object(o.g)(e!==gt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,s=[],a=!1,c=n.getIterator(dt.Wrap),u=c.getNext();u;)a=a||e.isDefinedOn(u.node),s.push(u),u=c.getNext();r=a?jt(s,e.getCompare()):Rt;var l=e.toString(),h=Object(i.a)({},this.indexSet_);h[l]=e;var f=Object(i.a)({},this.indexes_);return f[l]=r,new t(f,h)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Object(o.E)(this.indexes_,(function(t,i){var s=Object(o.G)(r.indexSet_,i);if(Object(o.g)(s,"Missing index implementation for "+i),t===Rt){if(s.isDefinedOn(e.node)){for(var a=[],c=n.getIterator(dt.Wrap),u=c.getNext();u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),jt(a,s.getCompare())}return Rt}var l=n.get(e.name),h=t;return l&&(h=h.remove(new dt(e.name,l))),h.insert(e,e.node)})),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Object(o.E)(this.indexes_,(function(t){if(t===Rt)return t;var r=n.get(e.name);return r?t.remove(new dt(e.name,r)):t})),this.indexSet_)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Dt(t,e){return A(t.name,e.name)}function $t(t,e){return A(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&St(this.priorityNode_),this.children_.isEmpty()&&Object(o.g)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return Tt||(Tt=new t(new xt($t),null,Mt.Default))},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||Tt},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Tt:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(Object(o.g)(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new dt(e,n),i=void 0,s=void 0;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?Tt:this.priorityNode_;return new t(i,a,s)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;Object(o.g)(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ct,(function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+wt(this.getPriority().val())+":"),this.forEachChild(Ct,(function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":m(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new dt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new dt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new dt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getIteratorFrom(t.name,dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getReverseIteratorFrom(t.name,dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ft?-1:0},t.prototype.withIndex=function(e){if(e===gt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===gt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Ct),r=e.getIterator(Ct),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===gt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Ft=new(function(t){function e(){return t.call(this,new xt($t),Lt.EMPTY_NODE,Mt.Default)||this}return Object(i.c)(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Lt.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Lt));Object.defineProperties(dt,{MIN:{value:new dt(C,Lt.EMPTY_NODE)},MAX:{value:new dt(I,Ft)}}),yt.__EMPTY_NODE=Lt.EMPTY_NODE,Ot.__childrenNodeConstructor=Lt,H=Ft,function(t){_t=t}(Ft);function Bt(t,e){if(void 0===e&&(e=null),null===t)return Lt.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Object(o.g)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Ot(t,Bt(e));if(t instanceof Array){var n=Lt.EMPTY_NODE;return j(t,(function(e,r){if(Object(o.k)(t,e)&&"."!==e.substring(0,1)){var i=Bt(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority(Bt(e))}var r=[],i=!1;if(j(t,(function(t,e){if("."!==t.substring(0,1)){var n=Bt(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new dt(t,n)))}})),0===r.length)return Lt.EMPTY_NODE;var s=jt(r,Dt,(function(t){return t.name}),$t);if(i){var a=jt(r,Ct.getCompare());return new Lt(s,Bt(e),new Mt({".priority":a},{".priority":Ct}))}return new Lt(s,Bt(e),Mt.Default)}!function(t){bt=t}(Bt);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ut,Vt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?A(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return dt.MIN},e.prototype.maxPost=function(){return dt.MAX},e.prototype.makePost=function(t,e){var n=Bt(t);return new dt(e,n)},e.prototype.toString=function(){return".value"},e}(mt)),qt=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,Object(o.g)(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.c)(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?A(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Bt(t),r=Lt.EMPTY_NODE.updateChild(this.indexPath_,n);return new dt(e,r)},e.prototype.maxPost=function(){var t=Lt.EMPTY_NODE.updateChild(this.indexPath_,Ft);return new dt(I,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(mt),Wt=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return Object(o.K)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return Object(o.K)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return Object(o.K)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return Object(o.K)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){Object(o.K)("DataSnapshot.child",0,1,arguments.length),e=String(e),st("DataSnapshot.child",1,e,!1);var n=new F(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Ct)},t.prototype.hasChild=function(t){Object(o.K)("DataSnapshot.hasChild",1,1,arguments.length),st("DataSnapshot.hasChild",1,t,!1);var e=new F(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return Object(o.K)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;if(Object(o.K)("DataSnapshot.forEach",1,1,arguments.length),Object(o.L)("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return e(new t(i,n.ref_.child(r),Ct))}))},t.prototype.hasChildren=function(){return Object(o.K)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return Object(o.K)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return Object(o.K)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),zt=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(o.J)(this.snapshot.exportVal())},t}(),Ht=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Kt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new zt("value",this,new Wt(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(o.g)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ht(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Gt=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Object(o.k)(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ht(this,t,e):null},t.prototype.createEvent=function(t,e){Object(o.g)(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new zt(t.type,this,new Wt(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Object(o.g)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var n=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var s=r[0],a=i[0];return!(a!==s||e.callbacks_[s]&&this.callbacks_[a]&&e.callbacks_[s]!==this.callbacks_[a])}return i.every((function(t){return e.callbacks_[t]===n.callbacks_[t]}))}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Qt=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(o.g)(Ut,"Reference.ts has not been loaded"),Ut},set:function(t){Ut=t},enumerable:!1,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===gt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==C)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==I)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ct){if(null!=e&&!Z(e)||null!=n&&!Z(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(o.g)(t.getIndex()instanceof qt||t.getIndex()===Vt,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return Object(o.K)("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){Object(o.K)("Query.on",2,4,arguments.length),it("Query.on",1,e,!1),Object(o.L)("Query.on",2,n,!1);var s=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,s.cancel,s.context);else{var a={};a[e]=n,this.onChildEvent(a,s.cancel,s.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Kt(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Gt(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){Object(o.K)("Query.off",0,3,arguments.length),it("Query.off",1,t,!0),Object(o.L)("Query.off",2,e,!0),Object(o.M)("Query.off",3,n,!0);var r=null,i=null;if("value"===t){var s=e||null;r=new Kt(s,null,n||null)}else t&&(e&&((i={})[t]=e),r=new Gt(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var s=this;Object(o.K)("Query.once",1,4,arguments.length),it("Query.once",1,e,!1),Object(o.L)("Query.once",2,n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,i),c=!0,u=new o.b;u.promise.catch((function(){}));var l=function(t){c&&(c=!1,s.off(e,l),n&&n.bind(a.context)(t),u.resolve(t))};return this.on(e,l,(function(t){s.off(e,l),a.cancel&&a.cancel.bind(a.context)(t),u.reject(t)})),u.promise},t.prototype.limitToFirst=function(e){if(Object(o.K)("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(Object(o.K)("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(Object(o.K)("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');st("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new F(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new qt(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){Object(o.K)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(gt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){Object(o.K)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Ct);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){Object(o.K)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Vt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),Object(o.K)("Query.startAt",0,2,arguments.length),tt("Query.startAt",1,e,this.path,!0),ot("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),Object(o.K)("Query.endAt",0,2,arguments.length),tt("Query.endAt",1,e,this.path,!0),ot("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(Object(o.K)("Query.equalTo",1,2,arguments.length),tt("Query.equalTo",1,t,this.path,!1),ot("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return Object(o.K)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return Object(o.K)("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=N(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(Object(o.K)("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===e.repo,i=this.path.equals(e.path),s=this.queryIdentifier()===e.queryIdentifier();return r&&i&&s},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Object(o.L)(t,3,r.cancel,!0),r.context=n,Object(o.M)(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Object(o.o)(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Yt=function(){function t(t){this.node_=t}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e))},t.prototype.node=function(){return this.node_},t}(),Xt=function(){function t(t,e){this.syncTree_=t,this.path_=e}return t.prototype.getImmediateChild=function(e){var n=this.path_.child(e);return new t(this.syncTree_,n)},t.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},t}(),Jt=function(t,e,n){return t&&"object"==typeof t?(Object(o.g)(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?Zt(t[".sv"],e,n):"object"==typeof t[".sv"]?te(t[".sv"],e):void Object(o.g)(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Zt=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Object(o.g)(!1,"Unexpected server value: "+t)}},te=function(t,e,n){t.hasOwnProperty("increment")||Object(o.g)(!1,"Unexpected server value: "+JSON.stringify(t,null,2));var r=t.increment;"number"!=typeof r&&Object(o.g)(!1,"Unexpected increment value: "+r);var i=e.node();if(Object(o.g)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var s=i.getValue();return"number"!=typeof s?r:s+r},ee=function(t,e,n,r){return re(e,new Xt(n,t),r)},ne=function(t,e,n){return re(t,new Yt(e),n)};function re(t,e,n){var r,i=t.getPriority().val(),o=Jt(i,e.getImmediateChild(".priority"),n);if(t.isLeafNode()){var s=t,a=Jt(s.getValue(),e,n);return a!==s.getValue()||o!==s.getPriority().val()?new Ot(a,Bt(o)):t}var c=t;return r=c,o!==c.getPriority().val()&&(r=r.updatePriority(new Ot(o))),c.forEachChild(Ct,(function(t,i){var o=re(i,e.getImmediateChild(t),n);o!==i&&(r=r.updateImmediateChild(t,o))})),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ie,oe=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,n);else{var r=e.getFront();this.children.has(r)||this.children.set(r,new t);var i=this.children.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ct,(function(t,e){n.remember(new F(t),e)})),this.forget(t)}if(this.children.size>0){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new F(t.toString()+"/"+n);r.forEachTree(i,e)}))},t.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ie||(ie={}));var se,ae,ce=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,Object(o.g)(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ue=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=ie.ACK_USER_WRITE,this.source=ce.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(o.g)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new F(e));return new t(F.Empty,n,this.revert)}return Object(o.g)(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),le=function(){function t(t,e){void 0===e&&(se||(se=new xt(k)),e=se),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return j(e,(function(t,e){n=n.set(new F(t),e)})),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:F.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new F(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,o)},t.prototype.fold=function(t){return this.fold_(F.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,F.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,F.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(F.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},t.Empty=new t(null),t}(),he=function(){function t(t,e){this.source=t,this.path=e,this.type=ie.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,F.Empty):new t(this.source,this.path.popFront())},t}(),fe=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=ie.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,F.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),pe=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=ie.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new F(e));return n.isEmpty()?null:n.value?new fe(this.source,F.Empty,n.value):new t(this.source,F.Empty,n)}return Object(o.g)(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),de=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),me=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new de(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new de(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new de(Lt.EMPTY_NODE,!1,!1),new de(Lt.EMPTY_NODE,!1,!1)),t}(),ye=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),ge=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,s){Object(o.g)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=s&&(n.isEmpty()?t.hasChild(e)?s.trackChildChange(ye.childRemovedChange(e,a)):Object(o.g)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(ye.childAddedChange(e,n)):s.trackChildChange(ye.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ct,(function(t,r){e.hasChild(t)||n.trackChildChange(ye.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(Ct,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(ye.childChangedChange(e,r,i))}else n.trackChildChange(ye.childAddedChange(e,r))}))),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Lt.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),ve=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Object(o.g)(e===ye.CHILD_ADDED||e===ye.CHILD_CHANGED||e===ye.CHILD_REMOVED,"Only child changes supported for tracking"),Object(o.g)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===ye.CHILD_ADDED&&i===ye.CHILD_REMOVED)this.changeMap.set(n,ye.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===ye.CHILD_REMOVED&&i===ye.CHILD_ADDED)this.changeMap.delete(n);else if(e===ye.CHILD_REMOVED&&i===ye.CHILD_CHANGED)this.changeMap.set(n,ye.childRemovedChange(n,r.oldSnap));else if(e===ye.CHILD_CHANGED&&i===ye.CHILD_ADDED)this.changeMap.set(n,ye.childAddedChange(n,t.snapshotNode));else{if(e!==ye.CHILD_CHANGED||i!==ye.CHILD_CHANGED)throw Object(o.h)("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,ye.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),be=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),_e=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new de(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),we=function(t,e){this.viewCache=t,this.changes=e},Se=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){Object(o.g)(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(o.g)(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var s,a,c=new ve;if(n.type===ie.OVERWRITE){var u=n;u.source.fromUser?s=this.applyUserOverwrite_(e,u.path,u.snap,r,i,c):(Object(o.g)(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),s=this.applyServerOverwrite_(e,u.path,u.snap,r,i,a,c))}else if(n.type===ie.MERGE){var l=n;l.source.fromUser?s=this.applyUserMerge_(e,l.path,l.children,r,i,c):(Object(o.g)(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.getServerCache().isFiltered(),s=this.applyServerMerge_(e,l.path,l.children,r,i,a,c))}else if(n.type===ie.ACK_USER_WRITE){var h=n;s=h.revert?this.revertUserWrite_(e,h.path,r,i,c):this.ackUserWrite_(e,h.path,h.affectedTree,r,i,c)}else{if(n.type!==ie.LISTEN_COMPLETE)throw Object(o.h)("Unknown operation type: "+n.type);s=this.listenComplete_(e,n.path,r,c)}var f=c.getChanges();return t.maybeAddValueEvent_(e,s,f),new we(s,f)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ye.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var s=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,c=void 0;if(e.isEmpty())if(Object(o.g)(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),l=u instanceof Lt?u:Lt.EMPTY_NODE,h=n.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var f=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),f,i)}else{var p=e.getFront();if(".priority"===p){Object(o.g)(1===e.getLength(),"Can't have a priority with additional path components");var d=s.getNode();c=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,d,c);a=null!=m?this.filter_.updatePriority(d,m):s.getNode()}else{var y=e.popFront(),g=void 0;if(s.isCompleteForChild(p)){c=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,s.getNode(),c);g=null!=v?s.getNode().getImmediateChild(p).updateChild(y,v):s.getNode().getImmediateChild(p)}else g=n.calcCompleteChild(p,t.getServerCache());a=null!=g?this.filter_.updateChild(s.getNode(),p,g,y,r,i):s.getNode()}}return t.updateEventSnap(a,s.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,s){var a,c=t.getServerCache(),u=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=u.updateFullNode(c.getNode(),n,null);else if(u.filtersNodes()&&!c.isFiltered()){var l=c.getNode().updateChild(e,n);a=u.updateFullNode(c.getNode(),l,null)}else{var h=e.getFront();if(!c.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=c.getNode().getImmediateChild(h).updateChild(f,n);a=".priority"===h?u.updatePriority(c.getNode(),p):u.updateChild(c.getNode(),h,p,f,be,null)}var d=t.updateServerSnap(a,c.isFullyInitialized()||e.isEmpty(),u.filtersNodes()),m=new _e(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,m,s)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var s,a,c=t.getEventCache(),u=new _e(r,t,i);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var l=e.getFront();if(".priority"===l)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),s=t.updateEventSnap(a,c.isFullyInitialized(),c.isFiltered());else{var h=e.popFront(),f=c.getNode().getImmediateChild(l),p=void 0;if(h.isEmpty())p=n;else{var d=u.getCompleteChild(l);p=null!=d?".priority"===h.getBack()&&d.getChild(h.parent()).isEmpty()?d:d.updateChild(h,n):Lt.EMPTY_NODE}if(f.equals(p))s=t;else{var m=this.filter_.updateChild(c.getNode(),l,p,h,u,o);s=t.updateEventSnap(m,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,s){var a=this,c=e;return r.foreach((function(r,u){var l=n.child(r);t.cacheHasChild_(e,l.getFront())&&(c=a.applyUserOverwrite_(c,l,u,i,o,s))})),r.foreach((function(r,u){var l=n.child(r);t.cacheHasChild_(e,l.getFront())||(c=a.applyUserOverwrite_(c,l,u,i,o,s))})),c},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,s){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var c,u=t;c=e.isEmpty()?n:le.Empty.setTree(e,n);var l=t.getServerCache().getNode();return c.children.inorderTraversal((function(e,n){if(l.hasChild(e)){var c=t.getServerCache().getNode().getImmediateChild(e),h=a.applyMerge_(c,n);u=a.applyServerOverwrite_(u,new F(e),h,r,i,o,s)}})),c.children.inorderTraversal((function(e,n){var c=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!l.hasChild(e)&&!c){var h=t.getServerCache().getNode().getImmediateChild(e),f=a.applyMerge_(h,n);u=a.applyServerOverwrite_(u,new F(e),f,r,i,o,s)}})),u},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var s=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,s,o);if(e.isEmpty()){var c=le.Empty;return a.getNode().forEachChild(gt,(function(t,e){c=c.set(new F(t),e)})),this.applyServerMerge_(t,e,c,r,i,s,o)}return t}var u=le.Empty;return n.foreach((function(t,n){var r=e.child(t);a.isCompleteForPath(r)&&(u=u.set(t,a.getNode().getChild(r)))})),this.applyServerMerge_(t,e,u,r,i,s,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,be,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var s;if(null!=n.shadowingWrite(e))return t;var a=new _e(n,t,r),c=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var l=void 0;if(t.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();Object(o.g)(h instanceof Lt,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(h)}l=l,u=this.filter_.updateFullNode(c,l,i)}else{var f=e.getFront(),p=n.calcCompleteChild(f,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(f)&&(p=c.getImmediateChild(f)),(u=null!=p?this.filter_.updateChild(c,f,p,e.popFront(),a,i):t.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(c,f,Lt.EMPTY_NODE,e.popFront(),a,i):c).isEmpty()&&t.getServerCache().isFullyInitialized()&&(s=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,s,i))}return s=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(F.Empty),t.updateEventSnap(u,s,this.filter_.filtersNodes())},t}(),Oe=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===ye.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ye.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,ye.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ye.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ye.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ye.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ye.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,s=n.filter((function(t){return t.type===e}));s.sort(this.compareChanges_.bind(this)),s.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Object(o.h)("Should only compare child_ events.");var n=new dt(t.childName,t.snapshotNode),r=new dt(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),Ee=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new ge(n.getIndex()),i=n.getNodeFilter();this.processor_=new Se(i);var o=e.getServerCache(),s=e.getEventCache(),a=r.updateFullNode(Lt.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(Lt.EMPTY_NODE,s.getNode(),null),u=new de(a,o.isFullyInitialized(),r.filtersNodes()),l=new de(c,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new me(l,u),this.eventGenerator_=new Oe(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){Object(o.g)(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)}))}if(t){for(var i=[],s=0;s<this.eventRegistrations_.length;++s){var a=this.eventRegistrations_[s];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(s+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===ie.MERGE&&null!==t.source.queryId&&(Object(o.g)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(o.g)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),Object(o.g)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Ct,(function(t,e){n.push(ye.childAddedChange(t,e))}));return e.isFullyInitialized()&&n.push(ye.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),Te=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return Object(o.g)(ae,"Reference.ts has not been loaded"),ae},set:function(t){Object(o.g)(!ae,"__referenceConstructor has already been defined"),ae=t},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,n){var r,s,a=t.source.queryId;if(null!==a){var c=this.views.get(a);return Object(o.g)(null!=c,"SyncTree gave us an op for an invalid query."),c.applyOperation(t,e,n)}var u=[];try{for(var l=Object(i.h)(this.views.values()),h=l.next();!h.done;h=l.next()){c=h.value;u=u.concat(c.applyOperation(t,e,n))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}return u},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),s=this.views.get(o);if(!s){var a=n.calcCompleteEventCache(i?r:null),c=!1;a?c=!0:r instanceof Lt?(a=n.calcCompleteEventChildren(r),c=!1):(a=Lt.EMPTY_NODE,c=!1);var u=new me(new de(a,c,!1),new de(r,i,!1));s=new Ee(t,u),this.views.set(o,s)}return s.addEventRegistration(e),s.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var o,s,a=e.queryIdentifier(),c=[],u=[],l=this.hasCompleteView();if("default"===a)try{for(var h=Object(i.h)(this.views.entries()),f=h.next();!f.done;f=h.next()){var p=Object(i.e)(f.value,2),d=p[0],m=p[1];u=u.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(d),m.getQuery().getQueryParams().loadsAllData()||c.push(m.getQuery()))}}catch(t){o={error:t}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}else(m=this.views.get(a))&&(u=u.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(a),m.getQuery().getQueryParams().loadsAllData()||c.push(m.getQuery())));return l&&!this.hasCompleteView()&&c.push(new t.__referenceConstructor(e.repo,e.path)),{removed:c,events:u}},t.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=Object(i.h)(this.views.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.getQuery().getQueryParams().loadsAllData()||n.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var o=Object(i.h)(this.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;try{for(var n=Object(i.h)(this.views.values()),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t}(),Ce=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new le(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=F.relativePath(i,e);return o=o.updateChild(s,n),new t(this.writeTree_.set(i,o))}var a=new le(n);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this;return j(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,le.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(F.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ct,(function(e,n){t.push(new dt(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new dt(e,n.value))})),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new le(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,s){".priority"===n?(Object(o.g)(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=t(e.child(n),s,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(F.Empty,this.writeTree_,t)},t.Empty=new t(new le(null)),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ie=function(){function t(){this.visibleWrites_=Ce.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Ae(t,this)},t.prototype.addOverwrite=function(t,e,n,r){Object(o.g)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){Object(o.g)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));Object(o.g)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,s=!1,a=this.allWrites_.length-1;i&&a>=0;){var c=this.allWrites_[a];c.visible&&(a>=n&&this.recordContainsPath_(c,r.path)?i=!1:r.path.contains(c.path)&&(s=!0)),a--}if(i){if(s)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):j(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))}));return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(F.Empty)){var s=t.layerTree_(this.allWrites_,(function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e);u=n||Lt.EMPTY_NODE;return s.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var c=this.visibleWrites_.childCompoundWrite(e);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite(F.Empty)){var u=n||Lt.EMPTY_NODE;return c.apply(u)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Lt.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ct,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ct,(function(t,e){var r=i.childCompoundWrite(new F(t)).apply(e);n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){Object(o.g)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var s=this.visibleWrites_.childCompoundWrite(i);return s.isEmpty()?r.getChild(e):s.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(t),c=a.getCompleteNode(F.Empty);if(null!=c)s=c;else{if(null==e)return[];s=a.apply(e)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var u=[],l=o.getCompare(),h=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),f=h.getNext();f&&u.length<r;)0!==l(f,n)&&u.push(f),f=h.getNext();return u},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,F.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=Ce.Empty,i=0;i<t.length;++i){var s=t[i];if(e(s)){var a=s.path,c=void 0;if(s.snap)n.contains(a)?(c=F.relativePath(n,a),r=r.addWrite(c,s.snap)):a.contains(n)&&(c=F.relativePath(a,n),r=r.addWrite(F.Empty,s.snap.getChild(c)));else{if(!s.children)throw Object(o.h)("WriteRecord should have .snap or .children");if(n.contains(a))c=F.relativePath(n,a),r=r.addWrites(c,s.children);else if(a.contains(n))if((c=F.relativePath(a,n)).isEmpty())r=r.addWrites(F.Empty,s.children);else{var u=Object(o.G)(s.children,c.getFront());if(u){var l=u.getChild(c.popFront());r=r.addWrite(F.Empty,l)}}}}}return r},t}(),Ae=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),ke=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=le.Empty,this.pendingWriteTree_=new Ie,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new fe(ce.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=le.fromObject(e);return this.applyOperationToSyncPoints_(new pe(ce.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=le.Empty;return null!=n.snap?r=r.set(F.Empty,!0):j(n.children,(function(t,e){r=r.set(new F(t),e)})),this.applyOperationToSyncPoints_(new ue(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new fe(ce.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=le.fromObject(e);return this.applyOperationToSyncPoints_(new pe(ce.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new he(ce.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,c=F.relativePath(s,e),u=new fe(ce.forServerTaggedQuery(a),c,n);return this.applyTaggedOperation_(s,u)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,c=F.relativePath(s,e),u=le.fromObject(n),l=new pe(ce.forServerTaggedQuery(a),c,u);return this.applyTaggedOperation_(s,l)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,s=i.queryId,a=F.relativePath(o,e),c=new he(ce.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,c)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,s=!1;this.syncPointTree_.foreachOnPath(r,(function(t,e){var n=F.relativePath(t,r);i=i||e.getCompleteServerCache(n),s=s||e.hasCompleteView()}));var a,c=this.syncPointTree_.get(r);(c?(s=s||c.hasCompleteView(),i=i||c.getCompleteServerCache(F.Empty)):(c=new Te,this.syncPointTree_=this.syncPointTree_.set(r,c)),null!=i)?a=!0:(a=!1,i=Lt.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(t,e){var n=e.getCompleteServerCache(F.Empty);n&&(i=i.updateImmediateChild(t,n))})));var u=c.viewExistsForQuery(e);if(!u&&!e.getQueryParams().loadsAllData()){var l=t.makeQueryKey_(e);Object(o.g)(!this.queryToTagMap.has(l),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap.set(l,h),this.tagToQueryMap.set(h,l)}var f=this.pendingWriteTree_.childWrites(r),p=c.addEventRegistration(e,n,f,i,a);if(!u&&!s){var d=c.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===e.queryIdentifier()||s.viewExistsForQuery(e))){var c=s.removeEventRegistration(e,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var u=c.removed;a=c.events;var l=-1!==u.findIndex((function(t){return t.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(o,(function(t,e){return e.hasCompleteView()}));if(l&&!h){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var m=p[d],y=m.getQuery(),g=this.createListenerForView_(m);this.listenProvider_.startListening(t.queryForListening_(y),this.tagForQuery_(y),g.hashFn,g.onComplete)}}if(!h&&u.length>0&&!r)if(l){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else u.forEach((function(e){var n=i.queryToTagMap.get(t.makeQueryKey_(e));i.listenProvider_.stopListening(t.queryForListening_(e),n)}));this.removeTags_(u)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=F.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),j(n,(function(t,e){r=r.concat(e)})),r}))},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),s=this.createListenerForView_(n),a=this.listenProvider_.startListening(t.queryForListening_(e),i,s.hashFn,s.onComplete),c=this.syncPointTree_.subtree(r);if(i)Object(o.g)(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=c.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),j(n,(function(t,e){r=r.concat(e)})),r})),l=0;l<u.length;++l){var h=u[l];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return a},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Lt.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return Object(o.g)(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new F(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return this.queryToTagMap.get(n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);Object(o.g)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(F.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(F.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(F.Empty));var o=[],s=t.path.getFront(),a=t.operationForChild(s),c=e.children.get(s);if(c&&a){var u=n?n.getImmediateChild(s):null,l=r.child(s);o=o.concat(this.applyOperationHelper_(a,c,u,l))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(F.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(F.Empty));var s=[];return e.children.inorderTraversal((function(e,o){var a=n?n.getImmediateChild(e):null,c=r.child(e),u=t.operationForChild(e);u&&(s=s.concat(i.applyOperationDescendantsHelper_(u,o,a,c)))})),o&&(s=s.concat(o.applyOperation(t,r,n))),s},t.nextQueryTag_=1,t}(),xe=function(){function t(){this.rootNode_=Lt.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),Ne=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Object(o.k)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return Object(o.m)(this.counters_)},t}(),Pe=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ne),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),je=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Object(i.a)({},t);return this.last_&&j(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},t}(),Re=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new je(t);var n=1e4+2e4*Math.random();L(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;j(e,(function(e,i){i>0&&Object(o.k)(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),L(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Me=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new De(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),De=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();g&&_("event: "+e.toString()),$(n)}}},t.prototype.getPath=function(){return this.path_},t}(),$e=function(){function t(t){this.allowedEvents_=t,this.listeners_={},Object(o.g)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=Object(i.f)(this.listeners_[t]),o=0;o<r.length;o++)r[o].callback.apply(r[o].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){Object(o.g)(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},t}(),Le=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))}),!1),r}return Object(i.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(o.g)("visible"===t,"Unknown event type: "+t),[this.visible_]},e}($e),Fe=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(o.x)()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return Object(i.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(o.g)("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}($e),Be=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&$((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},t}(),Ue=function(){function t(t,e,n,r,i){this.connId=t,this.repoInfo=e,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=w(t),this.stats_=Pe.getCollection(e),this.urlFn=function(t){return e.connectionURL("long_polling",t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Be(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(Object(o.z)()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Ve((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(i.e)(t,5),o=r[0],s=r[1],a=r[2];r[3],r[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===o)n.id=s,n.password=a;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(i.e)(t,2),o=r[0],s=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(o,s)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!Object(o.z)()&&(!!t.forceAllow_||!(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Object(o.J)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Object(o.j)(e),r=P(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!Object(o.z)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=Object(o.J)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),Ve=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(o.z)())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=d(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))s='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(t){_("frame writing exception"),t.stack&&_(t.stack),_(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||_("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r()}))},t.prototype.addTag=function(t,e){var n=this;Object(o.z)()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){_("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},t}(),qe="";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var We=null;"undefined"!=typeof MozWebSocket?We=MozWebSocket:"undefined"!=typeof WebSocket&&(We=WebSocket);var ze=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=w(this.connId),this.stats_=Pe.getCollection(n),this.connURL=t.connectionURL_(n,i,o)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!Object(o.z)()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(Object(o.z)()){var r=o.a.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+qe+"/"+process.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}},s=process.env,a=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new We(this.connURL,[],i)}else{i={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new We(this.connURL,[],i)}}catch(t){this.log_("Error instantiating WebSocket.");var c=t.message||t.data;return c&&this.log_(c),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==We&&!t.forceDisallow_},t.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Object(o.D)(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(Object(o.g)(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=Object(o.J)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=P(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),He=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Ue,ze]},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,o=ze&&ze.isAvailable(),s=o&&!ze.previouslyFailed();if(e.webSocketOnly&&(o||E("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ze];else{var a=this.transports_=[];try{for(var c=Object(i.h)(t.ALL_TRANSPORTS),u=c.next();!u.done;u=c.next()){var l=u.value;l&&l.isAvailable()&&a.push(l)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Ke=function(){function t(t,e,n,r,i,o,s,a){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=w("c:"+this.id+":"),this.transportManager_=new He(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=L((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=x("t",t),n=x("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=x("t",t),n=x("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=x("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?S("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&E("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),L((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):L((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Ge=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Qe=function(t){function e(n,r,i,s,a,c,u){var l=t.call(this)||this;if(l.repoInfo_=n,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=s,l.onServerInfoUpdate_=a,l.authTokenProvider_=c,l.authOverride_=u,l.id=e.nextPersistentConnectionId_++,l.log_=w("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=1e3,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!Object(o.z)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Le.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&Fe.getInstance().on("online",l.onOnline_,l),l}return Object(i.c)(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Object(o.J)(i)),Object(o.g)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),s=t.path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),Object(o.g)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(o.g)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};t.tag&&(s.q=r.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,c=s.s;e.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",s),"ok"!==c&&n.removeListen_(i,o),t.onComplete&&t.onComplete(c,a))}))},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Object(o.k)(t,"w")){var n=Object(o.G)(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();E("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||Object(o.q)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=Object(o.C)(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(o.g)(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}}))}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Object(o.J)(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):S("Unrecognized action received from server: "+Object(o.J)(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;Object(o.g)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,s=this,a=this.lastSessionId,c=!1,u=null,l=function(){u?u.close():(c=!0,r())};this.realtime_={close:l,sendRequest:function(t){Object(o.g)(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then((function(e){c?_("getToken() completed but was canceled"):(_("getToken() completed. Creating connection."),s.authToken_=e&&e.accessToken,u=new Ke(i,s.repoInfo_,s.applicationId_,t,n,r,(function(t){E(t+" ("+s.repoInfo_.toString()+")"),s.interrupt("server_kill")}),a))})).then(null,(function(t){s.log_("Failed to get token: "+t),c||(o.a.NODE_ADMIN&&E(t),l())}))}},e.prototype.interrupt=function(t){_("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){_("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Object(o.u)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return N(t)})).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new F(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){_("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var o=Object(i.h)(this.listens.values()),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var c=(n=void 0,Object(i.h)(a.values())),u=c.next();!u.done;u=c.next()){var l=u.value;this.sendListen_(l)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";o.a.NODE_ADMIN?e="admin_node":o.a.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+qe.replace(/\./g,"-")]=1,Object(o.x)()?t["framework.cordova"]=1:Object(o.A)()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Fe.getInstance().currentlyOnline();return Object(o.u)(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Ge),Ye=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=w("p:rest:"),i.listens_={},i}return Object(i.c)(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Object(o.g)(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var s=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var c=e.getListenId_(t,r),u={};this.listens_[c]=u;var l=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",l,(function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&s.onDataUpdate_(a,n,!1,r),Object(o.G)(s.listens_,c)===u)&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var s=i&&i.accessToken;s&&(e.auth=s);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+Object(o.F)(e);r.log_("Sending REST request for "+a);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);var t=null;if(c.status>=200&&c.status<300){try{t=Object(o.D)(c.responseText)}catch(t){E("Failed to parse JSON response for "+a+": "+c.responseText)}n(null,t)}else 401!==c.status&&404!==c.status&&E("Got unsuccessful REST response for "+a+" Status: "+c.status),n(c.status);n=null}},c.open("GET",a,!0),c.send()}))},e}(Ge),Xe=function(){function t(t,e,n,r){var i=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Me,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new oe,this.persistentConnection_=null,this.stats_=Pe.getCollection(t),e||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Ye(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(o.J)(s)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Qe(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,s),this.server_=this.persistentConnection_}r.addTokenChangeListener((function(t){i.server_.refreshAuthToken(t)})),this.statsReporter_=Pe.getOrCreateReporter(t,(function(){return new Re(i.stats_,i.server_)})),this.transactionsInit_(),this.infoData_=new xe,this.infoSyncTree_=new ke({startListening:function(t,e,n,r){var o=[],s=i.infoData_.getNode(t.path);return s.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout((function(){r("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new ke({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,(function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o)})),[]},stopListening:function(t,e){i.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new F(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new F(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var s=[];if(r)if(n){var a=Object(o.E)(e,(function(t){return Bt(t)}));s=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var c=Bt(e);s=this.serverSyncTree_.applyTaggedQueryOverwrite(i,c,r)}else if(n){var u=Object(o.E)(e,(function(t){return Bt(t)}));s=this.serverSyncTree_.applyServerMerge(i,u)}else{var l=Bt(e);s=this.serverSyncTree_.applyServerOverwrite(i,l)}var h=i;s.length>0&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,s)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;j(t,(function(t,n){e.updateInfo_(t,n)}))},t.prototype.updateInfo_=function(t,e){var n=new F("/.info/"+t),r=Bt(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),s=Bt(e,n),a=this.serverSyncTree_.calcCompleteEventCache(t),c=ne(s,a,o),u=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(t,c,u,!0);this.eventQueue_.queueEvents(l),this.server_.put(t.toString(),s.val(!0),(function(e,n){var o="ok"===e;o||E("set at "+t+" failed: "+e);var s=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,s),i.callOnCompleteCallback(r,e,n)}));var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),s={};if(j(e,(function(e,n){i=!1,s[e]=ee(t.child(e),Bt(n),r.serverSyncTree_,o)})),i)_("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserMerge(t,s,a);this.eventQueue_.queueEvents(c),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e;o||E("update at "+t+" failed: "+e);var s=r.serverSyncTree_.ackUserWrite(a,!o),c=s.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(c,s),r.callOnCompleteCallback(n,e,i)})),j(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=new oe;this.onDisconnect_.forEachTree(F.Empty,(function(r,i){var o=ee(r,i,t.serverSyncTree_,e);n.remember(r,o)}));var r=[];n.forEachTree(F.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)})),this.onDisconnect_=new oe,this.eventQueue_.raiseEventsForChangedPath(F.Empty,r)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Bt(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Bt(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Object(o.u)(e))return _("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&j(e,(function(e,n){var i=Bt(n);r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new je(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);j(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)}))}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),_.apply(void 0,Object(i.f)([n],t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&$((function(){if("ok"===e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}}))},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new ln(this))},enumerable:!1,configurable:!0}),t}(),Je=function(){function t(e){this.indexedFilter_=new ge(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new dt(e,n))||(n=Lt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Lt.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Lt.EMPTY_NODE);var i=this;return e.forEachChild(Ct,(function(t,e){i.matches(new dt(t,e))||(r=r.updateImmediateChild(t,Lt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),Ze=function(){function t(t){this.rangedFilter_=new Je(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new dt(e,n))||(n=Lt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Lt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Lt.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Lt.EMPTY_NODE);var a=void 0,c=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();u=function(t,e){return l(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();){s=i.getNext();!h&&u(a,s)<=0&&(h=!0),h&&o<this.limit_&&u(s,c)<=0?o++:r=r.updateImmediateChild(s.name,Lt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(t,e){return a(e,t)}}else s=this.index_.getCompare();var c=t;Object(o.g)(c.numChildren()===this.limit_,"");var u=new dt(e,n),l=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(c.hasChild(e)){for(var f=c.getImmediateChild(e),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===e||c.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:s(p,u);if(h&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(ye.childChangedChange(e,n,f)),c.updateImmediateChild(e,n);null!=i&&i.trackChildChange(ye.childRemovedChange(e,f));var m=c.updateImmediateChild(e,Lt.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(ye.childAddedChange(p.name,p.node)),m.updateImmediateChild(p.name,p.node)):m}return n.isEmpty()?t:h&&s(l,u)>=0?(null!=i&&(i.trackChildChange(ye.childRemovedChange(l.name,l.node)),i.trackChildChange(ye.childAddedChange(e,n))),c.updateImmediateChild(e,n).updateImmediateChild(l.name,Lt.EMPTY_NODE)):t},t}(),tn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ct}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return Object(o.g)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return Object(o.g)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:C},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return Object(o.g)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return Object(o.g)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:I},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return Object(o.g)(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==Ct&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ct},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new ge(this.getIndex()):this.hasLimit()?new Ze(this):new Je(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(this.index_===Ct?e=n.PRIORITY_INDEX:this.index_===Vt?e=n.VALUE_INDEX:this.index_===gt?e=n.KEY_INDEX:(Object(o.g)(this.index_ instanceof qt,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=Object(o.J)(e),this.startSet_&&(r[n.START_AT]=Object(o.J)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(o.J)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(o.J)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(o.J)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),en=function(t){function e(e,n){if(!(e instanceof Xe))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,tn.DEFAULT,!1)||this}return Object(i.c)(e,t),e.prototype.getKey=function(){return Object(o.K)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return Object(o.K)("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof F||(null===this.path.getFront()?at("Reference.child",1,t,!1):st("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){Object(o.K)("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){Object(o.K)("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){Object(o.K)("Reference.set",1,2,arguments.length),ct("Reference.set",this.path),tt("Reference.set",1,t,this.path,!1),Object(o.L)("Reference.set",2,e,!0);var n=new o.b;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(Object(o.K)("Reference.update",1,2,arguments.length),ct("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,E("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}nt("Reference.update",1,t,this.path,!1),Object(o.L)("Reference.update",2,e,!0);var i=new o.b;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(Object(o.K)("Reference.setWithPriority",2,3,arguments.length),ct("Reference.setWithPriority",this.path),tt("Reference.setWithPriority",1,t,this.path,!1),rt("Reference.setWithPriority",2,e,!1),Object(o.L)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new o.b;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return Object(o.K)("Reference.remove",0,1,arguments.length),ct("Reference.remove",this.path),Object(o.L)("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(Object(o.K)("Reference.transaction",1,3,arguments.length),ct("Reference.transaction",this.path),Object(o.L)("Reference.transaction",1,t,!1),Object(o.L)("Reference.transaction",2,e,!0),lt("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new o.b;"function"==typeof e&&r.promise.catch((function(){}));var i=function(t,n,i){t?r.reject(t):r.resolve(new ft(n,i)),"function"==typeof e&&e(t,n,i)};return this.repo.startTransaction(this.path,t,i,n),r.promise},e.prototype.setPriority=function(t,e){Object(o.K)("Reference.setPriority",1,2,arguments.length),ct("Reference.setPriority",this.path),rt("Reference.setPriority",1,t,!1),Object(o.L)("Reference.setPriority",2,e,!0);var n=new o.b;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){Object(o.K)("Reference.push",0,2,arguments.length),ct("Reference.push",this.path),tt("Reference.push",1,t,this.path,!0),Object(o.L)("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=pt(r),s=this.child(i),a=this.child(i);return n=null!=t?s.set(t,e).then((function(){return a})):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),s},e.prototype.onDisconnect=function(){return ct("Reference.onDisconnect",this.path),new ht(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Qt);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qt.__referenceConstructor=en,Te.__referenceConstructor=en;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var nn,rn=function(){this.children={},this.childCount=0,this.value=null},on=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new rn),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n=e instanceof F?e:new F(e),r=this,i=n.getFront();null!==i;){r=new t(i,r,Object(o.G)(r.node_.children,i)||new rn),i=(n=n.popFront()).getFront()}return r},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){Object(o.g)(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;j(this.node_.children,(function(r,i){e(new t(r,n,i))}))},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},t.prototype.path=function(){return new F(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Object(o.k)(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(nn||(nn={})),Xe.MAX_TRANSACTION_RETRIES_=25,Xe.prototype.transactionsInit_=function(){this.transactionQueueTree_=new on},Xe.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},s=new en(this,t);s.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:d(),applyLocally:r,retryCount:0,unwatcher:function(){s.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=this.getLatestState_(t);a.currentInputSnapshot=c;var u=a.update(c.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var l=new Wt(a.currentInputSnapshot,new en(this,a.path),Ct);a.onComplete(null,!1,l)}}else{et("transaction failed: Data returned ",u,a.path),a.status=nn.RUN;var h=this.transactionQueueTree_.subTree(t),f=h.getValue()||[];f.push(a),h.setValue(f);var p=void 0;if("object"==typeof u&&null!==u&&Object(o.k)(u,".priority"))p=Object(o.G)(u,".priority"),Object(o.g)(Z(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(t)||Lt.EMPTY_NODE).getPriority().val();p=p;var m=this.generateServerValues(),y=Bt(u,p),g=ne(y,c,m);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=g,a.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,g,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},Xe.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Lt.EMPTY_NODE},Xe.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);Object(o.g)(n.length>0,"Sending zero length transaction queue"),n.every((function(t){return t.status===nn.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},Xe.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),s=i,a=i.hash(),c=0;c<e.length;c++){var u=e[c];Object(o.g)(u.status===nn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=nn.SENT,u.retryCount++;var l=F.relativePath(t,u.path);s=s.updateChild(l,u.currentOutputSnapshotRaw)}var h=s.val(!0),f=t;this.server_.put(f.toString(),h,(function(r){n.log_("transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<e.length;s++){if(e[s].status=nn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,c=new en(n,e[s].path),u=new Wt(a,c,Ct);o.push(e[s].onComplete.bind(null,null,!0,u))}e[s].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(s=0;s<o.length;s++)$(o[s])}else{if("datastale"===r)for(s=0;s<e.length;s++)e[s].status===nn.SENT_NEEDS_ABORT?e[s].status=nn.NEEDS_ABORT:e[s].status=nn.RUN;else{E("transaction at "+f.toString()+" failed: "+r);for(s=0;s<e.length;s++)e[s].status=nn.NEEDS_ABORT,e[s].abortReason=r}n.rerunTransactions_(t)}}),a)},Xe.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Xe.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],s=t.filter((function(t){return t.status===nn.RUN})).map((function(t){return t.currentWriteId})),a=0;a<t.length;a++){var c=t[a],u=F.relativePath(e,c.path),l=!1,h=void 0;if(Object(o.g)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===nn.NEEDS_ABORT)l=!0,h=c.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else if(c.status===nn.RUN)if(c.retryCount>=Xe.MAX_TRANSACTION_RETRIES_)l=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else{var f=this.getLatestState_(c.path,s);c.currentInputSnapshot=f;var p=t[a].update(f.val());if(void 0!==p){et("transaction failed: Data returned ",p,c.path);var d=Bt(p);"object"==typeof p&&null!=p&&Object(o.k)(p,".priority")||(d=d.updatePriority(f.getPriority()));var m=c.currentWriteId,y=this.generateServerValues(),g=ne(d,f,y);c.currentOutputSnapshotRaw=d,c.currentOutputSnapshotResolved=g,c.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(m),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(c.path,g,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(m,!0))}else l=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],l&&(t[a].status=nn.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new en(this,t[a].path),b=t[a].currentInputSnapshot,_=new Wt(b,v,Ct);r.push(t[a].onComplete.bind(null,null,!1,_))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)$(r[a]);this.sendReadyTransactions_()}},Xe.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},Xe.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},Xe.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},Xe.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==nn.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},Xe.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},Xe.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,s=0;s<e.length;s++)if(e[s].status===nn.SENT_NEEDS_ABORT);else if(e[s].status===nn.SENT)Object(o.g)(i===s-1,"All SENT items should be at beginning of queue."),i=s,e[s].status=nn.SENT_NEEDS_ABORT,e[s].abortReason="set";else if(Object(o.g)(e[s].status===nn.RUN,"Unexpected transaction status in abort"),e[s].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[s].currentWriteId,!0)),e[s].onComplete){n.push(e[s].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(s=0;s<n.length;s++)$(n[s])}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var sn,an=function(){function t(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(_("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',E(t)},t}(),cn=function(){function t(){}return t.prototype.getToken=function(e){return Promise.resolve({accessToken:t.EMULATOR_AUTH_TOKEN})},t.prototype.addTokenChangeListener=function(e){e(t.EMULATOR_AUTH_TOKEN)},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.EMULATOR_AUTH_TOKEN="owner",t}(),un=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return sn||(sn=new t),sn},t.prototype.interrupt=function(){var t,e,n,r;try{for(var o=Object(i.h)(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var c=(n=void 0,Object(i.h)(Object.keys(this.repos_[a]))),u=c.next();!u.done;u=c.next()){var l=u.value;this.repos_[a][l].interrupt()}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.resume=function(){var t,e,n,r;try{for(var o=Object(i.h)(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var c=(n=void 0,Object(i.h)(Object.keys(this.repos_[a]))),u=c.next();!u.done;u=c.next()){var l=u.value;this.repos_[a][l].resume()}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.databaseFromApp=function(t,e,n){var r=n||t.options.databaseURL;void 0===r&&O("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var i,s=K(r),a=s.repoInfo,c=void 0;"undefined"!=typeof process&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(i=!0,r="http://"+c+"?ns="+a.namespace,a=(s=K(r)).repoInfo):i=!s.repoInfo.secure;var u=o.a.NODE_ADMIN&&i?new cn:new an(t,e);return ut("Invalid Firebase Database URL",1,s),s.path.isEmpty()||O("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(a,t,u).database},t.prototype.deleteRepo=function(t){var e=Object(o.G)(this.repos_,t.app.name);e&&Object(o.G)(e,t.repoInfo_.toURLString())===t||O("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e,n){var r=Object(o.G)(this.repos_,e.name);r||(r={},this.repos_[e.name]=r);var i=Object(o.G)(r,t.toURLString());return i&&O("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Xe(t,this.useRestClient_,e,n),r[t.toURLString()]=i,i},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),ln=function(){function t(t){this.repo_=t,t instanceof Xe||O("Don't call new Database() directly - please use firebase.database()."),this.root_=new en(t,F.Empty),this.INTERNAL=new hn(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Object(o.K)("database.ref",0,1,arguments.length),t instanceof en?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Object(o.K)(e,1,1,arguments.length);var n=K(t);ut(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&O(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&O("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Object(o.K)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Object(o.K)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(t){return{".sv":{increment:t}}}},t}(),hn=function(){function t(t){this.database=t}return t.prototype.delete=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.database.checkDeleted_("delete"),un.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},t}(),fn=Object.freeze({__proto__:null,forceLongPolling:function(){ze.forceDisallow(),Ue.forceAllow()},forceWebSockets:function(){Ue.forceDisallow()},isWebSocketsAvailable:function(){return ze.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),pn=Qe;Qe.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Qe.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var dn=Ke,mn=U,yn=Object.freeze({__proto__:null,DataConnection:pn,RealTimeConnection:dn,hijackHash:function(t){var e=Qe.prototype.put;return Qe.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Qe.prototype.put=e}},ConnectionTarget:mn,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){un.getInstance().forceRestClient(t)}}),gn=ln.ServerValue;!function(e){!function(t){qe=t}(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new a.a("database",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return un.getInstance().databaseFromApp(n,r,e)}),"PUBLIC").setServiceProps({Reference:en,Query:Qt,Database:ln,DataSnapshot:Wt,enableLogging:b,INTERNAL:fn,ServerValue:gn,TEST_ACCESS:yn}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.6.9"),Object(o.z)()&&(t.exports=n)}(r.a)}).call(this,n(529)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,n){"use strict";n.r(e);var r=n(18);n.d(e,"default",(function(){return r.a}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.a.registerVersion("firebase","7.17.1","app")},function(t,e,n){"use strict";n.r(e);n(495)},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r.a}));var r=n(18),i=(n(495),n(528),n(1)),o=n(44),s=n(2);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function a(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var c,u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=l||{},h=u||self;function f(){}function p(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function d(t){var e=p(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var y="closure_uid_"+(1e9*Math.random()>>>0),g=0;function v(t,e,n){return t.call.apply(t.bind,arguments)}function b(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:b).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function O(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function E(){this.j=this.j,this.i=this.i}E.prototype.j=!1,E.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))(function(t){Object.prototype.hasOwnProperty.call(t,y)&&t[y]||(t[y]=++g)})(this)},E.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var T=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},C=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function I(t){return Array.prototype.concat.apply([],arguments)}function A(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function k(t){return/^[\s\xa0]*$/.test(t)}var x,N=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function P(t,e){return-1!=t.indexOf(e)}function j(t,e){return t<e?-1:t>e?1:0}t:{var R=h.navigator;if(R){var M=R.userAgent;if(M){x=M;break t}}x=""}function D(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e={};for(var n in t)e[n]=t[n];return e}var L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<L.length;o++)n=L[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function B(t){return B[" "](t),t}B[" "]=f;var U,V,q=P(x,"Opera"),W=P(x,"Trident")||P(x,"MSIE"),z=P(x,"Edge"),H=z||W,K=P(x,"Gecko")&&!(P(x.toLowerCase(),"webkit")&&!P(x,"Edge"))&&!(P(x,"Trident")||P(x,"MSIE"))&&!P(x,"Edge"),G=P(x.toLowerCase(),"webkit")&&!P(x,"Edge");function Q(){var t=h.document;return t?t.documentMode:void 0}t:{var Y="",X=(V=x,K?/rv:([^\);]+)(\)|;)/.exec(V):z?/Edge\/([\d\.]+)/.exec(V):W?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(V):G?/WebKit\/(\S+)/.exec(V):q?/(?:Version)[ \/]?(\S+)/.exec(V):void 0);if(X&&(Y=X?X[1]:""),W){var J=Q();if(null!=J&&J>parseFloat(Y)){U=String(J);break t}}U=Y}var Z,tt={};function et(t){return function(t,e){var n=tt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=N(String(U)).split("."),r=N(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=j(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||j(0==s[2].length,0==a[2].length)||j(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(h.document&&W){var nt=Q();Z=nt||(parseInt(U,10)||void 0)}else Z=void 0;var rt=Z,it=!W||9<=Number(rt),ot=W&&!et("9"),st=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",f,e),h.removeEventListener("test",f,e)}catch(t){}return t}();function at(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function ct(t,e){if(at.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(K){t:{try{B(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ut[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}at.prototype.b=function(){this.defaultPrevented=!0},O(ct,at);var ut={2:"touch",3:"pen",4:"mouse"};ct.prototype.b=function(){ct.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ot)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var lt="closure_listenable_"+(1e6*Math.random()|0),ht=0;function ft(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++ht,this.V=this.X=!1}function pt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function dt(t){this.src=t,this.a={},this.b=0}function mt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=T(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(pt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function yt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=yt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new ft(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var gt="closure_lm_"+(1e6*Math.random()|0),vt={};function bt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=It(r),e&&e[lt]?e.sa(n,r,m(i)?!!i.capture:!!i,o):_t(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);return null}return n=It(n),t&&t[lt]?t.ra(e,n,m(r)?!!r.capture:!!r,i):_t(t,e,n,!1,r,i)}function _t(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=m(i)?!!i.capture:!!i;if(s&&!it)return null;var a=Tt(t);if(a||(t[gt]=a=new dt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Et,e=it?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)st||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(St(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function wt(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[lt])mt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(St(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Tt(e))?(mt(n,t),0==n.b&&(n.src=null,e[gt]=null)):pt(t)}}}function St(t){return t in vt?vt[t]:vt[t]="on"+t}function Ot(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&wt(t),n.call(r,e)}function Et(t,e){if(t.V)return!0;if(!it){if(!e)t:{e=["window","event"];for(var n=h,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ot(t,e=new ct(e,this))}return Ot(t,new ct(e,this))}function Tt(t){return(t=t[gt])instanceof dt?t:null}var Ct="__closure_events_fn_"+(1e9*Math.random()>>>0);function It(t){return"function"==p(t)?t:(t[Ct]||(t[Ct]=function(e){return t.handleEvent(e)}),t[Ct])}function At(){E.call(this),this.c=new dt(this),this.J=this,this.A=null}function kt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var a=s.listener,c=s.aa||s.src;s.X&&mt(t.c,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}O(At,E),At.prototype[lt]=!0,(c=At.prototype).addEventListener=function(t,e,n,r){bt(this,t,e,n,r)},c.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=m(i)?!!i.capture:!!i,r=It(r),e&&e[lt]?(e=e.c,(n=String(n).toString())in e.a&&(-1<(r=yt(s=e.a[n],r,i,o))&&(pt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--)))):e&&(e=Tt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=yt(n,r,i,o)),(r=-1<e?n[e]:null)&&wt(r))}(this,t,e,n,r)},c.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new at(t,n);else if(t instanceof at)t.target=t.target||n;else{var i=t;F(t=new at(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=kt(s,r,!0,t)&&i}if(i=kt(s=t.a=n,r,!0,t)&&i,i=kt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=kt(s=t.a=e[o],r,!1,t)&&i;return i},c.C=function(){if(At.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)pt(n[r]);delete e.a[t],e.b--}}this.A=null},c.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},c.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var xt=h.JSON.stringify;function Nt(){this.b=this.a=null}var Pt,jt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Mt}),(function(t){t.reset()}),100);function Rt(){var t=Ft,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Mt(){this.next=this.b=this.a=null}function Dt(t){h.setTimeout((function(){throw t}),0)}function $t(t,e){Pt||function(){var t=h.Promise.resolve(void 0);Pt=function(){t.then(Bt)}}(),Lt||(Pt(),Lt=!0),Ft.add(t,e)}Nt.prototype.add=function(t,e){var n=jt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Mt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Mt.prototype.reset=function(){this.next=this.b=this.a=null};var Lt=!1,Ft=new Nt;function Bt(){for(var t;t=Rt();){try{t.a.call(t.b)}catch(t){Dt(t)}var e=jt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Lt=!1}function Ut(t,e){At.call(this),this.b=t||1,this.a=e||h,this.f=_(this.Ua,this),this.g=S()}function Vt(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function qt(t,e,n){if("function"==p(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function Wt(t,e,n){E.call(this),this.f=null!=n?_(t,n):t,this.c=e,this.b=_(this.Pa,this),this.a=[]}function zt(t){t.T=qt(t.b,t.c),t.f.apply(null,t.a)}function Ht(t){E.call(this),this.b=t,this.a={}}O(Ut,At),(c=Ut.prototype).Z=!1,c.L=null,c.Ua=function(){if(this.Z){var t=S()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(Vt(this),this.start()))}},c.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=S())},c.C=function(){Ut.M.C.call(this),Vt(this),delete this.a},O(Wt,E),(c=Wt.prototype).ba=!1,c.T=null,c.Ia=function(t){this.a=arguments,this.T?this.ba=!0:zt(this)},c.C=function(){Wt.M.C.call(this),this.T&&(h.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},c.Pa=function(){this.T=null,this.ba&&(this.ba=!1,zt(this))},O(Ht,E);var Kt=[];function Gt(t,e,n,r){Array.isArray(n)||(n&&(Kt[0]=n.toString()),n=Kt);for(var i=0;i<n.length;i++){var o=bt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Qt(t){D(t.a,(function(t,e){this.a.hasOwnProperty(e)&&wt(t)}),t),t.a={}}function Yt(){}Ht.prototype.C=function(){Ht.M.C.call(this),Qt(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xt=null;function Jt(){return Xt=Xt||new At}function Zt(t){at.call(this,"serverreachability",t)}function te(t){var e=Jt();e.dispatchEvent(new Zt(e,t))}function ee(t){at.call(this,"statevent",t)}function ne(t){var e=Jt();e.dispatchEvent(new ee(e,t))}function re(t){at.call(this,"timingevent",t)}function ie(t,e){if("function"!=p(t))throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){t()}),e)}O(Zt,at),O(ee,at),O(re,at);var oe={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},se={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function ae(){}function ce(t){var e;return(e=t.a)||(e=t.a={}),e}function ue(){}ae.prototype.a=null;var le,he={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function fe(){at.call(this,"d")}function pe(){at.call(this,"c")}function de(){}function me(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new Ht(this),this.N=ye,t=H?125:void 0,this.O=new Ut(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}O(fe,at),O(pe,at),O(de,ae),le=new de;var ye=45e3,ge={},ve={};function be(t,e,n){t.B=1,t.f=Ue(Me(e)),t.j=n,t.F=!0,_e(t,null)}function _e(t,e){t.s=S(),Oe(t),t.A=Me(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),tn(n.b,"t",r),t.w=0,t.a=Hn(t.g,t.g.w?e:null),0<t.J&&(t.D=new Wt(_(t.ya,t,t.a),t.J)),Gt(t.G,t.a,"readystatechange",t.Sa),e=t.m?$(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),te(1)}function we(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=Se(t,n);if(i==ve){4==e&&(t.c=4,ne(14),r=!1);break}if(i==ge){t.c=4,ne(15),r=!1;break}Ae(t,i)}4==e&&0==n.length&&(t.c=1,ne(16),r=!1),t.b=t.b&&r,r||(Ie(t),Ce(t))}function Se(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?ve:(n=Number(e.substring(n,r)),isNaN(n)?ge:(r+=1)+n>e.length?ve:(e=e.substr(r,n),t.w=r+n,e))}function Oe(t){t.P=S()+t.N,Ee(t,t.N)}function Ee(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=ie(_(t.Qa,t),e)}function Te(t){t.h&&(h.clearTimeout(t.h),t.h=null)}function Ce(t){0==t.g.u||t.l||Un(t.g,t)}function Ie(t){Te(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,Vt(t.O),Qt(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Ae(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||cn(n.b,t)))if(n.A=t.H,!t.o&&cn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;Bn(n),n.a.cancel(),n.a=null}Fn(n),ne(18)}}else n.ia=i[1],0<n.ia-n.G&&37500>i[2]&&n.U&&0==n.m&&!n.l&&(n.l=ie(_(n.Na,n),6e3));if(1>=an(n.b)&&n.O){try{n.O()}catch(t){}n.O=void 0}}else qn(n,11)}else if((t.o||n.a==t)&&Bn(n),!k(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var a=n,c=t.a;if(c){var u=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(u){var l=a.b;!l.a&&(P(u,"spdy")||P(u,"quic")||P(u,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(un(l,l.b),l.b=null))}if(a.s){var h=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;h&&(a.ha=h,Be(a.v,a.s,h))}}n.u=3,n.c&&n.c.na();var f=t;if((a=n).ea=zn(a,a.w?a.R:null,a.P),f.o){ln(a.b,f);var p=f,d=a.D;d&&p.setTimeout(d),p.h&&(Te(p),Oe(p)),a.a=f}else Ln(a);0<n.f.length&&Rn(n)}else"stop"!=i[0]&&"close"!=i[0]||qn(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?qn(n,7):Nn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);te(4)}catch(t){}}function ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)C(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(d(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function xe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof xe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ne(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Pe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Pe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Pe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(c=me.prototype).setTimeout=function(t){this.N=t},c.Sa=function(t){t=t.target;var e=this.D;e&&3==In(t)?e.Ia():this.ya(t)},c.ya=function(t){try{if(t==this.a)t:{var e=In(this.a),n=this.a.qa(),r=this.a.S();if(!(3>e||3==e&&!H&&!this.a.Y())){this.l||4!=e||7==n||te(8==n||0>=r?3:2),Te(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(s)){var c=s;break e}}c=null}if(!c){this.b=!1,this.c=3,ne(12),Ie(this),Ce(this);break t}this.o=!0,Ae(this,c)}this.F?(we(this,e,o),H&&this.b&&3==e&&(Gt(this.G,this.O,"tick",this.Ra),this.O.start())):Ae(this,o),4==e&&Ie(this),this.b&&!this.l&&(4==e?Un(this.g,this):(this.b=!1,Oe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ne(12)):(this.c=0,ne(13)),Ie(this),Ce(this)}}}catch(t){}},c.Ra=function(){if(this.a){var t=In(this.a),e=this.a.Y();this.w<e.length&&(Te(this),we(this,t,e),this.b&&4!=t&&Oe(this))}},c.cancel=function(){this.l=!0,Ie(this)},c.Qa=function(){this.h=null;var t=S();0<=t-this.P?(2!=this.B&&(te(3),ne(17)),Ie(this),this.c=2,Ce(this)):Ee(this,this.P-t)},(c=xe.prototype).I=function(){Ne(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},c.K=function(){return Ne(this),this.a.concat()},c.get=function(t,e){return Pe(this.b,t)?this.b[t]:e},c.set=function(t,e){Pe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},c.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Re(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Re){this.a=void 0!==e?e:t.a,De(this,t.f),this.j=t.j,$e(this,t.c),Le(this,t.h),this.g=t.g,e=t.b;var n=new Ye;n.c=e.c,e.a&&(n.a=new xe(e.a),n.b=e.b),Fe(this,n),this.i=t.i}else t&&(n=String(t).match(je))?(this.a=!!e,De(this,n[1]||"",!0),this.j=Ve(n[2]||""),$e(this,n[3]||"",!0),Le(this,n[4]),this.g=Ve(n[5]||"",!0),Fe(this,n[6]||"",!0),this.i=Ve(n[7]||"")):(this.a=!!e,this.b=new Ye(null,this.a))}function Me(t){return new Re(t)}function De(t,e,n){t.f=n?Ve(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?Ve(e,!0):e}function Le(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Fe(t,e,n){e instanceof Ye?(t.b=e,function(t,e){e&&!t.f&&(Xe(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Je(this,e),tn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=qe(e,Ge)),t.b=new Ye(e,t.a))}function Be(t,e,n){t.b.set(e,n)}function Ue(t){return Be(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^S()).toString(36)),t}function Ve(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,We),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function We(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Re.prototype.toString=function(){var t=[],e=this.f;e&&t.push(qe(e,ze,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(qe(e,ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(qe(n,"/"==n.charAt(0)?Ke:He,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",qe(n,Qe)),t.join("")};var ze=/[#\/\?@]/g,He=/[#\?:]/g,Ke=/[#\?]/g,Ge=/[#\?@]/g,Qe=/#/g;function Ye(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Xe(t){t.a||(t.a=new xe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Je(t,e){Xe(t),e=en(t,e),Pe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Pe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ne(t)))}function Ze(t,e){return Xe(t),e=en(t,e),Pe(t.a.b,e)}function tn(t,e,n){Je(t,e),0<n.length&&(t.c=null,t.a.set(en(t,e),A(n)),t.b+=n.length)}function en(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function nn(t,e){this.b=t,this.a=e}function rn(t){this.g=t||on,h.PerformanceNavigationTiming?t=0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(h.ca&&h.ca.ua&&h.ca.ua()&&h.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(c=Ye.prototype).add=function(t,e){Xe(this),this.c=null,t=en(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},c.forEach=function(t,e){Xe(this),this.a.forEach((function(n,r){C(n,(function(n){t.call(e,n,r,this)}),this)}),this)},c.K=function(){Xe(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},c.I=function(t){Xe(this);var e=[];if("string"==typeof t)Ze(this,t)&&(e=I(e,this.a.get(en(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=I(e,t[n])}return e},c.set=function(t,e){return Xe(this),this.c=null,Ze(this,t=en(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},c.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},c.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var on=10;function sn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function an(t){return t.b?1:t.a?t.a.size:0}function cn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function un(t,e){t.a?t.a.add(e):t.b=e}function ln(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function hn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=a(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return A(t.c)}function fn(){}function pn(){this.a=new fn}function dn(t,e,n){var r=n||"";try{ke(t,(function(t,n){var i=t;m(t)&&(i=xt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function mn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}rn.prototype.cancel=function(){var t,e;if(this.c=hn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=a(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},fn.prototype.stringify=function(t){return h.JSON.stringify(t,void 0)},fn.prototype.parse=function(t){return h.JSON.parse(t,void 0)};var yn=h.JSON.parse;function gn(t){At.call(this),this.headers=new xe,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=vn,this.B=this.F=!1}O(gn,At);var vn="",bn=/^https?$/i,_n=["POST","PUT"];function wn(t){return"content-type"==t.toLowerCase()}function Sn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,On(t),Tn(t)}function On(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function En(t){if(t.b&&void 0!==l&&(!t.s[1]||4!=In(t)||2!=t.S()))if(t.l&&4==In(t))qt(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==In(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(je)[1]||null;if(!o&&h.self&&h.self.location){var s=h.self.location.protocol;o=s.substr(0,s.length-1)}i=!bn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<In(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.S()+"]",On(t)}}finally{Tn(t)}}}function Tn(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?f:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Cn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(h.clearTimeout(t.m),t.m=null)}function In(t){return t.a?t.a.readyState:0}function An(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return D(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Be(t,e,n))}function kn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function xn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=kn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=kn("baseRetryDelayMs",5e3,t),this.Ga=kn("retryDelaySeedMs",1e4,t),this.Da=kn("forwardChannelMaxRetries",2,t),this.ga=kn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new rn(t&&t.concurrentRequestLimit),this.ja=new pn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Nn(t){if(Pn(t),3==t.u){var e=t.H++,n=Me(t.v);Be(n,"SID",t.B),Be(n,"RID",e),Be(n,"TYPE","terminate"),Dn(t,n),(e=new me(t,e,void 0)).B=2,e.f=Ue(Me(n)),n=!1,h.navigator&&h.navigator.sendBeacon&&(n=h.navigator.sendBeacon(e.f.toString(),"")),!n&&h.Image&&((new Image).src=e.f,n=!0),n||(e.a=Hn(e.g,null),e.a.$(e.f)),e.s=S(),Oe(e)}Wn(t)}function Pn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(h.clearTimeout(t.i),t.i=null),Bn(t),t.b.cancel(),t.g&&("number"==typeof t.g&&h.clearTimeout(t.g),t.g=null)}function jn(t,e){t.f.push(new nn(t.Fa++,e)),3==t.u&&Rn(t)}function Rn(t){sn(t.b)||t.g||(t.g=!0,$t(t.xa,t),t.o=0)}function Mn(t,e){var n;n=e?e.W:t.H++;var r=Me(t.v);Be(r,"SID",t.B),Be(r,"RID",n),Be(r,"AID",t.G),Dn(t,r),t.h&&t.j&&An(r,t.h,t.j),n=new me(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),un(t.b,n),be(n,r,e)}function Dn(t,e){t.c&&ke({},(function(t,n){Be(e,n,t)}))}function $n(t,e,n){n=Math.min(t.f.length,n);var r=t.c?_(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,c=0;c<n;c++){var u=i[c].b,l=i[c].a;if(0>(u-=o))o=Math.max(0,i[c].b-100),a=!1;else try{dn(l,s,"req"+u+"_")}catch(t){r&&r(l)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Ln(t){t.a||t.i||(t.J=1,$t(t.wa,t),t.m=0)}function Fn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=ie(_(t.wa,t),Vn(t,t.m)),t.m++,!0)}function Bn(t){null!=t.l&&(h.clearTimeout(t.l),t.l=null)}function Un(t,e){var n=null;if(t.a==e){Bn(t),t.a=null;var r=2}else{if(!cn(t.b,e))return;n=e.i,ln(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=S()-e.s;var i=t.o;(r=Jt()).dispatchEvent(new re(r,n,e,i)),Rn(t)}else Ln(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){return!(an(t.b)>=t.b.f-(t.g?1:0))&&(t.g?(t.f=e.i.concat(t.f),!0):!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da))&&(t.g=ie(_(t.xa,t,e),Vn(t,t.o)),t.o++,!0))}(t,e)||2==r&&Fn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:qn(t,5);break;case 4:qn(t,10);break;case 3:qn(t,6);break;default:qn(t,2)}}function Vn(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function qn(t,e){if(2==e){var n=null;t.c&&(n=null);var r=_(t.Ta,t);n||(n=new Re("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||De(n,"https"),Ue(n)),function(t,e){var n=new Yt;if(h.Image){var r=new Image;r.onload=w(mn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(mn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(mn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(mn,n,r,"TestLoadImage: timeout",!1,e),h.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ne(2);t.u=0,t.c&&t.c.la(e),Wn(t),Pn(t)}function Wn(t){t.u=0,t.A=-1,t.c&&(0==hn(t.b).length&&0==t.f.length||(t.b.c.length=0,A(t.f),t.f.length=0),t.c.ka())}function zn(t,e,n){var r=function(t){return t instanceof Re?Me(t):new Re(t,void 0)}(n);if(""!=r.c)e&&$e(r,e+"."+r.c),Le(r,r.h);else{var i=h.location;r=function(t,e,n,r){var i=new Re(null,void 0);return t&&De(i,t),e&&$e(i,e),n&&Le(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.N&&D(t.N,(function(t,e){Be(r,e,t)})),e=t.s,n=t.ha,e&&n&&Be(r,e,n),Be(r,"VER",t.oa),Dn(t,r),r}function Hn(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new gn(t.Ea)).F=t.w,e}function Kn(){}function Gn(){if(W&&!(10<=Number(rt)))throw Error("Environmental error: no available transport.")}function Qn(t,e){At.call(this),this.a=new xn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!k(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!k(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Jn(this)}function Yn(t){fe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Xn(){pe.call(this),this.status=1}function Jn(t){this.a=t}(c=gn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?ce(this.G):ce(le),this.a.onreadystatechange=_(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Sn(this,t)}t=n||"";var i=new xe(this.headers);r&&ke(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=wn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.K()),n=h.FormData&&t instanceof h.FormData,!(0<=T(_n,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.B=function(t){return W&&et(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=_(this.ta,this)):this.m=qt(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Sn(this,t)}},c.ta=function(){void 0!==l&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},c.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Tn(this))},c.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Tn(this,!0)),gn.M.C.call(this)},c.va=function(){this.j||(this.w||this.l||this.g?En(this):this.Oa())},c.Oa=function(){En(this)},c.S=function(){try{return 2<In(this)?this.a.status:-1}catch(t){return-1}},c.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},c.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),yn(e)}},c.qa=function(){return this.h},c.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(c=xn.prototype).oa=8,c.u=1,c.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random());var e,n=new me(this,t=this.H++,void 0),r=this.j;if(this.F&&(r?F(r=$(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),Be(i=Me(this.v),"RID",t),Be(i,"CVER",22),this.s&&Be(i,"X-HTTP-Session-Id",this.s),Dn(this,i),this.h&&r&&An(i,this.h,r),un(this.b,n),this.fa?(Be(i,"$req",e),Be(i,"SID","null"),n.R=!0,be(n,i,null)):be(n,i,e),this.u=2}}else 3==this.u&&(t?Mn(this,t):0==this.f.length||sn(this.b)||Mn(this))},c.wa=function(){this.i=null,this.a=new me(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Me(this.ea);Be(t,"RID","rpc"),Be(t,"SID",this.B),Be(t,"CI",this.U?"0":"1"),Be(t,"AID",this.G),Dn(this,t),Be(t,"TYPE","xmlhttp"),this.h&&this.j&&An(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=Ue(Me(t)),e.j=null,e.F=!0,_e(e,n)},c.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Fn(this),ne(19))},c.Ta=function(t){ne(t?2:1)},(c=Kn.prototype).na=function(){},c.ma=function(){},c.la=function(){},c.ka=function(){},c.Ha=function(){},Gn.prototype.a=function(t,e){return new Qn(t,e)},O(Qn,At),(c=Qn.prototype).addEventListener=function(t,e,n,r){Qn.M.addEventListener.call(this,t,e,n,r)},c.removeEventListener=function(t,e,n,r){Qn.M.removeEventListener.call(this,t,e,n,r)},c.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ne(0),t.P=e,t.N=n||{},t.U=t.W,t.v=zn(t,null,t.P),Rn(t)},c.close=function(){Nn(this.a)},c.La=function(t){if("string"==typeof t){var e={};e.__data__=t,jn(this.a,e)}else this.g?((e={}).__data__=xt(t),jn(this.a,e)):jn(this.a,t)},c.C=function(){this.a.c=null,delete this.f,Nn(this.a),delete this.a,Qn.M.C.call(this)},O(Yn,fe),O(Xn,pe),O(Jn,Kn),Jn.prototype.na=function(){this.a.dispatchEvent("a")},Jn.prototype.ma=function(t){this.a.dispatchEvent(new Yn(t))},Jn.prototype.la=function(t){this.a.dispatchEvent(new Xn(t))},Jn.prototype.ka=function(){this.a.dispatchEvent("b")},Gn.prototype.createWebChannel=Gn.prototype.a,Qn.prototype.send=Qn.prototype.La,Qn.prototype.open=Qn.prototype.Ka,Qn.prototype.close=Qn.prototype.close,oe.NO_ERROR=0,oe.TIMEOUT=8,oe.HTTP_ERROR=6,se.COMPLETE="complete",ue.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",At.prototype.listen=At.prototype.ra,gn.prototype.listenOnce=gn.prototype.sa,gn.prototype.getLastError=gn.prototype.Ma,gn.prototype.getLastErrorCode=gn.prototype.qa,gn.prototype.getStatus=gn.prototype.S,gn.prototype.getResponseJson=gn.prototype.Ja,gn.prototype.getResponseText=gn.prototype.Y,gn.prototype.send=gn.prototype.$;var Zn={createWebChannelTransport:function(){return new Gn},ErrorCode:oe,EventType:se,WebChannel:ue,XhrIo:gn},tr=Zn.createWebChannelTransport,er=Zn.ErrorCode,nr=Zn.EventType,rr=Zn.WebChannel,ir=Zn.XhrIo,or=n(69),sr=new o.b("@firebase/firestore");function ar(){return sr.logLevel}function cr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(sr.logLevel<=o.a.DEBUG){var r=e.map(lr);sr.debug.apply(sr,Object(i.g)(["Firestore (7.17.1): "+t],r))}}function ur(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(sr.logLevel<=o.a.ERROR){var r=e.map(lr);sr.error.apply(sr,Object(i.g)(["Firestore (7.17.1): "+t],r))}}function lr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.17.1) INTERNAL ASSERTION FAILED: "+t;throw ur(e),new Error(e)}function fr(t,e){t||hr()}function pr(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mr=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=dr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function yr(t,e){return t<e?-1:t>e?1:0}function gr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function vr(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var br=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},_r=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.o=function(t){return yr(this.projectId,t.projectId)||yr(this.database,t.database)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Sr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Or(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Er=function(){function t(t,e){this.h=t,this.u=e,this.l={}}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.u(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Sr(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype._=function(){return Or(this.l)},t}(),Tr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(i.c)(e,t),e}(Error),Ir=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Cr(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Cr(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Cr(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Cr(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.T=function(t){return this.seconds===t.seconds?yr(this.nanoseconds,t.nanoseconds):yr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ar=function(){function t(t){this.timestamp=t}return t.I=function(e){return new t(e)},t.min=function(){return new t(new Ir(0,0))},t.prototype.o=function(t){return this.timestamp.T(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.A=function(){return this.timestamp},t}(),kr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&hr(),void 0===n?n=t.length-e:n>t.length-e&&hr(),this.segments=t,this.offset=e,this.R=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.g(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},t.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},t.prototype.v=function(){return this.segments[this.offset]},t.prototype.S=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype._=function(){return 0===this.length},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.F=function(){return this.segments.slice(this.offset,this.limit())},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.prototype.$=function(){return this.F().join("/")},e.prototype.toString=function(){return this.$()},e.N=function(t){if(t.indexOf("//")>=0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.k=function(){return new e([])},e}(kr),Nr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.M=function(t){return Nr.test(t)},e.prototype.$=function(){return this.F().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.M(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.$()},e.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},e.L=function(){return new e(["__name__"])},e.q=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Cr(Tr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var c=t[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new Cr(Tr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Cr(Tr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.k=function(){return new e([])},e}(kr),jr=function(){function t(t){this.path=t}return t.B=function(e){return new t(xr.N(e).V(5))},t.prototype.U=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===xr.P(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.P=function(t,e){return xr.P(t.path,e.path)},t.W=function(t){return t.length%2==0},t.j=function(e){return new t(new xr(e.slice()))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(t){return null==t}function Mr(t){return-0===t&&1/t==-1/0}function Dr(t){return"number"==typeof t&&Number.isInteger(t)&&!Mr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $r=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null};function Lr(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new $r(t,e,n,r,i,o,s)}function Fr(t){var e=pr(t);if(null===e.K){var n=e.path.$();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.$()+t.op.toString()+xi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.$()+e.dir;var e})).join(","),Rr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Es(e.startAt)),e.endAt&&(n+="|ub:",n+=Es(e.endAt)),e.K=n}return e.K}function Br(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!ks(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],!(i instanceof gs&&o instanceof gs&&i.op===o.op&&i.field.isEqual(o.field)&&Ci(i.value,o.value)))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Cs(t.startAt,e.startAt)&&Cs(t.endAt,e.endAt)}function Ur(t){return jr.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vr=function(){function t(t){this.G=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.G,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},t.prototype.H=function(){return 2*this.G.length},t.prototype.o=function(t){return yr(this.G,t.G)},t.prototype.isEqual=function(t){return this.G===t.G},t}();Vr.Y=new Vr("");var qr,Wr,zr=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Ar.min()),void 0===o&&(o=Ar.min()),void 0===s&&(s=Vr.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.Z=function(e){return new t(this.target,this.targetId,this.J,e,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.tt=function(e,n){return new t(this.target,this.targetId,this.J,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.et=function(e){return new t(this.target,this.targetId,this.J,this.sequenceNumber,this.X,e,this.resumeToken)},t}(),Hr=function(t){this.count=t};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kr(t){switch(t){case Tr.OK:return hr();case Tr.CANCELLED:case Tr.UNKNOWN:case Tr.DEADLINE_EXCEEDED:case Tr.RESOURCE_EXHAUSTED:case Tr.INTERNAL:case Tr.UNAVAILABLE:case Tr.UNAUTHENTICATED:return!1;case Tr.INVALID_ARGUMENT:case Tr.NOT_FOUND:case Tr.ALREADY_EXISTS:case Tr.PERMISSION_DENIED:case Tr.FAILED_PRECONDITION:case Tr.ABORTED:case Tr.OUT_OF_RANGE:case Tr.UNIMPLEMENTED:case Tr.DATA_LOSS:return!0;default:return hr()}}function Gr(t){if(void 0===t)return ur("GRPC error has no .code"),Tr.UNKNOWN;switch(t){case qr.OK:return Tr.OK;case qr.CANCELLED:return Tr.CANCELLED;case qr.UNKNOWN:return Tr.UNKNOWN;case qr.DEADLINE_EXCEEDED:return Tr.DEADLINE_EXCEEDED;case qr.RESOURCE_EXHAUSTED:return Tr.RESOURCE_EXHAUSTED;case qr.INTERNAL:return Tr.INTERNAL;case qr.UNAVAILABLE:return Tr.UNAVAILABLE;case qr.UNAUTHENTICATED:return Tr.UNAUTHENTICATED;case qr.INVALID_ARGUMENT:return Tr.INVALID_ARGUMENT;case qr.NOT_FOUND:return Tr.NOT_FOUND;case qr.ALREADY_EXISTS:return Tr.ALREADY_EXISTS;case qr.PERMISSION_DENIED:return Tr.PERMISSION_DENIED;case qr.FAILED_PRECONDITION:return Tr.FAILED_PRECONDITION;case qr.ABORTED:return Tr.ABORTED;case qr.OUT_OF_RANGE:return Tr.OUT_OF_RANGE;case qr.UNIMPLEMENTED:return Tr.UNIMPLEMENTED;case qr.DATA_LOSS:return Tr.DATA_LOSS;default:return hr()}}(Wr=qr||(qr={}))[Wr.OK=0]="OK",Wr[Wr.CANCELLED=1]="CANCELLED",Wr[Wr.UNKNOWN=2]="UNKNOWN",Wr[Wr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wr[Wr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wr[Wr.NOT_FOUND=5]="NOT_FOUND",Wr[Wr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wr[Wr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wr[Wr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wr[Wr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wr[Wr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wr[Wr.ABORTED=10]="ABORTED",Wr[Wr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wr[Wr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wr[Wr.INTERNAL=13]="INTERNAL",Wr[Wr.UNAVAILABLE=14]="UNAVAILABLE",Wr[Wr.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qr=function(){function t(t,e){this.P=t,this.root=e||Xr.EMPTY}return t.prototype.nt=function(e,n){return new t(this.P,this.root.nt(e,n,this.P).copy(null,null,Xr.st,null,null))},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,Xr.st,null,null))},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype._=function(){return this.root._()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.it=function(){return this.root.it()},t.prototype.rt=function(){return this.root.rt()},t.prototype.ot=function(t){return this.root.ot(t)},t.prototype.forEach=function(t){this.ot((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ot((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.at=function(){return new Yr(this.root,null,this.P,!1)},t.prototype.ut=function(t){return new Yr(this.root,t,this.P,!1)},t.prototype.ct=function(){return new Yr(this.root,null,this.P,!0)},t.prototype.lt=function(t){return new Yr(this.root,t,this.P,!0)},t}(),Yr=function(){function t(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}return t.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},t.prototype.wt=function(){return this.ft.length>0},t.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},t}(),Xr=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype._=function(){return!1},t.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},t.prototype.min=function(){return this.left._()?this:this.left.min()},t.prototype.it=function(){return this.min().key},t.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},t.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},t.prototype.It=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.At()||e.left.left.At()||(e=e.Rt()),(e=e.copy(null,null,null,e.left.It(),null)).Et()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.At()||i.left.left.At()||(i=i.Rt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.At()&&(i=i.Pt()),i.right._()||i.right.At()||i.right.left.At()||(i=i.gt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.It())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Et()},t.prototype.At=function(){return this.color},t.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.Vt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},t.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).Vt()).yt()),t},t.prototype.gt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},t.prototype.Vt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Pt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},t.prototype.bt=function(){if(this.At()&&this.left.At())throw hr();if(this.right.At())throw hr();var t=this.left.bt();if(t!==this.right.bt())throw hr();return t+(this.At()?0:1)},t}();Xr.EMPTY=null,Xr.RED=!0,Xr.st=!1,Xr.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw hr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw hr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw hr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw hr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw hr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.nt=function(t,e,n){return new Xr(t,e)},t.prototype.remove=function(t,e){return this},t.prototype._=function(){return!0},t.prototype.ot=function(t){return!1},t.prototype.ht=function(t){return!1},t.prototype.it=function(){return null},t.prototype.rt=function(){return null},t.prototype.At=function(){return!1},t.prototype.pt=function(){return!0},t.prototype.bt=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Jr=function(){function t(t){this.P=t,this.data=new Qr(this.P)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.it()},t.prototype.last=function(){return this.data.rt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ot((function(e,n){return t(e),!1}))},t.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(this.P(r.key,t[1])>=0)return;e(r.key)}},t.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},t.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},t.prototype.at=function(){return new Zr(this.data.at())},t.prototype.ut=function(t){return new Zr(this.data.ut(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype._=function(){return this.data._()},t.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.at(),r=e.data.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(0!==this.P(i,o))return!1}return!0},t.prototype.F=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n},t}(),Zr=function(){function t(t){this.Ft=t}return t.prototype.dt=function(){return this.Ft.dt().key},t.prototype.wt=function(){return this.Ft.wt()},t}(),ti=new Qr(jr.P);function ei(){return ti}function ni(){return ei()}var ri=new Qr(jr.P);function ii(){return ri}var oi=new Qr(jr.P),si=new Jr(jr.P);function ai(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=si,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ci=new Jr(yr);function ui(){return ci}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var li=function(){function t(t){this.P=t?function(e,n){return t(e,n)||jr.P(e.key,n.key)}:function(t,e){return jr.P(t.key,e.key)},this.$t=ii(),this.Nt=new Qr(this.P)}return t.kt=function(e){return new t(e.P)},t.prototype.has=function(t){return null!=this.$t.get(t)},t.prototype.get=function(t){return this.$t.get(t)},t.prototype.first=function(){return this.Nt.it()},t.prototype.last=function(){return this.Nt.rt()},t.prototype._=function(){return this.Nt._()},t.prototype.indexOf=function(t){var e=this.$t.get(t);return e?this.Nt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Nt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Nt.ot((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.nt(t.key,t),e.Nt.nt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Nt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Nt.at(),r=e.Nt.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.$t=e,r.Nt=n,r},t}(),hi=function(){function t(){this.xt=new Qr(jr.P)}return t.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);n?0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):hr():this.xt=this.xt.nt(e,t)},t.prototype.Mt=function(){var t=[];return this.xt.ot((function(e,n){t.push(n)})),t},t}(),fi=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.qt=s,this.Bt=a}return t.Ut=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,li.kt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.qt===t.qt&&this.Lt.isEqual(t.Lt)&&fs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),pi=function(){function t(t,e,n,r,i){this.X=t,this.Wt=e,this.Qt=n,this.jt=r,this.Kt=i}return t.Gt=function(e,n){var r=new Map;return r.set(e,di.zt(e,n)),new t(Ar.min(),r,ui(),ei(),ai())},t}(),di=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}return t.zt=function(e,n){return new t(Vr.Y,n,ai(),ai(),ai())},t}(),mi=function(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r},yi=function(t,e){this.targetId=t,this.ee=e},gi=function(t,e,n,r){void 0===n&&(n=Vr.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},vi=function(){function t(){this.ne=0,this.se=wi(),this.ie=Vr.Y,this.re=!1,this.oe=!0}return Object.defineProperty(t.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){t.H()>0&&(this.oe=!0,this.ie=t)},t.prototype.ce=function(){var t=ai(),e=ai(),n=ai();return this.se.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:hr()}})),new di(this.ie,this.re,t,e,n)},t.prototype.le=function(){this.oe=!1,this.se=wi()},t.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},t.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},t.prototype.de=function(){this.ne+=1},t.prototype.we=function(){this.ne-=1},t.prototype.Te=function(){this.oe=!0,this.re=!0},t}(),bi=function(){function t(t){this.Ee=t,this.Ie=new Map,this.me=ei(),this.Ae=_i(),this.Re=new Jr(yr)}return t.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof Zo?this.ge(r,t.te):t.te instanceof ts&&this.Ve(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Ve(s,t.key,t.te)}},t.prototype.ye=function(t){var e=this;this.pe(t,(function(n){var r=e.be(n);switch(t.state){case 0:e.ve(n)&&r.ue(t.resumeToken);break;case 1:r.we(),r.he||r.le(),r.ue(t.resumeToken);break;case 2:r.we(),r.he||e.removeTarget(n);break;case 3:e.ve(n)&&(r.Te(),r.ue(t.resumeToken));break;case 4:e.ve(n)&&(e.Se(n),r.ue(t.resumeToken));break;default:hr()}}))},t.prototype.pe=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ie.forEach((function(t,r){n.ve(r)&&e(r)}))},t.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(Ur(i))if(0===n){var o=new jr(i.path);this.Ve(e,o,new ts(o,Ar.min()))}else fr(1===n);else this.Fe(e)!==n&&(this.Se(e),this.Re=this.Re.add(e))}},t.prototype.$e=function(t){var e=this,n=new Map;this.Ie.forEach((function(r,i){var o=e.Ce(i);if(o){if(r.Ht&&Ur(o.target)){var s=new jr(o.target.path);null!==e.me.get(s)||e.Ne(i,s)||e.Ve(i,s,new ts(s,t))}r.ae&&(n.set(i,r.ce()),r.le())}}));var r=ai();this.Ae.forEach((function(t,n){var i=!0;n.St((function(t){var n=e.Ce(t);return!n||2===n.J||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new pi(t,n,this.Re,this.me,r);return this.me=ei(),this.Ae=_i(),this.Re=new Jr(yr),i},t.prototype.ge=function(t,e){if(this.ve(t)){var n=this.Ne(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t))}},t.prototype.Ve=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.Ne(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n))}},t.prototype.removeTarget=function(t){this.Ie.delete(t)},t.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size},t.prototype.de=function(t){this.be(t).de()},t.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new vi,this.Ie.set(t,e)),e},t.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new Jr(yr),this.Ae=this.Ae.nt(t,e)),e},t.prototype.ve=function(t){var e=null!==this.Ce(t);return e||cr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},t.prototype.Se=function(t){var e=this;this.Ie.set(t,new vi),this.Ee.xe(t).forEach((function(n){e.Ve(t,n,null)}))},t.prototype.Ne=function(t,e){return this.Ee.xe(t).has(e)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _i(){return new Qr(jr.P)}function wi(){return new Qr(jr.P)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Oi(t){var e=Ni(t.mapValue.fields.__local_write_time__.timestampValue);return new Ir(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ei=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Si(t)?4:10:hr()}function Ci(t,e){var n=Ti(t);if(n!==Ti(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Oi(t).isEqual(Oi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ni(t.timestampValue),r=Ni(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ji(t.bytesValue).isEqual(ji(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Pi(t.geoPointValue.latitude)===Pi(e.geoPointValue.latitude)&&Pi(t.geoPointValue.longitude)===Pi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Pi(t.integerValue)===Pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Pi(t.doubleValue),r=Pi(e.doubleValue);return n===r?Mr(n)===Mr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return gr(t.arrayValue.values||[],e.arrayValue.values||[],Ci);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(wr(n)!==wr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ci(n[i],r[i])))return!1;return!0}(t,e);default:return hr()}}function Ii(t,e){return void 0!==(t.values||[]).find((function(t){return Ci(t,e)}))}function Ai(t,e){var n=Ti(t),r=Ti(e);if(n!==r)return yr(n,r);switch(n){case 0:return 0;case 1:return yr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Pi(t.integerValue||t.doubleValue),r=Pi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ki(t.timestampValue,e.timestampValue);case 4:return ki(Oi(t),Oi(e));case 5:return yr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ji(t),r=ji(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=yr(n[i],r[i]);if(0!==o)return o}return yr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=yr(Pi(t.latitude),Pi(e.latitude));return 0!==n?n:yr(Pi(t.longitude),Pi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ai(n[i],r[i]);if(o)return o}return yr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=yr(r[s],o[s]);if(0!==a)return a;var c=Ai(n[r[s]],i[o[s]]);if(0!==c)return c}return yr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw hr()}}function ki(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return yr(t,e);var n=Ni(t),r=Ni(e),i=yr(n.seconds,r.seconds);return 0!==i?i:yr(n.nanos,r.nanos)}function xi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ni(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ji(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,jr.B(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):hr();var n,r}(t)}function Ni(t){if(fr(!!t),"string"==typeof t){var e=0,n=Ei.exec(t);if(fr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Pi(t.seconds),nanos:Pi(t.nanos)}}function Pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ji(t){return"string"==typeof t?Vr.fromBase64String(t):Vr.fromUint8Array(t)}function Ri(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.$()}}function Mi(t){return!!t&&"integerValue"in t}function Di(t){return!!t&&"arrayValue"in t}function $i(t){return!!t&&"nullValue"in t}function Li(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Fi(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bi={asc:"ASCENDING",desc:"DESCENDING"},Ui={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vi=function(t,e){this.s=t,this.Oe=e};function qi(t){return{integerValue:""+t}}function Wi(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mr(e)?"-0":e}}function zi(t,e){return Dr(e)?qi(e):Wi(t,e)}function Hi(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ki(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Gi(t,e){return Hi(t,e.A())}function Qi(t){return fr(!!t),Ar.I(function(t){var e=Ni(t);return new Ir(e.seconds,e.nanos)}(t))}function Yi(t,e){return function(t){return new xr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).$()}function Xi(t){var e=xr.N(t);return fr(go(e)),e}function Ji(t,e){return Yi(t.s,e.path)}function Zi(t,e){var n=Xi(e);return fr(n.get(1)===t.s.projectId),fr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new jr(ro(n))}function to(t,e){return Yi(t.s,e)}function eo(t){var e=Xi(t);return 4===e.length?xr.k():ro(e)}function no(t){return new xr(["projects",t.s.projectId,"databases",t.s.database]).$()}function ro(t){return fr(t.length>4&&"documents"===t.get(4)),t.V(5)}function io(t,e,n){return{name:Ji(t,e),fields:n.proto.mapValue.fields}}function oo(t,e){var n;if(e instanceof Uo)n={update:io(t,e.key,e.value)};else if(e instanceof Ko)n={delete:Ji(t,e.key)};else if(e instanceof Vo)n={update:io(t,e.key,e.data),updateMask:yo(e.Le)};else if(e instanceof Wo)n={transform:{document:Ji(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof So)return{fieldPath:e.field.$(),setToServerValue:"REQUEST_TIME"};if(n instanceof Oo)return{fieldPath:e.field.$(),appendMissingElements:{values:n.elements}};if(n instanceof To)return{fieldPath:e.field.$(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.$(),increment:n.qe};throw hr()}(0,t)}))}};else{if(!(e instanceof Go))return hr();n={verify:Ji(t,e.key)}}return e.Ue.Be||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Gi(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:hr()}(t,e.Ue)),n}function so(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?jo.updateTime(Qi(t.updateTime)):void 0!==t.exists?jo.exists(t.exists):jo.We()}(e.currentDocument):jo.We();if(e.update){e.update.name;var r=Zi(t,e.update.name),i=new Qo({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new xo(e.map((function(t){return Pr.q(t)})))}(e.updateMask);return new Vo(r,i,o,n)}return new Uo(r,i,n)}if(e.delete){var s=Zi(t,e.delete);return new Ko(s,n)}if(e.transform){var a=Zi(t,e.transform.document),c=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)fr("REQUEST_TIME"===e.setToServerValue),n=new So;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Oo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new To(i)}else"increment"in e?n=new Io(t,e.increment):hr();var o=Pr.q(e.fieldPath);return new No(o,n)}(t,e)}));return fr(!0===n.exists),new Wo(a,c)}if(e.verify){var u=Zi(t,e.verify);return new Go(u,n)}return hr()}function ao(t,e){return{documents:[to(t,e.path)]}}function co(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=to(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=to(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return t instanceof gs?function(t){if("=="===t.op){if(Li(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NAN"}};if($i(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:ho(t.field),op:(e=t.op,Ui[e]),value:t.value}};var e}(t):hr()}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:ho((e=t).field),direction:(n=e.dir,Bi[n])};var e,n}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Oe||Rr(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=uo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=uo(e.endAt)),n}function uo(t){return{before:t.before,values:t.position}}function lo(t){var e=!!t.before,n=t.values||[];return new Os(n,e)}function ho(t){return{fieldPath:t.$()}}function fo(t){return Pr.q(t.fieldPath)}function po(t){return gs.create(fo(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return hr()}}(t.fieldFilter.op),t.fieldFilter.value)}function mo(t){switch(t.unaryFilter.op){case"IS_NAN":var e=fo(t.unaryFilter.field);return gs.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=fo(t.unaryFilter.field);return gs.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return hr()}}function yo(t){var e=[];return t.fields.forEach((function(t){return e.push(t.$())})),{fieldPaths:e}}function go(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vo=function(){this.Qe=void 0};function bo(t,e,n){return t instanceof So?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Oo?Eo(t,e):t instanceof To?Co(t,e):function(t,e){var n=wo(t,e),r=Ao(n)+Ao(t.qe);return Mi(n)&&Mi(t.qe)?qi(r):Wi(t.serializer,r)}(t,e)}function _o(t,e,n){return t instanceof Oo?Eo(t,e):t instanceof To?Co(t,e):n}function wo(t,e){return t instanceof Io?Mi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var So=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e}(vo),Oo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(i.c)(e,t),e}(vo);function Eo(t,e){for(var n=ko(e),r=function(t){n.some((function(e){return Ci(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var To=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(i.c)(e,t),e}(vo);function Co(t,e){for(var n=ko(e),r=function(t){n=n.filter((function(e){return!Ci(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Io=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.qe=n,r}return Object(i.c)(e,t),e}(vo);function Ao(t){return Pi(t.integerValue||t.doubleValue)}function ko(t){return Di(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xo=function(){function t(t){this.fields=t,t.sort(Pr.P)}return t.prototype.je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},t.prototype.isEqual=function(t){return gr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),No=function(t,e){this.field=t,this.transform=e},Po=function(t,e){this.version=t,this.transformResults=e},jo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.We=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Be",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ro(t,e){return void 0!==t.updateTime?e instanceof Zo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Zo}var Mo=function(){};function Do(t,e,n){return t instanceof Uo?function(t,e,n){return new Zo(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Vo?function(t,e,n){if(!Ro(t.Ue,e))return new es(t.key,n.version);var r=qo(t,e);return new Zo(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Wo?function(t,e,n){if(fr(null!=n.transformResults),!Ro(t.Ue,e))return new es(t.key,n.version);var r=zo(t,e),i=function(t,e,n){var r=[];fr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof Zo&&(a=e.field(o.field)),r.push(_o(s,a,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Ho(t,r.data(),i);return new Zo(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new ts(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function $o(t,e,n,r){return t instanceof Uo?function(t,e){if(!Ro(t.Ue,e))return e;var n=Bo(e);return new Zo(t.key,n,t.value,{Ke:!0})}(t,e):t instanceof Vo?function(t,e){if(!Ro(t.Ue,e))return e;var n=Bo(e),r=qo(t,e);return new Zo(t.key,n,r,{Ke:!0})}(t,e):t instanceof Wo?function(t,e,n,r){if(!Ro(t.Ue,e))return e;var i=zo(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var a=s[o],c=a.transform,u=null;n instanceof Zo&&(u=n.field(a.field)),null===u&&r instanceof Zo&&(u=r.field(a.field)),i.push(bo(c,u,e))}return i}(t.fieldTransforms,n,e,r),s=Ho(t,i.data(),o);return new Zo(t.key,i.version,s,{Ke:!0})}(t,e,r,n):function(t,e){return Ro(t.Ue,e)?new ts(t.key,Ar.min()):e}(t,e)}function Lo(t,e){return t instanceof Wo?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof Zo?e.field(o.field):void 0,a=wo(o.transform,s||null);null!=a&&(n=null==n?(new Yo).set(o.field,a):n.set(o.field,a))}return n?n.Ge():null}(t,e):null}function Fo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||gr(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Oo&&e instanceof Oo||t instanceof To&&e instanceof To?gr(t.elements,e.elements,Ci):t instanceof Io&&e instanceof Io?Ci(t.qe,e.qe):t instanceof So&&e instanceof So}(t.transform,e.transform)}(t,e)})))}function Bo(t){return t instanceof Zo?t.version:Ar.min()}var Uo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ue=r,i.type=0,i}return Object(i.c)(e,t),e}(Mo),Vo=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Le=r,o.Ue=i,o.type=1,o}return Object(i.c)(e,t),e}(Mo);function qo(t,e){return function(t,e){var n=new Yo(e);return t.Le.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Ge()}(t,e instanceof Zo?e.data():Qo.empty())}var Wo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ue=jo.exists(!0),r}return Object(i.c)(e,t),e}(Mo);function zo(t,e){return e}function Ho(t,e,n){for(var r=new Yo(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Ge()}var Ko=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=3,r}return Object(i.c)(e,t),e}(Mo),Go=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=4,r}return Object(i.c)(e,t),e}(Mo),Qo=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Fi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},t.prototype.isEqual=function(t){return Ci(this.proto,t.proto)},t}(),Yo=function(){function t(t){void 0===t&&(t=Qo.empty()),this.ze=t,this.He=new Map}return t.prototype.set=function(t,e){return this.Ye(t,e),this},t.prototype.delete=function(t){return this.Ye(t,null),this},t.prototype.Ye=function(t,e){for(var n=this.He,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Ti(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.S(),e)},t.prototype.Ge=function(){var t=this.Je(Pr.k(),this.He);return null!=t?new Qo(t):this.ze},t.prototype.Je=function(t,e){var n=this,r=!1,i=this.ze.field(t),o=Fi(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Je(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function Xo(t){var e=[];return Sr(t.fields||{},(function(t,n){var r=new Pr([t]);if(Fi(n)){var i=Xo(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new xo(e)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var Jo=function(t,e){this.key=t,this.version=e},Zo=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Xe=r,o.Ke=!!i.Ke,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(i.c)(e,t),e.prototype.field=function(t){return this.Xe.field(t)},e.prototype.data=function(){return this.Xe},e.prototype.Ze=function(){return this.Xe.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ke===t.Ke&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Xe.isEqual(t.Xe)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Xe.toString()+", {hasLocalMutations: "+this.Ke+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Ke||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(Jo),ts=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(i.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Jo),es=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Jo);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Cr(Tr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new Cr(Tr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rs=function(){function t(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.tn=n,this.filters=r,this.limit=i,this.en=o,this.startAt=s,this.endAt=a,this.nn=null,this.sn=null,this.startAt,this.endAt}return t.prototype.rn=function(e){return new t(e,null,this.tn.slice(),this.filters.slice(),this.limit,this.en,this.startAt,this.endAt)},t.prototype.on=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.tn.length||1===this.tn.length&&this.tn[0].field.O())},t.prototype.hn=function(){return!Rr(this.limit)&&"F"===this.en},t.prototype.an=function(){return!Rr(this.limit)&&"L"===this.en},t.prototype.un=function(){return this.tn.length>0?this.tn[0].field:null},t.prototype.cn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n.ln())return n.field}return null},t.prototype._n=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(t.indexOf(r.op)>=0)return r.op}return null},t}();function is(t,e,n,r,i,o,s,a){return new rs(t,e,n,r,i,o,s,a)}function os(t){return new rs(t)}function ss(t){return null!==t.collectionGroup}function as(t){var e=ns(t,rs);if(null===e.nn){e.nn=[];var n=e.cn(),r=e.un();if(null!==n&&null===r)n.O()||e.nn.push(new Is(n)),e.nn.push(new Is(Pr.L(),"asc"));else{for(var i=!1,o=0,s=e.tn;o<s.length;o++){var a=s[o];e.nn.push(a),a.field.O()&&(i=!0)}if(!i){var c=e.tn.length>0?e.tn[e.tn.length-1].dir:"asc";e.nn.push(new Is(Pr.L(),c))}}}return e.nn}function cs(t){var e=ns(t,rs);if(!e.sn)if("F"===e.en)e.sn=Lr(e.path,e.collectionGroup,as(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=as(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Is(o.field,s))}var a=e.endAt?new Os(e.endAt.position,!e.endAt.before):null,c=e.startAt?new Os(e.startAt.position,!e.startAt.before):null;e.sn=Lr(e.path,e.collectionGroup,n,e.filters,e.limit,a,c)}return e.sn}function us(t,e,n){return new rs(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ls(t,e){return new rs(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,e,t.endAt)}function hs(t,e){return new rs(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,t.startAt,e)}function fs(t,e){return Br(cs(t),cs(e))&&t.en===e.en}function ps(t){return Fr(cs(t))+"|lt:"+t.en}function ds(t){return"Query(target="+function(t){var e=t.path.$();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.$()+" "+e.op+" "+xi(e.value);var e})).join(", ")+"]"),Rr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.$()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Es(t.startAt)),t.endAt&&(e+=", endAt: "+Es(t.endAt)),"Target("+e+")"}(cs(t))+"; limitType="+t.en+")"}function ms(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.U(t.collectionGroup)&&t.path.D(n):jr.W(t.path)?t.path.isEqual(n):t.path.C(n)}(t,e)&&function(t,e){for(var n=0,r=t.tn;n<r.length;n++){var i=r[n];if(!i.field.O()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ts(t.startAt,as(t),e)||t.endAt&&Ts(t.endAt,as(t),e))}(t,e)}function ys(t){return function(e,n){for(var r=!1,i=0,o=as(t);i<o.length;i++){var s=o[i],a=As(s,e,n);if(0!==a)return a;r=r||s.field.O()}return 0}}var gs=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(i.c)(e,t),e.create=function(t,n,r){if(t.O())return"in"===n?new bs(t,r):new vs(t,n,r);if($i(r)){if("=="!==n)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(Li(r)){if("=="!==n)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return"array-contains"===n?new _s(t,r):"in"===n?new ws(t,r):"array-contains-any"===n?new Ss(t,r):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Ti(this.value)===Ti(e)&&this.fn(Ai(e,this.value))},e.prototype.fn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return t>0;case">=":return t>=0;default:return hr()}},e.prototype.ln=function(){return["<","<=",">",">="].indexOf(this.op)>=0},e}((function(){})),vs=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=jr.B(r.referenceValue),i}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=jr.P(t.key,this.key);return this.fn(e)},e}(gs),bs=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=(n.arrayValue.values||[]).map((function(t){return jr.B(t.referenceValue)})),r}return Object(i.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(gs),_s=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return Di(e)&&Ii(e.arrayValue,this.value)},e}(gs),ws=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Ii(this.value.arrayValue,e)},e}(gs),Ss=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(i.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Di(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Ii(e.value.arrayValue,t)}))},e}(gs),Os=function(t,e){this.position=t,this.before=e};function Es(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return xi(t)})).join(",")}function Ts(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?jr.P(jr.B(s.referenceValue),n.key):Ai(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Cs(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ci(t.position[n],e.position[n]))return!1;return!0}var Is=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function As(t,e,n){var r=t.field.O()?jr.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Ai(r,i):hr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return hr()}}function ks(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xs=function(){function t(t,e,n,r){this.batchId=t,this.dn=e,this.baseMutations=n,this.mutations=r}return t.prototype.wn=function(t,e,n){for(var r=n.Tn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Do(o,e,r[i]))}return e},t.prototype.En=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=$o(i,e,e,this.dn))}for(var o=e,s=0,a=this.mutations;s<a.length;s++){var c=a[s];c.key.isEqual(t)&&(e=$o(c,e,o,this.dn))}return e},t.prototype.In=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.En(r.key,t.get(r.key));i&&(n=n.nt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),ai())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&gr(this.mutations,t.mutations,(function(t,e){return Fo(t,e)}))&&gr(this.baseMutations,t.baseMutations,(function(t,e){return Fo(t,e)}))},t}(),Ns=function(){function t(t,e,n,r){this.batch=t,this.mn=e,this.Tn=n,this.An=r}return t.from=function(e,n,r){fr(e.mutations.length===r.length);for(var i=oi,o=e.mutations,s=0;s<o.length;s++)i=i.nt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Ps=function(){function t(t){var e=this;this.Rn=null,this.Pn=null,this.result=void 0,this.error=void 0,this.gn=!1,this.Vn=!1,t((function(t){e.gn=!0,e.result=t,e.Rn&&e.Rn(t)}),(function(t){e.gn=!0,e.error=t,e.Pn&&e.Pn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Vn&&hr(),this.Vn=!0,this.gn?this.error?this.yn(n,this.error):this.pn(e,this.result):new t((function(t,i){r.Rn=function(n){r.pn(e,n).next(t,i)},r.Pn=function(e){r.yn(n,e).next(t,i)}}))},t.prototype.bn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.vn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.pn=function(e,n){return e?this.vn((function(){return e(n)})):t.resolve(n)},t.prototype.yn=function(e,n){return e?this.vn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Sn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Dn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Sn(r)},t}(),js=function(){function t(){this.Cn=new Er((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Fn=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.$n},set:function(t){this.$n=t},enumerable:!1,configurable:!0}),t.prototype.Nn=function(t,e){this.kn(),this.readTime=e,this.Cn.set(t.key,t)},t.prototype.xn=function(t,e){this.kn(),e&&(this.readTime=e),this.Cn.set(t,null)},t.prototype.Mn=function(t,e){this.kn();var n=this.Cn.get(e);return void 0!==n?Ps.resolve(n):this.On(t,e)},t.prototype.getEntries=function(t,e){return this.Ln(t,e)},t.prototype.apply=function(t){return this.kn(),this.Fn=!0,this.qn(t)},t.prototype.kn=function(){},t}(),Rs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ms=function(){function t(){this.Bn=[]}return t.prototype.Un=function(t){this.Bn.push(t)},t.prototype.Wn=function(){this.Bn.forEach((function(t){return t()}))},t}(),Ds=function(){function t(t,e,n){this.Qn=t,this.jn=e,this.Kn=n}return t.prototype.Gn=function(t,e){var n=this;return this.jn.zn(t,e).next((function(r){return n.Hn(t,e,r)}))},t.prototype.Hn=function(t,e,n){return this.Qn.Mn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].En(e,t);return t}))},t.prototype.Yn=function(t,e,n){var r=ni();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].En(t,e);r=r.nt(t,e)})),r},t.prototype.Jn=function(t,e){var n=this;return this.Qn.getEntries(t,e).next((function(e){return n.Xn(t,e)}))},t.prototype.Xn=function(t,e){var n=this;return this.jn.Zn(t,e).next((function(r){var i=n.Yn(t,e,r),o=ei();return i.forEach((function(t,e){e||(e=new ts(t,Ar.min())),o=o.nt(t,e)})),o}))},t.prototype.ts=function(t,e,n){return function(t){return jr.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.es(t,e.path):ss(e)?this.ns(t,e,n):this.ss(t,e,n)},t.prototype.es=function(t,e){return this.Gn(t,new jr(e)).next((function(t){var e=ii();return t instanceof Zo&&(e=e.nt(t.key,t)),e}))},t.prototype.ns=function(t,e,n){var r=this,i=e.collectionGroup,o=ii();return this.Kn.rs(t,i).next((function(s){return Ps.forEach(s,(function(s){var a=e.rn(s.child(i));return r.ss(t,a,n).next((function(t){t.forEach((function(t,e){o=o.nt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.ss=function(t,e,n){var r,i,o=this;return this.Qn.ts(t,e,n).next((function(n){return r=n,o.jn.os(t,e)})).next((function(e){return i=e,o.hs(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var c=a[s],u=c.key,l=r.get(u),h=$o(c,l,l,o.dn);r=h instanceof Zo?r.nt(u,h):r.remove(u)}}))})).next((function(){return r.forEach((function(t,n){ms(e,n)||(r=r.remove(t))})),r}))},t.prototype.hs=function(t,e,n){for(var r=ai(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var c=a[s];c instanceof Vo&&null===n.get(c.key)&&(r=r.add(c.key))}var u=n;return this.Qn.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Zo&&(u=u.nt(t,e))})),u}))},t}(),$s=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.as=n,this.us=r}return t.cs=function(e,n){for(var r=ai(),i=ai(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ls=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.ls=function(t){return n._s(t)},this.fs=function(t){return e.ds(t)})}return t.prototype._s=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.fs&&this.fs(t),t},t}();Ls.ws=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Fs=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Bs=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Ts=t,this.Es=e,this.Is=n,this.ms=r,this.As=i,this.Rs=0,this.Ps=null,this.gs=Date.now(),this.reset()}return t.prototype.reset=function(){this.Rs=0},t.prototype.Vs=function(){this.Rs=this.As},t.prototype.ys=function(t){var e=this;this.cancel();var n=Math.floor(this.Rs+this.ps()),r=Math.max(0,Date.now()-this.gs),i=Math.max(0,n-r);i>0&&cr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Rs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ps=this.Ts.bs(this.Es,i,(function(){return e.gs=Date.now(),t()})),this.Rs*=this.ms,this.Rs<this.Is&&(this.Rs=this.Is),this.Rs>this.As&&(this.Rs=this.As)},t.prototype.vs=function(){null!==this.Ps&&(this.Ps.Ss(),this.Ps=null)},t.prototype.cancel=function(){null!==this.Ps&&(this.Ps.cancel(),this.Ps=null)},t.prototype.ps=function(){return(Math.random()-.5)*this.Rs},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=qs(e)),e=Vs(t.get(n),e);return qs(e)}function Vs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function qs(t){return t+""}function Ws(t){var e=t.length;if(fr(e>=2),2===e)return fr(""===t.charAt(0)&&""===t.charAt(1)),xr.k();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&hr(),t.charAt(s+1)){case"":var a=t.substring(o,s),c=void 0;0===i.length?c=a:(c=i+=a,i=""),r.push(c);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:hr()}o=s+2}return new xr(r)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zs=function(){function t(){this.Ds=new Hs}return t.prototype.Cs=function(t,e){return this.Ds.add(e),Ps.resolve()},t.prototype.rs=function(t,e){return Ps.resolve(this.Ds.getEntries(e))},t}(),Hs=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Jr(xr.P),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Jr(xr.P)).F()},t}(),Ks=function(){function t(){this.Fs=new Hs}return t.prototype.Cs=function(t,e){var n=this;if(!this.Fs.has(e)){var r=e.S(),i=e.p();t.Un((function(){n.Fs.add(e)}));var o={collectionId:r,parent:Us(i)};return Gs(t).put(o)}return Ps.resolve()},t.prototype.rs=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[vr(e),""],!1,!0);return Gs(t).$s(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ws(o.parent))}return n}))},t}();function Gs(t){return ga.Ns(t,qa.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs=function(t){this.ks=t};function Ys(t,e){if(e.document)return function(t,e,n){var r=Zi(t,e.name),i=Qi(e.updateTime),o=new Qo({mapValue:{fields:e.fields}});return new Zo(r,i,o,{hasCommittedMutations:!!n})}(t.ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=jr.j(e.noDocument.path),r=ea(e.noDocument.readTime);return new ts(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=jr.j(e.unknownDocument.path),o=ea(e.unknownDocument.version);return new es(i,o)}return hr()}function Xs(t,e,n){var r=Js(n),i=e.key.path.p().F();if(e instanceof Zo){var o=function(t,e){return{name:Ji(t,e.key),fields:e.Ze().mapValue.fields,updateTime:Hi(t,e.version.A())}}(t.ks,e),s=e.hasCommittedMutations;return new La(null,null,o,s,r,i)}if(e instanceof ts){var a=e.key.path.F(),c=ta(e.version),u=e.hasCommittedMutations;return new La(null,new Da(a,c),null,u,r,i)}if(e instanceof es){var l=e.key.path.F(),h=ta(e.version);return new La(new $a(l,h),null,null,!0,r,i)}return hr()}function Js(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Zs(t){var e=new Ir(t[0],t[1]);return Ar.I(e)}function ta(t){var e=t.A();return new Na(e.seconds,e.nanoseconds)}function ea(t){var e=new Ir(t.seconds,t.nanoseconds);return Ar.I(e)}function na(t,e){var n=(e.baseMutations||[]).map((function(e){return so(t.ks,e)})),r=e.mutations.map((function(e){return so(t.ks,e)})),i=Ir.fromMillis(e.localWriteTimeMs);return new xs(e.batchId,i,n,r)}function ra(t){var e,n,r=ea(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ea(t.lastLimboFreeSnapshotVersion):Ar.min();return void 0!==t.query.documents?(fr(1===(n=t.query).documents.length),e=cs(os(eo(n.documents[0])))):e=function(t){var e=eo(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){fr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[mo(e)]:void 0!==e.fieldFilter?[po(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):hr():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new Is(fo((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var c=null;n.limit&&(c=function(t){var e;return Rr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var u=null;n.startAt&&(u=lo(n.startAt));var l=null;return n.endAt&&(l=lo(n.endAt)),cs(is(e,i,a,s,c,"F",u,l))}(t.query),new zr(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Vr.fromBase64String(t.resumeToken))}function ia(t,e){var n,r=ta(e.X),i=ta(e.lastLimboFreeSnapshotVersion);n=Ur(e.target)?ao(t.ks,e.target):co(t.ks,e.target);var o=e.resumeToken.toBase64();return new Ba(e.targetId,Fr(e.target),r,o,e.sequenceNumber,i,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oa=function(){function t(t,e){this.serializer=t,this.Kn=e}return t.prototype.Nn=function(t,e,n){return aa(t).put(ca(e),n)},t.prototype.xn=function(t,e){var n=aa(t),r=ca(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.xs(t,r)}))},t.prototype.Mn=function(t,e){var n=this;return aa(t).get(ca(e)).next((function(t){return n.Ms(t)}))},t.prototype.Os=function(t,e){var n=this;return aa(t).get(ca(e)).next((function(t){var e=n.Ms(t);return e?{Ls:e,size:ua(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ni();return this.qs(t,e,(function(t,e){var i=n.Ms(e);r=r.nt(t,i)})).next((function(){return r}))},t.prototype.Bs=function(t,e){var n=this,r=ni(),i=new Qr(jr.P);return this.qs(t,e,(function(t,e){var o=n.Ms(e);o?(r=r.nt(t,o),i=i.nt(t,ua(e))):(r=r.nt(t,null),i=i.nt(t,0))})).next((function(){return{Us:r,Ws:i}}))},t.prototype.qs=function(t,e,n){if(e._())return Ps.resolve();var r=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),i=e.at(),o=i.dt();return aa(t).Qs({range:r},(function(t,e,r){for(var s=jr.j(t);o&&jr.P(o,s)<0;)n(o,null),o=i.dt();o&&o.isEqual(s)&&(n(o,e),o=i.wt()?i.dt():null),o?r.js(o.path.F()):r.done()})).next((function(){for(;o;)n(o,null),o=i.wt()?i.dt():null}))},t.prototype.ts=function(t,e,n){var r=this,i=ii(),o=e.path.length+1,s={};if(n.isEqual(Ar.min())){var a=e.path.F();s.range=IDBKeyRange.lowerBound(a)}else{var c=e.path.F(),u=Js(n);s.range=IDBKeyRange.lowerBound([c,u],!0),s.index=La.collectionReadTimeIndex}return aa(t).Qs(s,(function(t,n,s){if(t.length===o){var a=Ys(r.serializer,n);e.path.D(a.key.path)?a instanceof Zo&&ms(e,a)&&(i=i.nt(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.Ks=function(t,e){var n=this,r=ei(),i=Js(e),o=aa(t),s=IDBKeyRange.lowerBound(i,!0);return o.Qs({index:La.readTimeIndex,range:s},(function(t,e){var o=Ys(n.serializer,e);r=r.nt(o.key,o),i=e.readTime})).next((function(){return{Gs:r,readTime:Zs(i)}}))},t.prototype.zs=function(t){var e=aa(t),n=Ar.min();return e.Qs({index:La.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Zs(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.Hs=function(e){return new t.Ys(this,!!e&&e.Js)},t.prototype.Xs=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return sa(t).get(Fa.key).next((function(t){return fr(!!t),t}))},t.prototype.xs=function(t,e){return sa(t).put(Fa.key,e)},t.prototype.Ms=function(t){if(t){var e=Ys(this.serializer,t);return e instanceof ts&&e.version.isEqual(Ar.min())?null:e}return null},t}();function sa(t){return ga.Ns(t,Fa.store)}function aa(t){return ga.Ns(t,La.store)}function ca(t){return t.path.F()}function ua(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw hr();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */oa.Ys=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Zs=e,r.Js=n,r.ti=new Er((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(i.c)(e,t),e.prototype.qn=function(t){var e=this,n=[],r=0,i=new Jr((function(t,e){return yr(t.$(),e.$())}));return this.Cn.forEach((function(o,s){var a=e.ti.get(o);if(s){var c=Xs(e.Zs.serializer,s,e.readTime);i=i.add(o.path.p());var u=ua(c);r+=u-a,n.push(e.Zs.Nn(t,o,c))}else if(r-=a,e.Js){var l=Xs(e.Zs.serializer,new ts(o,Ar.min()),e.readTime);n.push(e.Zs.Nn(t,o,l))}else n.push(e.Zs.xn(t,o))})),i.forEach((function(r){n.push(e.Zs.Kn.Cs(t,r))})),n.push(this.Zs.updateMetadata(t,r)),Ps.Sn(n)},e.prototype.On=function(t,e){var n=this;return this.Zs.Os(t,e).next((function(t){return null===t?(n.ti.set(e,0),null):(n.ti.set(e,t.size),t.Ls)}))},e.prototype.Ln=function(t,e){var n=this;return this.Zs.Bs(t,e).next((function(t){var e=t.Us;return t.Ws.forEach((function(t,e){n.ti.set(t,e)})),e}))},e}(js);var la=function(){function t(t){this.ei=t}return t.prototype.next=function(){return this.ei+=2,this.ei},t.ni=function(){return new t(0)},t.si=function(){return new t(-1)},t}(),ha=function(){function t(t,e){this.ii=t,this.serializer=e}return t.prototype.ri=function(t){var e=this;return this.oi(t).next((function(n){var r=new la(n.highestTargetId);return n.highestTargetId=r.next(),e.hi(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.ai=function(t){return this.oi(t).next((function(t){return Ar.I(new Ir(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.ui=function(t){return this.oi(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ci=function(t,e,n){var r=this;return this.oi(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.hi(t,i)}))},t.prototype.li=function(t,e){var n=this;return this._i(t,e).next((function(){return n.oi(t).next((function(r){return r.targetCount+=1,n.fi(e,r),n.hi(t,r)}))}))},t.prototype.di=function(t,e){return this._i(t,e)},t.prototype.wi=function(t,e){var n=this;return this.Ti(t,e.targetId).next((function(){return fa(t).delete(e.targetId)})).next((function(){return n.oi(t)})).next((function(e){return fr(e.targetCount>0),e.targetCount-=1,n.hi(t,e)}))},t.prototype.Ei=function(t,e,n){var r=this,i=0,o=[];return fa(t).Qs((function(s,a){var c=ra(a);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(i++,o.push(r.wi(t,c)))})).next((function(){return Ps.Sn(o)})).next((function(){return i}))},t.prototype.pe=function(t,e){return fa(t).Qs((function(t,n){var r=ra(n);e(r)}))},t.prototype.oi=function(t){return pa(t).get(Va.key).next((function(t){return fr(null!==t),t}))},t.prototype.hi=function(t,e){return pa(t).put(Va.key,e)},t.prototype._i=function(t,e){return fa(t).put(ia(this.serializer,e))},t.prototype.fi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Ii=function(t){return this.oi(t).next((function(t){return t.targetCount}))},t.prototype.mi=function(t,e){var n=Fr(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return fa(t).Qs({range:r,index:Ba.queryTargetsIndexName},(function(t,n,r){var o=ra(n);Br(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Ai=function(t,e,n){var r=this,i=[],o=da(t);return e.forEach((function(e){var s=Us(e.path);i.push(o.put(new Ua(n,s))),i.push(r.ii.Ri(t,n,e))})),Ps.Sn(i)},t.prototype.Pi=function(t,e,n){var r=this,i=da(t);return Ps.forEach(e,(function(e){var o=Us(e.path);return Ps.Sn([i.delete([n,o]),r.ii.gi(t,n,e)])}))},t.prototype.Ti=function(t,e){var n=da(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Vi=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=da(t),i=ai();return r.Qs({range:n,yi:!0},(function(t,e,n){var r=Ws(t[1]),o=new jr(r);i=i.add(o)})).next((function(){return i}))},t.prototype.pi=function(t,e){var n=Us(e.path),r=IDBKeyRange.bound([n],[vr(n)],!1,!0),i=0;return da(t).Qs({index:Ua.documentTargetsIndex,yi:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Me=function(t,e){return fa(t).get(e).next((function(t){return t?ra(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fa(t){return ga.Ns(t,Ba.store)}function pa(t){return ga.Ns(t,Va.store)}function da(t){return ga.Ns(t,Ua.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ma="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ya=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).bi=e,r.vi=n,r}return Object(i.c)(e,t),e}(Ms),ga=function(){function t(e,n,r,i,o,s,a,c,u,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Ts=o,this.window=s,this.document=a,this.Si=u,this.Di=l,this.Ci=null,this.Fi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.$i=null,this.inForeground=!1,this.Ni=null,this.ki=null,this.xi=Number.NEGATIVE_INFINITY,this.Mi=function(t){return Promise.resolve()},!t.Oi())throw new Cr(Tr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.ii=new _a(this,i),this.Li=n+"main",this.serializer=new Qs(c),this.qi=new ha(this.ii,this.serializer),this.Kn=new Ks,this.Qn=new oa(this.serializer,this.Kn),this.window&&this.window.localStorage?this.Bi=this.window.localStorage:(this.Bi=null,!1===l&&ur("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Ns=function(t,e){if(t instanceof ya)return Ka.Ns(t.bi,e);throw hr()},t.prototype.start=function(){var t=this;return Ka.Ui(this.Li,ka,new xa(this.serializer)).then((function(e){return t.Wi=e,t.Qi()})).then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Cr(Tr.FAILED_PRECONDITION,ma);return t.ji(),t.Ki(),t.Gi(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qi.ui(e)}))})).then((function(e){t.Ci=new Ls(e,t.Si)})).then((function(){t.Fi=!0})).catch((function(e){return t.Wi&&t.Wi.close(),Promise.reject(e)}))},t.prototype.zi=function(t){var e=this;return this.Mi=function(n){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.Hi?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Yi=function(t){var e=this;this.Wi.Ji((function(n){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Xi=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Ts.Zi((function(){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.Hi?[4,this.Qi()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Qi=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return ba(e).put(new za(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.tr(e).next((function(e){e||(t.isPrimary=!1,t.Ts.er((function(){return t.Mi(!1)})))}))})).next((function(){return t.nr(e)})).next((function(n){return t.isPrimary&&!n?t.sr(e).next((function(){return!1})):!!n&&t.ir(e).next((function(){return!0}))}))})).catch((function(e){if(Ya(e))return cr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return cr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Ts.er((function(){return t.Mi(e)})),t.isPrimary=e}))},t.prototype.tr=function(t){var e=this;return va(t).get(Pa.key).next((function(t){return Ps.resolve(e.rr(t))}))},t.prototype.or=function(t){return ba(t).delete(this.clientId)},t.prototype.hr=function(){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.ar(this.xi,18e5)?[3,2]:(this.xi=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Ns(e,za.store);return n.$s().next((function(t){var e=s.ur(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Ps.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=i.sent(),this.Bi)for(n=0,r=e;n<r.length;n++)o=r[n],this.Bi.removeItem(this.cr(o.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.Gi=function(){var t=this;this.ki=this.Ts.bs("client_metadata_refresh",4e3,(function(){return t.Qi().then((function(){return t.hr()})).then((function(){return t.Gi()}))}))},t.prototype.rr=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.nr=function(t){var e=this;return this.Di?Ps.resolve(!0):va(t).get(Pa.key).next((function(n){if(null!==n&&e.ar(n.leaseTimestampMs,5e3)&&!e.lr(n.ownerId)){if(e.rr(n)&&e.networkEnabled)return!0;if(!e.rr(n)){if(!n.allowTabSynchronization)throw new Cr(Tr.FAILED_PRECONDITION,ma);return!1}}return!(!e.networkEnabled||!e.inForeground)||ba(t).$s().next((function(t){return void 0===e.ur(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&cr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype._r=function(){return Object(i.b)(this,void 0,void 0,(function(){var t=this;return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.Fi=!1,this.dr(),this.ki&&(this.ki.cancel(),this.ki=null),this.wr(),this.Tr(),[4,this.runTransaction("shutdown","readwrite",(function(e){return t.sr(e).next((function(){return t.or(e)}))})).catch((function(t){cr("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}))];case 1:return e.sent(),this.Wi.close(),this.Er(),[2]}}))}))},t.prototype.ur=function(t,e){var n=this;return t.filter((function(t){return n.ar(t.updateTimeMs,e)&&!n.lr(t.clientId)}))},t.prototype.Ir=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return ba(e).$s().next((function(e){return t.ur(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Hi",{get:function(){return this.Fi},enumerable:!1,configurable:!0}),t.prototype.mr=function(t){return Oa.Ar(t,this.serializer,this.Kn,this.ii)},t.prototype.Rr=function(){return this.qi},t.prototype.Pr=function(){return this.Qn},t.prototype.gr=function(){return this.Kn},t.prototype.runTransaction=function(t,e,n){var r=this;cr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Wi.runTransaction(o,Ha,(function(o){return i=new ya(o,r.Ci?r.Ci.next():Ls.ws),"readwrite-primary"===e?r.tr(i).next((function(t){return!!t||r.nr(i)})).next((function(e){if(!e)throw ur("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Ts.er((function(){return r.Mi(!1)})),new Cr(Tr.FAILED_PRECONDITION,Rs);return n(i)})).next((function(t){return r.ir(i).next((function(){return t}))})):r.Vr(i).next((function(){return n(i)}))})).then((function(t){return i.Wn(),t}))},t.prototype.Vr=function(t){var e=this;return va(t).get(Pa.key).next((function(t){if(null!==t&&e.ar(t.leaseTimestampMs,5e3)&&!e.lr(t.ownerId)&&!e.rr(t)&&!(e.Di||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Cr(Tr.FAILED_PRECONDITION,ma)}))},t.prototype.ir=function(t){var e=new Pa(this.clientId,this.allowTabSynchronization,Date.now());return va(t).put(Pa.key,e)},t.Oi=function(){return Ka.Oi()},t.prototype.sr=function(t){var e=this,n=va(t);return n.get(Pa.key).next((function(t){return e.rr(t)?(cr("IndexedDbPersistence","Releasing primary lease."),n.delete(Pa.key)):Ps.resolve()}))},t.prototype.ar=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(ur("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.ji=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=function(){t.Ts.Zi((function(){return t.inForeground="visible"===t.document.visibilityState,t.Qi()}))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)},t.prototype.wr=function(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)},t.prototype.Ki=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.$i=function(){e.dr(),e.Ts.Zi((function(){return e._r()}))},this.window.addEventListener("unload",this.$i))},t.prototype.Tr=function(){this.$i&&(this.window.removeEventListener("unload",this.$i),this.$i=null)},t.prototype.lr=function(t){var e;try{var n=null!==(null===(e=this.Bi)||void 0===e?void 0:e.getItem(this.cr(t)));return cr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return ur("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.dr=function(){if(this.Bi)try{this.Bi.setItem(this.cr(this.clientId),String(Date.now()))}catch(t){ur("Failed to set zombie client id.",t)}},t.prototype.Er=function(){if(this.Bi)try{this.Bi.removeItem(this.cr(this.clientId))}catch(t){}},t.prototype.cr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function va(t){return ga.Ns(t,Pa.store)}function ba(t){return ga.Ns(t,za.store)}var _a=function(){function t(t,e){this.db=t,this.yr=new hc(this,e)}return t.prototype.pr=function(t){var e=this.br(t);return this.db.Rr().Ii(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.br=function(t){var e=0;return this.vr(t,(function(t){e++})).next((function(){return e}))},t.prototype.pe=function(t,e){return this.db.Rr().pe(t,e)},t.prototype.vr=function(t,e){return this.Sr(t,(function(t,n){return e(n)}))},t.prototype.Ri=function(t,e,n){return wa(t,n)},t.prototype.gi=function(t,e,n){return wa(t,n)},t.prototype.Ei=function(t,e,n){return this.db.Rr().Ei(t,e,n)},t.prototype.Dr=function(t,e){return wa(t,e)},t.prototype.Cr=function(t,e){return function(t,e){var n=!1;return Aa(t).Fr((function(r){return Ea(t,r,e).next((function(t){return t&&(n=!0),Ps.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.$r=function(t,e){var n=this,r=this.db.Pr().Hs(),i=[],o=0;return this.Sr(t,(function(s,a){if(a<=e){var c=n.Cr(t,s).next((function(e){if(!e)return o++,r.Mn(t,s).next((function(){return r.xn(s),da(t).delete([0,Us(s.path)])}))}));i.push(c)}})).next((function(){return Ps.Sn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Z(t.vi);return this.db.Rr().di(t,n)},t.prototype.Nr=function(t,e){return wa(t,e)},t.prototype.Sr=function(t,e){var n,r=da(t),i=Ls.ws;return r.Qs({index:Ua.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==Ls.ws&&e(new jr(Ws(n)),i),i=a,n=s):i=Ls.ws})).next((function(){i!==Ls.ws&&e(new jr(Ws(n)),i)}))},t.prototype.kr=function(t){return this.db.Pr().Xs(t)},t}();function wa(t,e){return da(t).put(function(t,e){return new Ua(0,Us(t.path),e)}(e,t.vi))}function Sa(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var Oa=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Kn=n,this.ii=r,this.xr={}}return t.Ar=function(e,n,r,i){return fr(""!==e.uid),new t(e.Mr()?e.uid:"",n,r,i)},t.prototype.Or=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ca(t).Qs({index:Ra.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Lr=function(t,e,n,r){var i=this,o=Ia(t),s=Ca(t);return s.add({}).next((function(a){fr("number"==typeof a);for(var c=new xs(a,e,n,r),u=function(t,e,n){var r=n.baseMutations.map((function(e){return oo(t.ks,e)})),i=n.mutations.map((function(e){return oo(t.ks,e)}));return new Ra(e,n.batchId,n.dn.toMillis(),r,i)}(i.serializer,i.userId,c),l=[],h=new Jr((function(t,e){return yr(t.$(),e.$())})),f=0,p=r;f<p.length;f++){var d=p[f],m=Ma.key(i.userId,d.key.path,a);h=h.add(d.key.path.p()),l.push(s.put(u)),l.push(o.put(m,Ma.PLACEHOLDER))}return h.forEach((function(e){l.push(i.Kn.Cs(t,e))})),t.Un((function(){i.xr[a]=c.keys()})),Ps.Sn(l).next((function(){return c}))}))},t.prototype.qr=function(t,e){var n=this;return Ca(t).get(e).next((function(t){return t?(fr(t.userId===n.userId),na(n.serializer,t)):null}))},t.prototype.Br=function(t,e){var n=this;return this.xr[e]?Ps.resolve(this.xr[e]):this.qr(t,e).next((function(t){if(t){var r=t.keys();return n.xr[e]=r,r}return null}))},t.prototype.Ur=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ca(t).Qs({index:Ra.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(fr(e.batchId>=r),o=na(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Wr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ca(t).Qs({index:Ra.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.Qr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ca(t).$s(Ra.userMutationsIndex,n).next((function(t){return t.map((function(t){return na(e.serializer,t)}))}))},t.prototype.zn=function(t,e){var n=this,r=Ma.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Ia(t).Qs({range:i},(function(r,i,s){var a=r[0],c=r[1],u=r[2],l=Ws(c);if(a===n.userId&&e.path.isEqual(l))return Ca(t).get(u).next((function(t){if(!t)throw hr();fr(t.userId===n.userId),o.push(na(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.Zn=function(t,e){var n=this,r=new Jr(yr),i=[];return e.forEach((function(e){var o=Ma.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Ia(t).Qs({range:s},(function(t,i,o){var s=t[0],a=t[1],c=t[2],u=Ws(a);s===n.userId&&e.path.isEqual(u)?r=r.add(c):o.done()}));i.push(a)})),Ps.Sn(i).next((function(){return n.jr(t,r)}))},t.prototype.os=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ma.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Jr(yr);return Ia(t).Qs({range:s},(function(t,e,o){var s=t[0],c=t[1],u=t[2],l=Ws(c);s===n.userId&&r.D(l)?l.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.jr(t,a)}))},t.prototype.jr=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ca(t).get(e).next((function(t){if(null===t)throw hr();fr(t.userId===n.userId),r.push(na(n.serializer,t))})))})),Ps.Sn(i).next((function(){return r}))},t.prototype.Kr=function(t,e){var n=this;return Ta(t.bi,this.userId,e).next((function(r){return t.Un((function(){n.Gr(e.batchId)})),Ps.forEach(r,(function(e){return n.ii.Dr(t,e)}))}))},t.prototype.Gr=function(t){delete this.xr[t]},t.prototype.zr=function(t){var e=this;return this.Or(t).next((function(n){if(!n)return Ps.resolve();var r=IDBKeyRange.lowerBound(Ma.prefixForUser(e.userId)),i=[];return Ia(t).Qs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ws(t[1]);i.push(o)}else r.done()})).next((function(){fr(0===i.length)}))}))},t.prototype.pi=function(t,e){return Ea(t,this.userId,e)},t.prototype.Hr=function(t){var e=this;return Aa(t).get(this.userId).next((function(t){return t||new ja(e.userId,-1,"")}))},t}();function Ea(t,e,n){var r=Ma.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Ia(t).Qs({range:o,yi:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Ta(t,e,n){var r=t.store(Ra.store),i=t.store(Ma.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,c=r.Qs({range:s},(function(t,e,n){return a++,n.delete()}));o.push(c.next((function(){fr(1===a)})));for(var u=[],l=0,h=n.mutations;l<h.length;l++){var f=h[l],p=Ma.key(e,f.key.path,n.batchId);o.push(i.delete(p)),u.push(f.key)}return Ps.Sn(o).next((function(){return u}))}function Ca(t){return ga.Ns(t,Ra.store)}function Ia(t){return ga.Ns(t,Ma.store)}function Aa(t){return ga.Ns(t,ja.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ka=10,xa=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;fr(n<r&&n>=0&&r<=ka);var o=new Xa(e);n<1&&r>=1&&(function(t){t.createObjectStore(Pa.store)}(t),function(t){t.createObjectStore(ja.store,{keyPath:ja.keyPath}),t.createObjectStore(Ra.store,{keyPath:Ra.keyPath,autoIncrement:!0}).createIndex(Ra.userMutationsIndex,Ra.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ma.store)}(t),Wa(t),function(t){t.createObjectStore(La.store)}(t));var s=Ps.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ua.store),t.deleteObjectStore(Ba.store),t.deleteObjectStore(Va.store)}(t),Wa(t)),s=s.next((function(){return function(t){var e=t.store(Va.store),n=new Va(0,0,Ar.min().A(),0);return e.put(Va.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Ra.store).$s().next((function(n){t.deleteObjectStore(Ra.store),t.createObjectStore(Ra.store,{keyPath:Ra.keyPath,autoIncrement:!0}).createIndex(Ra.userMutationsIndex,Ra.userMutationsKeyPath,{unique:!0});var r=e.store(Ra.store),i=n.map((function(t){return r.put(t)}));return Ps.Sn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(za.store,{keyPath:za.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Fa.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(La.store);e.createIndex(La.readTimeIndex,La.readTimeIndexPath,{unique:!1}),e.createIndex(La.collectionReadTimeIndex,La.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(La.store).Qs((function(t,n){e+=ua(n)})).next((function(){var n=new Fa(e);return t.store(Fa.store).put(Fa.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(ja.store),r=t.store(Ra.store);return n.$s().next((function(n){return Ps.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.$s(Ra.userMutationsIndex,i).next((function(r){return Ps.forEach(r,(function(r){fr(r.userId===n.userId);var i=na(e.serializer,r);return Ta(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Ua.store),n=t.store(La.store);return t.store(Va.store).get(Va.key).next((function(t){var r=[];return n.Qs((function(n,i){var o=new xr(n),s=function(t){return[0,Us(t)]}(o);r.push(e.get(s).next((function(n){return n?Ps.resolve():function(n){return e.put(new Ua(0,Us(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Ps.Sn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(qa.store,{keyPath:qa.keyPath});var n=e.store(qa.store),r=new Hs,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:Us(i)})}};return e.store(La.store).Qs({yi:!0},(function(t,e){var n=new xr(t);return i(n.p())})).next((function(){return e.store(Ma.store).Qs({yi:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Ws(n));return i(r.p())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ba.store);return n.Qs((function(t,r){var i=ra(r),o=ia(e.serializer,i);return n.put(o)}))},t}(),Na=function(t,e){this.seconds=t,this.nanoseconds=e},Pa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Pa.store="owner",Pa.key="owner";var ja=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ja.store="mutationQueues",ja.keyPath="userId";var Ra=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ra.store="mutations",Ra.keyPath="batchId",Ra.userMutationsIndex="userMutationsIndex",Ra.userMutationsKeyPath=["userId","batchId"];var Ma=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Us(e)]},t.key=function(t,e,n){return[t,Us(e),n]},t}();Ma.store="documentMutations",Ma.PLACEHOLDER=new Ma;var Da=function(t,e){this.path=t,this.readTime=e},$a=function(t,e){this.path=t,this.version=e},La=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};La.store="remoteDocuments",La.readTimeIndex="readTimeIndex",La.readTimeIndexPath="readTime",La.collectionReadTimeIndex="collectionReadTimeIndex",La.collectionReadTimeIndexPath=["parentPath","readTime"];var Fa=function(t){this.byteSize=t};Fa.store="remoteDocumentGlobal",Fa.key="remoteDocumentGlobalKey";var Ba=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ba.store="targets",Ba.keyPath="targetId",Ba.queryTargetsIndexName="queryTargetsIndex",Ba.queryTargetsKeyPath=["canonicalId","targetId"];var Ua=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ua.store="targetDocuments",Ua.keyPath=["targetId","path"],Ua.documentTargetsIndex="documentTargetsIndex",Ua.documentTargetsKeyPath=["path","targetId"];var Va=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Va.key="targetGlobalKey",Va.store="targetGlobal";var qa=function(t,e){this.collectionId=t,this.parent=e};function Wa(t){t.createObjectStore(Ua.store,{keyPath:Ua.keyPath}).createIndex(Ua.documentTargetsIndex,Ua.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ba.store,{keyPath:Ba.keyPath}).createIndex(Ba.queryTargetsIndexName,Ba.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Va.store)}qa.store="collectionParents",qa.keyPath=["collectionId","parent"];var za=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};za.store="clientMetadata",za.keyPath="clientId";var Ha=Object(i.g)(Object(i.g)(Object(i.g)([ja.store,Ra.store,Ma.store,La.store,Ba.store,Pa.store,Va.store,Ua.store],[za.store]),[Fa.store]),[qa.store]),Ka=function(){function t(e){this.db=e,12.2===t.Yr(Object(s.p)())&&ur("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.Ui=function(e,n,r){return cr("SimpleDb","Opening database:",e),new Ps((function(i,o){var s=indexedDB.open(e,n);s.onsuccess=function(e){var n=e.target.result;i(new t(n))},s.onblocked=function(){o(new Cr(Tr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new Cr(Tr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},s.onupgradeneeded=function(t){cr("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;r.createOrUpgrade(n,s.transaction,t.oldVersion,ka).next((function(){cr("SimpleDb","Database upgrade to version "+ka+" complete")}))}})).bn()},t.delete=function(t){return cr("SimpleDb","Removing database:",t),Za(window.indexedDB.deleteDatabase(t)).bn()},t.Oi=function(){if("undefined"==typeof indexedDB)return!1;if(t.Jr())return!0;var e=Object(s.p)(),n=t.Yr(e),r=0<n&&n<10,i=t.Xr(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.Jr=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Zr)},t.Ns=function(t,e){return t.store(e)},t.Yr=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Xr=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Ji=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a,c;return Object(i.d)(this,(function(u){switch(u.label){case 0:r="readonly"===t,o=0,s=function(){var t,s,c,u,l;return Object(i.d)(this,(function(i){switch(i.label){case 0:++o,t=Xa.open(a.db,r?"readonly":"readwrite",e),i.label=1;case 1:return i.trys.push([1,3,,4]),s=n(t).catch((function(e){return t.abort(e),Ps.reject(e)})).bn(),c={},s.catch((function(){})),[4,t.to];case 2:return[2,(c.value=(i.sent(),s),c)];case 3:return u=i.sent(),l="FirebaseError"!==u.name&&o<3,cr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",u.message,l),l?[3,4]:[2,{value:Promise.reject(u)}];case 4:return[2]}}))},a=this,u.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=u.sent()))return[2,c.value];u.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db.close()},t}(),Ga=function(){function t(t){this.eo=t,this.no=!1,this.so=null}return Object.defineProperty(t.prototype,"gn",{get:function(){return this.no},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"io",{get:function(){return this.so},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.eo=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.no=!0},t.prototype.js=function(t){this.so=t},t.prototype.delete=function(){return Za(this.eo.delete())},t}(),Qa=function(t){function e(e){var n=this;return(n=t.call(this,Tr.UNAVAILABLE,"IndexedDB transaction failed: "+e)||this).name="IndexedDbTransactionError",n}return Object(i.c)(e,t),e}(Cr);function Ya(t){return"IndexedDbTransactionError"===t.name}var Xa=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.ro=new Fs,this.transaction.oncomplete=function(){e.ro.resolve()},this.transaction.onabort=function(){t.error?e.ro.reject(new Qa(t.error)):e.ro.resolve()},this.transaction.onerror=function(t){var n=ec(t.target.error);e.ro.reject(new Qa(n))}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"to",{get:function(){return this.ro.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ro.reject(t),this.aborted||(cr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ja(e)},t}(),Ja=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(cr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(cr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Za(n)},t.prototype.add=function(t){return cr("SimpleDb","ADD",this.store.name,t,t),Za(this.store.add(t))},t.prototype.get=function(t){var e=this;return Za(this.store.get(t)).next((function(n){return void 0===n&&(n=null),cr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return cr("SimpleDb","DELETE",this.store.name,t),Za(this.store.delete(t))},t.prototype.count=function(){return cr("SimpleDb","COUNT",this.store.name),Za(this.store.count())},t.prototype.$s=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.oo(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.ho=function(t,e){cr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.yi=!1;var r=this.cursor(n);return this.oo(r,(function(t,e,n){return n.delete()}))},t.prototype.Qs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.oo(r,e)},t.prototype.Fr=function(t){var e=this.cursor({});return new Ps((function(n,r){e.onerror=function(t){var e=ec(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.oo=function(t,e){var n=[];return new Ps((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ga(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ps){var a=s.catch((function(t){return o.done(),Ps.reject(t)}));n.push(a)}o.gn?r():null===o.io?i.continue():i.continue(o.io)}else r()}})).next((function(){return Ps.Sn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.yi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Za(t){return new Ps((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ec(t.target.error);n(e)}}))}var tc=!1;function ec(t){var e=Ka.Yr(Object(s.p)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Cr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return tc||(tc=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(){return"undefined"!=typeof window?window:null}var rc=function(){function t(t,e,n,r,i){this.ao=t,this.Es=e,this.uo=n,this.op=r,this.co=i,this.lo=new Fs,this.then=this.lo.promise.then.bind(this.lo.promise),this.lo.promise.catch((function(t){}))}return t._o=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.fo=setTimeout((function(){return e.do()}),t)},t.prototype.Ss=function(){return this.do()},t.prototype.cancel=function(t){null!==this.fo&&(this.clearTimeout(),this.lo.reject(new Cr(Tr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.do=function(){var t=this;this.ao.Zi((function(){return null!==t.fo?(t.clearTimeout(),t.op().then((function(e){return t.lo.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.fo&&(this.co(this),clearTimeout(this.fo),this.fo=null)},t}(),ic=function(){function t(){var t=this;this.wo=Promise.resolve(),this.To=[],this.Eo=!1,this.Io=[],this.mo=null,this.Ao=!1,this.Ro=[],this.Po=new Bs(this,"async_queue_retry"),this.Vo=function(){return t.Po.vs()};var e=nc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vo)}return Object.defineProperty(t.prototype,"yo",{get:function(){return this.Eo},enumerable:!1,configurable:!0}),t.prototype.Zi=function(t){this.enqueue(t)},t.prototype.po=function(t){this.bo(),this.vo(t)},t.prototype.So=function(t){return this.bo(),this.vo(t)},t.prototype.Do=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return this.bo(),this.Eo?[3,2]:(this.Eo=!0,(e=nc())&&e.removeEventListener("visibilitychange",this.Vo),[4,this.So(t)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.bo(),this.Eo?new Promise((function(t){})):this.vo(t)},t.prototype.er=function(t){var e=this;this.To.push(t),this.Zi((function(){return e.Co()}))},t.prototype.Co=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){switch(n.label){case 0:if(0===this.To.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.To[0]()];case 2:return n.sent(),this.To.shift(),this.Po.reset(),[3,4];case 3:if(!Ya(t=n.sent()))throw t;return cr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.To.length>0&&this.Po.ys((function(){return e.Co()})),n.label=5;case 5:return[2]}}))}))},t.prototype.vo=function(t){var e=this,n=this.wo.then((function(){return e.Ao=!0,t().catch((function(t){throw e.mo=t,e.Ao=!1,ur("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Ao=!1,t}))}));return this.wo=n,n},t.prototype.bs=function(t,e,n){var r=this;this.bo(),this.Ro.indexOf(t)>-1&&(e=0);var i=rc._o(this,t,e,n,(function(t){return r.Fo(t)}));return this.Io.push(i),i},t.prototype.bo=function(){this.mo&&hr()},t.prototype.$o=function(){},t.prototype.No=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.wo];case 1:e.sent(),e.label=2;case 2:if(t!==this.wo)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.ko=function(t){for(var e=0,n=this.Io;e<n.length;e++)if(n[e].Es===t)return!0;return!1},t.prototype.xo=function(t){var e=this;return this.No().then((function(){e.Io.sort((function(t,e){return t.uo-e.uo}));for(var n=0,r=e.Io;n<r.length;n++){var i=r[n];if(i.Ss(),"all"!==t&&i.Es===t)break}return e.No()}))},t.prototype.Mo=function(t){this.Ro.push(t)},t.prototype.Fo=function(t){var e=this.Io.indexOf(t);this.Io.splice(e,1)},t}();function oc(t,e){if(ur("AsyncQueue",e+": "+t),Ya(t))return new Cr(Tr.UNAVAILABLE,e+": "+t);throw t}function sc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=yr(n,i);return 0===s?yr(r,o):s}var ac=function(){function t(t){this.Oo=t,this.buffer=new Jr(sc),this.Lo=0}return t.prototype.qo=function(){return++this.Lo},t.prototype.Bo=function(t){var e=[t,this.qo()];if(this.buffer.size<this.Oo)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();sc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),cc={Uo:!1,Wo:0,Qo:0,jo:0},uc=function(){function t(t,e,n){this.Ko=t,this.Go=e,this.zo=n}return t.Ho=function(e){return new t(e,t.Yo,t.Jo)},t}();uc.Xo=-1,uc.Zo=1048576,uc.th=41943040,uc.Yo=10,uc.Jo=1e3,uc.eh=new uc(uc.th,uc.Yo,uc.Jo),uc.nh=new uc(uc.Xo,0,0);var lc=function(){function t(t,e){this.yr=t,this.ao=e,this.sh=!1,this.ih=null}return t.prototype.start=function(t){this.yr.params.Ko!==uc.Xo&&this.rh(t)},t.prototype.stop=function(){this.ih&&(this.ih.cancel(),this.ih=null)},Object.defineProperty(t.prototype,"Hi",{get:function(){return null!==this.ih},enumerable:!1,configurable:!0}),t.prototype.rh=function(t){var e=this,n=this.sh?3e5:6e4;cr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ih=this.ao.bs("lru_garbage_collection",n,(function(){return Object(i.b)(e,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:this.ih=null,this.sh=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.oh(this.yr)];case 2:return n.sent(),[3,7];case 3:return Ya(e=n.sent())?(cr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,mc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.rh(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),hc=function(){function t(t,e){this.hh=t,this.params=e}return t.prototype.ah=function(t,e){return this.hh.pr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.uh=function(t,e){var n=this;if(0===e)return Ps.resolve(Ls.ws);var r=new ac(e);return this.hh.pe(t,(function(t){return r.Bo(t.sequenceNumber)})).next((function(){return n.hh.vr(t,(function(t){return r.Bo(t)}))})).next((function(){return r.maxValue}))},t.prototype.Ei=function(t,e,n){return this.hh.Ei(t,e,n)},t.prototype.$r=function(t,e){return this.hh.$r(t,e)},t.prototype.lh=function(t,e){var n=this;return this.params.Ko===uc.Xo?(cr("LruGarbageCollector","Garbage collection skipped; disabled"),Ps.resolve(cc)):this.kr(t).next((function(r){return r<n.params.Ko?(cr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Ko),cc):n._h(t,e)}))},t.prototype.kr=function(t){return this.hh.kr(t)},t.prototype._h=function(t,e){var n,r,i,s,a,c,u,l=this,h=Date.now();return this.ah(t,this.params.Go).next((function(e){return e>l.params.zo?(cr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.zo+" from "+e),r=l.params.zo):r=e,s=Date.now(),l.uh(t,r)})).next((function(r){return n=r,a=Date.now(),l.Ei(t,n,e)})).next((function(e){return i=e,c=Date.now(),l.$r(t,n)})).next((function(t){return u=Date.now(),ar()<=o.a.DEBUG&&cr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-s)+"ms\n\tRemoved "+i+" targets in "+(c-a)+"ms\n\tRemoved "+t+" documents in "+(u-c)+"ms\nTotal Duration: "+(u-h)+"ms"),Ps.resolve({Uo:!0,Wo:r,Qo:i,jo:t})}))},t}(),fc=function(){function t(t,e,n){this.persistence=t,this.fh=e,this.dh=new Qr(yr),this.wh=new Er((function(t){return Fr(t)}),Br),this.Th=Ar.min(),this.jn=t.mr(n),this.Eh=t.Pr(),this.qi=t.Rr(),this.Ih=new Ds(this.Eh,this.jn,this.persistence.gr()),this.fh.mh(this.Ih)}return t.prototype.Ah=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=this.jn,n=this.Ih,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var i;return o.jn.Qr(r).next((function(s){return i=s,e=o.persistence.mr(t),n=new Ds(o.Eh,e,o.persistence.gr()),e.Qr(r)})).next((function(t){for(var e=[],o=[],s=ai(),a=0,c=i;a<c.length;a++){var u=c[a];e.push(u.batchId);for(var l=0,h=u.mutations;l<h.length;l++){var f=h[l];s=s.add(f.key)}}for(var p=0,d=t;p<d.length;p++){var m=d[p];o.push(m.batchId);for(var y=0,g=m.mutations;y<g.length;y++){var v=g[y];s=s.add(v.key)}}return n.Jn(r,s).next((function(t){return{Rh:t,Ph:e,gh:o}}))}))}))];case 1:return r=i.sent(),[2,(this.jn=e,this.Ih=n,this.fh.mh(this.Ih),r)]}}))}))},t.prototype.Vh=function(t){var e,n=this,r=Ir.now(),i=t.reduce((function(t,e){return t.add(e.key)}),ai());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.Ih.Jn(o,i).next((function(i){e=i;for(var s=[],a=0,c=t;a<c.length;a++){var u=c[a],l=Lo(u,e.get(u.key));null!=l&&s.push(new Vo(u.key,l,Xo(l.proto.mapValue),jo.exists(!0)))}return n.jn.Lr(o,r,s,t)}))})).then((function(t){var n=t.In(e);return{batchId:t.batchId,Cn:n}}))},t.prototype.yh=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.Eh.Hs({Js:!0});return e.ph(n,t,i).next((function(){return i.apply(n)})).next((function(){return e.jn.zr(n)})).next((function(){return e.Ih.Jn(n,r)}))}))},t.prototype.bh=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.jn.qr(n,t).next((function(t){return fr(null!==t),r=t.keys(),e.jn.Kr(n,t)})).next((function(){return e.jn.zr(n)})).next((function(){return e.Ih.Jn(n,r)}))}))},t.prototype.Wr=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.jn.Wr(e)}))},t.prototype.ai=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.qi.ai(e)}))},t.prototype.vh=function(e){var n=this,r=e.X,i=this.dh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(o){var s=n.Eh.Hs({Js:!0});i=n.dh;var a=[];e.Wt.forEach((function(e,s){var c=i.get(s);if(c){a.push(n.qi.Pi(o,e.Xt,s).next((function(){return n.qi.Ai(o,e.Yt,s)})));var u=e.resumeToken;if(u.H()>0){var l=c.tt(u,r).Z(o.vi);i=i.nt(s,l),t.Sh(c,l,e)&&a.push(n.qi.di(o,l))}}}));var c=ei(),u=ai();if(e.jt.forEach((function(t,e){u=u.add(t)})),a.push(s.getEntries(o,u).next((function(t){e.jt.forEach((function(i,u){var l=t.get(i);u instanceof ts&&u.version.isEqual(Ar.min())?(s.xn(i,r),c=c.nt(i,u)):null==l||u.version.o(l.version)>0||0===u.version.o(l.version)&&l.hasPendingWrites?(s.Nn(u,r),c=c.nt(i,u)):cr("LocalStore","Ignoring outdated watch update for ",i,". Current version:",l.version," Watch version:",u.version),e.Kt.has(i)&&a.push(n.persistence.ii.Nr(o,i))}))}))),!r.isEqual(Ar.min())){var l=n.qi.ai(o).next((function(t){return n.qi.ci(o,o.vi,r)}));a.push(l)}return Ps.Sn(a).next((function(){return s.apply(o)})).next((function(){return n.Ih.Xn(o,c)}))})).then((function(t){return n.dh=i,t}))},t.Sh=function(t,e,n){return fr(e.resumeToken.H()>0),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.Dh||n.Yt.size+n.Jt.size+n.Xt.size>0},t.prototype.Ch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,a,c,u,l=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Ps.forEach(t,(function(t){return Ps.forEach(t.as,(function(n){return l.persistence.ii.Ri(e,t.targetId,n)})).next((function(){return Ps.forEach(t.us,(function(n){return l.persistence.ii.gi(e,t.targetId,n)}))}))}))}))];case 1:return i.sent(),[3,3];case 2:if(!Ya(e=i.sent()))throw e;return cr("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=t;n<r.length;n++)o=r[n],s=o.targetId,o.fromCache||(a=this.dh.get(s),c=a.X,u=a.et(c),this.dh=this.dh.nt(s,u));return[2]}}))}))},t.prototype.Fh=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.jn.Ur(n,t)}))},t.prototype.$h=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.Ih.Gn(n,t)}))},t.prototype.Nh=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.qi.mi(n,t).next((function(i){return i?(r=i,Ps.resolve(r)):e.qi.ri(n).next((function(i){return r=new zr(t,i,0,n.vi),e.qi.li(n,r).next((function(){return r}))}))}))})).then((function(n){var r=e.dh.get(n.targetId);return(null===r||n.X.o(r.X)>0)&&(e.dh=e.dh.nt(n.targetId,n),e.wh.set(t,n.targetId)),n}))},t.prototype.mi=function(t,e){var n=this.wh.get(e);return void 0!==n?Ps.resolve(this.dh.get(n)):this.qi.mi(t,e)},t.prototype.kh=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:n=this.dh.get(t),r=e?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),e?[3,3]:[4,this.persistence.runTransaction("Release target",r,(function(t){return s.persistence.ii.removeTarget(t,n)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!Ya(o=i.sent()))throw o;return cr("LocalStore","Failed to update sequence numbers for target "+t+": "+o),[3,5];case 5:return this.dh=this.dh.remove(t),this.wh.delete(n.target),[2]}}))}))},t.prototype.xh=function(t,e){var n=this,r=Ar.min(),i=ai();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.mi(o,cs(t)).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.qi.Vi(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.fh.ts(o,t,e?r:Ar.min(),e?i:ai())})).next((function(t){return{documents:t,Mh:i}}))}))},t.prototype.ph=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=Ps.resolve();return o.forEach((function(r){s=s.next((function(){return n.Mn(t,r)})).next((function(t){var o=t,s=e.An.get(r);fr(null!==s),(!o||o.version.o(s)<0)&&(o=i.wn(r,o,e))&&n.Nn(o,e.mn)}))})),s.next((function(){return r.jn.Kr(t,i)}))},t.prototype.oh=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.lh(n,e.dh)}))},t}();function pc(t,e,n){return new fc(t,e,n)}function dc(t,e){var n=pr(t),r=pr(n.qi),i=n.dh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Me(t,e).next((function(t){return t?t.target:null}))}))}function mc(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){if(t.code!==Tr.FAILED_PRECONDITION||t.message!==Rs)throw t;return cr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fc.Dh=3e8;var yc=function(){function t(){this.Oh=new Jr(gc.Lh),this.qh=new Jr(gc.Bh)}return t.prototype._=function(){return this.Oh._()},t.prototype.Ri=function(t,e){var n=new gc(t,e);this.Oh=this.Oh.add(n),this.qh=this.qh.add(n)},t.prototype.Uh=function(t,e){var n=this;t.forEach((function(t){return n.Ri(t,e)}))},t.prototype.gi=function(t,e){this.Wh(new gc(t,e))},t.prototype.Qh=function(t,e){var n=this;t.forEach((function(t){return n.gi(t,e)}))},t.prototype.jh=function(t){var e=this,n=new jr(new xr([])),r=new gc(n,t),i=new gc(n,t+1),o=[];return this.qh.vt([r,i],(function(t){e.Wh(t),o.push(t.key)})),o},t.prototype.Kh=function(){var t=this;this.Oh.forEach((function(e){return t.Wh(e)}))},t.prototype.Wh=function(t){this.Oh=this.Oh.delete(t),this.qh=this.qh.delete(t)},t.prototype.Gh=function(t){var e=new jr(new xr([])),n=new gc(e,t),r=new gc(e,t+1),i=ai();return this.qh.vt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.pi=function(t){var e=new gc(t,0),n=this.Oh.Dt(e);return null!==n&&t.isEqual(n.key)},t}(),gc=function(){function t(t,e){this.key=t,this.zh=e}return t.Lh=function(t,e){return jr.P(t.key,e.key)||yr(t.zh,e.zh)},t.Bh=function(t,e){return yr(t.zh,e.zh)||jr.P(t.key,e.key)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vc(t,e){if(0!==e.length)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Dc(e.length,"argument")+".")}function bc(t,e,n){if(e.length!==n)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires "+Dc(n,"argument")+", but was called with "+Dc(e.length,"argument")+".")}function _c(t,e,n){if(e.length<n)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Dc(n,"argument")+", but was called with "+Dc(e.length,"argument")+".")}function wc(t,e,n,r){if(e.length<n||e.length>r)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Dc(e.length,"argument")+".")}function Sc(t,e,n,r){Ac(t,e,Mc(n)+" argument",r)}function Oc(t,e,n,r){void 0!==r&&Sc(t,e,n,r)}function Ec(t,e,n,r){Ac(t,e,n+" option",r)}function Tc(t,e,n,r){void 0!==r&&Ec(t,e,n,r)}function Cc(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,a=i;s<a.length;s++){var c=a[s];if(c===r)return;o.push(xc(c))}var u=xc(r);throw new Cr(Tr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Ic(t,e,n,r){if(!e.some((function(t){return t===r})))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid value "+xc(r)+" provided to function "+t+"() for its "+Mc(n)+" argument. Acceptable values: "+e.join(", "));return r}function Ac(t,e,n,r){if(!("object"===e?kc(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=xc(r);throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function kc(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function xc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":hr()}function Nc(t,e,n){if(void 0===n)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Mc(e)+" argument, but it was undefined.")}function Pc(t,e,n){Sr(e,(function(e,r){if(n.indexOf(e)<0)throw new Cr(Tr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function jc(t,e,n,r){var i=xc(r);return new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Mc(n)+" argument to be a "+e+", but it was: "+i)}function Rc(t,e,n){if(n<=0)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Mc(e)+" argument to be a positive number, but it was: "+n+".")}function Mc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Dc(t,e){return t+" "+e+(1===t?"":"s")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(){if("undefined"==typeof Uint8Array)throw new Cr(Tr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Lc(){if("undefined"==typeof atob)throw new Cr(Tr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Fc=function(){function t(t){Lc(),this.Hh=t}return t.fromBase64String=function(e){bc("Blob.fromBase64String",arguments,1),Sc("Blob.fromBase64String","string",1,e),Lc();try{return new t(Vr.fromBase64String(e))}catch(e){throw new Cr(Tr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(bc("Blob.fromUint8Array",arguments,1),$c(),!(e instanceof Uint8Array))throw jc("Blob.fromUint8Array","Uint8Array",1,e);return new t(Vr.fromUint8Array(e))},t.prototype.toBase64=function(){return bc("Blob.toBase64",arguments,0),Lc(),this.Hh.toBase64()},t.prototype.toUint8Array=function(){return bc("Blob.toUint8Array",arguments,0),$c(),this.Hh.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.Hh.isEqual(t.Hh)},t}(),Bc=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Cr(Tr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Dc(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(Sc("FieldPath","string",e,t[e]),0===t[e].length)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Yh=new Pr(t)},Uc=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return Object(i.c)(e,t),e.documentId=function(){return new e(Pr.L().$())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw jc("isEqual","FieldPath",1,t);return this.Yh.isEqual(t.Yh)},e}(Bc),Vc=new RegExp("[~\\*/\\[\\]]"),qc=function(){this.Jh=this},Wc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Xh=e,n}return Object(i.c)(e,t),e.prototype.Zh=function(t){if(2!==t.ta)throw 1===t.ta?t.ea(this.Xh+"() can only appear at the top level of your update data"):t.ea(this.Xh+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(qc);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(t,e,n){return new ou({ta:3,na:e.settings.na,methodName:t.Xh,sa:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var Hc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Xh=e,n}return Object(i.c)(e,t),e.prototype.Zh=function(t){return new No(t.path,new So)},e.prototype.isEqual=function(t){return t instanceof e},e}(qc),Kc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Xh=e,r.ia=n,r}return Object(i.c)(e,t),e.prototype.Zh=function(t){var e=zc(this,t,!0),n=this.ia.map((function(t){return hu(t,e)})),r=new Oo(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qc),Gc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Xh=e,r.ia=n,r}return Object(i.c)(e,t),e.prototype.Zh=function(t){var e=zc(this,t,!0),n=this.ia.map((function(t){return hu(t,e)})),r=new To(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qc),Qc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Xh=e,r.ra=n,r}return Object(i.c)(e,t),e.prototype.Zh=function(t){var e=new Io(t.serializer,zi(t.serializer,this.ra));return new No(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(qc),Yc=function(t){function e(){return t.call(this)||this}return Object(i.c)(e,t),e.delete=function(){return vc("FieldValue.delete",arguments),new Xc(new Wc("FieldValue.delete"))},e.serverTimestamp=function(){return vc("FieldValue.serverTimestamp",arguments),new Xc(new Hc("FieldValue.serverTimestamp"))},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _c("FieldValue.arrayUnion",arguments,1),new Xc(new Kc("FieldValue.arrayUnion",t))},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _c("FieldValue.arrayRemove",arguments,1),new Xc(new Gc("FieldValue.arrayRemove",t))},e.increment=function(t){return Sc("FieldValue.increment","number",1,t),bc("FieldValue.increment",arguments,1),new Xc(new Qc("FieldValue.increment",t))},e}(qc),Xc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Jh=e,n.Xh=e.Xh,n}return Object(i.c)(e,t),e.prototype.Zh=function(t){return this.Jh.Zh(t)},e.prototype.isEqual=function(t){return t instanceof e&&this.Jh.isEqual(t.Jh)},e}(Yc),Jc=function(){function t(t,e){if(bc("GeoPoint",arguments,2),Sc("GeoPoint","number",1,t),Sc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new Cr(Tr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Cr(Tr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.oa=t,this.ha=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.oa},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.ha},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.oa===t.oa&&this.ha===t.ha},t.prototype.T=function(t){return yr(this.oa,t.oa)||yr(this.ha,t.ha)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(t){return new Vi(t,!0)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tu=/^__.*__$/,eu=function(t,e,n){this.aa=t,this.ua=e,this.ca=n},nu=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.la=function(t,e){var n=[];return null!==this.Le?n.push(new Vo(t,this.data,this.Le,e)):n.push(new Uo(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Wo(t,this.fieldTransforms)),n},t}(),ru=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}return t.prototype.la=function(t,e){var n=[new Vo(t,this.data,this.Le,e)];return this.fieldTransforms.length>0&&n.push(new Wo(t,this.fieldTransforms)),n},t}();function iu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw hr()}}var ou=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this._a(),this.fieldTransforms=i||[],this.Le=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ta",{get:function(){return this.settings.ta},enumerable:!1,configurable:!0}),t.prototype.fa=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},t.prototype.da=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.fa({path:n,sa:!1});return r.wa(t),r},t.prototype.Ta=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.fa({path:n,sa:!1});return r._a(),r},t.prototype.Ea=function(t){return this.fa({path:void 0,sa:!0})},t.prototype.ea=function(t){return gu(t,this.settings.methodName,this.settings.Ia||!1,this.path,this.settings.na)},t.prototype.contains=function(t){return void 0!==this.Le.find((function(e){return t.D(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field)}))},t.prototype._a=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.wa(this.path.get(t))},t.prototype.wa=function(t){if(0===t.length)throw this.ea("Document fields must not be empty");if(iu(this.ta)&&tu.test(t))throw this.ea('Document fields cannot begin and end with "__"')},t}(),su=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Zc(t)}return t.prototype.ma=function(t,e,n,r){return void 0===r&&(r=!1),new ou({ta:t,methodName:e,na:n,path:Pr.k(),sa:!1,Ia:r},this.s,this.serializer,this.ignoreUndefinedProperties)},t}();function au(t,e,n,r,i,o){void 0===o&&(o={});var s=t.ma(o.merge||o.mergeFields?2:0,e,n,i);du("Data must be an object, but it was:",s,r);var a,c,u=fu(r,s);if(o.merge)a=new xo(s.Le),c=s.fieldTransforms;else if(o.mergeFields){for(var l=[],h=0,f=o.mergeFields;h<f.length;h++){var p=f[h],d=void 0;if(p instanceof Bc)d=p.Yh;else{if("string"!=typeof p)throw hr();d=yu(e,p,n)}if(!s.contains(d))throw new Cr(Tr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");vu(l,d)||l.push(d)}a=new xo(l),c=s.fieldTransforms.filter((function(t){return a.je(t.field)}))}else a=null,c=s.fieldTransforms;return new nu(new Qo(u),a,c)}function cu(t,e,n,r){var i=t.ma(1,e,n);du("Data must be an object, but it was:",i,r);var o=[],s=new Yo;Sr(r,(function(t,r){var a=yu(e,t,n),c=i.Ta(a);if(r instanceof qc&&r.Jh instanceof Wc)o.push(a);else{var u=hu(r,c);null!=u&&(o.push(a),s.set(a,u))}}));var a=new xo(o);return new ru(s.Ge(),a,i.fieldTransforms)}function uu(t,e,n,r,i,o){var s=t.ma(1,e,n),a=[mu(e,r,n)],c=[i];if(o.length%2!=0)throw new Cr(Tr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<o.length;u+=2)a.push(mu(e,o[u])),c.push(o[u+1]);for(var l=[],h=new Yo,f=a.length-1;f>=0;--f)if(!vu(l,a[f])){var p=a[f],d=c[f],m=s.Ta(p);if(d instanceof qc&&d.Jh instanceof Wc)l.push(p);else{var y=hu(d,m);null!=y&&(l.push(p),h.set(p,y))}}var g=new xo(l);return new ru(h.Ge(),g,s.fieldTransforms)}function lu(t,e,n,r){return void 0===r&&(r=!1),hu(n,t.ma(r?4:3,e))}function hu(t,e){if(pu(t))return du("Unsupported field value:",e,t),fu(t,e);if(t instanceof qc)return function(t,e){if(!iu(e.ta))throw e.ea(t.Xh+"() can only be used with update() and set()");if(!e.path)throw e.ea(t.Xh+"() is not currently supported inside arrays");var n=t.Zh(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Le.push(e.path),t instanceof Array){if(e.settings.sa&&4!==e.ta)throw e.ea("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=hu(o[i],e.Ea(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return zi(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ir.fromDate(t);return{timestampValue:Hi(e.serializer,n)}}if(t instanceof Ir){var r=new Ir(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Hi(e.serializer,r)}}if(t instanceof Jc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Fc)return{bytesValue:Ki(e.serializer,t)};if(t instanceof eu){var i=e.s,o=t.aa;if(!o.isEqual(i))throw e.ea("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Yi(t.aa||e.s,t.ua.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.ea("Unsupported field value: "+xc(t))}(t,e)}function fu(t,e){var n={};return Or(t)?e.path&&e.path.length>0&&e.Le.push(e.path):Sr(t,(function(t,r){var i=hu(r,e.da(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function pu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ir||t instanceof Jc||t instanceof Fc||t instanceof eu||t instanceof qc)}function du(t,e,n){if(!pu(n)||!kc(n)){var r=xc(n);throw"an object"===r?e.ea(t+" a custom object"):e.ea(t+" "+r)}}function mu(t,e,n){if(e instanceof Bc)return e.Yh;if("string"==typeof e)return yu(t,e);throw gu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function yu(t,e,n){try{return function(t){if(t.search(Vc)>=0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Uc.bind.apply(Uc,Object(i.g)([void 0],t.split("."))))}catch(e){throw new Cr(Tr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Yh}catch(e){throw gu((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function gu(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var c="";return(o||s)&&(c+=" (found",o&&(c+=" in field "+r),s&&(c+=" in document "+i),c+=")"),new Cr(Tr.INVALID_ARGUMENT,(a+=". ")+t+c)}function vu(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bu=function(){function t(t){this.uid=t}return t.prototype.Mr=function(){return null!=this.uid},t.prototype.Aa=function(){return this.Mr()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();bu.UNAUTHENTICATED=new bu(null),bu.Ra=new bu("google-credentials-uid"),bu.Pa=new bu("first-party-uid");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _u=function(t,e){this.user=e,this.type="OAuth",this.ga={},this.ga.Authorization="Bearer "+t},wu=function(){function t(){this.Va=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.ya=function(){},t.prototype.pa=function(t){this.Va=t,t(bu.UNAUTHENTICATED)},t.prototype.ba=function(){this.Va=null},t}(),Su=function(){function t(t){var e=this;this.va=null,this.currentUser=bu.UNAUTHENTICATED,this.Sa=!1,this.Da=0,this.Va=null,this.forceRefresh=!1,this.va=function(){e.Da++,e.currentUser=e.Ca(),e.Sa=!0,e.Va&&e.Va(e.currentUser)},this.Da=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.va):(this.va(null),t.get().then((function(t){e.auth=t,e.va&&e.auth.addAuthTokenListener(e.va)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.Da,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.Da!==e?(cr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(fr("string"==typeof n.accessToken),new _u(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.ya=function(){this.forceRefresh=!0},t.prototype.pa=function(t){this.Va=t,this.Sa&&t(this.currentUser)},t.prototype.ba=function(){this.auth&&this.auth.removeAuthTokenListener(this.va),this.va=null,this.Va=null},t.prototype.Ca=function(){var t=this.auth&&this.auth.getUid();return fr(null===t||"string"==typeof t),new bu(t)},t}(),Ou=function(){function t(t,e){this.Fa=t,this.$a=e,this.type="FirstParty",this.user=bu.Pa}return Object.defineProperty(t.prototype,"ga",{get:function(){var t={"X-Goog-AuthUser":this.$a},e=this.Fa.auth.Na([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Eu=function(){function t(t,e){this.Fa=t,this.$a=e}return t.prototype.getToken=function(){return Promise.resolve(new Ou(this.Fa,this.$a))},t.prototype.pa=function(t){t(bu.Pa)},t.prototype.ba=function(){},t.prototype.ya=function(){},t}(),Tu=function(){function t(t,e,n,r,i,o){this.Ts=t,this.ka=n,this.xa=r,this.Ma=i,this.listener=o,this.state=0,this.Oa=0,this.La=null,this.stream=null,this.Po=new Bs(t,e)}return t.prototype.qa=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Ba=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Ua()},t.prototype.stop=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.qa()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Wa=function(){this.state=0,this.Po.reset()},t.prototype.Qa=function(){var t=this;this.Ba()&&null===this.La&&(this.La=this.Ts.bs(this.ka,6e4,(function(){return t.ja()})))},t.prototype.Ka=function(t){this.Ga(),this.stream.send(t)},t.prototype.ja=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.Ba()?[2,this.close(0)]:[2]}))}))},t.prototype.Ga=function(){this.La&&(this.La.cancel(),this.La=null)},t.prototype.close=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){switch(n.label){case 0:return this.Ga(),this.Po.cancel(),this.Oa++,3!==t?this.Po.reset():e&&e.code===Tr.RESOURCE_EXHAUSTED?(ur(e.toString()),ur("Using maximum backoff delay to prevent overloading the backend."),this.Po.Vs()):e&&e.code===Tr.UNAUTHENTICATED&&this.Ma.ya(),null!==this.stream&&(this.za(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ha(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.za=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.Ya(this.Oa),n=this.Oa;this.Ma.getToken().then((function(e){t.Oa===n&&t.Ja(e)}),(function(n){e((function(){var e=new Cr(Tr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Xa(e)}))}))},t.prototype.Ja=function(t){var e=this,n=this.Ya(this.Oa);this.stream=this.Za(t),this.stream.tu((function(){n((function(){return e.state=2,e.listener.tu()}))})),this.stream.Ha((function(t){n((function(){return e.Xa(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Ua=function(){var t=this;this.state=4,this.Po.ys((function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.Xa=function(t){return cr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.Ya=function(t){var e=this;return function(n){e.Ts.Zi((function(){return e.Oa===t?n():(cr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Cu=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return Object(i.c)(e,t),e.prototype.Za=function(t){return this.xa.eu("Listen",t)},e.prototype.onMessage=function(t){this.Po.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:hr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Oe?(fr(void 0===e||"string"==typeof e),Vr.fromBase64String(e||"")):(fr(void 0===e||e instanceof Uint8Array),Vr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,a=s&&function(t){var e=void 0===t.code?Tr.UNKNOWN:Gr(t.code);return new Cr(e,t.message||"")}(s);n=new gi(r,i,o,a||null)}else if("documentChange"in e){e.documentChange;var c=e.documentChange;c.document,c.document.name,c.document.updateTime;var u=Zi(t,c.document.name),l=Qi(c.document.updateTime),h=new Qo({mapValue:{fields:c.document.fields}}),f=new Zo(u,l,h,{}),p=c.targetIds||[],d=c.removedTargetIds||[];n=new mi(p,d,f.key,f)}else if("documentDelete"in e){e.documentDelete;var m=e.documentDelete;m.document;var y=Zi(t,m.document),g=m.readTime?Qi(m.readTime):Ar.min(),v=new ts(y,g),b=m.removedTargetIds||[];n=new mi([],b,v.key,v)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var w=Zi(t,_.document),S=_.removedTargetIds||[];n=new mi([],S,w,null)}else{if(!("filter"in e))return hr();e.filter;var O=e.filter;O.targetId;var E=O.count||0,T=new Hr(E),C=O.targetId;n=new yi(C,T)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ar.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ar.min():e.readTime?Qi(e.readTime):Ar.min()}(t);return this.listener.nu(e,n)},e.prototype.su=function(t){var e={};e.database=no(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=Ur(r)?{documents:ao(t,r)}:{query:co(t,r)}).targetId=e.targetId,e.resumeToken.H()>0&&(n.resumeToken=Ki(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return hr()}}(0,e.J);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ka(e)},e.prototype.iu=function(t){var e={};e.database=no(this.serializer),e.removeTarget=t,this.Ka(e)},e}(Tu),Iu=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.ru=!1,s}return Object(i.c)(e,t),Object.defineProperty(e.prototype,"ou",{get:function(){return this.ru},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.ru=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.za=function(){this.ru&&this.hu([])},e.prototype.Za=function(t){return this.xa.eu("Write",t)},e.prototype.onMessage=function(t){if(fr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.Po.reset();var e=function(t,e){return t&&t.length>0?(fr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Qi(t.updateTime):Qi(e);n.isEqual(Ar.min())&&(n=Qi(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Po(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Qi(t.commitTime);return this.listener.au(n,e)}return fr(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.uu()},e.prototype.cu=function(){var t={};t.database=no(this.serializer),this.Ka(t)},e.prototype.hu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return oo(e.serializer,t)}))};this.Ka(n)},e}(Tu),Au=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).credentials=e,r.serializer=n,r.lu=!1,r}return Object(i.c)(e,t),e.prototype._u=function(){if(this.lu)throw new Cr(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.start=function(t){this.xa=t},e.prototype.fu=function(t,e){var n=this;return this._u(),this.credentials.getToken().then((function(r){return n.xa.fu(t,e,r)})).catch((function(t){throw t.code===Tr.UNAUTHENTICATED&&n.credentials.ya(),t}))},e.prototype.du=function(t,e){var n=this;return this._u(),this.credentials.getToken().then((function(r){return n.xa.du(t,e,r)})).catch((function(t){throw t.code===Tr.UNAUTHENTICATED&&n.credentials.ya(),t}))},e}((function(){})),ku=function(){function t(t){this.wu=t,this.Tu=new Map,this.mutations=[],this.Eu=!1,this.Iu=null,this.mu=new Set}return t.prototype.Au=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:if(this.Ru(),this.mutations.length>0)throw new Cr(Tr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=pr(t),r={database:no(n.serializer),documents:e.map((function(t){return Ji(n.serializer,t)}))},[4,n.du("BatchGetDocuments",r)];case 1:return o=i.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){fr(!!e.found),e.found.name,e.found.updateTime;var n=Zi(t,e.found.name),r=Qi(e.found.updateTime),i=new Qo({mapValue:{fields:e.found.fields}});return new Zo(n,r,i,{})}(t,e):"missing"in e?function(t,e){fr(!!e.missing),fr(!!e.readTime);var n=Zi(t,e.missing),r=Qi(e.readTime);return new ts(n,r)}(t,e):hr()}(n.serializer,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());fr(!!e),a.push(e)})),a)]}}))}))}(this.wu,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof ts||t instanceof Zo?n.Pu(t):hr()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.la(t,this.Ue(t))),this.mu.add(t)},t.prototype.update=function(t,e){try{this.write(e.la(t,this.gu(t)))}catch(t){this.Iu=t}this.mu.add(t)},t.prototype.delete=function(t){this.write([new Ko(t,this.Ue(t))]),this.mu.add(t)},t.prototype.commit=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){switch(n.label){case 0:if(this.Ru(),this.Iu)throw this.Iu;return t=this.Tu,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=new jr(xr.N(n));e.mutations.push(new Go(r,e.Ue(r)))})),[4,function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=pr(t),r={database:no(n.serializer),writes:e.map((function(t){return oo(n.serializer,t)}))},[4,n.fu("Commit",r)];case 1:return i.sent(),[2]}}))}))}(this.wu,this.mutations)];case 1:return n.sent(),this.Eu=!0,[2]}}))}))},t.prototype.Pu=function(t){var e;if(t instanceof Zo)e=t.version;else{if(!(t instanceof ts))throw hr();e=Ar.min()}var n=this.Tu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Cr(Tr.ABORTED,"Document version changed between two reads.")}else this.Tu.set(t.key.toString(),e)},t.prototype.Ue=function(t){var e=this.Tu.get(t.toString());return!this.mu.has(t)&&e?jo.updateTime(e):jo.We()},t.prototype.gu=function(t){var e=this.Tu.get(t.toString());if(!this.mu.has(t)&&e){if(e.isEqual(Ar.min()))throw new Cr(Tr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jo.updateTime(e)}return jo.exists(!0)},t.prototype.write=function(t){this.Ru(),this.mutations=this.mutations.concat(t)},t.prototype.Ru=function(){},t}(),xu=function(){function t(t,e){this.ao=t,this.Vu=e,this.state="Unknown",this.yu=0,this.pu=null,this.bu=!0}return t.prototype.vu=function(){var t=this;0===this.yu&&(this.Su("Unknown"),this.pu=this.ao.bs("online_state_timeout",1e4,(function(){return t.pu=null,t.Du("Backend didn't respond within 10 seconds."),t.Su("Offline"),Promise.resolve()})))},t.prototype.Cu=function(t){"Online"===this.state?this.Su("Unknown"):(this.yu++,this.yu>=1&&(this.Fu(),this.Du("Connection failed 1 times. Most recent error: "+t.toString()),this.Su("Offline")))},t.prototype.set=function(t){this.Fu(),this.yu=0,"Online"===t&&(this.bu=!1),this.Su(t)},t.prototype.Su=function(t){t!==this.state&&(this.state=t,this.Vu(t))},t.prototype.Du=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.bu?(ur(e),this.bu=!1):cr("OnlineStateTracker",e)},t.prototype.Fu=function(){null!==this.pu&&(this.pu.cancel(),this.pu=null)},t}(),Nu=function(){function t(t,e,n,r,o){var s=this;this.$u=t,this.wu=e,this.ao=n,this.Nu=[],this.ku=new Map,this.xu=null,this.Mu=new Set,this.Ou=o,this.Ou.Lu((function(t){n.Zi((function(){return Object(i.b)(s,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.qu()?(cr("RemoteStore","Restarting streams for network reachability change."),[4,this.Bu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Uu=new xu(n,r),this.Wu=function(t,e,n){var r=pr(t);return r._u(),new Cu(e,r.xa,r.credentials,r.serializer,n)}(this.wu,n,{tu:this.Qu.bind(this),Ha:this.ju.bind(this),nu:this.Ku.bind(this)}),this.Gu=function(t,e,n){var r=pr(t);return r._u(),new Iu(e,r.xa,r.credentials,r.serializer,n)}(this.wu,n,{tu:this.zu.bind(this),Ha:this.Hu.bind(this),uu:this.Yu.bind(this),au:this.au.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return this.Mu.delete(0),this.Ju()},t.prototype.Ju=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.qu()?(this.Xu()?this.Zu():this.Uu.set("Unknown"),[4,this.tc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.disableNetwork=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.Mu.add(0),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Offline"),[2]}}))}))},t.prototype.ec=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.Gu.stop()];case 1:return t.sent(),[4,this.Wu.stop()];case 2:return t.sent(),this.Nu.length>0&&(cr("RemoteStore","Stopping write stream with "+this.Nu.length+" pending writes"),this.Nu=[]),this.nc(),[2]}}))}))},t.prototype._r=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return cr("RemoteStore","RemoteStore shutting down."),this.Mu.add(5),[4,this.ec()];case 1:return t.sent(),this.Ou._r(),this.Uu.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.ku.has(t.targetId)||(this.ku.set(t.targetId,t),this.Xu()?this.Zu():this.Wu.Ba()&&this.sc(t))},t.prototype.ic=function(t){this.ku.delete(t),this.Wu.Ba()&&this.rc(t),0===this.ku.size&&(this.Wu.Ba()?this.Wu.Qa():this.qu()&&this.Uu.set("Unknown"))},t.prototype.Me=function(t){return this.ku.get(t)||null},t.prototype.xe=function(t){return this.oc.xe(t)},t.prototype.sc=function(t){this.xu.de(t.targetId),this.Wu.su(t)},t.prototype.rc=function(t){this.xu.de(t),this.Wu.iu(t)},t.prototype.Zu=function(){this.xu=new bi(this),this.Wu.start(),this.Uu.vu()},t.prototype.Xu=function(){return this.qu()&&!this.Wu.qa()&&this.ku.size>0},t.prototype.qu=function(){return 0===this.Mu.size},t.prototype.nc=function(){this.xu=null},t.prototype.Qu=function(){return Object(i.b)(this,void 0,void 0,(function(){var t=this;return Object(i.d)(this,(function(e){return this.ku.forEach((function(e,n){t.sc(e)})),[2]}))}))},t.prototype.ju=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.nc(),this.Xu()?(this.Uu.Cu(t),this.Zu()):this.Uu.set("Unknown"),[2]}))}))},t.prototype.Ku=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(this.Uu.set("Online"),!(t instanceof gi&&2===t.state&&t.cause))return[3,6];i.label=1;case 1:return i.trys.push([1,3,,5]),[4,this.hc(t)];case 2:return i.sent(),[3,5];case 3:return n=i.sent(),cr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),[4,this.ac(n)];case 4:return i.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof mi?this.xu.Pe(t):t instanceof yi?this.xu.De(t):this.xu.ye(t),e.isEqual(Ar.min()))return[3,13];i.label=7;case 7:return i.trys.push([7,11,,13]),[4,this.$u.ai()];case 8:return r=i.sent(),e.o(r)>=0?[4,this.uc(e)]:[3,10];case 9:i.sent(),i.label=10;case 10:return[3,13];case 11:return cr("RemoteStore","Failed to raise snapshot:",o=i.sent()),[4,this.ac(o)];case 12:return i.sent(),[3,13];case 13:return[2]}}))}))},t.prototype.ac=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:if(!Ya(t))throw t;return this.Mu.add(1),[4,this.ec()];case 1:return r.sent(),this.Uu.set("Offline"),e||(e=function(){return n.$u.ai()}),this.ao.er((function(){return Object(i.b)(n,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return cr("RemoteStore","Retrying IndexedDB access"),[4,e()];case 1:return t.sent(),this.Mu.delete(1),[4,this.Ju()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.cc=function(t){var e=this;return t().catch((function(n){return e.ac(n,t)}))},t.prototype.uc=function(t){var e=this,n=this.xu.$e(t);return n.Wt.forEach((function(n,r){if(n.resumeToken.H()>0){var i=e.ku.get(r);i&&e.ku.set(r,i.tt(n.resumeToken,t))}})),n.Qt.forEach((function(t){var n=e.ku.get(t);if(n){e.ku.set(t,n.tt(Vr.Y,n.X)),e.rc(t);var r=new zr(n.target,t,1,n.sequenceNumber);e.sc(r)}})),this.oc.vh(n)},t.prototype.hc=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:e=t.cause,n=0,r=t.targetIds,i.label=1;case 1:return n<r.length?(o=r[n],this.ku.has(o)?[4,this.oc.lc(o,e)]:[3,3]):[3,5];case 2:i.sent(),this.ku.delete(o),this.xu.removeTarget(o),i.label=3;case 3:i.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},t.prototype.tc=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:t=this.Nu.length>0?this.Nu[this.Nu.length-1].batchId:-1,r.label=1;case 1:if(!this._c())return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.$u.Fh(t)];case 3:return null===(e=r.sent())?(0===this.Nu.length&&this.Gu.Qa(),[3,7]):(t=e.batchId,this.fc(e),[3,6]);case 4:return n=r.sent(),[4,this.ac(n)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return this.dc()&&this.wc(),[2]}}))}))},t.prototype._c=function(){return this.qu()&&this.Nu.length<10},t.prototype.Tc=function(){return this.Nu.length},t.prototype.fc=function(t){this.Nu.push(t),this.Gu.Ba()&&this.Gu.ou&&this.Gu.hu(t.mutations)},t.prototype.dc=function(){return this.qu()&&!this.Gu.qa()&&this.Nu.length>0},t.prototype.wc=function(){this.Gu.start()},t.prototype.zu=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){return this.Gu.cu(),[2]}))}))},t.prototype.Yu=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n;return Object(i.d)(this,(function(r){for(t=0,e=this.Nu;t<e.length;t++)n=e[t],this.Gu.hu(n.mutations);return[2]}))}))},t.prototype.au=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=this.Nu.shift(),r=Ns.from(n,t,e),[4,this.cc((function(){return o.oc.Ec(r)}))];case 1:return i.sent(),[4,this.tc()];case 2:return i.sent(),[2]}}))}))},t.prototype.Hu=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return t&&this.Gu.ou?[4,this.Ic(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.dc()&&this.wc(),[2]}}))}))},t.prototype.Ic=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return Kr(n=t.code)&&n!==Tr.ABORTED?(e=this.Nu.shift(),this.Gu.Wa(),[4,this.cc((function(){return r.oc.mc(e.batchId,t)}))]):[3,3];case 1:return i.sent(),[4,this.tc()];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.Ac=function(){return new ku(this.wu)},t.prototype.Bu=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.Mu.add(4),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Unknown"),this.Gu.Wa(),this.Wu.Wa(),this.Mu.delete(4),[4,this.Ju()];case 2:return t.sent(),[2]}}))}))},t.prototype.Rc=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.ao.$o(),cr("RemoteStore","RemoteStore received new credentials"),this.Mu.add(3),[4,this.ec()];case 1:return e.sent(),this.Uu.set("Unknown"),[4,this.oc.Rc(t)];case 2:return e.sent(),this.Mu.delete(3),[4,this.Ju()];case 3:return e.sent(),[2]}}))}))},t.prototype.Pc=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return t?(this.Mu.delete(2),[4,this.Ju()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.Mu.add(2),[4,this.ec()]);case 3:e.sent(),this.Uu.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(t,e){return"firestore_clients_"+t+"_"+e}function ju(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Mr()&&(r+="_"+e.uid),r}function Ru(t,e){return"firestore_targets_"+t+"_"+e}var Mu=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.gc=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new Cr(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(ur("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Vc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Du=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.gc=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Cr(r.error.code,r.error.message)),i?new t(e,r.state,o):(ur("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Vc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),$u=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.gc=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ui(),s=0;i&&s<r.activeTargetIds.length;++s)i=Dr(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(ur("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Lu=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.gc=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(ur("SharedClientState","Failed to parse online state: "+e),null)},t}(),Fu=function(){function t(){this.activeTargetIds=ui()}return t.prototype.yc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.pc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Vc=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Bu=function(){function t(t,e,n,r,i){this.window=t,this.Ts=e,this.persistenceKey=n,this.bc=r,this.oc=null,this.Vu=null,this.ls=null,this.vc=this.Sc.bind(this),this.Dc=new Qr(yr),this.Hi=!1,this.Cc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Fc=Pu(this.persistenceKey,this.bc),this.$c=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Dc=this.Dc.nt(this.bc,new Fu),this.Nc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.kc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.xc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Mc=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.vc)}return t.Oi=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,c,u,l,h,f=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.oc.Ir()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.bc&&(o=this.getItem(Pu(this.persistenceKey,r)))&&(s=$u.gc(r,o))&&(this.Dc=this.Dc.nt(s.clientId,s));for(this.Oc(),(a=this.storage.getItem(this.Mc))&&(c=this.Lc(a))&&this.qc(c),u=0,l=this.Cc;u<l.length;u++)h=l[u],this.Sc(h);return this.Cc=[],this.window.addEventListener("unload",(function(){return f._r()})),this.Hi=!0,[2]}}))}))},t.prototype.ds=function(t){this.setItem(this.$c,JSON.stringify(t))},t.prototype.Bc=function(){return this.Uc(this.Dc)},t.prototype.Wc=function(t){var e=!1;return this.Dc.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Qc=function(t){this.jc(t,"pending")},t.prototype.Kc=function(t,e,n){this.jc(t,e,n),this.Gc(t)},t.prototype.zc=function(t){var e="not-current";if(this.Wc(t)){var n=this.storage.getItem(Ru(this.persistenceKey,t));if(n){var r=Du.gc(t,n);r&&(e=r.state)}}return this.Hc.yc(t),this.Oc(),e},t.prototype.Yc=function(t){this.Hc.pc(t),this.Oc()},t.prototype.Jc=function(t){return this.Hc.activeTargetIds.has(t)},t.prototype.Xc=function(t){this.removeItem(Ru(this.persistenceKey,t))},t.prototype.Zc=function(t,e,n){this.tl(t,e,n)},t.prototype.Ah=function(t,e,n){var r=this;e.forEach((function(t){r.Gc(t)})),this.currentUser=t,n.forEach((function(t){r.Qc(t)}))},t.prototype.el=function(t){this.nl(t)},t.prototype._r=function(){this.Hi&&(this.window.removeEventListener("storage",this.vc),this.removeItem(this.Fc),this.Hi=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return cr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){cr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){cr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Sc=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(cr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Fc)return void ur("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ts.er((function(){return Object(i.b)(e,void 0,void 0,(function(){var t,e,r,o,s,a;return Object(i.d)(this,(function(i){if(this.Hi){if(null!==n.key)if(this.Nc.test(n.key)){if(null==n.newValue)return t=this.sl(n.key),[2,this.il(t,null)];if(e=this.rl(n.key,n.newValue))return[2,this.il(e.clientId,e)]}else if(this.kc.test(n.key)){if(null!==n.newValue&&(r=this.ol(n.key,n.newValue)))return[2,this.hl(r)]}else if(this.xc.test(n.key)){if(null!==n.newValue&&(o=this.al(n.key,n.newValue)))return[2,this.ul(o)]}else if(n.key===this.Mc){if(null!==n.newValue&&(s=this.Lc(n.newValue)))return[2,this.qc(s)]}else n.key===this.$c&&(a=function(t){var e=Ls.ws;if(null!=t)try{var n=JSON.parse(t);fr("number"==typeof n),e=n}catch(t){ur("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Ls.ws&&this.ls(a)}else this.Cc.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Hc",{get:function(){return this.Dc.get(this.bc)},enumerable:!1,configurable:!0}),t.prototype.Oc=function(){this.setItem(this.Fc,this.Hc.Vc())},t.prototype.jc=function(t,e,n){var r=new Mu(this.currentUser,t,e,n),i=ju(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Vc())},t.prototype.Gc=function(t){var e=ju(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.nl=function(t){var e={clientId:this.bc,onlineState:t};this.storage.setItem(this.Mc,JSON.stringify(e))},t.prototype.tl=function(t,e,n){var r=Ru(this.persistenceKey,t),i=new Du(t,e,n);this.setItem(r,i.Vc())},t.prototype.sl=function(t){var e=this.Nc.exec(t);return e?e[1]:null},t.prototype.rl=function(t,e){var n=this.sl(t);return $u.gc(n,e)},t.prototype.ol=function(t,e){var n=this.kc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Mu.gc(new bu(i),r,e)},t.prototype.al=function(t,e){var n=this.xc.exec(t),r=Number(n[1]);return Du.gc(r,e)},t.prototype.Lc=function(t){return Lu.gc(t)},t.prototype.hl=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.oc.cl(t.batchId,t.state,t.error)]:(cr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.ul=function(t){return this.oc.ll(t.targetId,t.state,t.error)},t.prototype.il=function(t,e){var n=this,r=e?this.Dc.nt(t,e):this.Dc.remove(t),i=this.Uc(this.Dc),o=this.Uc(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.oc._l(s,a).then((function(){n.Dc=r}))},t.prototype.qc=function(t){this.Dc.get(t.clientId)&&this.Vu(t.onlineState)},t.prototype.Uc=function(t){var e=ui();return t.forEach((function(t,n){e=e.Ct(n.activeTargetIds)})),e},t}(),Uu=function(){function t(){this.fl=new Fu,this.dl={},this.Vu=null,this.ls=null}return t.prototype.Qc=function(t){},t.prototype.Kc=function(t,e,n){},t.prototype.zc=function(t){return this.fl.yc(t),this.dl[t]||"not-current"},t.prototype.Zc=function(t,e,n){this.dl[t]=e},t.prototype.Yc=function(t){this.fl.pc(t)},t.prototype.Jc=function(t){return this.fl.activeTargetIds.has(t)},t.prototype.Xc=function(t){delete this.dl[t]},t.prototype.Bc=function(){return this.fl.activeTargetIds},t.prototype.Wc=function(t){return this.fl.activeTargetIds.has(t)},t.prototype.start=function(){return this.fl=new Fu,Promise.resolve()},t.prototype.Ah=function(t,e,n){},t.prototype.el=function(t){},t.prototype._r=function(){},t.prototype.ds=function(t){},t}(),Vu=function(t){this.key=t},qu=function(t){this.key=t},Wu=function(){function t(t,e){this.query=t,this.wl=e,this.Tl=null,this.Ht=!1,this.El=ai(),this.Lt=ai(),this.Il=ys(t),this.ml=new li(this.Il)}return Object.defineProperty(t.prototype,"Al",{get:function(){return this.wl},enumerable:!1,configurable:!0}),t.prototype.Rl=function(t,e){var n=this,r=e?e.Pl:new hi,i=e?e.ml:this.ml,o=e?e.Lt:this.Lt,s=i,a=!1,c=this.query.hn()&&i.size===this.query.limit?i.last():null,u=this.query.an()&&i.size===this.query.limit?i.first():null;if(t.ot((function(t,e){var l=i.get(t),h=e instanceof Zo?e:null;h&&(h=ms(n.query,h)?h:null);var f=!!l&&n.Lt.has(l.key),p=!!h&&(h.Ke||n.Lt.has(h.key)&&h.hasCommittedMutations),d=!1;l&&h?l.data().isEqual(h.data())?f!==p&&(r.track({type:3,doc:h}),d=!0):n.gl(l,h)||(r.track({type:2,doc:h}),d=!0,(c&&n.Il(h,c)>0||u&&n.Il(h,u)<0)&&(a=!0)):!l&&h?(r.track({type:0,doc:h}),d=!0):l&&!h&&(r.track({type:1,doc:l}),d=!0,(c||u)&&(a=!0)),d&&(h?(s=s.add(h),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.hn()||this.query.an())for(;s.size>this.query.limit;){var l=this.query.hn()?s.last():s.first();s=s.delete(l.key),o=o.delete(l.key),r.track({type:1,doc:l})}return{ml:s,Pl:r,Vl:a,Lt:o}},t.prototype.gl=function(t,e){return t.Ke&&e.hasCommittedMutations&&!e.Ke},t.prototype.qn=function(t,e,n){var r=this,i=this.ml;this.ml=t.ml,this.Lt=t.Lt;var o=t.Pl.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return hr()}};return n(t)-n(e)}(t.type,e.type)||r.Il(t.doc,e.doc)})),this.yl(n);var s=e?this.pl():[],a=0===this.El.size&&this.Ht?1:0,c=a!==this.Tl;return this.Tl=a,0!==o.length||c?{snapshot:new fi(this.query,t.ml,i,o,t.Lt,0===a,c,!1),bl:s}:{bl:s}},t.prototype.vl=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.qn({ml:this.ml,Pl:new hi,Lt:this.Lt,Vl:!1},!1)):{bl:[]}},t.prototype.Sl=function(t){return!this.wl.has(t)&&!!this.ml.has(t)&&!this.ml.get(t).Ke},t.prototype.yl=function(t){var e=this;t&&(t.Yt.forEach((function(t){return e.wl=e.wl.add(t)})),t.Jt.forEach((function(t){})),t.Xt.forEach((function(t){return e.wl=e.wl.delete(t)})),this.Ht=t.Ht)},t.prototype.pl=function(){var t=this;if(!this.Ht)return[];var e=this.El;this.El=ai(),this.ml.forEach((function(e){t.Sl(e.key)&&(t.El=t.El.add(e.key))}));var n=[];return e.forEach((function(e){t.El.has(e)||n.push(new qu(e))})),this.El.forEach((function(t){e.has(t)||n.push(new Vu(t))})),n},t.prototype.Dl=function(t){this.wl=t.Mh,this.El=ai();var e=this.Rl(t.documents);return this.qn(e,!0)},t.prototype.Cl=function(){return fi.Ut(this.query,this.ml,this.Lt,0===this.Tl)},t}(),zu=function(){function t(t,e,n,r){this.ao=t,this.wu=e,this.updateFunction=n,this.lo=r,this.Fl=5,this.Po=new Bs(this.ao,"transaction_retry")}return t.prototype.run=function(){this.$l()},t.prototype.$l=function(){var t=this;this.Po.ys((function(){return Object(i.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(i.d)(this,(function(r){return t=new ku(this.wu),(e=this.Nl(t))&&e.then((function(e){n.ao.Zi((function(){return t.commit().then((function(){n.lo.resolve(e)})).catch((function(t){n.kl(t)}))}))})).catch((function(t){n.kl(t)})),[2]}))}))}))},t.prototype.Nl=function(t){try{var e=this.updateFunction(t);return!Rr(e)&&e.catch&&e.then?e:(this.lo.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.lo.reject(t),null}},t.prototype.kl=function(t){var e=this;this.Fl>0&&this.xl(t)?(this.Fl-=1,this.ao.Zi((function(){return e.$l(),Promise.resolve()}))):this.lo.reject(t)},t.prototype.xl=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Kr(e)}return!1},t}(),Hu=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ku=function(t){this.key=t,this.Ml=!1},Gu=function(){function t(t,e,n,r,i,o){this.$u=t,this.Ol=e,this.wu=n,this.Ll=r,this.currentUser=i,this.ql=o,this.Bl=null,this.Ul=new Er((function(t){return ps(t)}),fs),this.Wl=new Map,this.Ql=[],this.jl=new Qr(jr.P),this.Kl=new Map,this.Gl=new yc,this.zl={},this.Hl=new Map,this.Yl=la.si(),this.onlineState="Unknown",this.Jl=void 0}return Object.defineProperty(t.prototype,"Xl",{get:function(){return!0===this.Jl},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.Bl=t},t.prototype.listen=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.Zl("listen()"),(r=this.Ul.get(t))?(e=r.targetId,this.Ll.zc(e),n=r.view.Cl(),[3,4]):[3,1];case 1:return[4,this.$u.Nh(cs(t))];case 2:return o=i.sent(),s=this.Ll.zc(o.targetId),e=o.targetId,[4,this.t_(t,e,"current"===s)];case 3:n=i.sent(),this.Xl&&this.Ol.listen(o),i.label=4;case 4:return[2,n]}}))}))},t.prototype.t_=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a,c,u;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.$u.xh(t,!0)];case 1:return r=i.sent(),o=new Wu(t,r.Mh),s=o.Rl(r.documents),a=di.zt(e,n&&"Offline"!==this.onlineState),c=o.qn(s,this.Xl,a),this.e_(e,c.bl),u=new Hu(t,e,o),[2,(this.Ul.set(t,u),this.Wl.has(e)?this.Wl.get(e).push(t):this.Wl.set(e,[t]),c.snapshot)]}}))}))},t.prototype.ic=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.Zl("unlisten()"),e=this.Ul.get(t),(n=this.Wl.get(e.targetId)).length>1?[2,(this.Wl.set(e.targetId,n.filter((function(e){return!fs(e,t)}))),void this.Ul.delete(t))]:this.Xl?(this.Ll.Yc(e.targetId),this.Ll.Wc(e.targetId)?[3,2]:[4,this.$u.kh(e.targetId,!1).then((function(){r.Ll.Xc(e.targetId),r.Ol.ic(e.targetId),r.n_(e.targetId)})).catch(mc)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.n_(e.targetId),[4,this.$u.kh(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:this.Zl("write()"),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.$u.Vh(t)];case 2:return n=i.sent(),this.Ll.Qc(n.batchId),this.s_(n.batchId,e),[4,this.i_(n.Cn)];case 3:return i.sent(),[4,this.Ol.tc()];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),o=oc(r,"Failed to persist write"),e.reject(o),[3,6];case 6:return[2]}}))}))},t.prototype.runTransaction=function(t,e,n){new zu(t,this.wu,e,n).run()},t.prototype.vh=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.Zl("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.$u.vh(t)];case 2:return e=r.sent(),t.Wt.forEach((function(t,e){var r=n.Kl.get(e);r&&(fr(t.Yt.size+t.Jt.size+t.Xt.size<=1),t.Yt.size>0?r.Ml=!0:t.Jt.size>0?fr(r.Ml):t.Xt.size>0&&(fr(r.Ml),r.Ml=!1))})),[4,this.i_(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,mc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.vl=function(t,e){if(this.Xl&&0===e||!this.Xl&&1===e){this.Zl("applyOnlineStateChange()");var n=[];this.Ul.forEach((function(e,r){var i=r.view.vl(t);i.snapshot&&n.push(i.snapshot)})),this.Bl.r_(t),this.Bl.nu(n),this.onlineState=t,this.Xl&&this.Ll.el(t)}},t.prototype.lc=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this.Zl("rejectListens()"),this.Ll.Zc(t,"rejected",e),n=this.Kl.get(t),(r=n&&n.key)?(o=(o=new Qr(jr.P)).nt(r,new ts(r,Ar.min())),s=ai().add(r),a=new pi(Ar.min(),new Map,new Jr(yr),o,s),[4,this.vh(a)]):[3,2];case 1:return i.sent(),this.jl=this.jl.remove(r),this.Kl.delete(t),this.o_(),[3,4];case 2:return[4,this.$u.kh(t,!1).then((function(){return c.n_(t,e)})).catch(mc)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},t.prototype.Ec=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.Zl("applySuccessfulWrite()"),e=t.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.$u.yh(t)];case 2:return n=r.sent(),this.h_(e,null),this.a_(e),this.Ll.Kc(e,"acknowledged"),[4,this.i_(n)];case 3:return r.sent(),[3,6];case 4:return[4,mc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.mc=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:this.Zl("rejectFailedWrite()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.$u.bh(t)];case 2:return n=r.sent(),this.h_(t,e),this.a_(t),this.Ll.Kc(t,"rejected",e),[4,this.i_(n)];case 3:return r.sent(),[3,6];case 4:return[4,mc(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.u_=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:this.Ol.qu()||cr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.$u.Wr()];case 2:return-1===(e=i.sent())?[2,void t.resolve()]:((n=this.Hl.get(e)||[]).push(t),this.Hl.set(e,n),[3,4]);case 3:return r=i.sent(),o=oc(r,"Initialization of waitForPendingWrites() operation failed"),t.reject(o),[3,4];case 4:return[2]}}))}))},t.prototype.a_=function(t){(this.Hl.get(t)||[]).forEach((function(t){t.resolve()})),this.Hl.delete(t)},t.prototype.c_=function(t){this.Hl.forEach((function(e){e.forEach((function(e){e.reject(new Cr(Tr.CANCELLED,t))}))})),this.Hl.clear()},t.prototype.s_=function(t,e){var n=this.zl[this.currentUser.Aa()];n||(n=new Qr(yr)),n=n.nt(t,e),this.zl[this.currentUser.Aa()]=n},t.prototype.h_=function(t,e){var n=this.zl[this.currentUser.Aa()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.zl[this.currentUser.Aa()]=n}},t.prototype.n_=function(t,e){var n=this;void 0===e&&(e=null),this.Ll.Yc(t);for(var r=0,i=this.Wl.get(t);r<i.length;r++){var o=i[r];this.Ul.delete(o),e&&this.Bl.l_(o,e)}this.Wl.delete(t),this.Xl&&this.Gl.jh(t).forEach((function(t){n.Gl.pi(t)||n.__(t)}))},t.prototype.__=function(t){var e=this.jl.get(t);null!==e&&(this.Ol.ic(e),this.jl=this.jl.remove(t),this.Kl.delete(e),this.o_())},t.prototype.e_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Vu?(this.Gl.Ri(i.key,t),this.f_(i)):i instanceof qu?(cr("SyncEngine","Document no longer in limbo: "+i.key),this.Gl.gi(i.key,t),this.Gl.pi(i.key)||this.__(i.key)):hr()}},t.prototype.f_=function(t){var e=t.key;this.jl.get(e)||(cr("SyncEngine","New document in limbo: "+e),this.Ql.push(e),this.o_())},t.prototype.o_=function(){for(;this.Ql.length>0&&this.jl.size<this.ql;){var t=this.Ql.shift(),e=this.Yl.next();this.Kl.set(e,new Ku(t)),this.jl=this.jl.nt(t,e),this.Ol.listen(new zr(cs(os(t.path)),e,2,Ls.ws))}},t.prototype.d_=function(){return this.jl},t.prototype.w_=function(){return this.Ql},t.prototype.i_=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.Ul.forEach((function(i,a){o.push(Promise.resolve().then((function(){var e=a.view.Rl(t);return e.Vl?s.$u.xh(a.query,!1).then((function(t){var n=t.documents;return a.view.Rl(n,e)})):e})).then((function(t){var i=e&&e.Wt.get(a.targetId),o=a.view.qn(t,s.Xl,i);if(s.e_(a.targetId,o.bl),o.snapshot){s.Xl&&s.Ll.Zc(a.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var c=$s.cs(a.targetId,o.snapshot);r.push(c)}})))})),[4,Promise.all(o)];case 1:return i.sent(),this.Bl.nu(n),[4,this.$u.Ch(r)];case 2:return i.sent(),[2]}}))}))},t.prototype.Zl=function(t){},t.prototype.Rc=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(cr("SyncEngine","User change. New user:",t.Aa()),[4,this.$u.Ah(t)]);case 1:return e=n.sent(),this.currentUser=t,this.c_("'waitForPendingWrites' promise is rejected due to a user change."),this.Ll.Ah(t,e.Ph,e.gh),[4,this.i_(e.Rh)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.xe=function(t){var e=this.Kl.get(t);if(e&&e.Ml)return ai().add(e.key);var n=ai(),r=this.Wl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.Ul.get(s);n=n.Ct(a.view.Al)}return n},t}();function Qu(t,e,n,r,i,o,s){var a=new Gu(t,e,n,r,i,o);return s&&(a.Jl=!0),a}function Yu(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,(n=pr(t)).$u.xh(e.query,!0)];case 1:return r=i.sent(),o=e.view.Dl(r),[2,(n.Xl&&n.e_(e.targetId,o.bl),o)]}}))}))}function Xu(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(o=pr(t)).Zl("applyBatchState()"),[4,function(t,e){var n=pr(t),r=pr(n.jn);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Br(t,e).next((function(e){return e?n.Ih.Jn(t,e):Ps.resolve(null)}))}))}(o.$u,e)];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,o.Ol.tc()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(o.h_(e,r||null),function(t,e){pr(pr(t).jn).Gr(e)}(o.$u,e)):hr(),i.label=4;case 4:return[4,o.i_(s)];case 5:return i.sent(),[3,7];case 6:cr("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}}))}))}function Ju(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,l;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=pr(t),!0!==e||!0===n.Jl?[3,3]:(r=n.Ll.Bc(),[4,Zu(n,r.F())]);case 1:return o=i.sent(),n.Jl=!0,[4,n.Ol.Pc(!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)c=a[s],n.Ol.listen(c);return[3,7];case 3:return!1!==e||!1===n.Jl?[3,7]:(u=[],l=Promise.resolve(),n.Wl.forEach((function(t,e){n.Ll.Jc(e)?u.push(e):l=l.then((function(){return n.n_(e),n.$u.kh(e,!0)})),n.Ol.ic(e)})),[4,l]);case 4:return i.sent(),[4,Zu(n,u)];case 5:return i.sent(),function(t){var e=pr(t);e.Kl.forEach((function(t,n){e.Ol.ic(n)})),e.Gl.Kh(),e.Kl=new Map,e.jl=new Qr(jr.P)}(n),n.Jl=!1,[4,n.Ol.Pc(!1)];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))}function Zu(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,l,h,f,p,d,m,y;return Object(i.d)(this,(function(i){switch(i.label){case 0:n=pr(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(c=a[s],u=void 0,(l=n.Wl.get(c))&&0!==l.length?[4,n.$u.Nh(cs(l[0]))]:[3,7]):[3,13];case 2:u=i.sent(),h=0,f=l,i.label=3;case 3:return h<f.length?(p=f[h],d=n.Ul.get(p),[4,Yu(n,d)]):[3,6];case 4:(m=i.sent()).snapshot&&o.push(m.snapshot),i.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,dc(n.$u,c)];case 8:return y=i.sent(),[4,n.$u.Nh(y)];case 9:return u=i.sent(),[4,n.t_(tl(y),c,!1)];case 10:i.sent(),i.label=11;case 11:r.push(u),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.Bl.nu(o),r)]}}))}))}function tl(t){return is(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function el(t){var e=pr(t);return pr(pr(e.$u).persistence).Ir()}function nl(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(o=pr(t)).Jl?(cr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Wl.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,function(t){var e=pr(t),n=pr(e.Eh);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n.Ks(t,e.Th)})).then((function(t){var n=t.Gs,r=t.readTime;return e.Th=r,n}))}(o.$u)];case 3:return s=i.sent(),a=pi.Gt(e,"current"===n),[4,o.i_(s,a)];case 4:return i.sent(),[3,8];case 5:return[4,o.$u.kh(e,!0)];case 6:return i.sent(),o.n_(e,r),[3,8];case 7:hr(),i.label=8;case 8:return[2]}}))}))}function rl(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a,c,u,l,h,f,p;return Object(i.d)(this,(function(d){switch(d.label){case 0:if(!(r=pr(t)).Jl)return[3,10];o=0,s=e,d.label=1;case 1:return o<s.length?(a=s[o],r.Wl.has(a)?(cr("SyncEngine","Adding an already active target "+a),[3,5]):[4,dc(r.$u,a)]):[3,6];case 2:return c=d.sent(),[4,r.$u.Nh(c)];case 3:return u=d.sent(),[4,r.t_(tl(c),u.targetId,!1)];case 4:d.sent(),r.Ol.listen(u),d.label=5;case 5:return o++,[3,1];case 6:l=function(t){return Object(i.d)(this,(function(e){switch(e.label){case 0:return r.Wl.has(t)?[4,r.$u.kh(t,!1).then((function(){r.Ol.ic(t),r.n_(t)})).catch(mc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,f=n,d.label=7;case 7:return h<f.length?(p=f[h],[5,l(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var il=function(){this.T_=void 0,this.listeners=[]},ol=function(){function t(t){this.oc=t,this.E_=new Er((function(t){return ps(t)}),fs),this.onlineState="Unknown",this.I_=new Set,this.oc.subscribe(this)}return t.prototype.listen=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:if(e=t.query,n=!1,(r=this.E_.get(e))||(n=!0,r=new il),!n)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),o=r,[4,this.oc.listen(e)];case 2:return o.T_=i.sent(),[3,4];case 3:return s=i.sent(),a=oc(s,"Initialization of query '"+ds(t.query)+"' failed"),[2,void t.onError(a)];case 4:return this.E_.set(e,r),r.listeners.push(t),t.vl(this.onlineState),r.T_&&t.m_(r.T_)&&this.A_(),[2]}}))}))},t.prototype.ic=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){return e=t.query,n=!1,(r=this.E_.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?[2,(this.E_.delete(e),this.oc.ic(e))]:[2]}))}))},t.prototype.nu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.E_.get(o);if(s){for(var a=0,c=s.listeners;a<c.length;a++)c[a].m_(i)&&(e=!0);s.T_=i}}e&&this.A_()},t.prototype.l_=function(t,e){var n=this.E_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.E_.delete(t)},t.prototype.r_=function(t){this.onlineState=t;var e=!1;this.E_.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].vl(t)&&(e=!0)})),e&&this.A_()},t.prototype.R_=function(t){this.I_.add(t),t.next()},t.prototype.P_=function(t){this.I_.delete(t)},t.prototype.A_=function(){this.I_.forEach((function(t){t.next()}))},t}(),sl=function(){function t(t,e,n){this.query=t,this.g_=e,this.V_=!1,this.y_=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.m_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new fi(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.qt,!0)}var o=!1;return this.V_?this.p_(t)&&(this.g_.next(t),o=!0):this.b_(t,this.onlineState)&&(this.v_(t),o=!0),this.y_=t,o},t.prototype.onError=function(t){this.g_.error(t)},t.prototype.vl=function(t){this.onlineState=t;var e=!1;return this.y_&&!this.V_&&this.b_(this.y_,t)&&(this.v_(this.y_),e=!0),e},t.prototype.b_=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.S_&&n||t.docs._()&&"Offline"!==e)},t.prototype.p_=function(t){if(t.docChanges.length>0)return!0;var e=this.y_&&this.y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.qt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.v_=function(t){t=fi.Ut(t.query,t.docs,t.Lt,t.fromCache),this.V_=!0,this.g_.next(t)},t}(),al=function(){function t(){}return t.prototype.mh=function(t){this.D_=t},t.prototype.ts=function(t,e,n,r){var i=this;return e.on()||n.isEqual(Ar.min())?this.C_(t,e):this.D_.Jn(t,r).next((function(s){var a=i.F_(e,s);return(e.hn()||e.an())&&i.Vl(e.en,a,r,n)?i.C_(t,e):(ar()<=o.a.DEBUG&&cr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ds(e)),i.D_.ts(t,e,n).next((function(t){return a.forEach((function(e){t=t.nt(e.key,e)})),t})))}))},t.prototype.F_=function(t,e){var n=new Jr(ys(t));return e.forEach((function(e,r){r instanceof Zo&&ms(t,r)&&(n=n.add(r))})),n},t.prototype.Vl=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0)},t.prototype.C_=function(t,e){return ar()<=o.a.DEBUG&&cr("IndexFreeQueryEngine","Using full collection scan to execute query:",ds(e)),this.D_.ts(t,e,Ar.min())},t}(),cl=function(){function t(t,e){this.Kn=t,this.ii=e,this.jn=[],this.N_=1,this.k_=new Jr(gc.Lh)}return t.prototype.Or=function(t){return Ps.resolve(0===this.jn.length)},t.prototype.Lr=function(t,e,n,r){var i=this.N_;this.N_++,this.jn.length>0&&this.jn[this.jn.length-1];var o=new xs(i,e,n,r);this.jn.push(o);for(var s=0,a=r;s<a.length;s++){var c=a[s];this.k_=this.k_.add(new gc(c.key,i)),this.Kn.Cs(t,c.key.path.p())}return Ps.resolve(o)},t.prototype.qr=function(t,e){return Ps.resolve(this.x_(e))},t.prototype.Ur=function(t,e){var n=e+1,r=this.M_(n),i=r<0?0:r;return Ps.resolve(this.jn.length>i?this.jn[i]:null)},t.prototype.Wr=function(){return Ps.resolve(0===this.jn.length?-1:this.N_-1)},t.prototype.Qr=function(t){return Ps.resolve(this.jn.slice())},t.prototype.zn=function(t,e){var n=this,r=new gc(e,0),i=new gc(e,Number.POSITIVE_INFINITY),o=[];return this.k_.vt([r,i],(function(t){var e=n.x_(t.zh);o.push(e)})),Ps.resolve(o)},t.prototype.Zn=function(t,e){var n=this,r=new Jr(yr);return e.forEach((function(t){var e=new gc(t,0),i=new gc(t,Number.POSITIVE_INFINITY);n.k_.vt([e,i],(function(t){r=r.add(t.zh)}))})),Ps.resolve(this.O_(r))},t.prototype.os=function(t,e){var n=e.path,r=n.length+1,i=n;jr.W(i)||(i=i.child(""));var o=new gc(new jr(i),0),s=new Jr(yr);return this.k_.St((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.zh)),!0)}),o),Ps.resolve(this.O_(s))},t.prototype.O_=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.x_(t);null!==r&&n.push(r)})),n},t.prototype.Kr=function(t,e){var n=this;fr(0===this.L_(e.batchId,"removed")),this.jn.shift();var r=this.k_;return Ps.forEach(e.mutations,(function(i){var o=new gc(i.key,e.batchId);return r=r.delete(o),n.ii.Dr(t,i.key)})).next((function(){n.k_=r}))},t.prototype.Gr=function(t){},t.prototype.pi=function(t,e){var n=new gc(e,0),r=this.k_.Dt(n);return Ps.resolve(e.isEqual(r&&r.key))},t.prototype.zr=function(t){return this.jn.length,Ps.resolve()},t.prototype.L_=function(t,e){return this.M_(t)},t.prototype.M_=function(t){return 0===this.jn.length?0:t-this.jn[0].batchId},t.prototype.x_=function(t){var e=this.M_(t);return e<0||e>=this.jn.length?null:this.jn[e]},t}(),ul=function(){function t(t,e){this.Kn=t,this.q_=e,this.docs=new Qr(jr.P),this.size=0}return t.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.q_(e);return this.docs=this.docs.nt(r,{Ls:e,size:s,readTime:n}),this.size+=s-o,this.Kn.Cs(t,r.path.p())},t.prototype.xn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Mn=function(t,e){var n=this.docs.get(e);return Ps.resolve(n?n.Ls:null)},t.prototype.getEntries=function(t,e){var n=this,r=ni();return e.forEach((function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ls:null)})),Ps.resolve(r)},t.prototype.ts=function(t,e,n){for(var r=ii(),i=new jr(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),a=s.key,c=s.value,u=c.Ls,l=c.readTime;if(!e.path.D(a.path))break;l.o(n)<=0||u instanceof Zo&&ms(e,u)&&(r=r.nt(u.key,u))}return Ps.resolve(r)},t.prototype.B_=function(t,e){return Ps.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Hs=function(e){return new t.Ys(this)},t.prototype.Xs=function(t){return Ps.resolve(this.size)},t}();ul.Ys=function(t){function e(e){var n=this;return(n=t.call(this)||this).Zs=e,n}return Object(i.c)(e,t),e.prototype.qn=function(t){var e=this,n=[];return this.Cn.forEach((function(r,i){i?n.push(e.Zs.Nn(t,i,e.readTime)):e.Zs.xn(r)})),Ps.Sn(n)},e.prototype.On=function(t,e){return this.Zs.Mn(t,e)},e.prototype.Ln=function(t,e){return this.Zs.getEntries(t,e)},e}(js);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ll=function(){function t(t){this.persistence=t,this.U_=new Er((function(t){return Fr(t)}),Br),this.lastRemoteSnapshotVersion=Ar.min(),this.highestTargetId=0,this.W_=0,this.Q_=new yc,this.targetCount=0,this.j_=la.ni()}return t.prototype.pe=function(t,e){return this.U_.forEach((function(t,n){return e(n)})),Ps.resolve()},t.prototype.ai=function(t){return Ps.resolve(this.lastRemoteSnapshotVersion)},t.prototype.ui=function(t){return Ps.resolve(this.W_)},t.prototype.ri=function(t){return this.highestTargetId=this.j_.next(),Ps.resolve(this.highestTargetId)},t.prototype.ci=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.W_&&(this.W_=e),Ps.resolve()},t.prototype._i=function(t){this.U_.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.j_=new la(e),this.highestTargetId=e),t.sequenceNumber>this.W_&&(this.W_=t.sequenceNumber)},t.prototype.li=function(t,e){return this._i(e),this.targetCount+=1,Ps.resolve()},t.prototype.di=function(t,e){return this._i(e),Ps.resolve()},t.prototype.wi=function(t,e){return this.U_.delete(e.target),this.Q_.jh(e.targetId),this.targetCount-=1,Ps.resolve()},t.prototype.Ei=function(t,e,n){var r=this,i=0,o=[];return this.U_.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.U_.delete(s),o.push(r.Ti(t,a.targetId)),i++)})),Ps.Sn(o).next((function(){return i}))},t.prototype.Ii=function(t){return Ps.resolve(this.targetCount)},t.prototype.mi=function(t,e){var n=this.U_.get(e)||null;return Ps.resolve(n)},t.prototype.Ai=function(t,e,n){return this.Q_.Uh(e,n),Ps.resolve()},t.prototype.Pi=function(t,e,n){this.Q_.Qh(e,n);var r=this.persistence.ii,i=[];return r&&e.forEach((function(e){i.push(r.Dr(t,e))})),Ps.Sn(i)},t.prototype.Ti=function(t,e){return this.Q_.jh(e),Ps.resolve()},t.prototype.Vi=function(t,e){var n=this.Q_.Gh(e);return Ps.resolve(n)},t.prototype.pi=function(t,e){return Ps.resolve(this.Q_.pi(e))},t}(),hl=function(){function t(t){var e=this;this.K_={},this.Ci=new Ls(0),this.Fi=!1,this.Fi=!0,this.ii=t(this),this.qi=new ll(this),this.Kn=new zs,this.Qn=new ul(this.Kn,(function(t){return e.ii.G_(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype._r=function(){return this.Fi=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Hi",{get:function(){return this.Fi},enumerable:!1,configurable:!0}),t.prototype.Yi=function(){},t.prototype.Xi=function(){},t.prototype.gr=function(){return this.Kn},t.prototype.mr=function(t){var e=this.K_[t.Aa()];return e||(e=new cl(this.Kn,this.ii),this.K_[t.Aa()]=e),e},t.prototype.Rr=function(){return this.qi},t.prototype.Pr=function(){return this.Qn},t.prototype.runTransaction=function(t,e,n){var r=this;cr("MemoryPersistence","Starting transaction:",t);var i=new fl(this.Ci.next());return this.ii.z_(),n(i).next((function(t){return r.ii.H_(i).next((function(){return t}))})).bn().then((function(t){return i.Wn(),t}))},t.prototype.Y_=function(t,e){return Ps.Dn(Object.values(this.K_).map((function(n){return function(){return n.pi(t,e)}})))},t}(),fl=function(t){function e(e){var n=this;return(n=t.call(this)||this).vi=e,n}return Object(i.c)(e,t),e}(Ms),pl=function(){function t(t){this.persistence=t,this.J_=new yc,this.X_=null}return t.Z_=function(e){return new t(e)},Object.defineProperty(t.prototype,"tf",{get:function(){if(this.X_)return this.X_;throw hr()},enumerable:!1,configurable:!0}),t.prototype.Ri=function(t,e,n){return this.J_.Ri(n,e),this.tf.delete(n),Ps.resolve()},t.prototype.gi=function(t,e,n){return this.J_.gi(n,e),this.tf.add(n),Ps.resolve()},t.prototype.Dr=function(t,e){return this.tf.add(e),Ps.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.J_.jh(e.targetId).forEach((function(t){return n.tf.add(t)}));var r=this.persistence.Rr();return r.Vi(t,e.targetId).next((function(t){t.forEach((function(t){return n.tf.add(t)}))})).next((function(){return r.wi(t,e)}))},t.prototype.z_=function(){this.X_=new Set},t.prototype.H_=function(t){var e=this,n=this.persistence.Pr().Hs();return Ps.forEach(this.tf,(function(r){return e.ef(t,r).next((function(t){t||n.xn(r)}))})).next((function(){return e.X_=null,n.apply(t)}))},t.prototype.Nr=function(t,e){var n=this;return this.ef(t,e).next((function(t){t?n.tf.delete(e):n.tf.add(e)}))},t.prototype.G_=function(t){return 0},t.prototype.ef=function(t,e){var n=this;return Ps.Dn([function(){return Ps.resolve(n.J_.pi(e))},function(){return n.persistence.Rr().pi(t,e)},function(){return n.persistence.Y_(t,e)}])},t}(),dl=function(){function t(t){this.nf=t.nf,this.sf=t.sf}return t.prototype.tu=function(t){this.if=t},t.prototype.Ha=function(t){this.rf=t},t.prototype.onMessage=function(t){this.hf=t},t.prototype.close=function(){this.sf()},t.prototype.send=function(t){this.nf(t)},t.prototype.af=function(){this.if()},t.prototype.uf=function(t){this.rf(t)},t.prototype.cf=function(t){this.hf(t)},t}(),ml={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},yl=function(){function t(t){this.s=t.s;var e=t.ssl?"https":"http";this.lf=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype._f=function(t,e){if(e)for(var n in e.ga)e.ga.hasOwnProperty(n)&&(t[n]=e.ga[n]);t["X-Goog-Api-Client"]="gl-js/ fire/7.17.1"},t.prototype.fu=function(t,e,n){var r=this,i=this.ff(t);return new Promise((function(o,s){var a=new ir;a.listenOnce(nr.COMPLETE,(function(){try{switch(a.getLastErrorCode()){case er.NO_ERROR:var e=a.getResponseJson();cr("Connection","XHR received:",JSON.stringify(e)),o(e);break;case er.TIMEOUT:cr("Connection",'RPC "'+t+'" timed out'),s(new Cr(Tr.DEADLINE_EXCEEDED,"Request time out"));break;case er.HTTP_ERROR:var n=a.getStatus();if(cr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(Tr).indexOf(e)>=0?e:Tr.UNKNOWN}(r.status);s(new Cr(i,r.message))}else s(new Cr(Tr.UNKNOWN,"Server responded with status "+a.getStatus()))}else cr("Connection",'RPC "'+t+'" failed'),s(new Cr(Tr.UNAVAILABLE,"Connection failed."));break;default:hr()}}finally{cr("Connection",'RPC "'+t+'" completed.')}}));var c=Object.assign({},e);delete c.database;var u=JSON.stringify(c);cr("Connection","XHR sending: ",i+" "+u);var l={"Content-Type":"text/plain"};r._f(l,n),a.send(i,"POST",u,l,15)}))},t.prototype.du=function(t,e,n){return this.fu(t,e,n)},t.prototype.eu=function(t,e){var n=[this.lf,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=tr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this._f(a.initMessageHeaders,e),Object(s.x)()||Object(s.A)()||Object(s.t)()||Object(s.v)()||Object(s.B)()||Object(s.s)()||(a.httpHeadersOverwriteParam="$httpHeaders");var c=n.join("");cr("Connection","Creating WebChannel: "+c+" "+a);var u=r.createWebChannel(c,a),l=!1,h=!1,f=new dl({nf:function(t){h?cr("Connection","Not sending because WebChannel is closed:",t):(l||(cr("Connection","Opening WebChannel transport."),u.open(),l=!0),cr("Connection","WebChannel sending:",t),u.send(t))},sf:function(){return u.close()}}),p=function(t,e){u.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return p(rr.EventType.OPEN,(function(){h||cr("Connection","WebChannel transport opened.")})),p(rr.EventType.CLOSE,(function(){h||(h=!0,cr("Connection","WebChannel transport closed"),f.uf())})),p(rr.EventType.ERROR,(function(t){h||(h=!0,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(sr.logLevel<=o.a.WARN){var r=e.map(lr);sr.warn.apply(sr,Object(i.g)(["Firestore (7.17.1): "+t],r))}}("Connection","WebChannel transport errored:",t),f.uf(new Cr(Tr.UNAVAILABLE,"The operation could not be completed")))})),p(rr.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];fr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){cr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=qr[t];if(void 0!==e)return Gr(e)}(o),a=i.message;void 0===s&&(s=Tr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,f.uf(new Cr(s,a)),u.close()}else cr("Connection","WebChannel received:",n),f.cf(n)}})),setTimeout((function(){f.af()}),0),f},t.prototype.ff=function(t){var e=ml[t];return this.lf+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},t}(),gl=function(){function t(){var t=this;this.df=function(){return t.wf()},this.Tf=function(){return t.Ef()},this.If=[],this.mf()}return t.prototype.Lu=function(t){this.If.push(t)},t.prototype._r=function(){window.removeEventListener("online",this.df),window.removeEventListener("offline",this.Tf)},t.prototype.mf=function(){window.addEventListener("online",this.df),window.addEventListener("offline",this.Tf)},t.prototype.wf=function(){cr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.If;t<e.length;t++)(0,e[t])(0)},t.prototype.Ef=function(){cr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.If;t<e.length;t++)(0,e[t])(1)},t.Oi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),vl=function(){function t(){}return t.prototype.Lu=function(t){},t.prototype._r=function(){},t}(),bl="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",_l=function(){function t(){}return t.prototype.initialize=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.Ll=this.Af(t),this.persistence=this.Rf(t),[4,this.persistence.start()];case 1:return r.sent(),this.Pf=this.gf(t),this.$u=this.Vf(t),this.wu=this.yf(t),[4,this.pf(t)];case 2:return e=r.sent(),this.wu.start(e),this.Ol=this.bf(t),this.oc=this.vf(t),this.Sf=this.Df(t),this.Ll.Vu=function(t){return n.oc.vl(t,1)},this.Ol.oc=this.oc,[4,this.Ll.start()];case 3:return r.sent(),[4,this.Ol.start()];case 4:return r.sent(),[4,this.Ol.Pc(this.oc.Xl)];case 5:return r.sent(),[2]}}))}))},t.prototype.pf=function(t){return e=t.Cf,Promise.resolve(new yl(e));var e},t.prototype.Df=function(t){return new ol(this.oc)},t.prototype.gf=function(t){return null},t.prototype.Vf=function(t){return pc(this.persistence,new al,t.Ff)},t.prototype.Rf=function(t){if(t.Nf.$f)throw new Cr(Tr.FAILED_PRECONDITION,bl);return new hl(pl.Z_)},t.prototype.yf=function(t){var e=Zc(t.Cf.s);return function(t,e){return new Au(t,e)}(t.credentials,e)},t.prototype.bf=function(t){var e=this;return new Nu(this.$u,this.wu,t.ao,(function(t){return e.oc.vl(t,0)}),gl.Oi()?new gl:new vl)},t.prototype.Af=function(t){return new Uu},t.prototype.vf=function(t){return Qu(this.$u,this.Ol,this.wu,this.Ll,t.Ff,t.ql,!0)},t.prototype.clearPersistence=function(t,e){throw new Cr(Tr.FAILED_PRECONDITION,bl)},t}(),wl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.initialize=function(e){return Object(i.b)(this,void 0,void 0,(function(){var n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,this.persistence.zi((function(t){return Object(i.b)(n,void 0,void 0,(function(){return Object(i.d)(this,(function(e){switch(e.label){case 0:return[4,Ju(this.oc,t)];case 1:return e.sent(),this.Pf&&(t&&!this.Pf.Hi?this.Pf.start(this.$u):t||this.Pf.stop()),[2]}}))}))}))];case 2:return r.sent(),[4,function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){return e=pr(t),n=pr(e.Eh),[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return n.zs(t)})).then((function(t){e.Th=t}))]}))}))}(this.$u)];case 3:return r.sent(),[2]}}))}))},e.prototype.vf=function(t){var e=!t.Nf.$f||!t.Nf.synchronizeTabs,n=Qu(this.$u,this.Ol,this.wu,this.Ll,t.Ff,t.ql,e);return this.Ll instanceof Bu&&(this.Ll.oc={cl:Xu.bind(null,n),ll:nl.bind(null,n),_l:rl.bind(null,n),Ir:el.bind(null,n)}),n},e.prototype.Af=function(t){if(t.Nf.$f&&t.Nf.synchronizeTabs){var e=nc();if(!Bu.Oi(e))throw new Cr(Tr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Sa(t.Cf.s,t.Cf.persistenceKey);return new Bu(e,t.ao,n,t.clientId,t.Ff)}return new Uu},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.Vf=function(t){return pc(this.persistence,new al,t.Ff)},e.prototype.gf=function(t){var e=this.persistence.ii.yr;return new lc(e,t.ao)},e.prototype.Rf=function(t){var e=Sa(t.Cf.s,t.Cf.persistenceKey),n=Zc(t.Cf.s);return new ga(t.Nf.synchronizeTabs,e,t.clientId,uc.Ho(t.Nf.cacheSizeBytes),t.ao,nc(),"undefined"!=typeof document?document:null,n,this.Ll,t.Nf.Di)},e.prototype.Af=function(t){return new Uu},e.prototype.clearPersistence=function(t,e){return function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return Ka.Oi()?(e=t+"main",[4,Ka.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Sa(t,e))},e}(_l)),Sl=function(){function t(t,e){this.credentials=t,this.ao=e,this.clientId=mr.t()}return t.prototype.start=function(t,e,n){var r=this;this.kf(),this.Cf=t;var i=new Fs,o=new Fs,s=!1;return this.credentials.pa((function(t){if(!s)return s=!0,cr("FirestoreClient","Initializing. user=",t.uid),r.xf(e,n,t,o).then(i.resolve,i.reject);r.ao.er((function(){return r.Ol.Rc(t)}))})),this.ao.Zi((function(){return i.promise})),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.kf(),this.ao.enqueue((function(){return t.persistence.Xi(!0),t.Ol.enableNetwork()}))},t.prototype.xf=function(t,e,n,r){return Object(i.b)(this,void 0,void 0,(function(){var o,s=this;return Object(i.d)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,t.initialize({ao:this.ao,Cf:this.Cf,clientId:this.clientId,credentials:this.credentials,Ff:n,ql:100,Nf:e})];case 1:return a.sent(),this.persistence=t.persistence,this.Ll=t.Ll,this.$u=t.$u,this.Ol=t.Ol,this.oc=t.oc,this.Pf=t.Pf,this.Mf=t.Sf,this.persistence.Yi((function(){return Object(i.b)(s,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),r.resolve(),[3,3];case 2:if(o=a.sent(),r.reject(o),!this.Of(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.xf(new _l,{$f:!1},n,r))];case 3:return[2]}}))}))},t.prototype.Of=function(t){return"FirebaseError"===t.name?t.code===Tr.FAILED_PRECONDITION||t.code===Tr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.kf=function(){if(this.ao.yo)throw new Cr(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.kf(),this.ao.enqueue((function(){return t.persistence.Xi(!1),t.Ol.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.ao.Do((function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.Pf&&this.Pf.stop(),[4,this.Ol._r()];case 1:return t.sent(),[4,this.Ll._r()];case 2:return t.sent(),[4,this.persistence._r()];case 3:return t.sent(),this.credentials.ba(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.kf();var e=new Fs;return this.ao.Zi((function(){return t.oc.u_(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.kf();var i=new sl(t,e,n);return this.ao.Zi((function(){return r.Mf.listen(i)})),i},t.prototype.ic=function(t){var e=this;this.Lf||this.ao.Zi((function(){return e.Mf.ic(t)}))},t.prototype.qf=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.kf(),e=new Fs,[4,this.ao.enqueue((function(){return Object(i.b)(n,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$u.$h(t)];case 1:return(n=i.sent())instanceof Zo?e.resolve(n):n instanceof ts?e.resolve(null):e.reject(new Cr(Tr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=oc(r,"Failed to get document '"+t+" from cache"),e.reject(o),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},t.prototype.Bf=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.kf(),e=new Fs,[4,this.ao.enqueue((function(){return Object(i.b)(n,void 0,void 0,(function(){var n,r,o,s,a,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.$u.xh(t,!0)];case 1:return n=i.sent(),r=new Wu(t,n.Mh),o=r.Rl(n.documents),s=r.qn(o,!1),e.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),c=oc(a,"Failed to execute query '"+t+" against cache"),e.reject(c),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},t.prototype.write=function(t){var e=this;this.kf();var n=new Fs;return this.ao.Zi((function(){return e.oc.write(t,n)})),n.promise},t.prototype.s=function(){return this.Cf.s},t.prototype.R_=function(t){var e=this;this.kf(),this.ao.Zi((function(){return e.Mf.R_(t),Promise.resolve()}))},t.prototype.P_=function(t){var e=this;this.Lf||this.ao.Zi((function(){return e.Mf.P_(t),Promise.resolve()}))},Object.defineProperty(t.prototype,"Lf",{get:function(){return this.ao.yo},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.kf();var n=new Fs;return this.ao.Zi((function(){return e.oc.runTransaction(e.ao,t,n),Promise.resolve()})),n.promise},t}(),Ol=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.Uf(this.observer.next,t)},t.prototype.error=function(t){this.Uf(this.observer.error,t)},t.prototype.Wf=function(){this.muted=!0},t.prototype.Uf=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Tl=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Qf=n,this.jf=r}return t.prototype.Kf=function(t){switch(Ti(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pi(t.integerValue||t.doubleValue);case 3:return this.Gf(t.timestampValue);case 4:return this.zf(t);case 5:return t.stringValue;case 6:return new Fc(ji(t.bytesValue));case 7:return this.Hf(t.referenceValue);case 8:return this.Yf(t.geoPointValue);case 9:return this.Jf(t.arrayValue);case 10:return this.Xf(t.mapValue);default:throw hr()}},t.prototype.Xf=function(t){var e=this,n={};return Sr(t.fields||{},(function(t,r){n[t]=e.Kf(r)})),n},t.prototype.Yf=function(t){return new Jc(Pi(t.latitude),Pi(t.longitude))},t.prototype.Jf=function(t){var e=this;return(t.values||[]).map((function(t){return e.Kf(t)}))},t.prototype.zf=function(t){switch(this.Qf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Si(n)?t(n):n}(t);return null==e?null:this.Kf(e);case"estimate":return this.Gf(Oi(t));default:return null}},t.prototype.Gf=function(t){var e=Ni(t),n=new Ir(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.Hf=function(t){var e=xr.N(t);fr(go(e));var n=new _r(e.get(1),e.get(3)),r=new jr(e.V(5));return n.isEqual(this.s)||ur("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.jf(r)},t}(),Cl=uc.Xo,Il=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Cr(Tr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ec("settings","non-empty string","host",t.host),this.host=t.host,Tc("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Pc("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Tc("settings","object","credentials",t.credentials),this.credentials=t.credentials,Tc("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Tc("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?ur("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&ur("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Tc("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=uc.th;else{if(t.cacheSizeBytes!==Cl&&t.cacheSizeBytes<uc.Zo)throw new Cr(Tr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+uc.Zo);this.cacheSizeBytes=t.cacheSizeBytes}Tc("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Al=function(){function t(e,n,r){var o=this;if(void 0===r&&(r=new _l),this.Zf=null,this.td=new ic,this.INTERNAL={delete:function(){return Object(i.b)(o,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return this.ed(),[4,this.nd.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var s=e;this.Zf=s,this.aa=t.sd(s),this.rd=s.name,this.od=new Su(n)}else{var a=e;if(!a.projectId)throw new Cr(Tr.INVALID_ARGUMENT,"Must provide projectId");this.aa=new _r(a.projectId,a.database),this.rd="[DEFAULT]",this.od=new wu}this.hd=r,this.ad=new Il({})}return Object.defineProperty(t.prototype,"ud",{get:function(){return this.ld||(this.ld=new su(this.aa,this.ad.ignoreUndefinedProperties)),this.ld},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){bc("Firestore.settings",arguments,1),Sc("Firestore.settings","object",1,t);var e=new Il(t);if(this.nd&&!this.ad.isEqual(e))throw new Cr(Tr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.ad=e,void 0!==e.credentials&&(this.od=function(t){if(!t)return new wu;switch(t.type){case"gapi":var e=t._d;return fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Eu(e,t.$a||"0");case"provider":return t._d;default:throw new Cr(Tr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ed(),this.nd.enableNetwork()},t.prototype.disableNetwork=function(){return this.ed(),this.nd.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.nd)throw new Cr(Tr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&ur("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Cr(Tr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.fd(this.hd,{$f:!0,cacheSizeBytes:this.ad.cacheSizeBytes,synchronizeTabs:r,Di:i})},t.prototype.clearPersistence=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e=this;return Object(i.d)(this,(function(n){if(void 0!==this.nd&&!this.nd.Lf)throw new Cr(Tr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new Fs,[2,(this.td.po((function(){return Object(i.b)(e,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.hd.clearPersistence(this.aa,this.rd)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"dd",{get:function(){return this.ed(),this.nd.Lf},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ed(),this.nd.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.ed(),El(t))return kl(this.nd,t);Sc("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return kl(this.nd,e)},t.prototype.ed=function(){return this.nd||this.fd(new _l,{$f:!1}),this.nd},t.prototype.wd=function(){return new br(this.aa,this.rd,this.ad.host,this.ad.ssl,this.ad.forceLongPolling)},t.prototype.fd=function(t,e){var n=this.wd();return this.nd=new Sl(this.od,this.td),this.nd.start(n,t,e)},t.sd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Cr(Tr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(!n||"string"!=typeof n)throw new Cr(Tr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new _r(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zf)throw new Cr(Tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return bc("Firestore.collection",arguments,1),Sc("Firestore.collection","non-empty string",1,t),this.ed(),new Hl(xr.N(t),this,null)},t.prototype.doc=function(t){return bc("Firestore.doc",arguments,1),Sc("Firestore.doc","non-empty string",1,t),this.ed(),Pl.Td(xr.N(t),this,null)},t.prototype.collectionGroup=function(t){if(bc("Firestore.collectionGroup",arguments,1),Sc("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ed(),new ql(function(t){return new rs(xr.k(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return bc("Firestore.runTransaction",arguments,1),Sc("Firestore.runTransaction","function",1,t),this.ed().transaction((function(n){return t(new xl(e,n))}))},t.prototype.batch=function(){return this.ed(),new Nl(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(ar()){case o.a.DEBUG:return"debug";case o.a.ERROR:return"error";case o.a.SILENT:return"silent";case o.a.WARN:return"warn";case o.a.INFO:return"info";case o.a.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;bc("Firestore.setLogLevel",arguments,1),Ic("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,sr.setLogLevel(e)},t.prototype.Ed=function(){return this.ad.timestampsInSnapshots},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(t,e){var n=new Ol({next:function(){e.next&&e.next()},error:function(t){throw hr()}});return t.R_(n),function(){n.Wf(),t.P_(n)}}var xl=function(){function t(t,e){this.Id=t,this.md=e}return t.prototype.get=function(t){var e=this;bc("Transaction.get",arguments,1);var n=Yl("Transaction.get",t,this.Id);return this.md.Au([n.ua]).then((function(t){if(!t||1!==t.length)return hr();var r=t[0];if(r instanceof ts)return new Ml(e.Id,n.ua,null,!1,!1,n.ca);if(r instanceof Zo)return new Ml(e.Id,n.ua,r,!1,!1,n.ca);throw hr()}))},t.prototype.set=function(t,e,n){wc("Transaction.set",arguments,2,3);var r=Yl("Transaction.set",t,this.Id);n=Kl("Transaction.set",n);var i=Jl(r.ca,e,n),o=au(this.Id.ud,"Transaction.set",r.ua,i,null!==r.ca,n);return this.md.set(r.ua,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof Uc?(_c("Transaction.update",arguments,3),r=Yl("Transaction.update",t,this.Id),i=uu(this.Id.ud,"Transaction.update",r.ua,e,n,o)):(bc("Transaction.update",arguments,2),r=Yl("Transaction.update",t,this.Id),i=cu(this.Id.ud,"Transaction.update",r.ua,e)),this.md.update(r.ua,i),this},t.prototype.delete=function(t){bc("Transaction.delete",arguments,1);var e=Yl("Transaction.delete",t,this.Id);return this.md.delete(e.ua),this},t}(),Nl=function(){function t(t){this.Id=t,this.Ad=[],this.Rd=!1}return t.prototype.set=function(t,e,n){wc("WriteBatch.set",arguments,2,3),this.Pd();var r=Yl("WriteBatch.set",t,this.Id);n=Kl("WriteBatch.set",n);var i=Jl(r.ca,e,n),o=au(this.Id.ud,"WriteBatch.set",r.ua,i,null!==r.ca,n);return this.Ad=this.Ad.concat(o.la(r.ua,jo.We())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Pd(),"string"==typeof e||e instanceof Uc?(_c("WriteBatch.update",arguments,3),r=Yl("WriteBatch.update",t,this.Id),i=uu(this.Id.ud,"WriteBatch.update",r.ua,e,n,o)):(bc("WriteBatch.update",arguments,2),r=Yl("WriteBatch.update",t,this.Id),i=cu(this.Id.ud,"WriteBatch.update",r.ua,e)),this.Ad=this.Ad.concat(i.la(r.ua,jo.exists(!0))),this},t.prototype.delete=function(t){bc("WriteBatch.delete",arguments,1),this.Pd();var e=Yl("WriteBatch.delete",t,this.Id);return this.Ad=this.Ad.concat(new Ko(e.ua,jo.We())),this},t.prototype.commit=function(){return this.Pd(),this.Rd=!0,this.Ad.length>0?this.Id.ed().write(this.Ad):Promise.resolve()},t.prototype.Pd=function(){if(this.Rd)throw new Cr(Tr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Pl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.aa,e,r)||this).ua=e,i.firestore=n,i.ca=r,i.nd=i.firestore.ed(),i}return Object(i.c)(e,t),e.Td=function(t,n,r){if(t.length%2!=0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.$()+" has "+t.length);return new e(new jr(t),n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this.ua.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Hl(this.ua.path.p(),this.firestore,this.ca)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.ua.path.$()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(bc("DocumentReference.collection",arguments,1),Sc("DocumentReference.collection","non-empty string",1,t),!t)throw new Cr(Tr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=xr.N(t);return new Hl(this.ua.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw jc("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.ua.isEqual(t.ua)&&this.ca===t.ca},e.prototype.set=function(t,e){wc("DocumentReference.set",arguments,1,2),e=Kl("DocumentReference.set",e);var n=Jl(this.ca,t,e),r=au(this.firestore.ud,"DocumentReference.set",this.ua,n,null!==this.ca,e);return this.nd.write(r.la(this.ua,jo.We()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof Uc?(_c("DocumentReference.update",arguments,2),n=uu(this.firestore.ud,"DocumentReference.update",this.ua,t,e,r)):(bc("DocumentReference.update",arguments,1),n=cu(this.firestore.ud,"DocumentReference.update",this.ua,t)),this.nd.write(n.la(this.ua,jo.exists(!0)))},e.prototype.delete=function(){return bc("DocumentReference.delete",arguments,0),this.nd.write([new Ko(this.ua,jo.We())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];wc("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||El(i[a])||(Pc("DocumentReference.onSnapshot",s=i[a],["includeMetadataChanges"]),Tc("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),a++);var c={includeMetadataChanges:s.includeMetadataChanges};if(El(i[a])){var u=i[a];i[a]=null===(t=u.next)||void 0===t?void 0:t.bind(u),i[a+1]=null===(e=u.error)||void 0===e?void 0:e.bind(u),i[a+2]=null===(n=u.complete)||void 0===n?void 0:n.bind(u)}else Sc("DocumentReference.onSnapshot","function",a,i[a]),Oc("DocumentReference.onSnapshot","function",a+1,i[a+1]),Oc("DocumentReference.onSnapshot","function",a+2,i[a+2]);var l={next:function(t){i[a]&&i[a](r.gd(t))},error:i[a+1],complete:i[a+2]};return jl(this.nd,this.ua,c,l)},e.prototype.get=function(t){var e=this;return wc("DocumentReference.get",arguments,0,1),Ql("DocumentReference.get",t),t&&"cache"===t.source?this.firestore.ed().qf(this.ua).then((function(t){return new Ml(e.firestore,e.ua,t,!0,t instanceof Zo&&t.Ke,e.ca)})):function(t,e,n){var r=new Fs,i=jl(t,e,{includeMetadataChanges:!0,S_:!0},{next:function(t){i();var o=t.docs.has(e);!o&&t.fromCache?r.reject(new Cr(Tr.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&t.fromCache&&n&&"server"===n.source?r.reject(new Cr(Tr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(t)},error:function(t){return r.reject(t)}});return r.promise}(this.nd,this.ua,t).then((function(t){return e.gd(t)}))},e.prototype.withConverter=function(t){return new e(this.ua,this.firestore,t)},e.prototype.gd=function(t){var e=t.docs.get(this.ua);return new Ml(this.firestore,this.ua,e,t.fromCache,t.hasPendingWrites,this.ca)},e}(eu);function jl(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Ol({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(os(e.path),o,n);return function(){o.Wf(),t.ic(s)}}var Rl=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Ml=function(){function t(t,e,n,r,i,o){this.Id=t,this.ua=e,this.Vd=n,this.yd=r,this.pd=i,this.ca=o}return t.prototype.data=function(t){var e=this;if(wc("DocumentSnapshot.data",arguments,0,1),t=Gl("DocumentSnapshot.data",t),this.Vd){if(this.ca){var n=new Dl(this.Id,this.ua,this.Vd,this.yd,this.pd,null);return this.ca.fromFirestore(n,t)}return new Tl(this.Id.aa,this.Id.Ed(),t.serverTimestamps||"none",(function(t){return new Pl(t,e.Id,null)})).Kf(this.Vd.Ze())}},t.prototype.get=function(t,e){var n=this;if(wc("DocumentSnapshot.get",arguments,1,2),e=Gl("DocumentSnapshot.get",e),this.Vd){var r=this.Vd.data().field(mu("DocumentSnapshot.get",t,this.ua));if(null!==r)return new Tl(this.Id.aa,this.Id.Ed(),e.serverTimestamps||"none",(function(t){return new Pl(t,n.Id,n.ca)})).Kf(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.ua.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Pl(this.ua,this.Id,this.ca)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Vd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Rl(this.pd,this.yd)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw jc("isEqual","DocumentSnapshot",1,e);return this.Id===e.Id&&this.yd===e.yd&&this.ua.isEqual(e.ua)&&(null===this.Vd?null===e.Vd:this.Vd.isEqual(e.Vd))&&this.ca===e.ca},t}(),Dl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(i.c)(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(Ml);function $l(t,e,n,r,i,o,s){var a;if(i.O()){if("array-contains"===o||"array-contains-any"===o)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o){Bl(s,o);for(var c=[],u=0,l=s;u<l.length;u++){var h=l[u];c.push(Fl(r,t,h))}a={arrayValue:{values:c}}}else a=Fl(r,t,s)}else"in"!==o&&"array-contains-any"!==o||Bl(s,o),a=lu(n,e,s,"in"===o);var f=gs.create(i,o,a);return function(t,e){if(e instanceof gs){var n=["array-contains","array-contains-any"],r=["in","array-contains-any"],i=n.indexOf(e.op)>=0,o=r.indexOf(e.op)>=0;if(e.ln()){var s=t.cn();if(null!==s&&!s.isEqual(e.field))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+s.toString()+"' and '"+e.field.toString()+"'");var a=t.un();null!==a&&Ul(t,e.field,a)}else if(o||i){var c=null;if(o&&(c=t._n(r)),null===c&&i&&(c=t._n(n)),null!==c)throw c===e.op?new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+c.toString()+"' filters.")}}}(t,f),f}function Ll(t,e,n){if(null!==t.startAt)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Is(e,n);return function(t,e){if(null===t.un()){var n=t.cn();null!==n&&Ul(t,n,e.field)}}(t,r),r}function Fl(t,e,n){if("string"==typeof n){if(""===n)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ss(e)&&-1!==n.indexOf("/"))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(xr.N(n));if(!jr.W(r))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ri(t,new jr(r))}if(n instanceof eu)return Ri(t,n.ua);throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+xc(n)+".")}function Bl(t,e){if(!Array.isArray(t)||0===t.length)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}function Ul(t,e,n){if(!n.isEqual(e))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Vl(t){if(t.an()&&0===t.tn.length)throw new Cr(Tr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ql=function(){function t(t,e,n){this.bd=t,this.firestore=e,this.ca=n}return t.prototype.where=function(e,n,r){bc("Query.where",arguments,3),Nc("Query.where",3,r);var i=Ic("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n),o=mu("Query.where",e),s=$l(this.bd,"Query.where",this.firestore.ud,this.firestore.aa,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new rs(t.path,t.collectionGroup,t.tn.slice(),n,t.limit,t.en,t.startAt,t.endAt)}(this.bd,s),this.firestore,this.ca)},t.prototype.orderBy=function(e,n){var r;if(wc("Query.orderBy",arguments,1,2),Oc("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new Cr(Tr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=mu("Query.orderBy",e),o=Ll(this.bd,i,r);return new t(function(t,e){var n=t.tn.concat([e]);return new rs(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.en,t.startAt,t.endAt)}(this.bd,o),this.firestore,this.ca)},t.prototype.limit=function(e){return bc("Query.limit",arguments,1),Sc("Query.limit","number",1,e),Rc("Query.limit",1,e),new t(us(this.bd,e,"F"),this.firestore,this.ca)},t.prototype.limitToLast=function(e){return bc("Query.limitToLast",arguments,1),Sc("Query.limitToLast","number",1,e),Rc("Query.limitToLast",1,e),new t(us(this.bd,e,"L"),this.firestore,this.ca)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];_c("Query.startAt",arguments,1);var i=this.vd("Query.startAt",e,n,!0);return new t(ls(this.bd,i),this.firestore,this.ca)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];_c("Query.startAfter",arguments,1);var i=this.vd("Query.startAfter",e,n,!1);return new t(ls(this.bd,i),this.firestore,this.ca)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];_c("Query.endBefore",arguments,1);var i=this.vd("Query.endBefore",e,n,!0);return new t(hs(this.bd,i),this.firestore,this.ca)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];_c("Query.endAt",arguments,1);var i=this.vd("Query.endAt",e,n,!1);return new t(hs(this.bd,i),this.firestore,this.ca)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw jc("isEqual","Query",1,e);return this.firestore===e.firestore&&fs(this.bd,e.bd)&&this.ca===e.ca},t.prototype.withConverter=function(e){return new t(this.bd,this.firestore,e)},t.prototype.vd=function(t,e,n,r){if(Nc(t,1,e),e instanceof Ml)return bc(t,Object(i.g)([e],n),1),function(t,e,n,r,i){if(!r)throw new Cr(Tr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=as(t);s<a.length;s++){var c=a[s];if(c.field.O())o.push(Ri(e,r.key));else{var u=r.field(c.field);if(Si(u))throw new Cr(Tr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var l=c.field.$();throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(u)}}return new Os(o,i)}(this.bd,this.firestore.aa,t,e.Vd,r);var o=[e].concat(n);return function(t,e,n,r,i,o){var s=t.tn;if(i.length>s.length)throw new Cr(Tr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],c=0;c<i.length;c++){var u=i[c];if(s[c].field.O()){if("string"!=typeof u)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof u);if(!ss(t)&&-1!==u.indexOf("/"))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+u+"' contains a slash.");var l=t.path.child(xr.N(u));if(!jr.W(l))throw new Cr(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");var h=new jr(l);a.push(Ri(e,h))}else{var f=lu(n,r,u);a.push(f)}}return new Os(a,o)}(this.bd,this.firestore.aa,this.firestore.ud,t,o,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];wc("Query.onSnapshot",arguments,1,4);var s={},a=0;if("object"!=typeof i[a]||El(i[a])||(Pc("Query.onSnapshot",s=i[a],["includeMetadataChanges"]),Tc("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),a++),El(i[a])){var c=i[a];i[a]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[a+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[a+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else Sc("Query.onSnapshot","function",a,i[a]),Oc("Query.onSnapshot","function",a+1,i[a+1]),Oc("Query.onSnapshot","function",a+2,i[a+2]);var u={next:function(t){i[a]&&i[a](new zl(r.firestore,r.bd,t,r.ca))},error:i[a+1],complete:i[a+2]};return Vl(this.bd),Wl(this.firestore.ed(),this.bd,s,u)},t.prototype.get=function(t){var e=this;wc("Query.get",arguments,0,1),Ql("Query.get",t),Vl(this.bd);var n=this.firestore.ed();return(t&&"cache"===t.source?n.Bf(this.bd):function(t,e,n){var r=new Fs,i=Wl(t,e,{includeMetadataChanges:!0,S_:!0},{next:function(t){i(),t.fromCache&&n&&"server"===n.source?r.reject(new Cr(Tr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(t)},error:function(t){return r.reject(t)}});return r.promise}(n,this.bd,t)).then((function(t){return new zl(e.firestore,e.bd,t,e.ca)}))},t}();function Wl(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Ol({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(e,o,n);return function(){o.Wf(),t.ic(s)}}var zl=function(){function t(t,e,n,r){this.Id=t,this.Sd=e,this.Dd=n,this.ca=r,this.Cd=null,this.Fd=null,this.metadata=new Rl(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.Dd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.Dd.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;wc("QuerySnapshot.forEach",arguments,1,2),Sc("QuerySnapshot.forEach","function",1,t),this.Dd.docs.forEach((function(r){t.call(e,n.$d(r,n.metadata.fromCache,n.Dd.Lt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new ql(this.Sd,this.Id,this.ca)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(Pc("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Tc("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Dd.Bt)throw new Cr(Tr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Cd&&this.Fd===e||(this.Cd=function(t,e,n){if(t.Ot._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Lt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ot;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Lt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:Xl(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.Dd,e,this.$d.bind(this)),this.Fd=e),this.Cd},t.prototype.isEqual=function(e){if(!(e instanceof t))throw jc("isEqual","QuerySnapshot",1,e);return this.Id===e.Id&&fs(this.Sd,e.Sd)&&this.Dd.isEqual(e.Dd)&&this.ca===e.ca},t.prototype.$d=function(t,e,n){return new Dl(this.Id,t.key,t,e,n,this.ca)},t}(),Hl=function(t){function e(e,n,r){var i=this;if((i=t.call(this,os(e),n,r)||this).Nd=e,e.length%2!=1)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.$()+" has "+e.length);return i}return Object(i.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.bd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.bd.path.p();return t._()?null:new Pl(new jr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.bd.path.$()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){wc("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=mr.t()),Sc("CollectionReference.doc","non-empty string",1,t);var e=xr.N(t);return Pl.Td(this.bd.path.child(e),this.firestore,this.ca)},e.prototype.add=function(t){bc("CollectionReference.add",arguments,1),Sc("CollectionReference.add","object",1,this.ca?this.ca.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this.Nd,this.firestore,t)},e}(ql);function Kl(t,e){if(void 0===e)return{merge:!1};if(Pc(t,e,["merge","mergeFields"]),Tc(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+xc(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Cr(Tr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+xc(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof Uc}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new Cr(Tr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Gl(t,e){return void 0===e?{}:(Pc(t,e,["serverTimestamps"]),Cc(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Ql(t,e){Oc(t,"object",1,e),e&&(Pc(t,e,["source"]),Cc(t,0,"source",e.source,["default","server","cache"]))}function Yl(t,e,n){if(e instanceof eu){if(e.firestore!==n)throw new Cr(Tr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw jc(t,"DocumentReference",1,e)}function Xl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return hr()}}function Jl(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Zl,th={Firestore:Al,GeoPoint:Jc,Timestamp:Ir,Blob:Fc,Transaction:xl,WriteBatch:Nl,DocumentReference:Pl,DocumentSnapshot:Ml,Query:ql,QueryDocumentSnapshot:Dl,QuerySnapshot:zl,CollectionReference:Hl,FieldPath:Uc,FieldValue:Yc,setLogLevel:Al.setLogLevel,CACHE_SIZE_UNLIMITED:Cl};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t,e){t.INTERNAL.registerComponent(new or.a("firestore",(function(t){return function(t,e){return new Al(t,e,new wl)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},th)))})(Zl=r.a),Zl.registerVersion("@firebase/firestore","1.16.2");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var eh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},nh=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Object(i.c)(e,t),e}(Error);var rh=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then((function(t){return n.auth=t}),(function(){})),this.messaging||e.get().then((function(t){return n.messaging=t}),(function(){}))}return t.prototype.getAuthToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 3:return e.sent(),[2,void 0];case 4:return[2]}}))}))},t.prototype.getInstanceIdToken=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){if(!this.messaging||!("Notification"in self)||"granted"!==Notification.permission)return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]}))}))},t.prototype.getContext=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}}))}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ih(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var oh=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map((function(t){return e.encode(t)}));if("function"==typeof t||"object"==typeof t)return ih(t,(function(t){return e.encode(t)}));throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map((function(t){return e.decode(t)})):"function"==typeof t||"object"==typeof t?ih(t,(function(t){return e.decode(t)})):t},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sh=function(){function t(t,e,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=t,this.region_=r,this.serializer=new oh,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new rh(e,n),this.cancelAllRequests=new Promise((function(t){i.deleteService=function(){return t()}}))}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:n.append("Content-Type","application/json"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),[2,{status:0,json:null}];case 4:o=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,r.json()];case 6:return o=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,{status:r.status,json:o}]}}))}))},t.prototype.call=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a,c,u,l,h,f,p,d;return Object(i.d)(this,(function(i){switch(i.label){case 0:return r=this._url(t),e=this.serializer.encode(e),o={data:e},s=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=i.sent()).authToken&&s.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&s.append("Firebase-Instance-ID-Token",a.instanceIdToken),c=n.timeout||7e4,u=function(t){var e,n=new Promise((function(n,r){e=setTimeout((function(){r(new nh("deadline-exceeded","deadline-exceeded"))}),t)}));return{timer:e,promise:n}}(c),l=u.timer,h=u.promise,[4,Promise.race([ah(l,this.postJSON(r,o,s)),h,ah(l,this.cancelAllRequests)])];case 2:if(!(f=i.sent()))throw new nh("cancelled","Firebase Functions instance was deleted.");if(p=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var s=e&&e.error;if(s){var a=s.status;if("string"==typeof a){if(!eh[a])return new nh("internal","internal");r=eh[a],i=a}var c=s.message;"string"==typeof c&&(i=c),void 0!==(o=s.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new nh(r,i,o)}(f.status,f.json,this.serializer))throw p;if(!f.json)throw new nh("internal","Response is not valid JSON object.");if(void 0===(d=f.json.data)&&(d=f.json.result),void 0===d)throw new nh("internal","Response is missing data field.");return[2,{data:this.serializer.decode(d)}]}}))}))},t}();function ah(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=r.sent(),clearTimeout(t),[2,n]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new sh(n,r,i,e)}var uh,lh;function hh(t){return Array.prototype.slice.call(t)}function fh(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function ph(t,e,n){var r,i=new Promise((function(i,o){fh(r=t[e].apply(t,n)).then(i,o)}));return i.request=r,i}function dh(t,e,n){var r=ph(t,e,n);return r.then((function(t){if(t)return new _h(t,r.request)}))}function mh(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function yh(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return ph(this[e],r,arguments)})}))}function gh(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function vh(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return dh(this[e],r,arguments)})}))}function bh(t){this._index=t}function _h(t,e){this._cursor=t,this._request=e}function wh(t){this._store=t}function Sh(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function Oh(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new Sh(n)}function Eh(t){this._db=t}function Th(t,e,n){var r=ph(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new Oh(i.result,t.oldVersion,i.transaction))}),r.then((function(t){return new Eh(t)}))}function Ch(t){return ph(indexedDB,"deleteDatabase",[t])}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
uh=r.a,lh={Functions:sh},uh.INTERNAL.registerComponent(new or.a("functions",ch,"PUBLIC").setServiceProps(lh).setMultipleInstances(!0)),r.a.registerVersion("@firebase/functions","0.4.49"),mh(bh,"_index",["name","keyPath","multiEntry","unique"]),yh(bh,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),vh(bh,"_index",IDBIndex,["openCursor","openKeyCursor"]),mh(_h,"_cursor",["direction","key","primaryKey","value"]),yh(_h,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(_h.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,n),fh(e._request).then((function(t){if(t)return new _h(t,e._request)}))}))})})),wh.prototype.createIndex=function(){return new bh(this._store.createIndex.apply(this._store,arguments))},wh.prototype.index=function(){return new bh(this._store.index.apply(this._store,arguments))},mh(wh,"_store",["name","keyPath","indexNames","autoIncrement"]),yh(wh,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),vh(wh,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),gh(wh,"_store",IDBObjectStore,["deleteIndex"]),Sh.prototype.objectStore=function(){return new wh(this._tx.objectStore.apply(this._tx,arguments))},mh(Sh,"_tx",["objectStoreNames","mode"]),gh(Sh,"_tx",IDBTransaction,["abort"]),Oh.prototype.createObjectStore=function(){return new wh(this._db.createObjectStore.apply(this._db,arguments))},mh(Oh,"_db",["name","version","objectStoreNames"]),gh(Oh,"_db",IDBDatabase,["deleteObjectStore","close"]),Eh.prototype.transaction=function(){return new Sh(this._db.transaction.apply(this._db,arguments))},mh(Eh,"_db",["name","version","objectStoreNames"]),gh(Eh,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[wh,bh].forEach((function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=hh(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[bh,wh].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise((function(i){n.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)}))}))})}));var Ih,Ah=((Ih={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',Ih["not-registered"]="Firebase Installation is not registered.",Ih["installation-not-found"]="Firebase Installation not found.",Ih["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',Ih["app-offline"]="Could not process request. Application offline.",Ih["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",Ih),kh=new s.c("installations","Installations",Ah);function xh(t){return t instanceof s.d&&t.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nh(t){return"https://firebaseinstallations.googleapis.com/v1/projects/"+t.projectId+"/installations"}function Ph(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}function jh(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,kh.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function Rh(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Mh(t,e){var n=e.refreshToken,r=Rh(t);return r.append("Authorization",function(t){return"FIS_v2 "+t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)),r}function Dh(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return(e=n.sent()).status>=500&&e.status<600?[2,t()]:[2,e]}}))}))}function $h(t,e){var n=e.fid;return Object(i.b)(this,void 0,void 0,(function(){var e,r,o,s,a,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=Nh(t),r=Rh(t),o={fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:"w:0.4.15"},s={method:"POST",headers:r,body:JSON.stringify(o)},[4,Dh((function(){return fetch(e,s)}))];case 1:return(a=i.sent()).ok?[4,a.json()]:[3,3];case 2:return c=i.sent(),[2,{fid:c.fid||n,registrationStatus:2,refreshToken:c.refreshToken,authToken:Ph(c.authToken)}];case 3:return[4,jh("Create Installation",a)];case 4:throw i.sent()}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lh(t){return new Promise((function(e){setTimeout(e,t)}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Fh=/^[cdef][\w-]{21}$/;function Bh(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return(e=t,btoa(String.fromCharCode.apply(String,Object(i.f)(e))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t);return Fh.test(e)?e:""}catch(t){return""}}function Uh(t){return t.appName+"!"+t.appId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vh=new Map;function qh(t,e){var n=Uh(t);Wh(n,e),function(t,e){var n=Hh();n&&n.postMessage({key:t,fid:e});Kh()}(n,e)}function Wh(t,e){var n,r,o=Vh.get(t);if(o)try{for(var s=Object(i.h)(o),a=s.next();!a.done;a=s.next()){(0,a.value)(e)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}var zh=null;function Hh(){return!zh&&"BroadcastChannel"in self&&((zh=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(t){Wh(t.data.key,t.data.fid)}),zh}function Kh(){0===Vh.size&&zh&&(zh.close(),zh=null)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gh,Qh="firebase-installations-store",Yh=null;function Xh(){return Yh||(Yh=Th("firebase-installations-database",1,(function(t){switch(t.oldVersion){case 0:t.createObjectStore(Qh)}}))),Yh}function Jh(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=Uh(t),[4,Xh()];case 1:return r=i.sent(),o=r.transaction(Qh,"readwrite"),[4,(s=o.objectStore(Qh)).get(n)];case 2:return a=i.sent(),[4,s.put(e,n)];case 3:return i.sent(),[4,o.complete];case 4:return i.sent(),a&&a.fid===e.fid||qh(t,e.fid),[2,e]}}))}))}function Zh(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=Uh(t),[4,Xh()];case 1:return n=i.sent(),[4,(r=n.transaction(Qh,"readwrite")).objectStore(Qh).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function tf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=Uh(t),[4,Xh()];case 1:return r=i.sent(),o=r.transaction(Qh,"readwrite"),[4,(s=o.objectStore(Qh)).get(n)];case 2:return a=i.sent(),void 0!==(c=e(a))?[3,4]:[4,s.delete(n)];case 3:return i.sent(),[3,6];case 4:return[4,s.put(c,n)];case 5:i.sent(),i.label=6;case 6:return[4,o.complete];case 7:return i.sent(),!c||a&&a.fid===c.fid||qh(t,c.fid),[2,c]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(o){switch(o.label){case 0:return[4,tf(t,(function(n){var r=function(t){return of(t||{fid:Bh(),registrationStatus:0})}(n),o=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){var n=Promise.reject(kh.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,$h(t,e)];case 1:return n=i.sent(),[2,Jh(t,n)];case 2:return xh(r=i.sent())&&409===r.serverCode?[4,Zh(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,Jh(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(t,r);return{installationEntry:r,registrationPromise:o}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:nf(t)}:{installationEntry:e}}(t,r);return e=o.registrationPromise,o.installationEntry}))];case 1:return""!==(n=o.sent()).fid?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=o.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}}))}))}function nf(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,rf(t)];case 1:e=i.sent(),i.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,Lh(100)];case 3:return i.sent(),[4,rf(t)];case 4:return e=i.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,ef(t)];case 6:return n=i.sent(),r=n.installationEntry,(o=n.registrationPromise)?[2,o]:[2,r];case 7:return[2,e]}}))}))}function rf(t){return tf(t,(function(t){if(!t)throw kh.create("installation-not-found");return of(t)}))}function of(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function sf(t,e){var n=t.appConfig,r=t.platformLoggerProvider;return Object(i.b)(this,void 0,void 0,(function(){var t,o,s,a,c,u,l;return Object(i.d)(this,(function(i){switch(i.label){case 0:return t=function(t,e){var n=e.fid;return Nh(t)+"/"+n+"/authTokens:generate"}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n,e),o=Mh(n,e),(s=r.getImmediate({optional:!0}))&&o.append("x-firebase-client",s.getPlatformInfoString()),a={installation:{sdkVersion:"w:0.4.15"}},c={method:"POST",headers:o,body:JSON.stringify(a)},[4,Dh((function(){return fetch(t,c)}))];case 1:return(u=i.sent()).ok?[4,u.json()]:[3,3];case 2:return l=i.sent(),[2,Ph(l)];case 3:return[4,jh("Generate Auth Token",u)];case 4:throw i.sent()}}))}))}function af(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(s){switch(s.label){case 0:return[4,tf(t.appConfig,(function(r){if(!uf(r))throw kh.create("not-registered");var o=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(t)}(o))return r;if(1===o.requestStatus)return n=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,cf(t.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,Lh(100)];case 3:return i.sent(),[4,cf(t.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,af(t,e)]:[2,r]}}))}))}(t,e),r;if(!navigator.onLine)throw kh.create("app-offline");var s=function(t){var e={requestStatus:1,requestTime:Date.now()};return Object(i.a)(Object(i.a)({},t),{authToken:e})}(r);return n=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,8]),[4,sf(t,e)];case 1:return n=s.sent(),o=Object(i.a)(Object(i.a)({},e),{authToken:n}),[4,Jh(t.appConfig,o)];case 2:return s.sent(),[2,n];case 3:return!xh(r=s.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,Zh(t.appConfig)];case 4:return s.sent(),[3,7];case 5:return o=Object(i.a)(Object(i.a)({},e),{authToken:{requestStatus:0}}),[4,Jh(t.appConfig,o)];case 6:s.sent(),s.label=7;case 7:throw r;case 8:return[2]}}))}))}(t,s),s}))];case 1:return r=s.sent(),n?[4,n]:[3,3];case 2:return o=s.sent(),[3,4];case 3:o=r.authToken,s.label=4;case 4:return[2,o]}}))}))}function cf(t){return tf(t,(function(t){if(!uf(t))throw kh.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+1e4<Date.now()?Object(i.a)(Object(i.a)({},t),{authToken:{requestStatus:0}}):t}))}function uf(t){return void 0!==t&&2===t.registrationStatus}function lf(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,ef(t)];case 1:return(e=n.sent().registrationPromise)?[4,e]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e){var n=e.fid;return Nh(t)+"/"+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e),r=Mh(t,e),o={method:"DELETE",headers:r},[4,Dh((function(){return fetch(n,o)}))];case 1:return(s=i.sent()).ok?[3,3]:[4,jh("Delete Installation",s)];case 2:throw i.sent();case 3:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ff(t,e){var n=t.appConfig;return function(t,e){Hh();var n=Uh(t),r=Vh.get(n);r||(r=new Set,Vh.set(n,r)),r.add(e)}(n,e),function(){!function(t,e){var n=Uh(t),r=Vh.get(n);r&&(r.delete(e),0===r.size&&Vh.delete(n),Kh())}(n,e)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(t){return kh.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.INTERNAL.registerComponent(new or.a("installations",(function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw pf("App Configuration");if(!t.name)throw pf("App Name");try{for(var r=Object(i.h)(["projectId","apiKey","appId"]),o=r.next();!o.done;o=r.next()){var s=o.value;if(!t.options[s])throw pf(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,ef(t.appConfig)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):af(t).catch(console.error),[2,n.fid]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)},getToken:function(t){return function(t,e){return void 0===e&&(e=!1),Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,lf(t.appConfig)];case 1:return n.sent(),[4,af(t,e)];case 2:return[2,n.sent().token]}}))}))}(n,t)},delete:function(){return function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,tf(e=t.appConfig,(function(t){if(!t||0!==t.registrationStatus)return t}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw kh.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw kh.create("app-offline");case 3:return[4,hf(e,n)];case 4:return r.sent(),[4,Zh(e)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(n)},onIdChange:function(t){return ff(n,t)}}}),"PUBLIC")),t.registerVersion("@firebase/installations","0.4.15")}(r.a);var df=((Gh={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',Gh["only-available-in-window"]="This method is available in a Window context.",Gh["only-available-in-sw"]="This method is available in a service worker context.",Gh["permission-default"]="The notification permission was not granted and dismissed instead.",Gh["permission-blocked"]="The notification permission was not granted and blocked instead.",Gh["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",Gh["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",Gh["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",Gh["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",Gh["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",Gh["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",Gh["token-update-no-token"]="FCM returned no token when updating the user to push.",Gh["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",Gh["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",Gh["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",Gh["invalid-vapid-key"]="The public VAPID key must be a string.",Gh["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",Gh),mf=new s.c("messaging","Messaging",df);function yf(t){return mf.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gf,vf="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function bf(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Object(i.f)(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _f(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"}(gf||(gf={}));function wf(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r=this;return Object(i.d)(this,(function(o){switch(o.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(e=o.sent(),!e.map((function(t){return t.name})).includes("fcm_token_details_db"))return[2,null];o.label=2;case 2:return n=null,[4,Th("fcm_token_details_db",5,(function(e){return Object(i.b)(r,void 0,void 0,(function(){var r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e.oldVersion<2?[2]:e.objectStoreNames.contains("fcm_token_object_Store")?[4,(r=e.transaction.objectStore("fcm_token_object_Store")).index("fcmSenderId").get(t)]:[2];case 1:return o=i.sent(),[4,r.clear()];case 2:if(i.sent(),!o)return[2];if(2===e.oldVersion){if(!(s=o).auth||!s.p256dh||!s.endpoint)return[2];n={token:s.fcmToken,createTime:null!==(a=s.createTime)&&void 0!==a?a:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:bf(s.vapidKey)}}}else(3===e.oldVersion||4===e.oldVersion)&&(n={token:(s=o).fcmToken,createTime:s.createTime,subscriptionOptions:{auth:bf(s.auth),p256dh:bf(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:bf(s.vapidKey)}});return[2]}}))}))}))];case 3:return o.sent().close(),[4,Ch("fcm_token_details_db")];case 4:return o.sent(),[4,Ch("fcm_vapid_details_db")];case 5:return o.sent(),[4,Ch("undefined")];case 6:return o.sent(),[2,Sf(n)?n:null]}}))}))}function Sf(t){if(!t||!t.subscriptionOptions)return!1;var e=t.subscriptionOptions;return"number"==typeof t.createTime&&t.createTime>0&&"string"==typeof t.token&&t.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Of=null;function Ef(){return Of||(Of=Th("firebase-messaging-database",1,(function(t){switch(t.oldVersion){case 0:t.createObjectStore("firebase-messaging-store")}}))),Of}function Tf(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=Af(t),[4,Ef()];case 1:return[4,i.sent().transaction("firebase-messaging-store").objectStore("firebase-messaging-store").get(e)];case 2:return(n=i.sent())?[2,n]:[3,3];case 3:return[4,wf(t.appConfig.senderId)];case 4:return(r=i.sent())?[4,Cf(t,r)]:[3,6];case 5:return i.sent(),[2,r];case 6:return[2]}}))}))}function Cf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n=Af(t),[4,Ef()];case 1:return r=i.sent(),[4,(o=r.transaction("firebase-messaging-store","readwrite")).objectStore("firebase-messaging-store").put(e,n)];case 2:return i.sent(),[4,o.complete];case 3:return i.sent(),[2,e]}}))}))}function If(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return e=Af(t),[4,Ef()];case 1:return n=i.sent(),[4,(r=n.transaction("firebase-messaging-store","readwrite")).objectStore("firebase-messaging-store").delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function Af(t){return t.appConfig.appId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,jf(t)];case 1:n=i.sent(),r=Rf(e),o={method:"POST",headers:n,body:JSON.stringify(r)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Pf(t.appConfig),o)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw a=i.sent(),mf.create("token-subscribe-failed",{errorInfo:a});case 6:if(s.error)throw c=s.error.message,mf.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw mf.create("token-subscribe-no-token");return[2,s.token]}}))}))}function xf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a,c;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,jf(t)];case 1:n=i.sent(),r=Rf(e.subscriptionOptions),o={method:"PATCH",headers:n,body:JSON.stringify(r)},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Pf(t.appConfig)+"/"+e.token,o)];case 3:return[4,i.sent().json()];case 4:return s=i.sent(),[3,6];case 5:throw a=i.sent(),mf.create("token-update-failed",{errorInfo:a});case 6:if(s.error)throw c=s.error.message,mf.create("token-update-failed",{errorInfo:c});if(!s.token)throw mf.create("token-update-no-token");return[2,s.token]}}))}))}function Nf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,jf(t)];case 1:n=i.sent(),r={method:"DELETE",headers:n},i.label=2;case 2:return i.trys.push([2,5,,6]),[4,fetch(Pf(t.appConfig)+"/"+e,r)];case 3:return[4,i.sent().json()];case 4:if((o=i.sent()).error)throw s=o.error.message,mf.create("token-unsubscribe-failed",{errorInfo:s});return[3,6];case 5:throw a=i.sent(),mf.create("token-unsubscribe-failed",{errorInfo:a});case 6:return[2]}}))}))}function Pf(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.projectId+"/registrations"}function jf(t){var e=t.appConfig,n=t.installations;return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return t=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}}))}))}function Rf(t){var e=t.p256dh,n=t.auth,r=t.endpoint,i=t.vapidKey,o={web:{endpoint:r,auth:n,p256dh:e}};return i!==vf&&(o.web.applicationPubKey=i),o}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mf(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:if("granted"!==Notification.permission)throw mf.create("permission-blocked");return[4,Ff(e,n)];case 1:return r=i.sent(),[4,Tf(t)];case 2:return o=i.sent(),s={vapidKey:n,swScope:e.scope,endpoint:r.endpoint,auth:bf(r.getKey("auth")),p256dh:bf(r.getKey("p256dh"))},o?[3,3]:[2,Lf(t,s)];case 3:if(c=o.subscriptionOptions,l=(u=s).vapidKey===c.vapidKey,h=u.endpoint===c.endpoint,f=u.auth===c.auth,p=u.p256dh===c.p256dh,l&&h&&f&&p)return[3,8];i.label=4;case 4:return i.trys.push([4,6,,7]),[4,Nf(t,o.token)];case 5:return i.sent(),[3,7];case 6:return a=i.sent(),console.warn(a),[3,7];case 7:return[2,Lf(t,s)];case 8:return Date.now()>=o.createTime+6048e5?[2,$f({token:o.token,createTime:Date.now(),subscriptionOptions:s},t,e)]:[2,o.token];case 9:return[2]}var c,u,l,h,f,p;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}))}))}function Df(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Tf(t)];case 1:return(n=i.sent())?[4,Nf(t,n.token)]:[3,4];case 2:return i.sent(),[4,If(t)];case 3:i.sent(),i.label=4;case 4:return[4,e.pushManager.getSubscription()];case 5:return(r=i.sent())?[2,r.unsubscribe()]:[2,!0]}}))}))}function $f(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o,s;return Object(i.d)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,5]),[4,xf(e,t)];case 1:return r=a.sent(),o=Object(i.a)(Object(i.a)({},t),{token:r,createTime:Date.now()}),[4,Cf(e,o)];case 2:return a.sent(),[2,r];case 3:return s=a.sent(),[4,Df(e,n)];case 4:throw a.sent(),s;case 5:return[2]}}))}))}function Lf(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,kf(t,e)];case 1:return n=i.sent(),r={token:n,createTime:Date.now(),subscriptionOptions:e},[4,Cf(t,r)];case 2:return i.sent(),[2,r.token]}}))}))}function Ff(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,t.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_f(e)})]}}))}))}function Bf(t){return"object"==typeof t&&!!t&&"google.c.a.c_id"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uf=function(){function t(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",(function(t){return e.messageEventListener(t)}))}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.getToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return this.vapidKey||(this.vapidKey=vf),[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),"default"!==Notification.permission?[3,3]:[4,Notification.requestPermission()];case 2:e.sent(),e.label=3;case 3:if("granted"!==Notification.permission)throw mf.create("permission-blocked");return[2,Mf(this.firebaseDependencies,t,this.vapidKey)]}}))}))},t.prototype.deleteToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return[4,this.getServiceWorkerRegistration()];case 1:return t=e.sent(),[2,Df(this.firebaseDependencies,t)]}}))}))},t.prototype.requestPermission=function(){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(e){switch(e.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?mf.create("permission-blocked"):mf.create("permission-default")}}))}))},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw mf.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw mf.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw mf.create("invalid-sw-registration");if(this.swRegistration)throw mf.create("use-sw-after-get-token");this.swRegistration=t},t.prototype.onMessage=function(t){var e=this;return this.onMessageCallback=t,function(){e.onMessageCallback=null}},t.prototype.setBackgroundMessageHandler=function(){throw mf.create("only-available-in-sw")},t.prototype.onTokenRefresh=function(){return function(){}},t.prototype.getServiceWorkerRegistration=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:if(this.swRegistration)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),t=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 2:return t.swRegistration=n.sent(),this.swRegistration.update().catch((function(){})),[3,4];case 3:throw e=n.sent(),mf.create("failed-service-worker-registration",{browserErrorMessage:e.message});case 4:return[2,this.swRegistration]}}))}))},t.prototype.messageEventListener=function(t){var e;return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(null===(e=t.data)||void 0===e?void 0:e.firebaseMessaging)?(n=t.data.firebaseMessaging,r=n.type,o=n.payload,this.onMessageCallback&&r===gf.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(o):this.onMessageCallback.next(o)),Bf(s=o.data)&&"1"===s["google.c.a.e"]?[4,this.logEvent(r,s)]:[3,2]):[2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},t.prototype.logEvent=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return n=function(t){switch(t){case gf.NOTIFICATION_CLICKED:return"notification_open";case gf.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return r.sent().logEvent(n,{message_id:e["google.c.a.c_id"],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}}))}))},t}();function Vf(t){return new Promise((function(e){setTimeout(e,t)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qf=function(){function t(t){var e=this;this.firebaseDependencies=t,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",(function(t){t.waitUntil(e.onPush(t))})),self.addEventListener("pushsubscriptionchange",(function(t){t.waitUntil(e.onSubChange(t))})),self.addEventListener("notificationclick",(function(t){t.waitUntil(e.onNotificationClick(t))}))}return Object.defineProperty(t.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),t.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw mf.create("invalid-bg-handler");this.bgMessageHandler=t},t.prototype.getToken=function(){var t,e;return Object(i.b)(this,void 0,void 0,(function(){var n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return this.vapidKey?[3,2]:[4,Tf(this.firebaseDependencies)];case 1:n=r.sent(),this.vapidKey=null!==(e=null===(t=null==n?void 0:n.subscriptionOptions)||void 0===t?void 0:t.vapidKey)&&void 0!==e?e:vf,r.label=2;case 2:return[2,Mf(this.firebaseDependencies,self.registration,this.vapidKey)]}}))}))},t.prototype.deleteToken=function(){return Df(this.firebaseDependencies,self.registration)},t.prototype.requestPermission=function(){throw mf.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){if(null!==this.vapidKey)throw mf.create("use-vapid-key-after-get-token");if("string"!=typeof t||0===t.length)throw mf.create("invalid-vapid-key");this.vapidKey=t},t.prototype.useServiceWorker=function(){throw mf.create("only-available-in-window")},t.prototype.onMessage=function(){throw mf.create("only-available-in-window")},t.prototype.onTokenRefresh=function(){throw mf.create("only-available-in-window")},t.prototype.onPush=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r;return Object(i.d)(this,(function(o){switch(o.label){case 0:return(e=function(t){var e=t.data;if(!e)return null;try{return e.json()}catch(t){return null}}(t))?[4,Hf()]:[2];case 1:return function(t){return t.some((function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")}))}(n=o.sent())?[2,zf(n,e)]:(r=function(t){var e;if(!t||"object"!=typeof t.notification)return;var n=Object(i.a)({},t.notification);return n.data=Object(i.a)(Object(i.a)({},t.notification.data),((e={}).FCM_MSG=t,e)),n}(e))?[4,Gf(r)]:[3,3];case 2:return o.sent(),[3,5];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))},t.prototype.onSubChange=function(t){var e,n;return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return t.newSubscription?[3,2]:[4,Df(this.firebaseDependencies,self.registration)];case 1:return i.sent(),[2];case 2:return[4,Tf(this.firebaseDependencies)];case 3:return r=i.sent(),[4,Df(this.firebaseDependencies,self.registration)];case 4:return i.sent(),[4,Mf(this.firebaseDependencies,self.registration,null!==(n=null===(e=null==r?void 0:r.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==n?n:vf)];case 5:return i.sent(),[2]}}))}))},t.prototype.onNotificationClick=function(t){var e,n;return Object(i.b)(this,void 0,void 0,(function(){var r,o,s,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(r=null===(n=null===(e=t.notification)||void 0===e?void 0:e.data)||void 0===n?void 0:n.FCM_MSG)?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(o=function(t){var e,n,r,i=null!==(n=null===(e=t.fcmOptions)||void 0===e?void 0:e.link)&&void 0!==n?n:null===(r=t.notification)||void 0===r?void 0:r.click_action;if(i)return i;return Bf(t.data)?self.location.origin:null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(r))?[4,Wf(o)]:[2]):[2];case 1:return(s=i.sent())?[3,4]:[4,self.clients.openWindow(o)];case 2:return s=i.sent(),[4,Vf(3e3)];case 3:return i.sent(),[3,6];case 4:return[4,s.focus()];case 5:s=i.sent(),i.label=6;case 6:return s?(a=Kf(gf.NOTIFICATION_CLICKED,r),[2,s.postMessage(a)]):[2]}}))}))},t}();function Wf(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,a,c;return Object(i.d)(this,(function(u){switch(u.label){case 0:return e=new URL(t,self.location.href),[4,Hf()];case 1:n=u.sent();try{for(r=Object(i.h)(n),o=r.next();!o.done;o=r.next())if(s=o.value,new URL(s.url,self.location.href).host===e.host)return[2,s]}catch(t){a={error:t}}finally{try{o&&!o.done&&(c=r.return)&&c.call(r)}finally{if(a)throw a.error}}return[2,null]}}))}))}function zf(t,e){var n,r,o=Kf(gf.PUSH_RECEIVED,e);try{for(var s=Object(i.h)(t),a=s.next();!a.done;a=s.next()){a.value.postMessage(o)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}function Hf(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Kf(t,e){return{firebaseMessaging:{type:t,payload:e}}}function Gf(t){var e,n=null!==(e=t.title)&&void 0!==e?e:"",r=t.actions,i=Notification.maxActions;return r&&i&&r.length>i&&console.warn("This browser only supports "+i+" actions. The remaining actions will not be displayed."),self.registration.showNotification(n,t)}var Qf={isSupported:Yf};function Yf(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}r.a.INTERNAL.registerComponent(new or.a("messaging",(function(t){var e=t.getProvider("app").getImmediate(),n={app:e,appConfig:
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){var e,n;if(!t||!t.options)throw yf("App Configuration Object");if(!t.name)throw yf("App Name");var r=t.options;try{for(var o=Object(i.h)(["projectId","apiKey","appId","messagingSenderId"]),s=o.next();!s.done;s=o.next()){var a=s.value;if(!r[a])throw yf(a)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{appName:t.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(e),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!Yf())throw mf.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new qf(n):new Uf(n)}),"PUBLIC").setServiceProps(Qf));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xf=function(){function t(t,e){this.code_=yp(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return yp(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.serverResponse_?this.message_+"\n"+this.serverResponse_:this.message_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!1,configurable:!0}),t}(),Jf="unknown",Zf="object-not-found",tp="quota-exceeded",ep="unauthenticated",np="unauthorized",rp="retry-limit-exceeded",ip="canceled",op="invalid-url",sp="invalid-default-bucket",ap="cannot-slice-blob",cp="server-file-wrong-size",up="no-download-url",lp="invalid-argument",hp="invalid-argument-count",fp="app-deleted",pp="invalid-root-operation",dp="invalid-format",mp="internal-error";function yp(t){return"storage/"+t}function gp(){return new Xf(Jf,"An unknown error occurred, please check the error payload for server response.")}function vp(){return new Xf(ip,"User canceled the upload/download.")}function bp(){return new Xf(ap,"Cannot slice blob for upload. Please retry the upload.")}function _p(){return new Xf(up,"The given file does not have any download URLs.")}function wp(t,e,n){return new Xf(lp,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Sp(){return new Xf(fp,"The Firebase app was deleted.")}function Op(t,e){return new Xf(dp,"String does not match format '"+t+"': "+e)}function Ep(t){throw new Xf(mp,"Internal error: "+t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Cp(t){switch(t){case Tp.RAW:case Tp.BASE64:case Tp.BASE64URL:case Tp.DATA_URL:return;default:throw"Expected one of the event types: ["+Tp.RAW+", "+Tp.BASE64+", "+Tp.BASE64URL+", "+Tp.DATA_URL+"]."}}var Ip=function(t,e){this.data=t,this.contentType=e||null};function Ap(t,e){switch(t){case Tp.RAW:return new Ip(kp(e));case Tp.BASE64:case Tp.BASE64URL:return new Ip(xp(t,e));case Tp.DATA_URL:return new Ip((n=new Np(e)).base64?xp(Tp.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Op(Tp.DATA_URL,"Malformed data URL.")}return kp(e)}(n.rest),function(t){return new Np(t).contentType}(e))}var n;throw gp()}function kp(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function xp(t,e){switch(t){case Tp.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw Op(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Tp.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw Op(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(e){throw Op(t,"Invalid character found")}for(var a=new Uint8Array(s.length),c=0;c<s.length;c++)a[c]=s.charCodeAt(c);return a}var Np=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Op(Tp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var r,i;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */};var Pp,jp={STATE_CHANGED:"state_changed"},Rp="running",Mp="pausing",Dp="paused",$p="success",Lp="canceling",Fp="canceled",Bp="error",Up={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Vp(t){switch(t){case Rp:case Mp:case Lp:return Up.RUNNING;case Dp:return Up.PAUSED;case $p:return Up.SUCCESS;case Fp:return Up.CANCELED;case Bp:default:return Up.ERROR}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(t){return null!=t}function Wp(t){return void 0!==t}function zp(t){return"function"==typeof t}function Hp(t){return"object"==typeof t}function Kp(t){return Hp(t)&&null!==t}function Gp(t){return"string"==typeof t||t instanceof String}function Qp(t){return Yp(t)&&Number.isInteger(t)}function Yp(t){return"number"==typeof t||t instanceof Number}function Xp(t){return Jp()&&t instanceof Blob}function Jp(){return"undefined"!=typeof Blob}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(Pp||(Pp={}));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Zp=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Pp.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=Pp.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=Pp.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw Ep("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),qp(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return qp(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Ep("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Ep("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Ep("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){qp(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){qp(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),td=function(){function t(){}return t.prototype.createXhrIo=function(){return new Zp},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ed(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function nd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ed();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Jp())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var rd=function(){function t(t,e){var n=0,r="";Xp(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Xp(this.data_)){var r=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,e,n);return null===r?null:new t(r)}return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Jp()){var r=e.map((function(e){return e instanceof t?e.data_:e}));return new t(nd.apply(null,r))}var i=e.map((function(t){return Gp(t)?Ap(Tp.RAW,t).data:t.data_})),o=0;i.forEach((function(t){o+=t.byteLength}));var s=new Uint8Array(o),a=0;return i.forEach((function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]})),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}(),id=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw new Xf(sp,"Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function i(t){t.path_=decodeURIComponent(t.path)}for(var o="firebasestorage.googleapis.com".replace(/[.]/g,"\\."),s=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp("^https?://(?:storage.googleapis.com|storage.cloud.google.com)/([A-Za-z0-9.\\-_]+)/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:i}],a=0;a<s.length;a++){var c=s[a],u=c.regex.exec(e);if(u){var l=u[c.indices.bucket],h=u[c.indices.path];h||(h=""),n=new t(l,h),c.postModify(n);break}}if(null==n)throw function(t){return new Xf(op,"Invalid URL '"+t+"'.")}(e);return n},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function od(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return Hp(n=e)&&!Array.isArray(n)?e:null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sd(t,e){var n=e.split("/").filter((function(t){return t.length>0})).join("/");return 0===t.length?n:t+"/"+n}function ad(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(t){return"https://firebasestorage.googleapis.com/v0"+t}function ud(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(t,e){return e}var hd=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||ld},fd=null;function pd(){if(fd)return fd;var t=[];t.push(new hd("bucket")),t.push(new hd("generation")),t.push(new hd("metageneration")),t.push(new hd("name","fullPath",!0));var e=new hd("name");e.xform=function(t,e){return function(t){return!Gp(t)||t.length<2?t:ad(t)}(e)},t.push(e);var n=new hd("size");return n.xform=function(t,e){return qp(e)?Number(e):e},t.push(n),t.push(new hd("timeCreated")),t.push(new hd("updated")),t.push(new hd("md5Hash",null,!0)),t.push(new hd("cacheControl",null,!0)),t.push(new hd("contentDisposition",null,!0)),t.push(new hd("contentEncoding",null,!0)),t.push(new hd("contentLanguage",null,!0)),t.push(new hd("contentType",null,!0)),t.push(new hd("metadata","customMetadata",!0)),fd=t}function dd(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new id(n,r);return e.makeStorageReference(i)}})}(r,t),r}function md(t,e,n){var r=od(e);return null===r?null:dd(t,r,n)}function yd(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function gd(t){if(!Hp(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!Hp(n))throw"Expected object for 'customMetadata' mapping."}else if(Kp(n))throw"Mapping for '"+e+"' cannot be an object."}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(t,e,n){var r=od(n);return null===r?null:function(t,e,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,o=n.prefixes;i<o.length;i++){var s=o[i].replace(/\/$/,""),a=t.makeStorageReference(new id(e,s));r.prefixes.push(a)}if(n.items)for(var c=0,u=n.items;c<u.length;c++){var l=u[c];a=t.makeStorageReference(new id(e,l.name));r.items.push(a)}return r}(t,e,r)}function bd(t){if(!Hp(t)||!t)throw"Expected ListOptions object.";for(var e in t)if("maxResults"===e){if(!Qp(t.maxResults)||t.maxResults<=0)throw"Expected maxResults to be a positive number.";if(t.maxResults>1e3)throw"Expected maxResults to be less than or equal to 1000."}else{if("pageToken"!==e)throw"Unknown option: "+e;if(t.pageToken&&!Gp(t.pageToken))throw"Expected pageToken to be string."}}var _d=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(t){if(!t)throw gp()}function Sd(t,e){return function(n,r){var i=md(t,r,e);return wd(null!==i),i}}function Od(t,e){return function(n,r){var i=md(t,r,e);return wd(null!==i),function(t,e){var n=od(e);if(null===n)return null;if(!Gp(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(e){var n=t.bucket,r=t.fullPath;return cd("/b/"+i(n)+"/o/"+i(r))+ud({alt:"media",token:e})}))[0]}(i,r)}}function Ed(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new Xf(ep,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new Xf(tp,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new Xf(np,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function Td(t){var e=Ed(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Xf(Zf,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function Cd(t,e,n){var r=cd(e.fullServerUrl()),i=t.maxOperationRetryTime,o=new _d(r,"GET",Sd(t,n),i);return o.errorHandler=Td(e),o}function Id(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var s=cd(e.bucketOnlyServerUrl()),a=t.maxOperationRetryTime,c=new _d(s,"GET",function(t,e){return function(n,r){var i=vd(t,e,r);return wd(null!==i),i}}(t,e.bucket),a);return c.urlParams=o,c.errorHandler=Ed(e),c}function Ad(t,e,n){var r=cd(e.fullServerUrl()),i=t.maxOperationRetryTime,o=new _d(r,"GET",Od(t,n),i);return o.errorHandler=Td(e),o}function kd(t,e,n,r){var i=cd(e.fullServerUrl()),o=yd(n,r),s=t.maxOperationRetryTime,a=new _d(i,"PATCH",Sd(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=Td(e),a}function xd(t,e){var n=cd(e.fullServerUrl()),r=t.maxOperationRetryTime;var i=new _d(n,"DELETE",(function(t,e){}),r);return i.successCodes=[200,204],i.errorHandler=Td(e),i}function Nd(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var Pd=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function jd(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){wd(!1)}return wd(!!n&&-1!==(e||["active"]).indexOf(n)),n}function Rd(t,e,n,r,i,o,s,a){var c=new Pd(0,0);if(s?(c.current=s.current,c.total=s.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Xf(cp,"Server recorded incorrect upload file size, please retry the upload.");var u=c.total-c.current,l=u;i>0&&(l=Math.min(l,i));var h=c.current,f=h+l,p={"X-Goog-Upload-Command":l===u?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=r.slice(h,f);if(null===d)throw bp();var m=e.maxUploadRetryTime,y=new _d(n,"POST",(function(t,n){var i,s=jd(t,["active","final"]),a=c.current+l,u=r.size();return i="final"===s?Sd(e,o)(t,n):null,new Pd(a,u,"final"===s,i)}),m);return y.headers=p,y.body=d.uploadData(),y.progressCallback=a||null,y.errorHandler=Ed(t),y}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Md=function(t,e,n){if(zp(t)||qp(e)||qp(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},Dd=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $d(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var s,a,c,u,l,h;if(!(r<=n.length&&n.length<=i))throw s=r,a=i,c=t,u=n.length,s===a?(l=s,h=1===s?"argument":"arguments"):(l="between "+s+" and "+a,h="arguments"),new Xf(hp,"Invalid argument count in `"+c+"`: Expected "+l+" "+h+", received "+u+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?wp(o,t,e.message):wp(o,t,e)}}var Ld=function(t,e){var n=this;this.validator=function(e){n.optional&&!Wp(e)||t(e)},this.optional=!!e};function Fd(t,e){function n(t){if(!Gp(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new Ld(r,e)}function Bd(){return new Ld((function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Jp()&&t instanceof Blob))throw"Expected Blob or File."}))}function Ud(t){return new Ld(gd,t)}function Vd(t){return new Ld(bd,t)}function qd(){return new Ld((function(t){if(!(Yp(t)&&t>=0))throw"Expected a number 0 or greater."}))}function Wd(t,e){return new Ld((function(e){if(!(null===e||qp(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)}),e)}function zd(t){return new Ld((function(t){if(!(null===t||zp(t)))throw"Expected a Function."}),t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kd=function(){function t(t,e,n,r,i,o){var s=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.service_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Rp,this.errorHandler_=function(t){s.request_=null,s.chunkMultiplier_=1,t.codeEquals(ip)?(s.needToFetchStatus_=!0,s.completeTransitions_()):(s.error_=t,s.transition_(Bp))},this.metadataErrorHandler_=function(t){s.request_=null,t.codeEquals(ip)?s.completeTransitions_():(s.error_=t,s.transition_(Bp))},this.promise_=new Promise((function(t,e){s.resolve_=t,s.reject_=e,s.start_()})),this.promise_.then(null,(function(){}))}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===Rp&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.service_.getAuthToken().then((function(n){switch(e.state_){case Rp:t(n);break;case Lp:e.transition_(Fp);break;case Mp:e.transition_(Dp)}}))},t.prototype.createResumable_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=Nd(e,r,i),a={name:s.fullPath},c=cd(o),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},l=yd(s,n),h=t.maxUploadRetryTime,f=new _d(c,"POST",(function(t){var e;jd(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){wd(!1)}return wd(Gp(e)),e}),h);return f.urlParams=a,f.headers=u,f.body=l,f.errorHandler=Ed(e),f}(t.service_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.service_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_((function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime,o=new _d(n,"POST",(function(t){var e=jd(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){wd(!1)}n||wd(!1);var i=Number(n);return wd(!isNaN(i)),new Pd(i,r.size(),"final"===e)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=Ed(e),o}(t.service_,t.location_,e,t.blob_),i=t.service_.makeRequest(r,n);t.request_=i,i.getPromise().then((function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new Pd(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var o;try{o=Rd(t.location_,t.service_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(Bp)}var s=t.service_.makeRequest(o,i);t.request_=s,s.getPromise().then((function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_($p)):t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_((function(e){var n=Cd(t.service_,t.location_,t.mappings_),r=t.service_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.transition_($p)}),t.metadataErrorHandler_)}))},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var c=Nd(e,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+yd(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=rd.getBlob(u,r,l);if(null===h)throw bp();var f={name:c.fullPath},p=cd(o),d=t.maxUploadRetryTime,m=new _d(p,"POST",Sd(t,n),d);return m.urlParams=f,m.headers=s,m.body=h.uploadData(),m.errorHandler=Ed(e),m}(t.service_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.service_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_($p)}),t.errorHandler_)}))},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Lp:case Mp:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Rp:var e=this.state_===Dp;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Dp:this.state_=t,this.notifyObservers_();break;case Fp:this.error_=vp(),this.state_=t,this.notifyObservers_();break;case Bp:case $p:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Mp:this.transition_(Dp);break;case Lp:this.transition_(Fp);break;case Rp:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Vp(this.state_);return new Dd(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,r){function i(){if(t!==jp.STATE_CHANGED)throw"Expected one of the event types: ["+jp.STATE_CHANGED+"]."}var o="Expected a function or an Object with one of `next`, `error`, `complete` properties.",s=zd(!0).validator,a=Wd(null,!0).validator;function c(t){try{return void s(t)}catch(t){}try{if(a(t),!(Wp(t.next)||Wp(t.error)||Wp(t.complete)))throw"";return}catch(t){throw o}}var u=[Fd(i),Wd(c,!0),zd(!0),zd(!0)];$d("on",u,arguments);var l=this;function h(t){return function(e,n,i){null!==t&&$d("on",t,arguments);var o=new Md(e,n,r);return l.addObserver_(o),function(){l.removeObserver_(o)}}}function f(t){if(null===t)throw o;c(t)}var p=[Wd(f),zd(!0),zd(!0)],d=!(Wp(e)||Wp(n)||Wp(r));return d?h(p):h(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach((function(e){t.notifyObserver_(e)}))},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Vp(this.state_)){case Up.SUCCESS:Hd(this.resolve_.bind(null,this.snapshot))();break;case Up.CANCELED:case Up.ERROR:Hd(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Vp(this.state_)){case Up.RUNNING:case Up.PAUSED:t.next&&Hd(t.next.bind(t,this.snapshot))();break;case Up.SUCCESS:t.complete&&Hd(t.complete.bind(t))();break;case Up.CANCELED:case Up.ERROR:t.error&&Hd(t.error.bind(t,this.error_))();break;default:t.error&&Hd(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){$d("resume",[],arguments);var t=this.state_===Dp||this.state_===Mp;return t&&this.transition_(Rp),t},t.prototype.pause=function(){$d("pause",[],arguments);var t=this.state_===Rp;return t&&this.transition_(Mp),t},t.prototype.cancel=function(){$d("cancel",[],arguments);var t=this.state_===Rp||this.state_===Mp;return t&&this.transition_(Lp),t},t}(),Gd=function(){function t(t,e){this.service=t,this.location=e instanceof id?e:id.makeFromUrl(e)}return t.prototype.toString=function(){return $d("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return pd()},t.prototype.child=function(t){$d("child",[Fd()],arguments);var e=sd(this.location.path,t),n=new id(this.location.bucket,e);return this.newRef(this.service,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new id(this.location.bucket,t);return this.newRef(this.service,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new id(this.location.bucket,"");return this.newRef(this.service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return ad(this.location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.service},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),$d("put",[Bd(),Ud(!0)],arguments),this.throwIfRoot_("put"),new Kd(this,this.service,this.location,this.mappings(),new rd(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=Tp.RAW),$d("putString",[Fd(),Fd(Cp,!0),Ud(!0)],arguments),this.throwIfRoot_("putString");var r=Ap(e,t),i=Object.assign({},n);return!qp(i.contentType)&&qp(r.contentType)&&(i.contentType=r.contentType),new Kd(this,this.service,this.location,this.mappings(),new rd(r.data,!0),i)},t.prototype.delete=function(){var t=this;return $d("delete",[],arguments),this.throwIfRoot_("delete"),this.service.getAuthToken().then((function(e){var n=xd(t.service,t.location);return t.service.makeRequest(n,e).getPromise()}))},t.prototype.listAll=function(){$d("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then((function(){return t}))},t.prototype.listAllHelper=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=i.sent(),(o=t.prefixes).push.apply(o,r.prefixes),(s=t.items).push.apply(s,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.list=function(t){$d("list",[Vd(!0)],arguments);var e=this;return this.service.getAuthToken().then((function(n){var r=t||{},i=Id(e.service,e.location,"/",r.pageToken,r.maxResults);return e.service.makeRequest(i,n).getPromise()}))},t.prototype.getMetadata=function(){var t=this;return $d("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.service.getAuthToken().then((function(e){var n=Cd(t.service,t.location,t.mappings());return t.service.makeRequest(n,e).getPromise()}))},t.prototype.updateMetadata=function(t){var e=this;return $d("updateMetadata",[Ud()],arguments),this.throwIfRoot_("updateMetadata"),this.service.getAuthToken().then((function(n){var r=kd(e.service,e.location,t,e.mappings());return e.service.makeRequest(r,n).getPromise()}))},t.prototype.getDownloadURL=function(){var t=this;return $d("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.service.getAuthToken().then((function(e){var n=Ad(t.service,t.location,t.mappings());return t.service.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw _p();return t}))}))},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Xf(pp,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),Qd=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yd=function(){function t(t,e,n,r,i,o,s,a,c,u,l){var h=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=u,this.timeout_=c,this.pool_=l,this.promise_=new Promise((function(t,e){h.resolve_=t,h.reject_=e,h.start_()}))}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());Wp(a)?i(a):i()}catch(t){o(t)}else null!==s?((r=gp()).setServerResponseProp(s.getResponseText()),t.errorCallback_?o(t.errorCallback_(s,r)):o(r)):n.canceled?o(r=t.appDelete_?Sp():vp()):o(r=new Xf(rp,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Xd(!1,null,!0)):this.backoffId_=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){var r=1,o=null,s=!1,a=0;function c(){return 2===a}var u=!1;function l(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){o=setTimeout((function(){o=null,t(f,c())}),e)}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!u)if(t)l.call.apply(l,Object(i.g)([null,t],e));else{var o,f=c()||s;if(f)l.call.apply(l,Object(i.g)([null,t],e));else r<64&&(r*=2),1===a?(a=2,o=0):o=1e3*(r+Math.random()),h(o)}}var p=!1;function d(t){p||(p=!0,u||(null!==o?(t||(a=2),clearTimeout(o),h(0)):t||(a=1)))}return h(0),setTimeout((function(){s=!0,d(!0)}),n),d}((function(e,n){if(n)e(!1,new Xd(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===Pp.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var s=-1!==t.successCodes_.indexOf(o);e(!0,new Xd(s,n))}else{var a=n.getErrorCode()===Pp.ABORT;e(!1,new Xd(!1,null,a))}}))}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}}),e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),Xd=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function Jd(t,e,n,i){var o=ud(t.urlParams),s=t.url+o,a=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(a,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(a,n),function(t){var e=void 0!==r.a?r.a.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(a),new Yd(s,t.method,a,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zd=function(){function t(e,n,r,i){var o;this.bucket_=null,this.appId_=null,this.deleted_=!1,this.app_=e,this.authProvider_=n,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requests_=new Set,this.pool_=r,this.bucket_=null!=i?id.makeFromBucketSpec(i):t.extractBucket_(null===(o=this.app_)||void 0===o?void 0:o.options),this.internals_=new tm(this)}return t.extractBucket_=function(t){var e=null==t?void 0:t.storageBucket;return null==e?null:id.makeFromBucketSpec(e)},t.prototype.getAuthToken=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return(t=this.authProvider_.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}}))}))},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requests_.forEach((function(t){return t.cancel()})),this.requests_.clear()},t.prototype.makeStorageReference=function(t){return new Gd(this,t)},t.prototype.makeRequest=function(t,e){var n=this;if(this.deleted_)return new Qd(Sp());var r=Jd(t,this.appId_,e,this.pool_);return this.requests_.add(r),r.getPromise().then((function(){return n.requests_.delete(r)}),(function(){return n.requests_.delete(r)})),r},t.prototype.ref=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}if($d("ref",[Fd(e,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var n=new Gd(this,this.bucket_);return null!=t?n.child(t):n},t.prototype.refFromURL=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{id.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}}return $d("refFromURL",[Fd(e,!1)],arguments),new Gd(this,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.maxUploadRetryTime_},enumerable:!1,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){$d("setMaxUploadRetryTime",[qd()],arguments),this.maxUploadRetryTime_=t},Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this.maxOperationRetryTime_},enumerable:!1,configurable:!0}),t.prototype.setMaxOperationRetryTime=function(t){$d("setMaxOperationRetryTime",[qd()],arguments),this.maxOperationRetryTime_=t},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!1,configurable:!0}),t}(),tm=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.deleteApp(),Promise.resolve()},t}();function em(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new Zd(n,r,new td,e)}!function(t){var e={TaskState:Up,TaskEvent:jp,StringFormat:Tp,Storage:Zd,Reference:Gd};t.INTERNAL.registerComponent(new or.a("storage",em,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion("@firebase/storage","0.3.41")}(r.a);var nm,rm,im,om,sm=((nm={})["trace started"]="Trace {$traceName} was started before.",nm["trace stopped"]="Trace {$traceName} is not running.",nm["no window"]="Window is not available.",nm["no app id"]="App id is not available.",nm["no project id"]="Project id is not available.",nm["no api key"]="Api key is not available.",nm["invalid cc log"]="Attempted to queue invalid cc event",nm["FB not default"]="Performance can only start when Firebase app instance is the default one.",nm["RC response not ok"]="RC response is not ok",nm["invalid attribute name"]="Attribute name {$attributeName} is invalid.",nm["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",nm["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",nm["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",nm),am=new s.c("performance","Performance",sm),cm=function(){function t(t){if(this.window=t,!t)throw am.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}})).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===rm&&(rm=new t(im)),rm},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function um(t,e){var n=t.length-e.length;if(n<0||n>1)throw am.create("invalid String merger input");for(var r=[],i=0;i<t.length;i++)r.push(t.charAt(i)),e.length>i&&r.push(e.charAt(i));return r.join("")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lm,hm,fm=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=um("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=um("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw am.create("no app id");return t},t.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw am.create("no project id");return t},t.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw am.create("no api key");return t},t.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},t.getInstance=function(){return void 0===om&&(om=new t),om},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pm(){return lm}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN"}(hm||(hm={}));var dm=["firebase_","google_","ga_"],mm=new RegExp("^[a-zA-Z]\\w*$");function ym(){var t=cm.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}function gm(){switch(cm.getInstance().document.visibilityState){case"visible":return hm.VISIBLE;case"hidden":return hm.HIDDEN;default:return hm.UNKNOWN}}function vm(){var t=cm.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bm=new o.b("Performance");bm.logLevel=o.a.INFO;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _m=!0;function wm(t){var e=function(){var t=cm.getInstance().localStorage;if(!t)return;var e=t.getItem("@firebase/performance/configexpire");if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem("@firebase/performance/config");if(!r)return;try{return JSON.parse(r)}catch(t){return}}();return e?(Sm(e),Promise.resolve()):function(t){return(e=fm.getInstance().installationsService.getToken(),e.then((function(t){})),e).then((function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+fm.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+fm.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:fm.getInstance().getAppId(),app_version:"0.3.10",sdk_version:"0.0.1"})});return fetch(r).then((function(t){if(t.ok)return t.json();throw am.create("RC response not ok")}))})).catch((function(){bm.info("Could not fetch config, will use default configs")}));var e;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(t).then(Sm).then((function(t){return function(t){var e=cm.getInstance().localStorage;if(!t||!e)return;e.setItem("@firebase/performance/config",JSON.stringify(t)),e.setItem("@firebase/performance/configexpire",String(Date.now()+60*fm.getInstance().configTimeToLive*60*1e3))}(t)}),(function(){}))}function Sm(t){if(!t)return t;var e=fm.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=_m,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(e.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Om(e.tracesSamplingRate),e.logNetworkAfterSampling=Om(e.networkRequestsSamplingRate),t}function Om(t){return Math.random()<=t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Em,Tm=1;function Cm(){return Tm=2,Em=Em||function(){var t=cm.getInstance().document;return new Promise((function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()}))}().then((function(){return(t=fm.getInstance().installationsService.getId()).then((function(t){lm=t})),t;var t})).then((function(t){return wm(t)})).then((function(){return Im()}),(function(){return Im()}))}function Im(){Tm=3}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Am,km=3,xm=[],Nm=!1;function Pm(t){setTimeout((function(){if(0!==km)return xm.length?void function(){var t=Object(i.g)(xm);xm=[];var e=t.map((function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}}));(function(t,e){return function(t){var e=fm.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(t)})}(t).then((function(t){return t.ok||bm.info("Call to Firebase backend failed."),t.json()})).then((function(t){var n=Number(t.nextRequestWaitMillis),r=1e4;isNaN(n)||(r=Math.max(n,r));var o=t.logResponseDetails;Array.isArray(o)&&o.length>0&&"RETRY_REQUEST_LATER"===o[0].responseAction&&(xm=Object(i.g)(e,xm),bm.info("Retry transport request later.")),km=3,Pm(r)}))})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:fm.getInstance().logSource,log_event:e},t).catch((function(){xm=Object(i.g)(t,xm),km--,bm.info("Tries left: "+km+"."),Pm(1e4)}))}():Pm(1e4)}),t)}function jm(t){if(!t.eventTime||!t.message)throw am.create("invalid cc log");xm=Object(i.g)(xm,[t])}function Rm(t,e){Am||(Am=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.apply(void 0,e);jm({message:r,eventTime:Date.now()})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */($m)),Am(t,e)}function Mm(t){var e=fm.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&cm.getInstance().requiredApisAvailable()&&(t.isAuto&&gm()!==hm.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===Tm?Dm(t):Cm().then((function(){return Dm(t)}),(function(){return Dm(t)}))))}function Dm(t){pm()&&setTimeout((function(){return Rm(t,1)}),0)}function $m(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:Lm(),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:Lm(),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function Lm(){return{google_app_id:fm.getInstance().getAppId(),app_instance_id:pm(),web_app_info:{sdk_version:"0.3.10",page_url:cm.getInstance().getUrl(),service_worker_status:ym(),visibility_state:gm(),effective_connection_type:vm()},application_process_state:0}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fm=["_fp","_fcp","_fid"];
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Bm=function(){function t(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=cm.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||"FB-PERF-TRACE-MEASURE-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw am.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw am.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Mm(this)},t.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=Object(i.a)({},n.attributes)),n&&n.metrics)for(var r=0,o=Object.keys(n.metrics);r<o.length;r++){var s=o[r];isNaN(Number(n.metrics[s]))||(this.counters[s]=Number(Math.floor(n.metrics[s])))}Mm(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},t.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||t.length>100)&&(e&&e.startsWith("_wt_")&&Fm.indexOf(t)>-1||!t.startsWith("_"))}(t,this.name))throw am.create("invalid custom metric name",{customMetricName:t});this.counters[t]=e},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n=function(t){return!(0===t.length||t.length>40)&&(!dm.some((function(e){return t.startsWith(e)}))&&!!t.match(mm))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw am.create("invalid attribute name",{attributeName:t});if(!r)throw am.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return Object(i.a)({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r){var i=cm.getInstance().getUrl();if(i){var o=new t("_wt_"+i,!0),s=Math.floor(1e3*cm.getInstance().getTimeOrigin());o.setStartTime(s),e&&e[0]&&(o.setDuration(Math.floor(1e3*e[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*e[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*e[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*e[0].loadEventEnd)));if(n){var a=n.find((function(t){return"first-paint"===t.name}));a&&a.startTime&&o.putMetric("_fp",Math.floor(1e3*a.startTime));var c=n.find((function(t){return"first-contentful-paint"===t.name}));c&&c.startTime&&o.putMetric("_fcp",Math.floor(1e3*c.startTime)),r&&o.putMetric("_fid",Math.floor(1e3*r))}Mm(o)}},t.createUserTimingTrace=function(e){Mm(new t(e,!1,e))},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Um(t){var e=t;if(e&&void 0!==e.responseStart){var n=cm.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=fm.getInstance();if(e.instrumentationEnabled){var n=t.url,r=e.logEndPointUrl.split("?")[0],i=e.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout((function(){return Rm(t,0)}),0)}}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vm(){pm()&&(setTimeout((function(){return function(){var t=cm.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout((function(){Bm.createOobTrace(e,n),r=void 0}),5e3);t.onFirstInputDelay((function(t){r&&(clearTimeout(r),Bm.createOobTrace(e,n,t))}))}else Bm.createOobTrace(e,n)}()}),0),setTimeout((function(){return function(){for(var t=cm.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){Um(r[n])}t.setupObserver("resource",Um)}()}),0),setTimeout((function(){return function(){for(var t=cm.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){qm(r[n])}t.setupObserver("measure",qm)}()}),0))}function qm(t){var e=t.name;"FB-PERF-TRACE-MEASURE"!==e.substring(0,"FB-PERF-TRACE-MEASURE".length)&&Bm.createUserTimingTrace(e)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wm=function(){function t(t){this.app=t,cm.getInstance().requiredApisAvailable()?(Nm||(Pm(5500),Nm=!0),Cm().then(Vm,Vm)):bm.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return t.prototype.trace=function(t){return new Bm(t)},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return fm.getInstance().instrumentationEnabled},set:function(t){fm.getInstance().instrumentationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return fm.getInstance().dataCollectionEnabled},set:function(t){fm.getInstance().dataCollectionEnabled=t},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){var e=function(t,e){if("[DEFAULT]"!==t.name)throw am.create("FB not default");if("undefined"==typeof window)throw am.create("no window");return function(t){im=t}(window),fm.getInstance().firebaseAppInstance=t,fm.getInstance().installationsService=e,new Wm(t)};t.INTERNAL.registerComponent(new or.a("performance",(function(t){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();return e(n,r)}),"PUBLIC")),t.registerVersion("@firebase/performance","0.3.10")}(r.a);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var zm,Hm,Km="https://www.googletagmanager.com/gtag/js";!function(t){t.EVENT="event",t.SET="set",t.CONFIG="config"}(zm||(zm={})),function(t){t.ADD_SHIPPING_INFO="add_shipping_info",t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SELECT_ITEM="select_item",t.SELECT_PROMOTION="select_promotion",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_CART="view_cart",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results"}(Hm||(Hm={}));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Gm,Qm=new o.b("@firebase/analytics");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ym(t,e,n){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];window[e].push(arguments)};return window[n]&&"function"==typeof window[n]&&(r=window[n]),window[n]=function(t,e){return function(n,r,i){if(n===zm.EVENT){var o=[];if(i&&i.send_to){var s=i.send_to;Array.isArray(s)||(s=[s]);for(var a=0,c=s;a<c.length;a++){var u=c[a],l=e[u];if(!l){o=[];break}o.push(l)}}if(0===o.length)for(var h=0,f=Object.values(e);h<f.length;h++){var p=f[h];o.push(p)}Promise.all(o).then((function(){return t(zm.EVENT,r,i||{})})).catch((function(t){return Qm.error(t)}))}else if(n===zm.CONFIG){(e[r]||Promise.resolve()).then((function(){t(zm.CONFIG,r,i)})).catch((function(t){return Qm.error(t)}))}else t(zm.SET,r)}}(r,t),{gtagCore:r,wrappedGtag:window[n]}}var Xm,Jm,Zm=((Gm={})["no-ga-id"]='"measurementId" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',Gm["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",Gm["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Gm["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",Gm["indexedDB-unsupported"]="IndexedDB is not supported by current browswer",Gm["invalid-indexedDB-context"]="Environment doesn't support IndexedDB: {$errorInfo}. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments",Gm["cookies-not-enabled"]="Cookies are not enabled in this browser environment. Analytics requires cookies to be enabled.",Gm),ty=new s.c("analytics","Analytics",Zm),ey={},ny="dataLayer",ry="gtag",iy=!1;function oy(t){if(iy)throw ty.create("already-initialized");t.dataLayerName&&(ny=t.dataLayerName),t.gtagName&&(ry=t.gtagName)}function sy(t,e){if(!Object(s.f)())throw ty.create("cookies-not-enabled");if(!Object(s.w)())throw ty.create("indexedDB-unsupported");Object(s.N)().catch((function(t){throw ty.create("invalid-indexedDB-context",{errorInfo:t})}));var n=t.options.measurementId;if(!n)throw ty.create("no-ga-id");if(null!=ey[n])throw ty.create("already-exists",{id:n});if(!iy){(function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(Km))return r}return null}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)()||function(t){var e=document.createElement("script");e.src=Km+"?l="+t,e.async=!0,document.head.appendChild(e)}(ny),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(ny);var r=Ym(ey,ny,ry),o=r.wrappedGtag,a=r.gtagCore;Jm=o,Xm=a,iy=!0}return ey[n]=function(t,e,n){return Object(i.b)(this,void 0,void 0,(function(){var r,o;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,e.getId()];case 1:return r=i.sent(),n("js",new Date),n(zm.CONFIG,t.options.measurementId,((o={}).firebase_id=r,o.origin="firebase",o.update=!0,o)),[2]}}))}))}(t,e,Xm),{app:t,logEvent:function(t,e,r){
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(t,e,n,r,o){var s=r||{};o&&o.global||(s=Object(i.a)(Object(i.a)({},r),{send_to:e})),t(zm.EVENT,n,s||{})}(Jm,n,t,e,r)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(zm.SET,{screen_name:n}):t(zm.CONFIG,e,{update:!0,screen_name:n})}(Jm,n,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(zm.SET,{user_id:n}):t(zm.CONFIG,e,{update:!0,user_id:n})}(Jm,n,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,s=Object.keys(n);o<s.length;o++){var a=s[o];i["user_properties."+a]=n[a]}t(zm.SET,i)}else t(zm.CONFIG,e,{update:!0,user_properties:n})}(Jm,n,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(n,t)}}}function ay(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:if(!Object(s.f)())return[2,!1];if(!Object(s.w)())return[2,!1];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Object(s.N)()];case 2:return[2,t.sent()];case 3:return t.sent(),[2,!1];case 4:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t.INTERNAL.registerComponent(new or.a("analytics",(function(t){return sy(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:oy,EventName:Hm,isSupported:ay})),t.INTERNAL.registerComponent(new or.a("analytics-internal",(function(t){try{return{logEvent:t.getProvider("analytics").getImmediate().logEvent}}catch(t){throw ty.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),t.registerVersion("@firebase/analytics","0.4.1")}(r.a);var cy,uy=function(){function t(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}return t.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=i.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(t.cacheMaxAgeMillis,n)?[2,r]:(t.eTag=r&&r.eTag,[4,this.client.fetch(t)]);case 2:return o=i.sent(),s=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===o.status&&s.push(this.storage.setLastSuccessfulFetchResponse(o)),[4,Promise.all(s)];case 3:return i.sent(),[2,o]}}))}))},t}(),ly=((cy={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",cy["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",cy["registration-api-key"]="Undefined API key. Check Firebase app initialization.",cy["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",cy["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",cy["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",cy["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",cy["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",cy["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",cy["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',cy["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',cy["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",cy["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",cy),hy=new s.c("remoteconfig","Remote Config",ly);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var fy=function(){function t(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n,r,o,s,a,c,u,l,h,f,p,d,m,y,g,v,b,_;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=i.sent(),n=e[0],r=e[1],o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",s=o+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":t.eTag||"*"},c={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:(void 0===w&&(w=navigator),w.languages&&w.languages[0]||w.language)},u={method:"POST",headers:a,body:JSON.stringify(c)},l=fetch(s,u),h=new Promise((function(e,n){t.signal.addEventListener((function(){var t=new Error("The operation was aborted.");t.name="AbortError",n(t)}))})),i.label=2;case 2:return i.trys.push([2,5,,6]),[4,Promise.race([l,h])];case 3:return i.sent(),[4,l];case 4:return f=i.sent(),[3,6];case 5:throw p=i.sent(),d="fetch-client-network","AbortError"===p.name&&(d="fetch-timeout"),hy.create(d,{originalErrorMessage:p.message});case 6:if(m=f.status,y=f.headers.get("ETag")||void 0,200!==f.status)return[3,11];b=void 0,i.label=7;case 7:return i.trys.push([7,9,,10]),[4,f.json()];case 8:return b=i.sent(),[3,10];case 9:throw _=i.sent(),hy.create("fetch-client-parse",{originalErrorMessage:_.message});case 10:g=b.entries,v=b.state,i.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===v?m=500:"NO_CHANGE"===v?m=304:"NO_TEMPLATE"!==v&&"EMPTY_CONFIG"!==v||(g={}),304!==m&&200!==m)throw hy.create("fetch-status",{httpStatus:m});return[2,{status:m,eTag:y,config:g}]}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var w}))}))},t}(),py=function(){function t(){this.listeners=[]}return t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.abort=function(){this.listeners.forEach((function(t){return t()}))},t}(),dy=["1","true","t","yes","y","on"],my=function(){function t(t,e){void 0===e&&(e=""),this._source=t,this._value=e}return t.prototype.asString=function(){return this._value},t.prototype.asBoolean=function(){return"static"!==this._source&&dy.indexOf(this._value.toLowerCase())>=0},t.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},t.prototype.getSource=function(){return this._source},t}(),yy=function(){function t(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return t.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=o.a.DEBUG;break;case"silent":this._logger.logLevel=o.a.SILENT;break;default:this._logger.logLevel=o.a.ERROR}},Object.defineProperty(t.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),t.prototype.activate=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return t=r.sent(),e=t[0],n=t[1],e&&e.config&&e.eTag&&e.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(e.config),this._storage.setActiveConfigEtag(e.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}}))}))},t.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then((function(){t._isInitializationComplete=!0}))),this._initializePromise},t.prototype.fetch=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r=this;return Object(i.d)(this,(function(o){switch(o.label){case 0:t=new py,setTimeout((function(){return Object(i.b)(r,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return t.abort(),[2]}))}))}),this.settings.fetchTimeoutMillis),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:t})];case 2:return o.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return o.sent(),[3,6];case 4:return e=o.sent(),c="fetch-throttle",n=(a=e)instanceof s.d&&-1!==a.code.indexOf(c)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw o.sent(),e;case 6:return[2]}var a,c}))}))},t.prototype.fetchAndActivate=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}}))}))},t.prototype.getAll=function(){var t=this;return function(t,e){void 0===t&&(t={});void 0===e&&(e={});return Object.keys(Object(i.a)(Object(i.a)({},t),e))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._storageCache.getActiveConfig(),this.defaultConfig).reduce((function(e,n){return e[n]=t.getValue(n),e}),{})},t.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},t.prototype.getNumber=function(t){return this.getValue(t).asNumber()},t.prototype.getString=function(t){return this.getValue(t).asString()},t.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new my("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new my("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new my("static"))},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(t,e){var n=t.target.error||void 0;return hy.create(e,{originalErrorMessage:n&&n.message})}var vy=function(){function t(t,e,n,r){void 0===r&&(r=new Promise((function(t,e){var n=indexedDB.open("firebase_remote_config",1);n.onerror=function(t){e(gy(t,"storage-open"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore("app_namespace_store",{keyPath:"compositeKey"})}}}))),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}return t.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},t.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},t.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},t.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},t.prototype.getActiveConfig=function(){return this.get("active_config")},t.prototype.setActiveConfig=function(t){return this.set("active_config",t)},t.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},t.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},t.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},t.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},t.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},t.prototype.get=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction(["app_namespace_store"],"readonly").objectStore("app_namespace_store"),s=n.createCompositeKey(t);try{var a=o.get(s);a.onerror=function(t){i(gy(t,"storage-get"))},a.onsuccess=function(t){var e=t.target.result;r(e?e.value:void 0)}}catch(t){i(hy.create("storage-get",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.set=function(t,e){return Object(i.b)(this,void 0,void 0,(function(){var n,r=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,this.openDbPromise];case 1:return n=i.sent(),[2,new Promise((function(i,o){var s=n.transaction(["app_namespace_store"],"readwrite").objectStore("app_namespace_store"),a=r.createCompositeKey(t);try{var c=s.put({compositeKey:a,value:e});c.onerror=function(t){o(gy(t,"storage-set"))},c.onsuccess=function(){i()}}catch(t){o(hy.create("storage-set",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.delete=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e,n=this;return Object(i.d)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return e=r.sent(),[2,new Promise((function(r,i){var o=e.transaction(["app_namespace_store"],"readwrite").objectStore("app_namespace_store"),s=n.createCompositeKey(t);try{var a=o.delete(s);a.onerror=function(t){i(gy(t,"storage-delete"))},a.onsuccess=function(){r()}}catch(t){i(hy.create("storage-delete",{originalErrorMessage:t&&t.message}))}}))]}}))}))},t.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},t}(),by=function(){function t(t){this.storage=t}return t.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},t.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},t.prototype.getActiveConfig=function(){return this.activeConfig},t.prototype.loadFromStorage=function(){return Object(i.b)(this,void 0,void 0,(function(){var t,e,n,r,o,s;return Object(i.d)(this,(function(i){switch(i.label){case 0:return t=this.storage.getLastFetchStatus(),e=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,t];case 1:return(r=i.sent())&&(this.lastFetchStatus=r),[4,e];case 2:return(o=i.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,n];case 3:return(s=i.sent())&&(this.activeConfig=s),[2]}}))}))},t.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},t.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},t.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wy(t,e){return new Promise((function(n,r){var i=Math.max(e-Date.now(),0),o=setTimeout(n,i);t.addEventListener((function(){clearTimeout(o),r(hy.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}var Sy,Oy=function(){function t(t,e){this.client=t,this.storage=e}return t.prototype.fetch=function(t){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.d)(this,(function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(t,e)]}}))}))},t.prototype.attemptFetch=function(t,e){var n=e.throttleEndTimeMillis,r=e.backoffCount;return Object(i.b)(this,void 0,void 0,(function(){var e,o,a;return Object(i.d)(this,(function(i){switch(i.label){case 0:return[4,wy(t.signal,n)];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,5,,7]),[4,this.client.fetch(t)];case 3:return e=i.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return i.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof s.d))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(o=i.sent()))throw o;return a={throttleEndTimeMillis:Date.now()+_y(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(a)];case 6:return i.sent(),[2,this.attemptFetch(t,a)];case 7:return[2]}}))}))},t}();(Sy=r.a).INTERNAL.registerComponent(new or.a("remoteConfig",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw hy.create("registration-window");var i=n.options,s=i.projectId,a=i.apiKey,c=i.appId;if(!s)throw hy.create("registration-project-id");if(!a)throw hy.create("registration-api-key");if(!c)throw hy.create("registration-app-id");e=e||"firebase";var u=new vy(c,n.name,e),l=new by(u),h=new o.b("@firebase/remote-config");h.logLevel=o.a.ERROR;var f=new fy(r,Sy.SDK_VERSION,e,s,a,c),p=new Oy(f,u),d=new uy(p,u,l,h),m=new yy(n,d,l,u,h);return m.ensureInitialized(),m}),"PUBLIC").setMultipleInstances(!0)),Sy.registerVersion("@firebase/remote-config","0.1.26");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
r.a.registerVersion("firebase","7.17.1","app");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport * as firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),r.a.registerVersion("firebase","7.17.1")},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){const{routerConfig:r}=n(246),i=n(526),o=n(244);var s=n(1420);e.handler=r({POST:async(t,e,n)=>{const r=JSON.parse(t.body),a={email:r.email,name:r.name,username:r.username,videos:0,uploadedVideos:[],subscriptions:[],likes:[],dislikes:[],subscribers:0,imageUrl:s.url(r.email)};try{await i.signUp(r.email,r.password);let t=await o.create(a),e=await i.getUserToken();n(null,{statusCode:200,body:JSON.stringify({user:t._doc,token:e})})}catch(t){n(null,{statusCode:400,error:t.code})}}})},function(t,e,n){t.exports=n(1421)},function(t,e,n){var r=n(1422),i=n(247),o=/^[0-9a-f]{32}$/;function s(t,e){if(t)return"boolean"==typeof t.protocol?t.protocol:"http"!==t.protocol&&("https"===t.protocol||void 0)}function a(t){return(t="string"==typeof t?t.trim().toLowerCase():"unspecified").match(o)?t:r(t)}function c(t){var e=i.stringify(function(t){var e={},n={protocol:1,format:1};for(var r in t)n[r]||(e[r]=t[r]);return e}(t));return e&&"?"+e||""}t.exports={url:function(t,e,n){var r="//www.gravatar.com/avatar/";e&&e.cdn?(r=e.cdn+"/avatar/",delete e.cdn):(e&&e.protocol&&(n=s(e)),void 0!==n&&(r=n?"https://s.gravatar.com/avatar/":"http://www.gravatar.com/avatar/"));var i=c(e);return r+a(t)+i},profile_url:function(t,e,n){var r=null!=e&&null!=e.format?String(e.format):"json";if(e&&e.cdn)i=e.cdn+"/",delete e.cdn;else{e&&e.protocol&&(n=s(e));var i=n?"https://secure.gravatar.com/":"http://www.gravatar.com/"}var o=c(e);return i+a(t)+"."+r+o}}},function(t,e,n){var r;!function(i){"use strict";function o(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function s(t,e,n,r,i,s){return o((a=o(o(e,t),o(r,s)))<<(c=i)|a>>>32-c,n);var a,c}function a(t,e,n,r,i,o,a){return s(e&n|~e&r,t,e,i,o,a)}function c(t,e,n,r,i,o,a){return s(e&r|n&~r,t,e,i,o,a)}function u(t,e,n,r,i,o,a){return s(e^n^r,t,e,i,o,a)}function l(t,e,n,r,i,o,a){return s(n^(e|~r),t,e,i,o,a)}function h(t,e){var n,r,i,s,h;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var f=1732584193,p=-271733879,d=-1732584194,m=271733878;for(n=0;n<t.length;n+=16)r=f,i=p,s=d,h=m,f=a(f,p,d,m,t[n],7,-680876936),m=a(m,f,p,d,t[n+1],12,-389564586),d=a(d,m,f,p,t[n+2],17,606105819),p=a(p,d,m,f,t[n+3],22,-1044525330),f=a(f,p,d,m,t[n+4],7,-176418897),m=a(m,f,p,d,t[n+5],12,1200080426),d=a(d,m,f,p,t[n+6],17,-1473231341),p=a(p,d,m,f,t[n+7],22,-45705983),f=a(f,p,d,m,t[n+8],7,1770035416),m=a(m,f,p,d,t[n+9],12,-1958414417),d=a(d,m,f,p,t[n+10],17,-42063),p=a(p,d,m,f,t[n+11],22,-1990404162),f=a(f,p,d,m,t[n+12],7,1804603682),m=a(m,f,p,d,t[n+13],12,-40341101),d=a(d,m,f,p,t[n+14],17,-1502002290),f=c(f,p=a(p,d,m,f,t[n+15],22,1236535329),d,m,t[n+1],5,-165796510),m=c(m,f,p,d,t[n+6],9,-1069501632),d=c(d,m,f,p,t[n+11],14,643717713),p=c(p,d,m,f,t[n],20,-373897302),f=c(f,p,d,m,t[n+5],5,-701558691),m=c(m,f,p,d,t[n+10],9,38016083),d=c(d,m,f,p,t[n+15],14,-660478335),p=c(p,d,m,f,t[n+4],20,-405537848),f=c(f,p,d,m,t[n+9],5,568446438),m=c(m,f,p,d,t[n+14],9,-1019803690),d=c(d,m,f,p,t[n+3],14,-187363961),p=c(p,d,m,f,t[n+8],20,1163531501),f=c(f,p,d,m,t[n+13],5,-1444681467),m=c(m,f,p,d,t[n+2],9,-51403784),d=c(d,m,f,p,t[n+7],14,1735328473),f=u(f,p=c(p,d,m,f,t[n+12],20,-1926607734),d,m,t[n+5],4,-378558),m=u(m,f,p,d,t[n+8],11,-2022574463),d=u(d,m,f,p,t[n+11],16,1839030562),p=u(p,d,m,f,t[n+14],23,-35309556),f=u(f,p,d,m,t[n+1],4,-1530992060),m=u(m,f,p,d,t[n+4],11,1272893353),d=u(d,m,f,p,t[n+7],16,-155497632),p=u(p,d,m,f,t[n+10],23,-1094730640),f=u(f,p,d,m,t[n+13],4,681279174),m=u(m,f,p,d,t[n],11,-358537222),d=u(d,m,f,p,t[n+3],16,-722521979),p=u(p,d,m,f,t[n+6],23,76029189),f=u(f,p,d,m,t[n+9],4,-640364487),m=u(m,f,p,d,t[n+12],11,-421815835),d=u(d,m,f,p,t[n+15],16,530742520),f=l(f,p=u(p,d,m,f,t[n+2],23,-995338651),d,m,t[n],6,-198630844),m=l(m,f,p,d,t[n+7],10,1126891415),d=l(d,m,f,p,t[n+14],15,-1416354905),p=l(p,d,m,f,t[n+5],21,-57434055),f=l(f,p,d,m,t[n+12],6,1700485571),m=l(m,f,p,d,t[n+3],10,-1894986606),d=l(d,m,f,p,t[n+10],15,-1051523),p=l(p,d,m,f,t[n+1],21,-2054922799),f=l(f,p,d,m,t[n+8],6,1873313359),m=l(m,f,p,d,t[n+15],10,-30611744),d=l(d,m,f,p,t[n+6],15,-1560198380),p=l(p,d,m,f,t[n+13],21,1309151649),f=l(f,p,d,m,t[n+4],6,-145523070),m=l(m,f,p,d,t[n+11],10,-1120210379),d=l(d,m,f,p,t[n+2],15,718787259),p=l(p,d,m,f,t[n+9],21,-343485551),f=o(f,r),p=o(p,i),d=o(d,s),m=o(m,h);return[f,p,d,m]}function f(t){var e,n="",r=32*t.length;for(e=0;e<r;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function p(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;var r=8*t.length;for(e=0;e<r;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function d(t){var e,n,r="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),r+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return r}function m(t){return unescape(encodeURIComponent(t))}function y(t){return function(t){return f(h(p(t),8*t.length))}(m(t))}function g(t,e){return function(t,e){var n,r,i=p(t),o=[],s=[];for(o[15]=s[15]=void 0,i.length>16&&(i=h(i,8*t.length)),n=0;n<16;n+=1)o[n]=909522486^i[n],s[n]=1549556828^i[n];return r=h(o.concat(p(e)),512+8*e.length),f(h(s.concat(r),640))}(m(t),m(e))}function v(t,e,n){return e?n?g(e,t):d(g(e,t)):n?y(t):d(y(t))}void 0===(r=function(){return v}.call(e,n,e,t))||(t.exports=r)}()}]));